<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>Cyber Apocalypse CTF 2022 | Welcome to Chovid99&#39;s Blog</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta property="og:title" content="Cyber Apocalypse CTF 2022" />
<meta property="og:description" content="Writeup of Cyber Apocalypse CTF 2022 by Chovid99" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chovid99.github.io/posts/cyber-apocalypse-ctf-2022/" /><meta property="og:image" content="https://chovid99.github.io/site-feature-image.jpeg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-19T22:00:19+07:00" />
<meta property="article:modified_time" content="2022-05-19T22:00:19+07:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image:src" content="https://chovid99.github.io/site-feature-image.jpeg"/>

<meta name="twitter:title" content="Cyber Apocalypse CTF 2022"/>
<meta name="twitter:description" content="Writeup of Cyber Apocalypse CTF 2022 by Chovid99"/>
<meta name="twitter:site" content="@Chovid99"/>
<meta name="twitter:creator" content="@Chovid99"/>
<meta property="og:site_name" content="Chovid99's Blog">

<meta name="generator" content="Hugo 0.95.0" />


  <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">


<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/tocbot.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />


  <script async src="https://www.googletagmanager.com/gtag/js?id=G-19HP521HQ9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-19HP521HQ9');
  </script>



  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '\\[', right: '\\[', display: true}, {left: '$', right: '$', display: false}, {left: '\\(', right: '\\)', display: false}]});"></script>






  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">←</span>Home</a>
	
	<a href="/posts">Posts</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">Cyber Apocalypse CTF 2022</h1>

    <div class="tip">
        <time datetime="2022-05-19 22:00:19 &#43;0700 &#43;0700">May 19, 2022</time>
        <span class="split">
          ·
        </span>
        <span>
          3158 words
        </span>
        <span class="split">
          ·
        </span>
        <span>
          15 minute read
        </span>
    </div>

    <div class="content">
      <div class="post-content js-toc-content">
        <p><p class="markdown-image">
  <img src="https://i.imgur.com/cGQswC4.jpg" alt=""  />
</p>
On this CTF, I only worked on the crypto challenges. I managed to solve two crypto challenges. Here is my writeup for those challenges.</p>
<h1 id="crypto">Crypto <a href="#crypto" class="anchor">#</a></h1>
<h2 id="down-the-rabinhole-325-pt">Down the Rabinhole (325 pt) <a href="#down-the-rabinhole-325-pt" class="anchor">#</a></h2>
<h3 id="initial-analysis">Initial Analysis <a href="#initial-analysis" class="anchor">#</a></h3>
<p>We were given two files,</p>
<p><code>source.py</code></p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">Crypto.Util.number</span> <span style="color:#069;font-weight:bold">import</span> getPrime, isPrime, bytes_to_long
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">Crypto.Util.Padding</span> <span style="color:#069;font-weight:bold">import</span> pad
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">os</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FLAG <span style="color:#555">=</span> <span style="color:#c30">b</span><span style="color:#c30">&#34;HTB{--REDACTED--}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">getPrimes</span>(coefficient):
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">while</span> <span style="color:#069;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span>        a <span style="color:#555">=</span> getPrime(<span style="color:#f60">512</span>)
</span></span><span style="display:flex;"><span>        p <span style="color:#555">=</span> <span style="color:#f60">3</span> <span style="color:#555">*</span> coefficient <span style="color:#555">*</span> a <span style="color:#555">+</span> <span style="color:#f60">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> isPrime(p):
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">while</span> <span style="color:#069;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span>        b <span style="color:#555">=</span> getPrime(<span style="color:#f60">512</span>)
</span></span><span style="display:flex;"><span>        q <span style="color:#555">=</span> <span style="color:#f60">3</span> <span style="color:#555">*</span> coefficient <span style="color:#555">*</span> b <span style="color:#555">+</span> <span style="color:#f60">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> isPrime(q):
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> p, q
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">encrypt</span>(message, coefficient):
</span></span><span style="display:flex;"><span>    p, q <span style="color:#555">=</span> getPrimes(coefficient)
</span></span><span style="display:flex;"><span>    n <span style="color:#555">=</span> p <span style="color:#555">*</span> q
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    padded_message <span style="color:#555">=</span> bytes_to_long(pad(message, <span style="color:#f60">64</span>))
</span></span><span style="display:flex;"><span>    message <span style="color:#555">=</span> bytes_to_long(message)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    c1 <span style="color:#555">=</span> (message <span style="color:#555">*</span> (message <span style="color:#555">+</span> coefficient)) <span style="color:#555">%</span> n
</span></span><span style="display:flex;"><span>    c2 <span style="color:#555">=</span> (padded_message <span style="color:#555">*</span> (padded_message <span style="color:#555">+</span> coefficient)) <span style="color:#555">%</span> n
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> (n, c1, c2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">main</span>():
</span></span><span style="display:flex;"><span>    coefficient <span style="color:#555">=</span> getPrime(<span style="color:#f60">128</span>)
</span></span><span style="display:flex;"><span>    out <span style="color:#555">=</span> <span style="color:#c30">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    message <span style="color:#555">=</span> FLAG[<span style="color:#f60">0</span>:<span style="color:#366">len</span>(FLAG)<span style="color:#555">//</span><span style="color:#f60">2</span>]
</span></span><span style="display:flex;"><span>    n1, c1, c2 <span style="color:#555">=</span> encrypt(message, coefficient)
</span></span><span style="display:flex;"><span>    out <span style="color:#555">+=</span> <span style="color:#c30">f</span><span style="color:#c30">&#34;</span><span style="color:#a00">{</span>n1<span style="color:#a00">}</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#a00">{</span>c1<span style="color:#a00">}</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#a00">{</span>c2<span style="color:#a00">}</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    message <span style="color:#555">=</span> FLAG[<span style="color:#366">len</span>(FLAG)<span style="color:#555">//</span><span style="color:#f60">2</span>:]
</span></span><span style="display:flex;"><span>    n2, c3, c4 <span style="color:#555">=</span> encrypt(message, coefficient)
</span></span><span style="display:flex;"><span>    out <span style="color:#555">+=</span> <span style="color:#c30">f</span><span style="color:#c30">&#34;</span><span style="color:#a00">{</span>n2<span style="color:#a00">}</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#a00">{</span>c3<span style="color:#a00">}</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#a00">{</span>c4<span style="color:#a00">}</span><span style="color:#c30">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">with</span> <span style="color:#366">open</span>(<span style="color:#c30">&#34;out.txt&#34;</span>, <span style="color:#c30">&#34;w&#34;</span>) <span style="color:#069;font-weight:bold">as</span> f:
</span></span><span style="display:flex;"><span>        f<span style="color:#555">.</span>write(out)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">if</span> __name__ <span style="color:#555">==</span> <span style="color:#c30">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></td></tr></table>
</div>
</div><p>and <code>out.txt</code></p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>59695566410375916085091065597867624599396247120105936423853186912270957035981683790353782357813780840261434564512137529316306287245132306537487688075992115491809442873176686026221661043777720872604111654524551850568278941757944240802222861051514726510684250078771979880364039814240006038057748087210740783689350438039317498789505078530402846140787188830971536805605748267334628057592989
</span></span><span style="display:flex;"><span>206131769237721955001530863959688756686125485413899261197125641745745636359058664398433013356663394210624150086689905532
</span></span><span style="display:flex;"><span>14350341133918883930676906390648724486852266960811870561648194176794020698141189777337348951219934072588842789694987397861496993878758159916334335632468891342228755755695273096621152247970509517996580512069034691932835017774636881861331636331496873041705094768329156701838193429109420730982051593645140188946
</span></span><span style="display:flex;"><span>56438641309774959123579452414864548345708278641778632906871133633348990457713200426806112132039095059800662176837023585166134224681069774331148738554157081531312104961252755406614635488382297434171375724135403083446853715913787796744272218693049072693460001363598351151832646947233969595478647666992523249343972394051106514947235445828889363124242280013397047951812688863313932909903047
</span></span><span style="display:flex;"><span>429546912004731012886527767254149694574730322956287028161761007271362927652041138366004560890773167255588200792979452452
</span></span><span style="display:flex;"><span>29903904396126887576044949247400308530425862142675118500848365445245957090320752747039056821346410855821626622960719507094119542088455732058232895757115241568569663893434035594991241152575495936972994239671806350060725033375704703416762794475486000391074743029264587481673930383986479738961452214727157980946
</span></span></code></pre></td></tr></table>
</div>
</div><p>Okay, so what this challenge do is basically:</p>
<ul>
<li>Split the flag to two parts</li>
<li>Generate $\text{coeff}$ which is a prime ~$128$ bits</li>
<li>Use this $\text{coeff}$ to generate a new prime which fulfill $\text{prime}=3.\text{coeff}.a +2$</li>
<li>Use those generated primes to encrypt the partial flag with RSA.
<ul>
<li>Each part got encrypted twice, the first one is without padding, and the second one is with padding</li>
</ul>
</li>
<li>And then, they provide us with $n_{1}, c_{1}, c_{2}, n_{2}, c_{3}, c_{4}$</li>
</ul>
<p>So, with the given informations, we need to be able decrypt our flag.</p>
<h3 id="solution">Solution <a href="#solution" class="anchor">#</a></h3>
<p>Let&rsquo;s try to create equations from the given source code on generating $n_{1}$ and $n_{2}$ ($c = \text{coeff}$).</p>
<p>$$
\begin{align*}
\tag{1}
n_1 &amp;= p_1q_1 \\
&amp;= (3ca_{11} + 2)(3ca_{12} + 2) \\
&amp;= 9a_{11}a_{12}c^2 + 6c(a_{11}+a_{12}) + 4 \\
(n_1 - 4) &amp;= 9a_{11}a_{12}c^2 + 6c(a_{11}+a_{12}) \\
(n_1 - 4) &amp;= 3c(3a_{11}a_{12}c + 2(a_{11}+a_{12})) \\
\end{align*}
$$</p>
<p>$$
\begin{align*}
\tag{2}
n_2 &amp;= p_2q_2 \\
&amp;= (3ca_{21} + 2)(3ca_{22} + 2)\\
&amp;= 9a_{21}a_{22}c^2 + 6c(a_{21}+a_{22}) + 4\\
(n_2 - 4) &amp;= 9a_{21}a_{22}c^2 + 6c(a_{21}+a_{22})\\
(n_2 - 4) &amp;= 3c(3a_{21}a_{22}c + 2(a_{21}+a_{22}))\\
\end{align*}
$$</p>
<p>Notice that both of them share common factors (which is $c$). $GCD$ both equations can help us to retrieve the $\text{coeff}$ value, because both of them share common factors $c$. Just do $GCD(n_1-4, n_2-4)$, factorize it, and take the prime which has ~$128$ bits (Because $\text{coeff}$ size is ~$128$ bits). Based on the given output, we get $\text{coeff} = GCD(n_1-4, n_2-4)//9$.</p>
<p>Now we have $\text{coeff}$. Now let re-visit the code on the encryption:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">encrypt</span>(message, coefficient):
</span></span><span style="display:flex;"><span>    p, q <span style="color:#555">=</span> getPrimes(coefficient)
</span></span><span style="display:flex;"><span>    n <span style="color:#555">=</span> p <span style="color:#555">*</span> q
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    padded_message <span style="color:#555">=</span> bytes_to_long(pad(message, <span style="color:#f60">64</span>))
</span></span><span style="display:flex;"><span>    message <span style="color:#555">=</span> bytes_to_long(message)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    c1 <span style="color:#555">=</span> (message <span style="color:#555">*</span> (message <span style="color:#555">+</span> coefficient)) <span style="color:#555">%</span> n
</span></span><span style="display:flex;"><span>    c2 <span style="color:#555">=</span> (padded_message <span style="color:#555">*</span> (padded_message <span style="color:#555">+</span> coefficient)) <span style="color:#555">%</span> n
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> (n, c1, c2)
</span></span></code></pre></td></tr></table>
</div>
</div><p>$n$ is ~$1280$ bits. And $c_1=m*(m+\text{coeff}) \mod n$. Notice that if $m$ bits is less than $640$ bits (~$80$ chars), we actually can ignore the mod operation, because $m*(m+\text{coeff})$ is less than $n$. I don&rsquo;t think that the partial flag length will be larger than 80 chars, so I think we can actually solve the equations.</p>
<p>So let&rsquo;s try to solve this quadratic equation $n = m*(m+\text{coeff})$. Turn out, we successfully retrieve the flag by solving those quadratic equations on each part.</p>
<h3 id="full-script">Full Script <a href="#full-script" class="anchor">#</a></h3>
<p>I use sage to solve the solution</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">Crypto.Util.number</span> <span style="color:#069;font-weight:bold">import</span> <span style="color:#555">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>n1 <span style="color:#555">=</span> <span style="color:#f60">59695566410375916085091065597867624599396247120105936423853186912270957035981683790353782357813780840261434564512137529316306287245132306537487688075992115491809442873176686026221661043777720872604111654524551850568278941757944240802222861051514726510684250078771979880364039814240006038057748087210740783689350438039317498789505078530402846140787188830971536805605748267334628057592989</span>
</span></span><span style="display:flex;"><span>c1 <span style="color:#555">=</span> <span style="color:#f60">206131769237721955001530863959688756686125485413899261197125641745745636359058664398433013356663394210624150086689905532</span>
</span></span><span style="display:flex;"><span>c2 <span style="color:#555">=</span> <span style="color:#f60">14350341133918883930676906390648724486852266960811870561648194176794020698141189777337348951219934072588842789694987397861496993878758159916334335632468891342228755755695273096621152247970509517996580512069034691932835017774636881861331636331496873041705094768329156701838193429109420730982051593645140188946</span>
</span></span><span style="display:flex;"><span>n2 <span style="color:#555">=</span> <span style="color:#f60">56438641309774959123579452414864548345708278641778632906871133633348990457713200426806112132039095059800662176837023585166134224681069774331148738554157081531312104961252755406614635488382297434171375724135403083446853715913787796744272218693049072693460001363598351151832646947233969595478647666992523249343972394051106514947235445828889363124242280013397047951812688863313932909903047</span>
</span></span><span style="display:flex;"><span>c3 <span style="color:#555">=</span> <span style="color:#f60">429546912004731012886527767254149694574730322956287028161761007271362927652041138366004560890773167255588200792979452452</span>
</span></span><span style="display:flex;"><span>c4 <span style="color:#555">=</span> <span style="color:#f60">29903904396126887576044949247400308530425862142675118500848365445245957090320752747039056821346410855821626622960719507094119542088455732058232895757115241568569663893434035594991241152575495936972994239671806350060725033375704703416762794475486000391074743029264587481673930383986479738961452214727157980946</span>
</span></span><span style="display:flex;"><span>coeff <span style="color:#555">=</span> gcd(n1<span style="color:#555">-</span><span style="color:#f60">4</span>, n2<span style="color:#555">-</span><span style="color:#f60">4</span>) <span style="color:#555">//</span> <span style="color:#f60">9</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m1 <span style="color:#555">=</span> var(<span style="color:#c30">&#39;m1&#39;</span>)
</span></span><span style="display:flex;"><span>m2 <span style="color:#555">=</span> var(<span style="color:#c30">&#39;m2&#39;</span>)
</span></span><span style="display:flex;"><span>m1_roots <span style="color:#555">=</span> solve(m1<span style="color:#555">*</span>(m1<span style="color:#555">+</span>coeff) <span style="color:#555">==</span> c1, m1)
</span></span><span style="display:flex;"><span>m2_roots <span style="color:#555">=</span> solve(m2<span style="color:#555">*</span>(m2<span style="color:#555">+</span>coeff) <span style="color:#555">==</span> c3, m2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flag <span style="color:#555">=</span> <span style="color:#c30">b</span><span style="color:#c30">&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">for</span> root <span style="color:#000;font-weight:bold">in</span> m1_roots:
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> root<span style="color:#555">.</span>right() <span style="color:#555">&gt;</span> <span style="color:#f60">0</span>:
</span></span><span style="display:flex;"><span>        flag <span style="color:#555">+=</span> long_to_bytes(<span style="color:#366">int</span>(root<span style="color:#555">.</span>right()))
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">for</span> root <span style="color:#000;font-weight:bold">in</span> m2_roots:
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> root<span style="color:#555">.</span>right() <span style="color:#555">&gt;</span> <span style="color:#f60">0</span>:
</span></span><span style="display:flex;"><span>        flag <span style="color:#555">+=</span> long_to_bytes(<span style="color:#366">int</span>(root<span style="color:#555">.</span>right()))
</span></span><span style="display:flex;"><span><span style="color:#366">print</span>(<span style="color:#c30">f</span><span style="color:#c30">&#39;Flag: </span><span style="color:#a00">{</span>flag<span style="color:#555">.</span>decode()<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Flag: <code>HTB{gcd_+_2_*_R@6in_.|5_thi5_@_cro55over_epi5ode?}</code></p>
</blockquote>
<h2 id="mind-in-the-clouds-375-pt">Mind in the Clouds (375 pt) <a href="#mind-in-the-clouds-375-pt" class="anchor">#</a></h2>
<h3 id="initial-analysis-1">Initial Analysis <a href="#initial-analysis-1" class="anchor">#</a></h3>
<p>We were given a source code:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">json</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">signal</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">subprocess</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">socketserver</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">hashlib</span> <span style="color:#069;font-weight:bold">import</span> sha1
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">random</span> <span style="color:#069;font-weight:bold">import</span> randint
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">Crypto.Util.number</span> <span style="color:#069;font-weight:bold">import</span> bytes_to_long, long_to_bytes, inverse
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">ecdsa.ecdsa</span> <span style="color:#069;font-weight:bold">import</span> curve_256, generator_256, Public_key, Private_key, Signature
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">os</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fnames <span style="color:#555">=</span> [<span style="color:#c30">b</span><span style="color:#c30">&#39;subject_kolhen&#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;subject_stommb&#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;subject_danbeer&#39;</span>]
</span></span><span style="display:flex;"><span>nfnames <span style="color:#555">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">ECDSA</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#555">.</span>G <span style="color:#555">=</span> generator_256
</span></span><span style="display:flex;"><span>        self<span style="color:#555">.</span>n <span style="color:#555">=</span> self<span style="color:#555">.</span>G<span style="color:#555">.</span>order()
</span></span><span style="display:flex;"><span>        self<span style="color:#555">.</span>key <span style="color:#555">=</span> randint(<span style="color:#f60">1</span>, self<span style="color:#555">.</span>n <span style="color:#555">-</span> <span style="color:#f60">1</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#555">.</span>pubkey <span style="color:#555">=</span> Public_key(self<span style="color:#555">.</span>G, self<span style="color:#555">.</span>key <span style="color:#555">*</span> self<span style="color:#555">.</span>G)
</span></span><span style="display:flex;"><span>        self<span style="color:#555">.</span>privkey <span style="color:#555">=</span> Private_key(self<span style="color:#555">.</span>pubkey, self<span style="color:#555">.</span>key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">sign</span>(self, fname):
</span></span><span style="display:flex;"><span>        h <span style="color:#555">=</span> sha1(fname)<span style="color:#555">.</span>digest()
</span></span><span style="display:flex;"><span>        nonce <span style="color:#555">=</span> randint(<span style="color:#f60">1</span>, self<span style="color:#555">.</span>n <span style="color:#555">-</span> <span style="color:#f60">1</span>)
</span></span><span style="display:flex;"><span>        sig <span style="color:#555">=</span> self<span style="color:#555">.</span>privkey<span style="color:#555">.</span>sign(bytes_to_long(h), nonce)
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> {<span style="color:#c30">&#34;r&#34;</span>: <span style="color:#366">hex</span>(sig<span style="color:#555">.</span>r)[<span style="color:#f60">2</span>:], <span style="color:#c30">&#34;s&#34;</span>: <span style="color:#366">hex</span>(sig<span style="color:#555">.</span>s)[<span style="color:#f60">2</span>:], <span style="color:#c30">&#34;nonce&#34;</span>: <span style="color:#366">hex</span>(nonce)[<span style="color:#f60">2</span>:]}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">verify</span>(self, fname, r, s):
</span></span><span style="display:flex;"><span>        h <span style="color:#555">=</span> bytes_to_long(sha1(fname)<span style="color:#555">.</span>digest())
</span></span><span style="display:flex;"><span>        r <span style="color:#555">=</span> <span style="color:#366">int</span>(r, <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>        s <span style="color:#555">=</span> <span style="color:#366">int</span>(s, <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>        sig <span style="color:#555">=</span> Signature(r, s)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> self<span style="color:#555">.</span>pubkey<span style="color:#555">.</span>verifies(h, sig):
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">return</span> retrieve_file(fname)
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#39;Signature is not valid</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ecc <span style="color:#555">=</span> ECDSA()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">init_storage</span>():
</span></span><span style="display:flex;"><span>    i <span style="color:#555">=</span> <span style="color:#f60">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">for</span> fname <span style="color:#000;font-weight:bold">in</span> fnames[:<span style="color:#555">-</span><span style="color:#f60">1</span>]:
</span></span><span style="display:flex;"><span>        data <span style="color:#555">=</span> ecc<span style="color:#555">.</span>sign(fname)
</span></span><span style="display:flex;"><span>        r, s <span style="color:#555">=</span> data[<span style="color:#c30">&#39;r&#39;</span>], data[<span style="color:#c30">&#39;s&#39;</span>]
</span></span><span style="display:flex;"><span>        nonce <span style="color:#555">=</span> data[<span style="color:#c30">&#39;nonce&#39;</span>]
</span></span><span style="display:flex;"><span>        nfname <span style="color:#555">=</span> fname<span style="color:#555">.</span>decode() <span style="color:#555">+</span> <span style="color:#c30">&#39;_&#39;</span> <span style="color:#555">+</span> r <span style="color:#555">+</span> <span style="color:#c30">&#39;_&#39;</span> <span style="color:#555">+</span> s <span style="color:#555">+</span> <span style="color:#c30">&#39;_&#39;</span> <span style="color:#555">+</span> nonce[(<span style="color:#f60">14</span> <span style="color:#555">+</span> i):<span style="color:#555">-</span><span style="color:#f60">14</span>]
</span></span><span style="display:flex;"><span>        nfnames<span style="color:#555">.</span>append(nfname)
</span></span><span style="display:flex;"><span>        i <span style="color:#555">+=</span> <span style="color:#f60">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">retrieve_file</span>(fname):
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>        dt <span style="color:#555">=</span> <span style="color:#366">open</span>(fname, <span style="color:#c30">&#39;rb&#39;</span>)<span style="color:#555">.</span>read()
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> dt<span style="color:#555">.</span>hex()
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">except</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#39;The file does not exist!&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">challenge</span>(req):
</span></span><span style="display:flex;"><span>    req<span style="color:#555">.</span>sendall(<span style="color:#c30">b</span><span style="color:#c30">&#39;This is a cloud storage service.</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span> <span style="color:#555">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#c30">b</span><span style="color:#c30">&#39;You can list the files inside and also see their contents if your signatures are valid.</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">while</span> <span style="color:#069;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span>        req<span style="color:#555">.</span>sendall(<span style="color:#c30">b</span><span style="color:#c30">&#39;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">Options:</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">1.List files</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">2.Access a file</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>            payload <span style="color:#555">=</span> json<span style="color:#555">.</span>loads(req<span style="color:#555">.</span>recv(<span style="color:#f60">4096</span>))
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> payload[<span style="color:#c30">&#39;option&#39;</span>] <span style="color:#555">==</span> <span style="color:#c30">&#39;list&#39;</span>:
</span></span><span style="display:flex;"><span>                payload <span style="color:#555">=</span> json<span style="color:#555">.</span>dumps(
</span></span><span style="display:flex;"><span>                    {<span style="color:#c30">&#39;response&#39;</span>: <span style="color:#c30">&#39;success&#39;</span>, <span style="color:#c30">&#39;files&#39;</span>: nfnames})
</span></span><span style="display:flex;"><span>                req<span style="color:#555">.</span>sendall(payload<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">elif</span> payload[<span style="color:#c30">&#39;option&#39;</span>] <span style="color:#555">==</span> <span style="color:#c30">&#39;access&#39;</span>:
</span></span><span style="display:flex;"><span>                fname <span style="color:#555">=</span> payload[<span style="color:#c30">&#39;fname&#39;</span>]
</span></span><span style="display:flex;"><span>                r, s <span style="color:#555">=</span> payload[<span style="color:#c30">&#39;r&#39;</span>], payload[<span style="color:#c30">&#39;s&#39;</span>]
</span></span><span style="display:flex;"><span>                dt <span style="color:#555">=</span> ecc<span style="color:#555">.</span>verify(fname<span style="color:#555">.</span>encode(), r, s)
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">if</span> (<span style="color:#c30">&#39;not exist&#39;</span> <span style="color:#000;font-weight:bold">in</span> dt) <span style="color:#000;font-weight:bold">or</span> (<span style="color:#c30">&#39;not valid&#39;</span> <span style="color:#000;font-weight:bold">in</span> dt):
</span></span><span style="display:flex;"><span>                    payload <span style="color:#555">=</span> json<span style="color:#555">.</span>dumps({<span style="color:#c30">&#39;response&#39;</span>: <span style="color:#c30">&#39;error&#39;</span>, <span style="color:#c30">&#39;message&#39;</span>: dt})
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>                    payload <span style="color:#555">=</span> json<span style="color:#555">.</span>dumps({<span style="color:#c30">&#39;response&#39;</span>: <span style="color:#c30">&#39;success&#39;</span>, <span style="color:#c30">&#39;data&#39;</span>: dt})
</span></span><span style="display:flex;"><span>                req<span style="color:#555">.</span>sendall(payload<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>                payload <span style="color:#555">=</span> json<span style="color:#555">.</span>dumps(
</span></span><span style="display:flex;"><span>                    {<span style="color:#c30">&#39;response&#39;</span>: <span style="color:#c30">&#39;error&#39;</span>, <span style="color:#c30">&#39;message&#39;</span>: <span style="color:#c30">&#39;Invalid option!&#39;</span>})
</span></span><span style="display:flex;"><span>                req<span style="color:#555">.</span>sendall(payload<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">except</span>:
</span></span><span style="display:flex;"><span>            payload <span style="color:#555">=</span> json<span style="color:#555">.</span>dumps(
</span></span><span style="display:flex;"><span>                {<span style="color:#c30">&#39;response&#39;</span>: <span style="color:#c30">&#39;error&#39;</span>, <span style="color:#c30">&#39;message&#39;</span>: <span style="color:#c30">&#39;An error occured!&#39;</span>})
</span></span><span style="display:flex;"><span>            req<span style="color:#555">.</span>sendall(payload<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">incoming</span>(socketserver<span style="color:#555">.</span>BaseRequestHandler):
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">handle</span>(self):
</span></span><span style="display:flex;"><span>        signal<span style="color:#555">.</span>alarm(<span style="color:#f60">30</span>)
</span></span><span style="display:flex;"><span>        req <span style="color:#555">=</span> self<span style="color:#555">.</span>request
</span></span><span style="display:flex;"><span>        challenge(req)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">ReusableTCPServer</span>(socketserver<span style="color:#555">.</span>ForkingMixIn, socketserver<span style="color:#555">.</span>TCPServer):
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">main</span>():
</span></span><span style="display:flex;"><span>    init_storage()
</span></span><span style="display:flex;"><span>    socketserver<span style="color:#555">.</span>TCPServer<span style="color:#555">.</span>allow_reuse_address <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#555">=</span> ReusableTCPServer((<span style="color:#c30">&#34;0.0.0.0&#34;</span>, <span style="color:#f60">1337</span>), incoming)
</span></span><span style="display:flex;"><span>    server<span style="color:#555">.</span>serve_forever()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">if</span> __name__ <span style="color:#555">==</span> <span style="color:#c30">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></td></tr></table>
</div>
</div><p>So, this is an <a href="https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm" target="_blank" rel="noopener">ECDSA</a> challenge. Let&rsquo;s try to analysis the source code part by part.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">main</span>():
</span></span><span style="display:flex;"><span>    init_storage()
</span></span><span style="display:flex;"><span>    socketserver<span style="color:#555">.</span>TCPServer<span style="color:#555">.</span>allow_reuse_address <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#555">=</span> ReusableTCPServer((<span style="color:#c30">&#34;0.0.0.0&#34;</span>, <span style="color:#f60">1337</span>), incoming)
</span></span><span style="display:flex;"><span>    server<span style="color:#555">.</span>serve_forever()
</span></span></code></pre></td></tr></table>
</div>
</div><p>Okay, so this challenge will call <code>init_storage</code> and then turn up the server. Let&rsquo;s check what <code>init_storage</code> do</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>fnames <span style="color:#555">=</span> [<span style="color:#c30">b</span><span style="color:#c30">&#39;subject_kolhen&#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;subject_stommb&#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;subject_danbeer&#39;</span>]
</span></span><span style="display:flex;"><span>nfnames <span style="color:#555">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#555">...</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">init_storage</span>():
</span></span><span style="display:flex;"><span>    i <span style="color:#555">=</span> <span style="color:#f60">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">for</span> fname <span style="color:#000;font-weight:bold">in</span> fnames[:<span style="color:#555">-</span><span style="color:#f60">1</span>]:
</span></span><span style="display:flex;"><span>        data <span style="color:#555">=</span> ecc<span style="color:#555">.</span>sign(fname)
</span></span><span style="display:flex;"><span>        r, s <span style="color:#555">=</span> data[<span style="color:#c30">&#39;r&#39;</span>], data[<span style="color:#c30">&#39;s&#39;</span>]
</span></span><span style="display:flex;"><span>        nonce <span style="color:#555">=</span> data[<span style="color:#c30">&#39;nonce&#39;</span>]
</span></span><span style="display:flex;"><span>        nfname <span style="color:#555">=</span> fname<span style="color:#555">.</span>decode() <span style="color:#555">+</span> <span style="color:#c30">&#39;_&#39;</span> <span style="color:#555">+</span> r <span style="color:#555">+</span> <span style="color:#c30">&#39;_&#39;</span> <span style="color:#555">+</span> s <span style="color:#555">+</span> <span style="color:#c30">&#39;_&#39;</span> <span style="color:#555">+</span> nonce[(<span style="color:#f60">14</span> <span style="color:#555">+</span> i):<span style="color:#555">-</span><span style="color:#f60">14</span>]
</span></span><span style="display:flex;"><span>        nfnames<span style="color:#555">.</span>append(nfname)
</span></span><span style="display:flex;"><span>        i <span style="color:#555">+=</span> <span style="color:#f60">2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Okay, so from the defined filenames, <code>init_storage</code> will only sign <strong>two files</strong> (which is <code>subject_kolhen</code> and <code>subject_stommb</code>), and then store it with format <code>filename_r_s_nonce[(14+i):-14]</code>. $(r, s)$ is the signature that is returned by ECDSA. Usually, in ECDSA scheme, we shouldn&rsquo;t shared our $\text{nonce}$ or reused it, because knowning the $\text{nonce}$ will allow us to derive the secret key. Let&rsquo;s try to remember how does ECDSA signature works first. We can sign a message with ECDSA by doing this:
$$
\tag{1}
s \equiv k^{-1}(h+r\alpha) \mod q
$$
where, $s=\text{signature}$, $k=\text{nonce}$, $h=\text{hash}(\text{msg})$, $\alpha=\text{secret}$.</p>
<p>Hence, if we know $\text{nonce}$, we can derive the $\text{secret}$ by doing this:
$$
\tag{2}
\alpha\equiv(ks-h)r^{-1} \mod q
$$
That&rsquo;s why we shouldn&rsquo;t share the $\text{nonce}$ that we use during signing a message. This challenge leaked the middle bits of the $\text{nonce}$ (First filename leaks ~$144$ middle bits, second filename leaks ~$136$ middle bits). We will keep this in our mind first.</p>
<p>Let&rsquo;s check the challenge code.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">retrieve_file</span>(fname):
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>        dt <span style="color:#555">=</span> <span style="color:#366">open</span>(fname, <span style="color:#c30">&#39;rb&#39;</span>)<span style="color:#555">.</span>read()
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> dt<span style="color:#555">.</span>hex()
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">except</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#39;The file does not exist!&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">challenge</span>(req):
</span></span><span style="display:flex;"><span>    req<span style="color:#555">.</span>sendall(<span style="color:#c30">b</span><span style="color:#c30">&#39;This is a cloud storage service.</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span> <span style="color:#555">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#c30">b</span><span style="color:#c30">&#39;You can list the files inside and also see their contents if your signatures are valid.</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">while</span> <span style="color:#069;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span>        req<span style="color:#555">.</span>sendall(<span style="color:#c30">b</span><span style="color:#c30">&#39;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">Options:</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">1.List files</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">2.Access a file</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>            payload <span style="color:#555">=</span> json<span style="color:#555">.</span>loads(req<span style="color:#555">.</span>recv(<span style="color:#f60">4096</span>))
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> payload[<span style="color:#c30">&#39;option&#39;</span>] <span style="color:#555">==</span> <span style="color:#c30">&#39;list&#39;</span>:
</span></span><span style="display:flex;"><span>                payload <span style="color:#555">=</span> json<span style="color:#555">.</span>dumps(
</span></span><span style="display:flex;"><span>                    {<span style="color:#c30">&#39;response&#39;</span>: <span style="color:#c30">&#39;success&#39;</span>, <span style="color:#c30">&#39;files&#39;</span>: nfnames})
</span></span><span style="display:flex;"><span>                req<span style="color:#555">.</span>sendall(payload<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">elif</span> payload[<span style="color:#c30">&#39;option&#39;</span>] <span style="color:#555">==</span> <span style="color:#c30">&#39;access&#39;</span>:
</span></span><span style="display:flex;"><span>                fname <span style="color:#555">=</span> payload[<span style="color:#c30">&#39;fname&#39;</span>]
</span></span><span style="display:flex;"><span>                r, s <span style="color:#555">=</span> payload[<span style="color:#c30">&#39;r&#39;</span>], payload[<span style="color:#c30">&#39;s&#39;</span>]
</span></span><span style="display:flex;"><span>                dt <span style="color:#555">=</span> ecc<span style="color:#555">.</span>verify(fname<span style="color:#555">.</span>encode(), r, s)
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">if</span> (<span style="color:#c30">&#39;not exist&#39;</span> <span style="color:#000;font-weight:bold">in</span> dt) <span style="color:#000;font-weight:bold">or</span> (<span style="color:#c30">&#39;not valid&#39;</span> <span style="color:#000;font-weight:bold">in</span> dt):
</span></span><span style="display:flex;"><span>                    payload <span style="color:#555">=</span> json<span style="color:#555">.</span>dumps({<span style="color:#c30">&#39;response&#39;</span>: <span style="color:#c30">&#39;error&#39;</span>, <span style="color:#c30">&#39;message&#39;</span>: dt})
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>                    payload <span style="color:#555">=</span> json<span style="color:#555">.</span>dumps({<span style="color:#c30">&#39;response&#39;</span>: <span style="color:#c30">&#39;success&#39;</span>, <span style="color:#c30">&#39;data&#39;</span>: dt})
</span></span><span style="display:flex;"><span>                req<span style="color:#555">.</span>sendall(payload<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>                payload <span style="color:#555">=</span> json<span style="color:#555">.</span>dumps(
</span></span><span style="display:flex;"><span>                    {<span style="color:#c30">&#39;response&#39;</span>: <span style="color:#c30">&#39;error&#39;</span>, <span style="color:#c30">&#39;message&#39;</span>: <span style="color:#c30">&#39;Invalid option!&#39;</span>})
</span></span><span style="display:flex;"><span>                req<span style="color:#555">.</span>sendall(payload<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">except</span>:
</span></span><span style="display:flex;"><span>            payload <span style="color:#555">=</span> json<span style="color:#555">.</span>dumps(
</span></span><span style="display:flex;"><span>                {<span style="color:#c30">&#39;response&#39;</span>: <span style="color:#c30">&#39;error&#39;</span>, <span style="color:#c30">&#39;message&#39;</span>: <span style="color:#c30">&#39;An error occured!&#39;</span>})
</span></span><span style="display:flex;"><span>            req<span style="color:#555">.</span>sendall(payload<span style="color:#555">.</span>encode())
</span></span></code></pre></td></tr></table>
</div>
</div><p>Okay, so basically, we can send two commands:</p>
<ul>
<li>List files</li>
<li>Access file</li>
</ul>
<p>List files command will return two filenames with its signature, and access file will allow us to read the file&rsquo;s content only if we provide the correct signature. Remember that the challenge is actually have three files.</p>
<p>We can deduce that on this challenges, given,</p>
<ul>
<li>Two messages (filename)</li>
<li>Two signatures of the messages</li>
<li>Two leaked middle bits of the used $\text{nonce}$ during signing each messages</li>
</ul>
<p>we need to be able create a valid signature for the third filename, and then access its content.</p>
<h3 id="solution-1">Solution <a href="#solution-1" class="anchor">#</a></h3>
<p>We actually can represent the challenge problems into <a href="https://kel.bz/post/hnp" target="_blank" rel="noopener">Hidden Number Problem</a> which was introduced by Boneh and Venkatesan. There are a lot of existing papers those discussed about these problems (<a href="https://eprint.iacr.org/2020/1506.pdf" target="_blank" rel="noopener">paper1</a>, <a href="https://eprint.iacr.org/2019/023.pdf" target="_blank" rel="noopener">paper2</a>, <a href="https://link.springer.com/chapter/10.1007/978-3-030-51938-4_18" target="_blank" rel="noopener">paper3</a>). I choose to implement the first paper in order to solve this solutions (with some modifications). I will try to explain it.</p>
<p>Basically, given the leaked middle bits of the $k$, we can say that:
$$
\tag{3}
k_{i} = 2^{\ell_{i}}c_{1} + a_{1} + b_{1}
$$
where, $max(k_{bits})=256_{bits}$, $\ell_{i}=max(k_{bits})-leaked_{i_{bits}}$, $a_{i}=2^{56}leaked_{i}$, and $b_{i}$ is the $56$ lsb of the $k_{i}$.</p>
<p>So, in this case, $\ell_{1}$ will be ~$200$ (because $leaked_{i_{bits}}=144$) and $\ell_{2}$ will be ~$192$ (because $leaked_{i_{bits}}=136$). And $c_{1}$ will be $256-144-56=56$ bits, and $c_{2}$ will be $256-136-56=64$ bits.</p>
<p>Remember $\text{eq1}$ where,
$$
s \equiv k^{-1}(h+r\alpha) \mod q
$$
and we have two signatures
$$
\begin{align*}
\tag{4}
s_{1} &amp;\equiv k_{1}^{-1}(h_{1}+r_{1}\alpha) \mod q \\
s_{1}k_{1} &amp;\equiv h_{1}+r_{1}\alpha \mod q \\
\end{align*}
$$</p>
<p>$$
\begin{align*}
\tag{5}
s_{2} &amp;\equiv k_{2}^{-1}(h_{2}+r_{2}\alpha) \mod q \\
s_{2}k_{2} &amp;\equiv h_{2}+r_{2}\alpha \mod q \\
\end{align*}
$$</p>
<p>If we try to do elimination of $\alpha$ between the equations that we have by multiplying first equation with $r_{2}$ and second equation with $r_{1}$, we will get</p>
<p>$$
\begin{align*}
\tag{6}
r_{2}s_{1}k_{1} - r_{1}s_{2}k_{2} &amp;\equiv r_{2}h_{1}+r_{2}r_{1}\alpha - (r_{1}h_{2}+r_{1}r_{2}\alpha) \mod q \\
r_{2}s_{1}k_{1} - r_{1}s_{2}k_{2} &amp;\equiv r_{2}h_{1} - r_{1}h_{2} \mod q \\
k_{1} - r_{2}^{-1}s_{1}^{-1}r_{1}s_{2}k_{2} &amp;\equiv s_{1}^{-1}h_{1} - r_{2}^{-1}s_{1}^{-1}r_{1}h_{2} \mod q \\
k_{1} - s_{1}^{-1}r_{1}s_{2}r_{2}^{-1}k_{2} + s_{1}^{-1}r_{1}r_{2}^{-1}h_{2} - s_{1}^{-1}h_{1}  &amp;\equiv 0 \mod q \\
k_{1} + tk_{2} + u &amp;\equiv 0 \mod q\\
\end{align*}
$$
where $t=-s_{1}^{-1}r_{1}s_{2}r_{2}^{-1}$ and $u=s_{1}^{-1}r_{1}r_{2}^{-1}h_{2} - s_{1}^{-1}h_{1}$</p>
<p>Remember $\text{eq3}$ where we actually can expand the $k$ further. Putting it to $\text{eq6}$.</p>
<p>$$
\begin{align*}
\tag{7}
2^{\ell_{1}}c_{1} + a_{1} + b_{1} + t2^{\ell_{2}}c_{2} + ta_{2} + tb_{2} + u &amp;\equiv 0 \mod q\\
b_{1} + 2^{\ell_{1}}c_{1} + tb_{2} + t2^{\ell_{2}}c_{2} + a_{1} + ta_{2} + u &amp;\equiv 0 \mod q\\
b_{1} + 2^{\ell_{1}}c_{1} + tb_{2} + t2^{\ell_{2}}c_{2} + u' &amp;\equiv 0 \mod q\\
b_{1} + 2^{\ell_{1}}c_{1} + tb_{2} + t2^{\ell_{2}}c_{2} + u' &amp;\equiv 0 \mod q\\
\end{align*}
$$
where $u'= a_{1} + ta_{2} + u$.</p>
<p>Now, notice that $b_{1}$, $c_{1}$, $b_{2}$, $c_{2}$ are small unknowns. Based on the paper, we can construct a lattice where the result will contains 4 linear equations with 4 unknowns. Now, below is the lattice that I use.
$$
B =
\begin{bmatrix}
K &amp; K2^{\ell_{1}} &amp; Kt &amp; Kt2^{\ell_{2}} &amp; u' \\
0 &amp; Kq &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; Kq &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; Kq &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; q \\
\end{bmatrix}
$$
where for this challenge, I choose $K=2^{56}$ ($K$ is the expected bound for $b_{1}, c_{1}, b_{2}, c_{2}$). I know that $c_{2}$ value is expected to be larger than $K$ (remember that $c_{2}$ bits length should be around $64$), but this is enough for some cases (Refer to Extra Notes below).</p>
<p>Notes that the lattice is slightly different from the example in the paper, because on this challenge, the total leaked middle bits that we got on signature 1 and signature 2 is difference ($leaked_{1_{bits}}=~144$ and $leaked_{1_{bits}}=~136$). Hence, the $\ell_i$ value is difference.</p>
<p>Using this basis and reduce it with $LLL$, we will got matrix 5x5, where it contains vector
$$
v_{i} = (x_{0}Kb_{1}, x_{1}Kc_{1}, x_{2}Kb_{2}, x_{3}Kc_{2}, y_{i})
$$
where $x_{i}K$ is the coefficients of the linear equation and $y_{i}$ is the result of the linear equation.</p>
<p>Just like the paper said, the first 4 vector is actually a linear equation of 4 unknown variables. So the vector is basically represents:
$$
x_{0}Kb_{1} + x_{1}Kc_{1} + x_{2}Kb_{2} + x_{3}Kc_{2} - y_{i} = 0
$$
Solving the equations, we will be able to retrieve the $k_{1}$ and $k_{2}$ by putting the result into $\text{eq3}$. Refer to $\text{eq2}$, now we can recover the $\text{secret}$ ($\alpha$). After that, we can use the given ECDSA class in the source code to sign the third message <code>subject_danbeer</code>, and send it to the server. The server will give the content (which contains the flag) to us.</p>
<p><p class="markdown-image">
  <img src="https://i.imgur.com/7jiwdNd.png" alt=""  />
</p></p>
<blockquote>
<p>Flag: <code>HTB{y0u_4r3_th3_m4st3r_0f_LLL}</code></p>
</blockquote>
<h3 id="extra-notes">Extra notes <a href="#extra-notes" class="anchor">#</a></h3>
<p>The solution is unstable, which after testing in the local, I found out that we can only apply our constructed lattice only if the bits length of the $c_2$ is &lt; $63$ bits. So, during the challenge, what I do is simply restart the docker so many times, until the $c_2$ value is &lt; $63$ bits.</p>
<p>I believe one of the reason of this unstable result is due to the $K$ value that I set is $2^{56}$. I&rsquo;m pretty sure that my lattice can be improved so that it can recover the $\text{nonce}$ even though the $c_2$ bits length is between ${63,64}$ bits. Also in the paper, it is stated that</p>
<blockquote>
<p>The determinant bounds guarantee that we will find one short lattice vector, but do not guarantee that we will find four short lattice vectors. For that, we rely on the heuristic that the reduced vectors of a random lattice are close to the same length.</p>
</blockquote>
<p>So maybe, it is expected that we might need to do several attempts to break the given ECDSA system.</p>
<h3 id="full-script-1">Full Script <a href="#full-script-1" class="anchor">#</a></h3>
<p>I use sage to run this script</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">pwn</span> <span style="color:#069;font-weight:bold">import</span> <span style="color:#555">*</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">Crypto.Util.number</span> <span style="color:#069;font-weight:bold">import</span> <span style="color:#555">*</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">json</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">hashlib</span> <span style="color:#069;font-weight:bold">import</span> sha1
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">ecdsa.ecdsa</span> <span style="color:#069;font-weight:bold">import</span> generator_256, Public_key, Private_key, Signature
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">binascii</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">retrieve_file</span>(fname):
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>        dt <span style="color:#555">=</span> <span style="color:#366">open</span>(fname, <span style="color:#c30">&#39;rb&#39;</span>)<span style="color:#555">.</span>read()
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> dt<span style="color:#555">.</span>hex()
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">except</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#39;The file does not exist!&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">ECDSA</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">def</span> __init__(self, key<span style="color:#555">=-</span><span style="color:#f60">1</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#555">.</span>G <span style="color:#555">=</span> generator_256
</span></span><span style="display:flex;"><span>        self<span style="color:#555">.</span>n <span style="color:#555">=</span> self<span style="color:#555">.</span>G<span style="color:#555">.</span>order()
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> key <span style="color:#555">==</span> <span style="color:#555">-</span><span style="color:#f60">1</span>:
</span></span><span style="display:flex;"><span>            self<span style="color:#555">.</span>key <span style="color:#555">=</span> randint(<span style="color:#f60">1</span>, self<span style="color:#555">.</span>n <span style="color:#555">-</span> <span style="color:#f60">1</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            self<span style="color:#555">.</span>key <span style="color:#555">=</span> key
</span></span><span style="display:flex;"><span>        self<span style="color:#555">.</span>pubkey <span style="color:#555">=</span> Public_key(self<span style="color:#555">.</span>G, self<span style="color:#555">.</span>key <span style="color:#555">*</span> self<span style="color:#555">.</span>G)
</span></span><span style="display:flex;"><span>        self<span style="color:#555">.</span>privkey <span style="color:#555">=</span> Private_key(self<span style="color:#555">.</span>pubkey, self<span style="color:#555">.</span>key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">sign</span>(self, fname):
</span></span><span style="display:flex;"><span>        h <span style="color:#555">=</span> sha1(fname)<span style="color:#555">.</span>digest()
</span></span><span style="display:flex;"><span>        nonce <span style="color:#555">=</span> randint(<span style="color:#f60">1</span>, self<span style="color:#555">.</span>n <span style="color:#555">-</span> <span style="color:#f60">1</span>)
</span></span><span style="display:flex;"><span>        sig <span style="color:#555">=</span> self<span style="color:#555">.</span>privkey<span style="color:#555">.</span>sign(bytes_to_long(h), nonce)
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> {<span style="color:#c30">&#34;r&#34;</span>: <span style="color:#366">hex</span>(sig<span style="color:#555">.</span>r)[<span style="color:#f60">2</span>:], <span style="color:#c30">&#34;s&#34;</span>: <span style="color:#366">hex</span>(sig<span style="color:#555">.</span>s)[<span style="color:#f60">2</span>:], <span style="color:#c30">&#34;nonce&#34;</span>: <span style="color:#366">hex</span>(nonce)[<span style="color:#f60">2</span>:]}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">verify</span>(self, fname, r, s):
</span></span><span style="display:flex;"><span>        h <span style="color:#555">=</span> bytes_to_long(sha1(fname)<span style="color:#555">.</span>digest())
</span></span><span style="display:flex;"><span>        r <span style="color:#555">=</span> <span style="color:#366">int</span>(r, <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>        s <span style="color:#555">=</span> <span style="color:#366">int</span>(s, <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>        sig <span style="color:#555">=</span> Signature(r, s)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> self<span style="color:#555">.</span>pubkey<span style="color:#555">.</span>verifies(h, sig):
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">return</span> retrieve_file(fname)
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#39;Signature is not valid</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">list_files</span>(conn):
</span></span><span style="display:flex;"><span>    conn<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;a file</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;{&#34;option&#34;: &#34;list&#34;}&#39;</span>)
</span></span><span style="display:flex;"><span>    response <span style="color:#555">=</span> json<span style="color:#555">.</span>loads(conn<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>)<span style="color:#555">.</span>strip())
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> response[<span style="color:#c30">&#39;files&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">access_file</span>(conn, fname, r, s):
</span></span><span style="display:flex;"><span>    payload <span style="color:#555">=</span> json<span style="color:#555">.</span>dumps({
</span></span><span style="display:flex;"><span>        <span style="color:#c30">&#39;option&#39;</span>: <span style="color:#c30">&#39;access&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#c30">&#39;fname&#39;</span>: fname,
</span></span><span style="display:flex;"><span>        <span style="color:#c30">&#39;r&#39;</span>: r,
</span></span><span style="display:flex;"><span>        <span style="color:#c30">&#39;s&#39;</span>: s,
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    conn<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;a file</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>, payload<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>    response <span style="color:#555">=</span> conn<span style="color:#555">.</span>recvuntil(<span style="color:#c30">b</span><span style="color:#c30">&#39;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> json<span style="color:#555">.</span>loads(response)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>url <span style="color:#555">=</span> <span style="color:#c30">&#39;localhost:1337&#39;</span>
</span></span><span style="display:flex;"><span>host <span style="color:#555">=</span> url<span style="color:#555">.</span>split(<span style="color:#c30">&#39;:&#39;</span>)[<span style="color:#f60">0</span>]
</span></span><span style="display:flex;"><span>port <span style="color:#555">=</span> <span style="color:#366">int</span>(url<span style="color:#555">.</span>split(<span style="color:#c30">&#39;:&#39;</span>)[<span style="color:#f60">1</span>])
</span></span><span style="display:flex;"><span>conn <span style="color:#555">=</span> remote(host, port)
</span></span><span style="display:flex;"><span>files <span style="color:#555">=</span> list_files(conn)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>q <span style="color:#555">=</span> <span style="color:#f60">115792089210356248762697446949407573529996955224135760342422259061068512044369</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Get first signature with its leaked nonce</span>
</span></span><span style="display:flex;"><span>fname1 <span style="color:#555">=</span> (files[<span style="color:#f60">0</span>]<span style="color:#555">.</span>split(<span style="color:#c30">&#39;_&#39;</span>)[<span style="color:#f60">0</span>] <span style="color:#555">+</span> <span style="color:#c30">&#39;_&#39;</span> <span style="color:#555">+</span> files[<span style="color:#f60">0</span>]<span style="color:#555">.</span>split(<span style="color:#c30">&#39;_&#39;</span>)[<span style="color:#f60">1</span>])<span style="color:#555">.</span>encode()
</span></span><span style="display:flex;"><span>h1 <span style="color:#555">=</span> bytes_to_long(sha1(fname1)<span style="color:#555">.</span>digest())
</span></span><span style="display:flex;"><span>r1 <span style="color:#555">=</span> <span style="color:#366">int</span>(files[<span style="color:#f60">0</span>]<span style="color:#555">.</span>split(<span style="color:#c30">&#39;_&#39;</span>)[<span style="color:#f60">2</span>], <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>s1 <span style="color:#555">=</span> <span style="color:#366">int</span>(files[<span style="color:#f60">0</span>]<span style="color:#555">.</span>split(<span style="color:#c30">&#39;_&#39;</span>)[<span style="color:#f60">3</span>], <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>leaked1 <span style="color:#555">=</span> <span style="color:#366">int</span>(files[<span style="color:#f60">0</span>]<span style="color:#555">.</span>split(<span style="color:#c30">&#39;_&#39;</span>)[<span style="color:#f60">4</span>], <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>a1 <span style="color:#555">=</span> leaked1<span style="color:#555">*</span>(<span style="color:#f60">2</span><span style="color:#555">**</span><span style="color:#f60">56</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Get second signature with its leaked nonce</span>
</span></span><span style="display:flex;"><span>fname2 <span style="color:#555">=</span> (files[<span style="color:#f60">1</span>]<span style="color:#555">.</span>split(<span style="color:#c30">&#39;_&#39;</span>)[<span style="color:#f60">0</span>] <span style="color:#555">+</span> <span style="color:#c30">&#39;_&#39;</span> <span style="color:#555">+</span> files[<span style="color:#f60">1</span>]<span style="color:#555">.</span>split(<span style="color:#c30">&#39;_&#39;</span>)[<span style="color:#f60">1</span>])<span style="color:#555">.</span>encode()
</span></span><span style="display:flex;"><span>h2 <span style="color:#555">=</span> bytes_to_long(sha1(fname2)<span style="color:#555">.</span>digest())
</span></span><span style="display:flex;"><span>r2 <span style="color:#555">=</span> <span style="color:#366">int</span>(files[<span style="color:#f60">1</span>]<span style="color:#555">.</span>split(<span style="color:#c30">&#39;_&#39;</span>)[<span style="color:#f60">2</span>], <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>s2 <span style="color:#555">=</span> <span style="color:#366">int</span>(files[<span style="color:#f60">1</span>]<span style="color:#555">.</span>split(<span style="color:#c30">&#39;_&#39;</span>)[<span style="color:#f60">3</span>], <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>leaked2 <span style="color:#555">=</span> <span style="color:#366">int</span>(files[<span style="color:#f60">1</span>]<span style="color:#555">.</span>split(<span style="color:#c30">&#39;_&#39;</span>)[<span style="color:#f60">4</span>], <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>a2 <span style="color:#555">=</span> leaked2<span style="color:#555">*</span>(<span style="color:#f60">2</span><span style="color:#555">**</span><span style="color:#f60">56</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Craft our lattice</span>
</span></span><span style="display:flex;"><span>k <span style="color:#555">=</span> <span style="color:#f60">2</span><span style="color:#555">**</span><span style="color:#f60">56</span>
</span></span><span style="display:flex;"><span>inv_s1 <span style="color:#555">=</span> <span style="color:#366">int</span>(inverse_mod(s1, q))
</span></span><span style="display:flex;"><span>inv_r2 <span style="color:#555">=</span> <span style="color:#366">int</span>(inverse_mod(r2, q))
</span></span><span style="display:flex;"><span>t <span style="color:#555">=</span> (<span style="color:#555">-</span>inv_s1<span style="color:#555">*</span>s2<span style="color:#555">*</span>r1<span style="color:#555">*</span>inv_r2) <span style="color:#555">%</span> q
</span></span><span style="display:flex;"><span>u <span style="color:#555">=</span> (inv_s1<span style="color:#555">*</span>r1<span style="color:#555">*</span>h2<span style="color:#555">*</span>inv_r2 <span style="color:#555">-</span> inv_s1<span style="color:#555">*</span>h1) <span style="color:#555">%</span> q
</span></span><span style="display:flex;"><span>uu <span style="color:#555">=</span> a1 <span style="color:#555">+</span> t<span style="color:#555">*</span>a2 <span style="color:#555">+</span> u
</span></span><span style="display:flex;"><span>m <span style="color:#555">=</span> Matrix([
</span></span><span style="display:flex;"><span>    [k, k<span style="color:#555">*</span><span style="color:#f60">2</span><span style="color:#555">**</span><span style="color:#f60">200</span>, k<span style="color:#555">*</span>t, k<span style="color:#555">*</span>t<span style="color:#555">*</span><span style="color:#f60">2</span><span style="color:#555">**</span><span style="color:#f60">192</span>, uu],
</span></span><span style="display:flex;"><span>    [<span style="color:#f60">0</span>, k<span style="color:#555">*</span>q, <span style="color:#f60">0</span>, <span style="color:#f60">0</span>, <span style="color:#f60">0</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#f60">0</span>, <span style="color:#f60">0</span>, k<span style="color:#555">*</span>q, <span style="color:#f60">0</span>, <span style="color:#f60">0</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#f60">0</span>, <span style="color:#f60">0</span>, <span style="color:#f60">0</span>, k<span style="color:#555">*</span>q, <span style="color:#f60">0</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#f60">0</span>, <span style="color:#f60">0</span>, <span style="color:#f60">0</span>, <span style="color:#f60">0</span>,   q],
</span></span><span style="display:flex;"><span>])
</span></span><span style="display:flex;"><span>m <span style="color:#555">=</span> m<span style="color:#555">.</span>LLL()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Now, from the reduced basis, we try to solve the equations</span>
</span></span><span style="display:flex;"><span>new_m <span style="color:#555">=</span> []
</span></span><span style="display:flex;"><span>res <span style="color:#555">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">for</span> row <span style="color:#000;font-weight:bold">in</span> m[:<span style="color:#555">-</span><span style="color:#f60">1</span>]:
</span></span><span style="display:flex;"><span>    real_row <span style="color:#555">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">for</span> val <span style="color:#000;font-weight:bold">in</span> row[:<span style="color:#555">-</span><span style="color:#f60">1</span>]:
</span></span><span style="display:flex;"><span>        real_row<span style="color:#555">.</span>append(val <span style="color:#555">/</span> k)
</span></span><span style="display:flex;"><span>    new_m<span style="color:#555">.</span>append(real_row)
</span></span><span style="display:flex;"><span>    res<span style="color:#555">.</span>append(<span style="color:#555">-</span>row[<span style="color:#555">-</span><span style="color:#f60">1</span>])
</span></span><span style="display:flex;"><span>new_m <span style="color:#555">=</span> Matrix(new_m)
</span></span><span style="display:flex;"><span>res <span style="color:#555">=</span> vector(res)
</span></span><span style="display:flex;"><span>ans <span style="color:#555">=</span> new_m<span style="color:#555">.</span>solve_right(res)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Now, we can get the nonce</span>
</span></span><span style="display:flex;"><span>k1 <span style="color:#555">=</span> ans[<span style="color:#f60">0</span>] <span style="color:#555">+</span> ans[<span style="color:#f60">1</span>]<span style="color:#555">*</span><span style="color:#f60">2</span><span style="color:#555">**</span><span style="color:#f60">200</span> <span style="color:#555">+</span> a1
</span></span><span style="display:flex;"><span>k2 <span style="color:#555">=</span> ans[<span style="color:#f60">2</span>] <span style="color:#555">+</span> ans[<span style="color:#f60">3</span>]<span style="color:#555">*</span><span style="color:#f60">2</span><span style="color:#555">**</span><span style="color:#f60">192</span> <span style="color:#555">+</span> a2
</span></span><span style="display:flex;"><span><span style="color:#366">print</span>(<span style="color:#c30">&#39;nonce_1:&#39;</span>, <span style="color:#366">hex</span>(k1))
</span></span><span style="display:flex;"><span><span style="color:#366">print</span>(<span style="color:#c30">&#39;nonce_2:&#39;</span>, <span style="color:#366">hex</span>(k2))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># From the retrieved nonce, we get the secret (key)</span>
</span></span><span style="display:flex;"><span>secret <span style="color:#555">=</span> ((k1 <span style="color:#555">*</span> s1 <span style="color:#555">-</span> h1) <span style="color:#555">*</span> inverse_mod(r1, q)) <span style="color:#555">%</span> q
</span></span><span style="display:flex;"><span><span style="color:#366">print</span>(<span style="color:#c30">&#39;secret:&#39;</span>, secret)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Sign &#39;subject_danbeer&#39;</span>
</span></span><span style="display:flex;"><span>new_ecc <span style="color:#555">=</span> ECDSA(secret)
</span></span><span style="display:flex;"><span>filename <span style="color:#555">=</span> <span style="color:#c30">b</span><span style="color:#c30">&#39;subject_danbeer&#39;</span>
</span></span><span style="display:flex;"><span>signature <span style="color:#555">=</span> new_ecc<span style="color:#555">.</span>sign(<span style="color:#c30">b</span><span style="color:#c30">&#39;subject_danbeer&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Send its signature to the server</span>
</span></span><span style="display:flex;"><span>resp <span style="color:#555">=</span> access_file(conn, filename<span style="color:#555">.</span>decode(), signature[<span style="color:#c30">&#39;r&#39;</span>], signature[<span style="color:#c30">&#39;s&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#366">print</span>(<span style="color:#c30">&#39;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">Response:&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#366">print</span>(binascii<span style="color:#555">.</span>unhexlify(resp[<span style="color:#c30">&#39;data&#39;</span>])<span style="color:#555">.</span>decode())
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="social-media">Social Media <a href="#social-media" class="anchor">#</a></h1>
<p>Follow me on <a href="https://twitter.com/chovid99" target="_blank" rel="noopener">twitter</a></p>

      </div>
      
        
  <aside class="toc-container">
    <a href="#" style="font-weight: 700; color: black;">Cyber Apocalypse CTF 2022</a>
    <div class="js-toc">
      <details>
          <summary>Table of Contents
          </summary>
          <div>
              <nav id="TableOfContents">
  <ul>
    <li><a href="#down-the-rabinhole-325-pt">Down the Rabinhole (325 pt)</a>
      <ul>
        <li><a href="#initial-analysis">Initial Analysis</a></li>
        <li><a href="#solution">Solution</a></li>
        <li><a href="#full-script">Full Script</a></li>
      </ul>
    </li>
    <li><a href="#mind-in-the-clouds-375-pt">Mind in the Clouds (375 pt)</a>
      <ul>
        <li><a href="#initial-analysis-1">Initial Analysis</a></li>
        <li><a href="#solution-1">Solution</a></li>
        <li><a href="#extra-notes">Extra notes</a></li>
        <li><a href="#full-script-1">Full Script</a></li>
      </ul>
    </li>
  </ul>
</nav>
          </div>
      </details>
    </div>
  </aside>


      
    </div>

    
        <div class="tags">
            
                <a href="https://chovid99.github.io/tags/writeup">Writeup</a>
            
                <a href="https://chovid99.github.io/tags/htb">htb</a>
            
                <a href="https://chovid99.github.io/tags/cyberapocalypsectf">CyberApocalypseCTF</a>
            
                <a href="https://chovid99.github.io/tags/rsa">RSA</a>
            
                <a href="https://chovid99.github.io/tags/ecdsa">ECDSA</a>
            
                <a href="https://chovid99.github.io/tags/lll">LLL</a>
            
                <a href="https://chovid99.github.io/tags/hnp">HNP</a>
            
                <a href="https://chovid99.github.io/tags/crypto">crypto</a>
            
                <a href="https://chovid99.github.io/tags/2022">2022</a>
            
        </div>
    
    
    
  <div id="comment">
    
    
  </div>


</section>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="/js/tocbot.min.js"></script>

<script type="text/javascript">
  tocbot.init({
      
      tocSelector: '.js-toc',
      
      contentSelector: '.js-toc-content',
      headingSelector: 'h1, h2, h3',
      orderedList: false,
      headingLabelCallback: s => s.substr(0, s.length-2),
      collapseDepth: 2
  });
  function initTOC() {
    var windowWidth = 1316;
    var $block_2 = $(".toc-container");
    var lastLeft = parseFloat($block_2.css("left").slice(0, -2))*(100/($(window).width()));
    $block_2.css("left", (lastLeft/lastWindowWidth)*$(window).width() + "vw");
  }
  window.onload = initTOC;

  var lastWindowWidth = $(window).width();
  $(window).resize(function() {
    var $block_2 = $(".toc-container");
    var lastLeft = parseFloat($block_2.css("left").slice(0, -2))*(100/($(window).width()));
    $block_2.css("left", (lastLeft/lastWindowWidth)*$(window).width() + "vw");
    lastWindowWidth = $(window).width();
  });
</script>

    </main>
    
    <footer id="footer">
    
        <div id="social">


    <a class="symbol" href="https://github.com/Chovid99" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28"  viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>Github</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)">
            <g id="Github" transform="translate(264.000000, 939.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M35.9985,13 C22.746,13 12,23.7870921 12,37.096644 C12,47.7406712 18.876,56.7718301 28.4145,59.9584121 C29.6145,60.1797862 30.0525,59.4358488 30.0525,58.7973276 C30.0525,58.2250681 30.0315,56.7100863 30.0195,54.6996482 C23.343,56.1558981 21.9345,51.4693938 21.9345,51.4693938 C20.844,48.6864054 19.2705,47.9454799 19.2705,47.9454799 C17.091,46.4500754 19.4355,46.4801943 19.4355,46.4801943 C21.843,46.6503662 23.1105,48.9634994 23.1105,48.9634994 C25.2525,52.6455377 28.728,51.5823398 30.096,50.9649018 C30.3135,49.4077535 30.9345,48.3460615 31.62,47.7436831 C26.2905,47.1352808 20.688,45.0691228 20.688,35.8361671 C20.688,33.2052792 21.6225,31.0547881 23.1585,29.3696344 C22.911,28.7597262 22.0875,26.3110578 23.3925,22.9934585 C23.3925,22.9934585 25.4085,22.3459017 29.9925,25.4632101 C31.908,24.9285993 33.96,24.6620468 36.0015,24.6515052 C38.04,24.6620468 40.0935,24.9285993 42.0105,25.4632101 C46.5915,22.3459017 48.603,22.9934585 48.603,22.9934585 C49.9125,26.3110578 49.089,28.7597262 48.8415,29.3696344 C50.3805,31.0547881 51.309,33.2052792 51.309,35.8361671 C51.309,45.0917119 45.6975,47.1292571 40.3515,47.7256117 C41.2125,48.4695491 41.9805,49.9393525 41.9805,52.1877301 C41.9805,55.4089489 41.9505,58.0067059 41.9505,58.7973276 C41.9505,59.4418726 42.3825,60.1918338 43.6005,59.9554002 C53.13,56.7627944 60,47.7376593 60,37.096644 C60,23.7870921 49.254,13 35.9985,13" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>

    <a class="symbol" href="https://twitter.com/Chovid99" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="438.536px" height="438.536px" viewBox="0 0 438.536 438.536" style="enable-background:new 0 0 438.536 438.536;"
	 xml:space="preserve">
<g>
	<path d="M414.41,24.123C398.333,8.042,378.963,0,356.315,0H82.228C59.58,0,40.21,8.042,24.126,24.123
		C8.045,40.207,0.003,59.576,0.003,82.225v274.084c0,22.647,8.042,42.018,24.123,58.102c16.084,16.084,35.454,24.126,58.102,24.126
		h274.084c22.648,0,42.018-8.042,58.095-24.126c16.084-16.084,24.126-35.454,24.126-58.102V82.225
		C438.532,59.576,430.49,40.204,414.41,24.123z M335.471,168.735c0.191,1.713,0.288,4.278,0.288,7.71
		c0,15.989-2.334,32.025-6.995,48.104c-4.661,16.087-11.8,31.504-21.416,46.254c-9.606,14.749-21.074,27.791-34.396,39.115
		c-13.325,11.32-29.311,20.365-47.968,27.117c-18.648,6.762-38.637,10.143-59.953,10.143c-33.116,0-63.76-8.952-91.931-26.836
		c4.568,0.568,9.329,0.855,14.275,0.855c27.6,0,52.439-8.565,74.519-25.7c-12.941-0.185-24.506-4.179-34.688-11.991
		c-10.185-7.803-17.273-17.699-21.271-29.691c4.947,0.76,8.658,1.137,11.132,1.137c4.187,0,9.042-0.76,14.56-2.279
		c-13.894-2.669-25.598-9.562-35.115-20.697c-9.519-11.136-14.277-23.84-14.277-38.114v-0.571
		c10.085,4.755,19.602,7.229,28.549,7.422c-17.321-11.613-25.981-28.265-25.981-49.963c0-10.66,2.758-20.747,8.278-30.264
		c15.035,18.464,33.311,33.213,54.816,44.252c21.507,11.038,44.54,17.227,69.092,18.558c-0.95-3.616-1.427-8.186-1.427-13.704
		c0-16.562,5.853-30.692,17.56-42.399c11.703-11.706,25.837-17.561,42.394-17.561c17.515,0,32.079,6.283,43.688,18.846
		c13.134-2.474,25.892-7.33,38.26-14.56c-4.757,14.652-13.613,25.788-26.55,33.402c12.368-1.716,23.88-4.95,34.537-9.708
		C357.458,149.793,347.462,160.166,335.471,168.735z"/>
</g>
</svg>

    </a>


</div>

    

    <div class="copyright">
    
       © Copyright 
       2022 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       Chovid99
    
    </div>

    
</footer>



  </body>
</html>
